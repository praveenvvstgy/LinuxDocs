<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
  <title>
   slapo-retcode(5) &mdash; Linux manual pages
  </title>
  <link href="../stylesheet/manpages.css" rel="stylesheet" type="text/css"/>
  <link href="../index.html" rel="home" title="slapo-retcode(5) &mdash; Linux manual pages"/>
  <script src="../stylesheet/manpages.js" type="text/javascript" xml:space="preserve">
  </script>
  <link href="../stylesheet/icon.gif" rel="icon" type="image/gif"/>
 </head>
 <body>
  <div class="refentry">
   <a id="slapo-retcode.5" name="slapo-retcode.5" shape="rect">
   </a>
   <div class="titlepage">
   </div>
   <div class="refnamediv">
    <h2>
     Name
    </h2>
    <p>
     slapo&minus;retcode &mdash; return code overlay to
      slapd
    </p>
   </div>
   <div class="refsynopsisdiv">
    <h2>
     Synopsis
    </h2>
    <div class="informalexample">
     <pre class="programlisting" xml:space="preserve">
ETCDIR/slapd.conf
  
</pre>
    </div>
   </div>
   <div class="refsect1">
    <a id="slapo-retcode-5_sect1" name="slapo-retcode-5_sect1" shape="rect">
    </a>
    <h2>
     DESCRIPTION
    </h2>
    <p>
     The
     <em class="replaceable">
      <code>
       retcode
      </code>
     </em>
     overlay to
     <a class="link" href="../htmlman8/slapd.8.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        slapd
       </span>
       (8)
      </span>
     </a>
     is useful to test
      the behavior of clients when server-generated erroneous
      and/or unusual responses occur, e.g. error codes, referrals,
      excessive response times and so on.
    </p>
    <p>
     The error responses are generated according to different
      strategies.
    </p>
    <p>
     In the first case, all operations targeted at a specific
      configurable subtree cause the object related to the request
      DN to be looked up and checked for return code data: a
      response code, plus an optional textual message, an optional
      configurable delay, an optional matched DN field, and, when
      the response code is "referral", a (list of) referral(s).
    </p>
    <p>
     Well-known response codes from standard track documents
      are provided in
     <em class="replaceable">
      <code>
       retcode.conf
      </code>
     </em>
     , which can be
      included after instantiating the overlay.
    </p>
    <p>
     In the second case, objects of classes inherited from the
     <em class="replaceable">
      <code>
       errAbsObject
      </code>
     </em>
     , like
     <em class="replaceable">
      <code>
       errObject
      </code>
     </em>
     or
     <em class="replaceable">
      <code>
       errAuxObject
      </code>
     </em>
     , when
      returned as intermediate responses of a search request, are
      changed into the response dictated by their content.
    </p>
    <p>
     A third mode causes objects to be looked up from the
      underlying database to discover if their class inherits from
     <em class="replaceable">
      <code>
       errABsObject
      </code>
     </em>
     ; in
      that case, their content is used to compute the corresponding
      response.
    </p>
    <p>
     The behavior is disabled by using the
     <em class="replaceable">
      <code>
       manageDSAit
      </code>
     </em>
     control (RFC
      3296); in that case, the resulting object, either present in
      the directory or dynamically generated by the overlay, or
      contained in the request, is handled as usual.
    </p>
    <p>
     The config directives that are specific to the
     <em class="replaceable">
      <code>
       retcode
      </code>
     </em>
     overlay must be
      prefixed by
     <em class="replaceable">
      <code>
       retcode&minus;
      </code>
     </em>
     , to avoid
      conflicts with directives specific to the underlying database
      or to other stacked overlays. The following specific
      directives can be used to configure the retcode overlay:
    </p>
    <div class="variablelist">
     <dl class="variablelist">
      <dt>
       <span class="term">
        <span class="emphasis">
         <em>
          retcode&minus;parent
          &lt;DN&gt;
         </em>
        </span>
       </span>
      </dt>
      <dd>
       <p>
        This directive defines the parent DN where
            dynamically generated entries reside. If not defined,
            the suffix of the database is used.
       </p>
       <p>
        <span class="emphasis">
         <em>
          retcode&minus;item
            &lt;RDN&gt; &lt;errCode&gt; [op=&lt;oplist&gt;]
            [text=&lt;message&gt;]
         </em>
        </span>
        <span class="emphasis">
         <em>
          [ref=&lt;referral&gt;]
            [sleeptime=&lt;sec&gt;]
            [matched=&lt;DN&gt;]
         </em>
        </span>
        <span class="emphasis">
         <em>
          [unsolicited=&lt;OID&gt;[:&lt;data&gt;]]
            [flags=[{pre|post}&minus;]disconnect[,...]]
         </em>
        </span>
       </p>
       <div class="blockquote">
        <blockquote class="blockquote">
         <p>
          A dynamically generated entry, located below
          <em class="replaceable">
           <code>
            retcode&minus;parent
           </code>
          </em>
          .
                The
          <em class="replaceable">
           <code>
            errCode
           </code>
          </em>
          is the
                number of the response code; it can be in any
                format supported by
          <a class="link" href="../htmlman3/strtol.3.html" shape="rect" target="_top">
           <span class="citerefentry">
            <span class="refentrytitle">
             strtol
            </span>
            (3)
           </span>
          </a>
          . The
                optional
          <em class="replaceable">
           <code>
            oplist
           </code>
          </em>
          is a list of
                operations that cause response code generation; if
                absent, all operations are affected. The
          <em class="replaceable">
           <code>
            matched
           </code>
          </em>
          field is
                the matched DN that is returned along with the
                error, while the
          <em class="replaceable">
           <code>
            text
           </code>
          </em>
          field is an
                optional diagnostics message. The
          <em class="replaceable">
           <code>
            ref
           </code>
          </em>
          field is only
                allowed for the
          <em class="replaceable">
           <code>
            referral
           </code>
          </em>
          response
                code. The
          <em class="replaceable">
           <code>
            sleeptime
           </code>
          </em>
          field
                causes
          <a class="link" href="../htmlman8/slapd.8.html" shape="rect" target="_top">
           <span class="citerefentry">
            <span class="refentrytitle">
             slapd
            </span>
            (8)
           </span>
          </a>
          to sleep
                the specified number of seconds before proceeding
                with the operation. The
          <em class="replaceable">
           <code>
            unsolicited
           </code>
          </em>
          field
                can be used to cause the return of an RFC 4511
                unsolicited response message; if
          <code class="constant">
           OID
          </code>
          is not "0", an extended
                response is generated, with the optional
          <em class="replaceable">
           <code>
            data
           </code>
          </em>
          appended. If
          <em class="replaceable">
           <code>
            flags
           </code>
          </em>
          contains
          <em class="replaceable">
           <code>
            disconnect
           </code>
          </em>
          , or
          <em class="replaceable">
           <code>
            pre&minus;disconnect
           </code>
          </em>
          ,
          <a class="link" href="../htmlman8/slapd.8.html" shape="rect" target="_top">
           <span class="citerefentry">
            <span class="refentrytitle">
             slapd
            </span>
            (8)
           </span>
          </a>
          disconnects abruptly, without notice;
          <em class="replaceable">
           <code>
            post&minus;disconnect
           </code>
          </em>
          causes disconnection right after sending response
                as appropriate.
         </p>
        </blockquote>
       </div>
      </dd>
      <dt>
       <span class="term">
        retcode&minus;indir
       </span>
      </dt>
      <dd>
       <p>
        Enables exploitation of in-directory stored
            errAbsObject. May result in a lot of unnecessary
            overhead.
       </p>
      </dd>
      <dt>
       <span class="term">
        <span class="emphasis">
         <em>
          retcode&minus;sleep
          [&minus;]&lt;n&gt;
         </em>
        </span>
       </span>
      </dt>
      <dd>
       <p>
        Defines a sleep time in seconds that is spent before
            actually handling any operation. If negative, a random
            time between 0 and the absolute value of the argument
            is used.
       </p>
      </dd>
     </dl>
    </div>
   </div>
   <div class="refsect1">
    <a id="slapo-retcode-5_sect2" name="slapo-retcode-5_sect2" shape="rect">
    </a>
    <h2>
     SCHEMA
    </h2>
    <p>
     The
     <em class="replaceable">
      <code>
       retcode
      </code>
     </em>
     overlay utilizes the "return code" schema described herein.
      This schema is specifically designed for use with this
      overlay and is not intended to be used otherwise. It is also
      noted that the schema described here is
     <span class="emphasis">
      <em>
       a work in
      </em>
     </span>
     <em class="replaceable">
      <code>
       progress
      </code>
     </em>
     , and hence subject
      to change without notice. The schema is loaded automatically
      by the overlay.
    </p>
    <p>
     The schema includes a number of object classes and
      associated attribute types as described below.
    </p>
    <p>
     The error code:
    </p>
    <div class="blockquote">
     <blockquote class="blockquote">
      <p>
       ( 1.3.6.1.4.1.4203.666.11.4.1.1 NAME ( 'errCode' )
          DESC 'LDAP error code' EQUALITY integerMatch ORDERING
          integerOrderingMatch SYNTAX 1.3.6.1.4.1.1466.115.121.1.27
          SINGLE&minus;VALUE )
      </p>
     </blockquote>
    </div>
    <p>
     The operations that trigger the response code:
    </p>
    <div class="blockquote">
     <blockquote class="blockquote">
      <p>
       ( 1.3.6.1.4.1.4203.666.11.4.1.2 NAME ( 'errOp' ) DESC
          'Operations the errObject applies to' EQUALITY
          caseIgnoreMatch SUBSTR caseIgnoreSubstringsMatch SYNTAX
          1.3.6.1.4.1.1466.115.121.1.15 )
      </p>
     </blockquote>
    </div>
    <p>
     The text message:
    </p>
    <div class="blockquote">
     <blockquote class="blockquote">
      <p>
       ( 1.3.6.1.4.1.4203.666.11.4.1.3 NAME ( 'errText' )
          DESC 'LDAP error textual description' EQUALITY
          caseIgnoreMatch SUBSTR caseIgnoreSubstringsMatch SYNTAX
          1.3.6.1.4.1.1466.115.121.1.15 SINGLE&minus;VALUE )
      </p>
     </blockquote>
    </div>
    <p>
     The sleep time before the response is actually returned to
      the client:
    </p>
    <div class="blockquote">
     <blockquote class="blockquote">
      <p>
       ( 1.3.6.1.4.1.4203.666.11.4.1.4 NAME ( 'errSleepTime'
          ) DESC 'Time to wait before returning the error' EQUALITY
          integerMatch SYNTAX 1.3.6.1.4.1.1466.115.121.1.27
          SINGLE&minus;VALUE )
      </p>
     </blockquote>
    </div>
    <p>
     The matched DN returned to the client:
    </p>
    <div class="blockquote">
     <blockquote class="blockquote">
      <p>
       ( 1.3.6.1.4.1.4203.666.11.4.1.5 NAME ( 'errMatchedDN'
          ) DESC 'Value to be returned as matched DN' EQUALITY
          distinguishedNameMatch SYNTAX
          1.3.6.1.4.1.1466.115.121.1.12 SINGLE&minus;VALUE )
      </p>
     </blockquote>
    </div>
    <p>
     The OID to be returned as extended response OID in RFC
      4511 unsolicited responses ("0" generates a regular response
      with msgid set to 0):
    </p>
    <div class="blockquote">
     <blockquote class="blockquote">
      <p>
       ( 1.3.6.1.4.1.4203.666.11.4.1.6 NAME (
          'errUnsolicitedOID' ) DESC 'OID to be returned within
          unsolicited response' EQUALITY objectIdentifierMatch
          SYNTAX 1.3.6.1.4.1.1466.115.121.1.38 SINGLE&minus;VALUE
          )
      </p>
     </blockquote>
    </div>
    <p>
     The octet string to be returned as extended response data
      in RFC 4511 unsolicited response:
    </p>
    <div class="blockquote">
     <blockquote class="blockquote">
      <p>
       ( 1.3.6.1.4.1.4203.666.11.4.1.7 NAME (
          'errUnsolicitedData' ) DESC 'Data to be returned within
          unsolicited response' SYNTAX
          1.3.6.1.4.1.1466.115.121.1.40 SINGLE&minus;VALUE )
      </p>
     </blockquote>
    </div>
    <p>
     If TRUE,
     <a class="link" href="../htmlman8/slapd.8.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        slapd
       </span>
       (8)
      </span>
     </a>
     disconnects
      abruptly without notice; if FALSE, it disconnects after
      sending response as appropriate:
    </p>
    <div class="blockquote">
     <blockquote class="blockquote">
      <p>
       ( 1.3.6.1.4.1.4203.666.11.4.1.8 NAME ( 'errDisconnect'
          ) DESC 'Disconnect without notice' SYNTAX
          1.3.6.1.4.1.1466.115.121.1.7 SINGLE&minus;VALUE )
      </p>
     </blockquote>
    </div>
    <p>
     The abstract class that triggers the overlay:
    </p>
    <div class="blockquote">
     <blockquote class="blockquote">
      <p>
       ( 1.3.6.1.4.1.4203.666.11.4.3.0 NAME ( 'errAbsObject'
          ) SUP top ABSTRACT MUST ( errCode ) MAY ( cn $
          description $ errOp $ errText $ errSleepTime $
          errMatchedDN ) )
      </p>
     </blockquote>
    </div>
    <p>
     The standalone structural objectclass for specifically
      created data:
    </p>
    <div class="blockquote">
     <blockquote class="blockquote">
      <p>
       ( 1.3.6.1.4.1.4203.666.11.4.3.1 NAME ( 'errObject' )
          SUP errAbsObject STRUCTURAL )
      </p>
     </blockquote>
    </div>
    <p>
     The auxiliary objectclass to alter the behavior of
      existing objects:
    </p>
    <div class="blockquote">
     <blockquote class="blockquote">
      <p>
       ( 1.3.6.1.4.1.4203.666.11.4.3.2 NAME ( 'errAuxObject'
          ) SUP errAbsObject AUXILIARY )
      </p>
     </blockquote>
    </div>
   </div>
   <div class="refsect1">
    <a id="slapo-retcode-5_sect3" name="slapo-retcode-5_sect3" shape="rect">
    </a>
    <h2>
     EXAMPLE
    </h2>
    <div class="blockquote">
     <blockquote class="blockquote">
      <div class="informalexample">
       <pre class="programlisting" xml:space="preserve">
overlay         retcode
retcode&minus;parent  "ou=RetCodes,dc=example,dc=com"

# retcode.conf is found in tests/data/ of the source tree
include         ./retcode.conf

# Wait 10 seconds, then return success (0x00)
retcode&minus;item    "cn=Success after 10 seconds" 0x00 sleeptime=10
# Wait 10 seconds, then return timelimitExceeded (0x03)
retcode&minus;item    "cn=Timelimit after 10 seconds" 0x03 sleeptime=10
</pre>
      </div>
     </blockquote>
    </div>
   </div>
   <div class="refsect1">
    <a id="slapo-retcode-5_sect4" name="slapo-retcode-5_sect4" shape="rect">
    </a>
    <h2>
     FILES
    </h2>
    <div class="variablelist">
     <dl class="variablelist">
      <dt>
       <span class="term">
        ETCDIR/slapd.conf
       </span>
      </dt>
      <dd>
       <p>
        default slapd configuration file
       </p>
      </dd>
     </dl>
    </div>
   </div>
   <div class="refsect1">
    <a id="slapo-retcode-5_sect5" name="slapo-retcode-5_sect5" shape="rect">
    </a>
    <h2>
     SEE ALSO
    </h2>
    <p>
     <a class="link" href="../htmlman5/slapd.conf.5.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        slapd.conf
       </span>
       (5)
      </span>
     </a>
     ,
     <a class="link" href="../htmlman5/slapd-config.5.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        slapd-config
       </span>
       (5)
      </span>
     </a>
     ,
     <a class="link" href="../htmlman8/slapd.8.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        slapd
       </span>
       (8)
      </span>
     </a>
     . The
     <a class="link" href="../htmlman5/slapo-retcode.5.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        slapo-retcode
       </span>
       (5)
      </span>
     </a>
     overlay
      supports dynamic configuration via
     <em class="replaceable">
      <code>
       back-config
      </code>
     </em>
     .
    </p>
   </div>
   <div class="refsect1">
    <a id="slapo-retcode-5_sect6" name="slapo-retcode-5_sect6" shape="rect">
    </a>
    <h2>
     ACKNOWLEDGEMENTS
    </h2>
    <p>
     This module was written in 2005 by Pierangelo Masarati for
      SysNet s.n.c.
    </p>
   </div>
  </div>
 </body>
</html>
