<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
  <title>
   utimensat(2) &mdash; Linux manual pages
  </title>
  <link href="../stylesheet/manpages.css" rel="stylesheet" type="text/css"/>
  <link href="../index.html" rel="home" title="utimensat(2) &mdash; Linux manual pages"/>
  <script src="../stylesheet/manpages.js" type="text/javascript" xml:space="preserve">
  </script>
  <link href="../stylesheet/icon.gif" rel="icon" type="image/gif"/>
 </head>
 <body>
  <div class="refentry">
   <a id="utimensat.2" name="utimensat.2" shape="rect">
   </a>
   <div class="titlepage">
   </div>
   <div class="refnamediv">
    <h2>
     Name
    </h2>
    <p>
     utimensat, futimens &mdash; change file timestamps with
      nanosecond precision
    </p>
   </div>
   <div class="refsynopsisdiv">
    <h2>
     Synopsis
    </h2>
    <div class="informalexample">
     <pre class="programlisting" xml:space="preserve">
#include &lt;fcntl.h&gt; /* Definition of AT_* constants */
#include &lt;sys/stat.h&gt;
</pre>
    </div>
    <div class="funcsynopsis">
     <table border="0" class="funcprototype-table" style="cellspacing: 0; cellpadding: 0;" summary="Function synopsis">
      <tr>
       <td colspan="1" rowspan="1">
        <code class="funcdef">
         int
         <strong>
          utimensat
         </strong>
         (
        </code>
       </td>
       <td colspan="1" rowspan="1">
        int
        <var class="pdparam">
         dirfd
        </var>
        ,
       </td>
      </tr>
      <tr>
       <td colspan="1" rowspan="1">
        &nbsp;
       </td>
       <td colspan="1" rowspan="1">
        const char *
        <var class="pdparam">
         pathname
        </var>
        ,
       </td>
      </tr>
      <tr>
       <td colspan="1" rowspan="1">
        &nbsp;
       </td>
       <td colspan="1" rowspan="1">
        const struct timespec
        <var class="pdparam">
         times[2]
        </var>
        ,
       </td>
      </tr>
      <tr>
       <td colspan="1" rowspan="1">
        &nbsp;
       </td>
       <td colspan="1" rowspan="1">
        int
        <var class="pdparam">
         flags
        </var>
        <code>
         )
        </code>
        ;
       </td>
      </tr>
     </table>
     <div class="funcprototype-spacer">
      &nbsp;
     </div>
    </div>
    <div class="funcsynopsis">
     <table border="0" class="funcprototype-table" style="cellspacing: 0; cellpadding: 0;" summary="Function synopsis">
      <tr>
       <td colspan="1" rowspan="1">
        <code class="funcdef">
         int
         <strong>
          futimens
         </strong>
         (
        </code>
       </td>
       <td colspan="1" rowspan="1">
        int
        <var class="pdparam">
         fd
        </var>
        ,
       </td>
      </tr>
      <tr>
       <td colspan="1" rowspan="1">
        &nbsp;
       </td>
       <td colspan="1" rowspan="1">
        const struct timespec
        <var class="pdparam">
         times[2]
        </var>
        <code>
         )
        </code>
        ;
       </td>
      </tr>
     </table>
     <div class="funcprototype-spacer">
      &nbsp;
     </div>
    </div>
    <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tr>
       <td align="center" colspan="1" rowspan="2" valign="top" width="25">
        <img alt="[Note]" src="../stylesheet/note.png"/>
       </td>
       <th align="left" colspan="1" rowspan="1">
        Note
       </th>
      </tr>
      <tr>
       <td align="left" colspan="1" rowspan="1" valign="top">
        <div class="featuretests">
         <table style="border-collapse: collapse;">
          <colgroup span="1">
           <col span="1">
           </col>
          </colgroup>
          <thead>
           <tr>
            <th colspan="1" rowspan="1" style="">
             Feature Test Macro Requirements
                      for glibc (see
             <a class="link" href="../htmlman7/feature_test_macros.7.html" shape="rect" target="_top">
              <span class="citerefentry">
               <span class="refentrytitle">
                feature_test_macros
               </span>
               (7)
              </span>
             </a>
             ):
            </th>
           </tr>
          </thead>
          <tbody>
           <tr>
            <td colspan="1" rowspan="1" style="">
             <code class="function">
              utimensat
             </code>
             ():
            </td>
           </tr>
           <tr>
            <td class="featuretestver" colspan="1" rowspan="1" style="">
             Since
                      glibc 2.10:
            </td>
           </tr>
           <tr>
            <td class="featuretestdef" colspan="1" rowspan="1" style="">
             <code class="constant">
              _XOPEN_SOURCE
             </code>
             &gt;= 700 ||
             <code class="constant">
              _POSIX_C_SOURCE
             </code>
             &gt;=
                      200809L
            </td>
           </tr>
           <tr>
            <td class="featuretestver" colspan="1" rowspan="1" style="">
             Before
                      glibc 2.10:
            </td>
           </tr>
           <tr>
            <td class="featuretestdef" colspan="1" rowspan="1" style="">
             <code class="constant">
              _ATFILE_SOURCE
             </code>
            </td>
           </tr>
           <tr>
            <td colspan="1" rowspan="1" style="">
             <code class="function">
              futimens
             </code>
             ():
            </td>
           </tr>
           <tr>
            <td class="featuretestver" colspan="1" rowspan="1" style="">
             Since
                      glibc 2.10:
            </td>
           </tr>
           <tr>
            <td class="featuretestdef" colspan="1" rowspan="1" style="">
             <code class="constant">
              _XOPEN_SOURCE
             </code>
             &gt;= 700 ||
             <code class="constant">
              _POSIX_C_SOURCE
             </code>
             &gt;=
                      200809L
            </td>
           </tr>
           <tr>
            <td class="featuretestver" colspan="1" rowspan="1" style="">
             Before
                      glibc 2.10:
            </td>
           </tr>
           <tr>
            <td class="featuretestdef" colspan="1" rowspan="1" style="">
             <code class="constant">
              _GNU_SOURCE
             </code>
            </td>
           </tr>
          </tbody>
         </table>
        </div>
       </td>
      </tr>
     </table>
    </div>
   </div>
   <div class="refsect1">
    <a id="utimensat-2_sect1" name="utimensat-2_sect1" shape="rect">
    </a>
    <h2>
     DESCRIPTION
    </h2>
    <p>
     <code class="function">
      utimensat
     </code>
     () and
     <code class="function">
      futimens
     </code>
     () update the timestamps of a file
      with nanosecond precision. This contrasts with the historical
     <a class="link" href="../htmlman2/utime.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        utime
       </span>
       (2)
      </span>
     </a>
     and
     <a class="link" href="../htmlman2/utime.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        utimes
       </span>
       (2)
      </span>
     </a>
     , which permit
      only second and microsecond precision, respectively, when
      setting file timestamps.
    </p>
    <p>
     With
     <code class="function">
      utimensat
     </code>
     () the file is
      specified via the pathname given in
     <em class="parameter">
      <code>
       pathname
      </code>
     </em>
     . With
     <code class="function">
      futimens
     </code>
     () the file whose timestamps are to
      be updated is specified via an open file descriptor,
     <em class="parameter">
      <code>
       fd
      </code>
     </em>
     .
    </p>
    <p>
     For both calls, the new file timestamps are specified in
      the array
     <em class="parameter">
      <code>
       times
      </code>
     </em>
     :
     <em class="parameter">
      <code>
       times
      </code>
     </em>
     [0] specifies
      the new "last access time" (
     <em class="replaceable">
      <code>
       atime
      </code>
     </em>
     );
     <em class="parameter">
      <code>
       times
      </code>
     </em>
     [1] specifies the new
      "last modification time" (
     <em class="replaceable">
      <code>
       mtime
      </code>
     </em>
     ). Each of the elements
      of
     <em class="parameter">
      <code>
       times
      </code>
     </em>
     specifies a
      time as the number of seconds and nanoseconds since the
      Epoch, 1970-01-01 00:00:00 +0000 (UTC). This information is
      conveyed in a structure of the following form:
    </p>
    <div class="blockquote">
     <blockquote class="blockquote">
      <div class="structdef">
       <table style="border-collapse: collapse;">
        <colgroup span="1">
         <col class="c1" span="1">
         </col>
         <col class="c2" span="1">
         </col>
         <col class="c3" span="1">
         </col>
         <col class="c4" span="1">
         </col>
         <col class="c5" span="1">
         </col>
        </colgroup>
        <tbody>
         <tr>
          <td align="left" class="structdefhdr" colspan="1" rowspan="1" style="">
           struct
          </td>
          <td align="left" class="structdefhdr" colspan="4" rowspan="1" style="">
           <span class="structname">
            timespec
           </span>
           &nbsp;{
          </td>
         </tr>
         <tr>
          <td colspan="1" rowspan="1" style="">
           &nbsp;
          </td>
          <td align="left" colspan="1" rowspan="1" style="">
           <span class="type">
            time_t
           </span>
          </td>
          <td align="right" class="norightpad" colspan="1" rowspan="1" style="">
           &nbsp;
          </td>
          <td align="left" colspan="1" rowspan="1" style="">
           <em class="structfield">
            <code>
             tv_sec
            </code>
           </em>
           ;
          </td>
          <td align="left" colspan="1" rowspan="1" style="">
           <div class="literallayout">
            /*&nbsp;seconds&nbsp;*/
           </div>
          </td>
         </tr>
         <tr>
          <td colspan="1" rowspan="1" style="">
           &nbsp;
          </td>
          <td align="left" colspan="1" rowspan="1" style="">
           <span class="type">
            long
           </span>
          </td>
          <td align="right" class="norightpad" colspan="1" rowspan="1" style="">
           &nbsp;
          </td>
          <td align="left" colspan="1" rowspan="1" style="">
           <em class="structfield">
            <code>
             tv_nsec
            </code>
           </em>
           ;
          </td>
          <td align="left" colspan="1" rowspan="1" style="">
           <div class="literallayout">
            /*&nbsp;nanoseconds&nbsp;*/
           </div>
          </td>
         </tr>
         <tr>
          <td align="left" class="structdefftr" colspan="5" rowspan="1" style="">
           };
          </td>
         </tr>
        </tbody>
       </table>
      </div>
     </blockquote>
    </div>
    <p>
     Updated file timestamps are set to the greatest value
      supported by the filesystem that is not greater than the
      specified time.
    </p>
    <p>
     If the
     <em class="parameter">
      <code>
       tv_nsec
      </code>
     </em>
     field of one of the
     <span class="structname">
      timespec
     </span>
     structures has the special value
     <code class="constant">
      UTIME_NOW
     </code>
     , then the corresponding file
      timestamp is set to the current time. If the
     <em class="parameter">
      <code>
       tv_nsec
      </code>
     </em>
     field of one of the
     <span class="structname">
      timespec
     </span>
     structures has the
      special value
     <code class="constant">
      UTIME_OMIT
     </code>
     , then
      the corresponding file timestamp is left unchanged. In both
      of these cases, the value of the corresponding
     <em class="parameter">
      <code>
       tv_sec
      </code>
     </em>
     field is ignored.
    </p>
    <p>
     If
     <em class="parameter">
      <code>
       times
      </code>
     </em>
     is NULL,
      then both timestamps are set to the current time.
    </p>
    <div class="refsect2">
     <a id="utimensat-2_sect2" name="utimensat-2_sect2" shape="rect">
     </a>
     <h3>
      Permissions requirements
     </h3>
     <p>
      To set both file timestamps to the current time (i.e.,
      <em class="parameter">
       <code>
        times
       </code>
      </em>
      is NULL, or
        both
      <em class="parameter">
       <code>
        tv_nsec
       </code>
      </em>
      fields
        specify
      <code class="constant">
       UTIME_NOW
      </code>
      ),
        either:
     </p>
     <div class="orderedlist">
      <ol class="orderedlist" type="1">
       <li class="listitem">
        <p>
         the caller must have write access to the file;
        </p>
       </li>
       <li class="listitem">
        <p>
         the caller's effective user ID must match the
              owner of the file; or
        </p>
       </li>
       <li class="listitem">
        <p>
         the caller must have appropriate privileges.
        </p>
       </li>
      </ol>
     </div>
     <p>
      To make any change other than setting both timestamps to
        the current time (i.e.,
      <em class="parameter">
       <code>
        times
       </code>
      </em>
      is not NULL, and
        neither
      <em class="parameter">
       <code>
        tv_nsec
       </code>
      </em>
      field is
      <code class="constant">
       UTIME_NOW
      </code>
      and
        neither
      <em class="parameter">
       <code>
        tv_nsec
       </code>
      </em>
      field is
      <code class="constant">
       UTIME_OMIT
      </code>
      ), either
        condition 2 or 3 above must apply.
     </p>
     <p>
      If both
      <em class="parameter">
       <code>
        tv_nsec
       </code>
      </em>
      fields are specified as
      <code class="constant">
       UTIME_OMIT
      </code>
      , then no file ownership or
        permission checks are performed, and the file timestamps
        are not modified, but other error conditions may still be
        detected.
     </p>
    </div>
    <div class="refsect2">
     <a id="utimensat-2_sect3" name="utimensat-2_sect3" shape="rect">
     </a>
     <h3>
      utimensat() specifics
     </h3>
     <p>
      If
      <em class="parameter">
       <code>
        pathname
       </code>
      </em>
      is
        relative, then by default it is interpreted relative to the
        directory referred to by the open file descriptor,
      <em class="parameter">
       <code>
        dirfd
       </code>
      </em>
      (rather than
        relative to the current working directory of the calling
        process, as is done by
      <a class="link" href="../htmlman2/utime.2.html" shape="rect" target="_top">
       <span class="citerefentry">
        <span class="refentrytitle">
         utimes
        </span>
        (2)
       </span>
      </a>
      for a relative
        pathname). See
      <a class="link" href="../htmlman2/open.2.html" shape="rect" target="_top">
       <span class="citerefentry">
        <span class="refentrytitle">
         openat
        </span>
        (2)
       </span>
      </a>
      for an
        explanation of why this can be useful.
     </p>
     <p>
      If
      <em class="parameter">
       <code>
        pathname
       </code>
      </em>
      is
        relative and
      <em class="parameter">
       <code>
        dirfd
       </code>
      </em>
      is the special value
      <code class="constant">
       AT_FDCWD
      </code>
      , then
      <em class="parameter">
       <code>
        pathname
       </code>
      </em>
      is interpreted
        relative to the current working directory of the calling
        process (like
      <a class="link" href="../htmlman2/utime.2.html" shape="rect" target="_top">
       <span class="citerefentry">
        <span class="refentrytitle">
         utimes
        </span>
        (2)
       </span>
      </a>
      ).
     </p>
     <p>
      If
      <em class="parameter">
       <code>
        pathname
       </code>
      </em>
      is
        absolute, then
      <em class="parameter">
       <code>
        dirfd
       </code>
      </em>
      is ignored.
     </p>
     <p>
      The
      <em class="parameter">
       <code>
        flags
       </code>
      </em>
      field
        is a bit mask that may be 0, or include the following
        constant, defined in
      <code class="literal">
       &lt;
      </code>
      <code class="filename">
       fcntl.h
      </code>
      <code class="literal">
       &gt;
      </code>
     </p>
     <div class="variablelist">
      <dl class="variablelist">
       <dt>
        <span class="term">
         <code class="constant">
          AT_SYMLINK_NOFOLLOW
         </code>
        </span>
       </dt>
       <dd>
        <p>
         If
         <em class="parameter">
          <code>
           pathname
          </code>
         </em>
         specifies a
              symbolic link, then update the timestamps of the
              link, rather than the file to which it refers.
        </p>
       </dd>
      </dl>
     </div>
    </div>
   </div>
   <div class="refsect1">
    <a id="utimensat-2_sect4" name="utimensat-2_sect4" shape="rect">
    </a>
    <h2>
     RETURN VALUE
    </h2>
    <p>
     On success,
     <code class="function">
      utimensat
     </code>
     () and
     <code class="function">
      futimens
     </code>
     () return 0. On error,
      &minus;1 is returned and
     <code class="varname">
      errno
     </code>
     is set to indicate the error.
    </p>
   </div>
   <div class="refsect1">
    <a id="utimensat-2_sect5" name="utimensat-2_sect5" shape="rect">
    </a>
    <h2>
     ERRORS
    </h2>
    <div class="variablelist">
     <dl class="variablelist">
      <dt>
       <span class="term">
        <span class="errorname">
         EACCES
        </span>
       </span>
      </dt>
      <dd>
       <p>
        <em class="parameter">
         <code>
          times
         </code>
        </em>
        is
            NULL, or both
        <em class="parameter">
         <code>
          tv_nsec
         </code>
        </em>
        values are
        <code class="constant">
         UTIME_NOW
        </code>
        , and:
       </p>
       <div class="blockquote">
        <blockquote class="blockquote">
         <div class="itemizedlist">
          <ul class="itemizedlist" style="list-style-type: disc;">
           <li class="listitem">
            <p>
             the effective user ID of the caller does
                      not match the owner of the file, the caller
                      does not have write access to the file, and
                      the caller is not privileged (Linux: does not
                      have either the
             <code class="constant">
              CAP_FOWNER
             </code>
             or the
             <code class="constant">
              CAP_DAC_OVERRIDE
             </code>
             capability); or,
            </p>
           </li>
           <li class="listitem">
            <p>
             the file is marked immutable (see
             <span class="citerefentry">
              <span class="refentrytitle">
               chattr
              </span>
              (1)
             </span>
             ).
            </p>
           </li>
          </ul>
         </div>
        </blockquote>
       </div>
      </dd>
      <dt>
       <span class="term">
        <span class="errorname">
         EBADF
        </span>
       </span>
      </dt>
      <dd>
       <p>
        (
        <code class="function">
         futimens
        </code>
        ())
        <em class="parameter">
         <code>
          fd
         </code>
        </em>
        is not a
            valid file descriptor.
       </p>
      </dd>
      <dt>
       <span class="term">
        <span class="errorname">
         EBADF
        </span>
       </span>
      </dt>
      <dd>
       <p>
        (
        <code class="function">
         utimensat
        </code>
        ())
        <em class="parameter">
         <code>
          pathname
         </code>
        </em>
        is a
            relative pathname, but
        <em class="parameter">
         <code>
          dirfd
         </code>
        </em>
        is neither
        <code class="constant">
         AT_FDCWD
        </code>
        nor a valid file
            descriptor.
       </p>
      </dd>
      <dt>
       <span class="term">
        <span class="errorname">
         EFAULT
        </span>
       </span>
      </dt>
      <dd>
       <p>
        <em class="parameter">
         <code>
          times
         </code>
        </em>
        pointed to an invalid address; or,
        <em class="parameter">
         <code>
          dirfd
         </code>
        </em>
        was
        <code class="constant">
         AT_FDCWD
        </code>
        , and
        <em class="parameter">
         <code>
          pathname
         </code>
        </em>
        is NULL or an
            invalid address.
       </p>
      </dd>
      <dt>
       <span class="term">
        <span class="errorname">
         EINVAL
        </span>
       </span>
      </dt>
      <dd>
       <p>
        Invalid value in
        <em class="parameter">
         <code>
          flags
         </code>
        </em>
        .
       </p>
      </dd>
      <dt>
       <span class="term">
        <span class="errorname">
         EINVAL
        </span>
       </span>
      </dt>
      <dd>
       <p>
        Invalid value in one of the
        <em class="parameter">
         <code>
          tv_nsec
         </code>
        </em>
        fields (value
            outside range 0 to 999,999,999, and not
        <code class="constant">
         UTIME_NOW
        </code>
        or
        <code class="constant">
         UTIME_OMIT
        </code>
        ); or an invalid value in
            one of the
        <em class="parameter">
         <code>
          tv_sec
         </code>
        </em>
        fields.
       </p>
      </dd>
      <dt>
       <span class="term">
        <span class="errorname">
         EINVAL
        </span>
       </span>
      </dt>
      <dd>
       <p>
        <em class="parameter">
         <code>
          pathname
         </code>
        </em>
        is
            NULL,
        <em class="parameter">
         <code>
          dirfd
         </code>
        </em>
        is
            not
        <code class="constant">
         AT_FDCWD
        </code>
        , and
        <em class="parameter">
         <code>
          flags
         </code>
        </em>
        contains
        <code class="constant">
         AT_SYMLINK_NOFOLLOW
        </code>
        .
       </p>
      </dd>
      <dt>
       <span class="term">
        <span class="errorname">
         ELOOP
        </span>
       </span>
      </dt>
      <dd>
       <p>
        (
        <code class="function">
         utimensat
        </code>
        ()) Too many
            symbolic links were encountered in resolving
        <em class="parameter">
         <code>
          pathname
         </code>
        </em>
        .
       </p>
      </dd>
      <dt>
       <span class="term">
        <span class="errorname">
         ENAMETOOLONG
        </span>
       </span>
      </dt>
      <dd>
       <p>
        (
        <code class="function">
         utimensat
        </code>
        ())
        <em class="parameter">
         <code>
          pathname
         </code>
        </em>
        is too
            long.
       </p>
      </dd>
      <dt>
       <span class="term">
        <span class="errorname">
         ENOENT
        </span>
       </span>
      </dt>
      <dd>
       <p>
        (
        <code class="function">
         utimensat
        </code>
        ()) A
            component of
        <em class="parameter">
         <code>
          pathname
         </code>
        </em>
        does not refer
            to an existing directory or file, or
        <em class="parameter">
         <code>
          pathname
         </code>
        </em>
        is an empty
            string.
       </p>
      </dd>
      <dt>
       <span class="term">
        <span class="errorname">
         ENOTDIR
        </span>
       </span>
      </dt>
      <dd>
       <p>
        (
        <code class="function">
         utimensat
        </code>
        ())
        <em class="parameter">
         <code>
          pathname
         </code>
        </em>
        is a
            relative pathname, but
        <em class="parameter">
         <code>
          dirfd
         </code>
        </em>
        is neither
        <code class="constant">
         AT_FDCWD
        </code>
        nor a file
            descriptor referring to a directory; or, one of the
            prefix components of
        <em class="parameter">
         <code>
          pathname
         </code>
        </em>
        is not a
            directory.
       </p>
      </dd>
      <dt>
       <span class="term">
        <span class="errorname">
         EPERM
        </span>
       </span>
      </dt>
      <dd>
       <p>
        The caller attempted to change one or both
            timestamps to a value other than the current time, or
            to change one of the timestamps to the current time
            while leaving the other timestamp unchanged, (i.e.,
        <em class="parameter">
         <code>
          times
         </code>
        </em>
        is not
            NULL, neither
        <em class="parameter">
         <code>
          tv_nsec
         </code>
        </em>
        field is
        <code class="constant">
         UTIME_NOW
        </code>
        , and neither
        <em class="parameter">
         <code>
          tv_nsec
         </code>
        </em>
        field
            is
        <code class="constant">
         UTIME_OMIT
        </code>
        ) and:
       </p>
       <div class="blockquote">
        <blockquote class="blockquote">
         <div class="itemizedlist">
          <ul class="itemizedlist" style="list-style-type: disc;">
           <li class="listitem">
            <p>
             the caller's effective user ID does not
                      match the owner of file, and the caller is
                      not privileged (Linux: does not have the
             <code class="constant">
              CAP_FOWNER
             </code>
             capability); or,
            </p>
           </li>
           <li class="listitem">
            <p>
             the file is marked append-only or
                      immutable (see
             <span class="citerefentry">
              <span class="refentrytitle">
               chattr
              </span>
              (1)
             </span>
             ).
            </p>
           </li>
          </ul>
         </div>
        </blockquote>
       </div>
      </dd>
      <dt>
       <span class="term">
        <span class="errorname">
         EROFS
        </span>
       </span>
      </dt>
      <dd>
       <p>
        The file is on a read-only filesystem.
       </p>
      </dd>
      <dt>
       <span class="term">
        <span class="errorname">
         ESRCH
        </span>
       </span>
      </dt>
      <dd>
       <p>
        (
        <code class="function">
         utimensat
        </code>
        ()) Search
            permission is denied for one of the prefix components
            of
        <em class="parameter">
         <code>
          pathname
         </code>
        </em>
        .
       </p>
      </dd>
     </dl>
    </div>
   </div>
   <div class="refsect1">
    <a id="utimensat-2_sect6" name="utimensat-2_sect6" shape="rect">
    </a>
    <h2>
     VERSIONS
    </h2>
    <p>
     <code class="function">
      utimensat
     </code>
     () was added to
      Linux in kernel 2.6.22; glibc support was added with version
      2.6.
    </p>
    <p>
     Support for
     <code class="function">
      futimens
     </code>
     () first
      appeared in glibc 2.6.
    </p>
   </div>
   <div class="refsect1">
    <a id="utimensat-2_sect7" name="utimensat-2_sect7" shape="rect">
    </a>
    <h2>
     CONFORMING TO
    </h2>
    <p>
     <code class="function">
      futimens
     </code>
     () and
     <code class="function">
      utimensat
     </code>
     () are specified in
      POSIX.1-2008.
    </p>
   </div>
   <div class="refsect1">
    <a id="utimensat-2_sect8" name="utimensat-2_sect8" shape="rect">
    </a>
    <h2>
     NOTES
    </h2>
    <p>
     <code class="function">
      utimensat
     </code>
     () obsoletes
     <a class="link" href="../htmlman2/futimesat.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        futimesat
       </span>
       (2)
      </span>
     </a>
     .
    </p>
    <p>
     On Linux, timestamps cannot be changed for a file marked
      immutable, and the only change permitted for files marked
      append-only is to set the timestamps to the current time.
      (This is consistent with the historical behavior of
     <a class="link" href="../htmlman2/utime.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        utime
       </span>
       (2)
      </span>
     </a>
     and
     <a class="link" href="../htmlman2/utime.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        utimes
       </span>
       (2)
      </span>
     </a>
     on Linux.)
    </p>
    <p>
     On Linux,
     <code class="function">
      futimens
     </code>
     () is a
      library function implemented on top of the
     <code class="function">
      utimensat
     </code>
     () system call. To support this,
      the Linux
     <code class="function">
      utimensat
     </code>
     () system
      call implements a nonstandard feature: if
     <em class="parameter">
      <code>
       pathname
      </code>
     </em>
     is NULL, then the call
      modifies the timestamps of the file referred to by the file
      descriptor
     <em class="parameter">
      <code>
       dirfd
      </code>
     </em>
     (which may refer to any type of file). Using this feature,
      the call
     <span class="emphasis">
      <em>
       futimens(fd,
      times)
      </em>
     </span>
     is implemented as:
    </p>
    <div class="informalexample">
     <pre class="programlisting" xml:space="preserve">
    utimensat(fd, NULL, times, 0);
</pre>
    </div>
   </div>
   <div class="refsect1">
    <a id="utimensat-2_sect9" name="utimensat-2_sect9" shape="rect">
    </a>
    <h2>
     BUGS
    </h2>
    <p>
     Several bugs afflict
     <code class="function">
      utimensat
     </code>
     () and
     <code class="function">
      futimens
     </code>
     () on kernels before 2.6.26. These
      bugs are either nonconformances with the POSIX.1 draft
      specification or inconsistencies with historical Linux
      behavior.
    </p>
    <div class="itemizedlist">
     <ul class="itemizedlist" style="list-style-type: disc;">
      <li class="listitem">
       <p>
        POSIX.1 specifies that if one of the
        <em class="parameter">
         <code>
          tv_nsec
         </code>
        </em>
        fields has the
            value
        <code class="constant">
         UTIME_NOW
        </code>
        or
        <code class="constant">
         UTIME_OMIT
        </code>
        , then the
            value of the corresponding
        <em class="parameter">
         <code>
          tv_sec
         </code>
        </em>
        field should be
            ignored. Instead, the value of the
        <em class="parameter">
         <code>
          tv_sec
         </code>
        </em>
        field is required
            to be 0 (or the error
        <span class="errorname">
         EINVAL
        </span>
        results).
       </p>
      </li>
      <li class="listitem">
       <p>
        Various bugs mean that for the purposes of
            permission checking, the case where both
        <em class="parameter">
         <code>
          tv_nsec
         </code>
        </em>
        fields are set to
        <code class="constant">
         UTIME_NOW
        </code>
        isn't always
            treated the same as specifying
        <em class="parameter">
         <code>
          times
         </code>
        </em>
        as NULL, and the
            case where one
        <em class="parameter">
         <code>
          tv_nsec
         </code>
        </em>
        value is
        <code class="constant">
         UTIME_NOW
        </code>
        and the other
            is
        <code class="constant">
         UTIME_OMIT
        </code>
        isn't
            treated the same as specifying
        <em class="parameter">
         <code>
          times
         </code>
        </em>
        as a pointer to an
            array of structures containing arbitrary time values.
            As a result, in some cases: a) file timestamps can be
            updated by a process that shouldn't have permission to
            perform updates; b) file timestamps can't be updated by
            a process that should have permission to perform
            updates; and c) the wrong
        <code class="varname">
         errno
        </code>
        value is returned in case of an
            error.
       </p>
      </li>
      <li class="listitem">
       <p>
        POSIX.1 says that a process that has
        <span class="emphasis">
         <em>
          write access to the file
         </em>
        </span>
        can
            make a call with
        <em class="parameter">
         <code>
          times
         </code>
        </em>
        as NULL, or with
        <em class="parameter">
         <code>
          times
         </code>
        </em>
        pointing
            to an array of structures in which both
        <em class="parameter">
         <code>
          tv_nsec
         </code>
        </em>
        fields are
        <code class="constant">
         UTIME_NOW
        </code>
        , in order to
            update both timestamps to the current time. However,
        <code class="function">
         futimens
        </code>
        () instead checks
            whether the
        <span class="emphasis">
         <em>
          access mode of
            the file descriptor allows writing
         </em>
        </span>
        .
       </p>
      </li>
     </ul>
    </div>
   </div>
   <div class="refsect1">
    <a id="utimensat-2_sect10" name="utimensat-2_sect10" shape="rect">
    </a>
    <h2>
     SEE ALSO
    </h2>
    <p>
     <span class="citerefentry">
      <span class="refentrytitle">
       chattr
      </span>
      (1)
     </span>
     ,
     <a class="link" href="../htmlman2/futimesat.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        futimesat
       </span>
       (2)
      </span>
     </a>
     ,
     <a class="link" href="../htmlman2/open.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        openat
       </span>
       (2)
      </span>
     </a>
     ,
     <a class="link" href="../htmlman2/stat.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        stat
       </span>
       (2)
      </span>
     </a>
     ,
     <a class="link" href="../htmlman2/utime.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        utimes
       </span>
       (2)
      </span>
     </a>
     ,
     <a class="link" href="../htmlman3/futimes.3.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        futimes
       </span>
       (3)
      </span>
     </a>
     ,
     <a class="link" href="../htmlman7/path_resolution.7.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        path_resolution
       </span>
       (7)
      </span>
     </a>
     ,
     <a class="link" href="../htmlman7/symlink.7.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        symlink
       </span>
       (7)
      </span>
     </a>
    </p>
   </div>
   <div class="colophon">
    <a id="utimensat-2_sect11" name="utimensat-2_sect11" shape="rect">
    </a>
    <h2>
     COLOPHON
    </h2>
    <p>
     This page is part of release 3.72 of the Linux
     <em class="replaceable">
      <code>
       man-pages
      </code>
     </em>
     project. A
      description of the project, information about reporting bugs,
      and the latest version of this page, can be found at
      http://www.kernel.org/doc/man&minus;pages/.
    </p>
   </div>
  </div>
 </body>
</html>
