<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
  <title>
   shmctl(2) &mdash; Linux manual pages
  </title>
  <link href="../stylesheet/manpages.css" rel="stylesheet" type="text/css"/>
  <link href="../index.html" rel="home" title="shmctl(2) &mdash; Linux manual pages"/>
  <script src="../stylesheet/manpages.js" type="text/javascript" xml:space="preserve">
  </script>
  <link href="../stylesheet/icon.gif" rel="icon" type="image/gif"/>
 </head>
 <body>
  <div class="refentry">
   <a id="shmctl.2" name="shmctl.2" shape="rect">
   </a>
   <div class="titlepage">
   </div>
   <div class="refnamediv">
    <h2>
     Name
    </h2>
    <p>
     shmctl &mdash; System V shared memory control
    </p>
   </div>
   <div class="refsynopsisdiv">
    <h2>
     Synopsis
    </h2>
    <div class="informalexample">
     <pre class="programlisting" xml:space="preserve">
#include &lt;sys/ipc.h&gt;
#include &lt;sys/shm.h&gt;
</pre>
    </div>
    <div class="funcsynopsis">
     <table border="0" class="funcprototype-table" style="cellspacing: 0; cellpadding: 0;" summary="Function synopsis">
      <tr>
       <td colspan="1" rowspan="1">
        <code class="funcdef">
         int
         <strong>
          shmctl
         </strong>
         (
        </code>
       </td>
       <td colspan="1" rowspan="1">
        int
        <var class="pdparam">
         shmid
        </var>
        ,
       </td>
      </tr>
      <tr>
       <td colspan="1" rowspan="1">
        &nbsp;
       </td>
       <td colspan="1" rowspan="1">
        int
        <var class="pdparam">
         cmd
        </var>
        ,
       </td>
      </tr>
      <tr>
       <td colspan="1" rowspan="1">
        &nbsp;
       </td>
       <td colspan="1" rowspan="1">
        struct shmid_ds *
        <var class="pdparam">
         buf
        </var>
        <code>
         )
        </code>
        ;
       </td>
      </tr>
     </table>
     <div class="funcprototype-spacer">
      &nbsp;
     </div>
    </div>
   </div>
   <div class="refsect1">
    <a id="shmctl-2_sect1" name="shmctl-2_sect1" shape="rect">
    </a>
    <h2>
     DESCRIPTION
    </h2>
    <p>
     <code class="function">
      shmctl
     </code>
     () performs the
      control operation specified by
     <em class="parameter">
      <code>
       cmd
      </code>
     </em>
     on the System V shared
      memory segment whose identifier is given in
     <em class="parameter">
      <code>
       shmid
      </code>
     </em>
     .
    </p>
    <p>
     The
     <em class="parameter">
      <code>
       buf
      </code>
     </em>
     argument
      is a pointer to a
     <span class="structname">
      shmid_ds
     </span>
     structure, defined in
     <code class="literal">
      &lt;
     </code>
     <code class="filename">
      sys/shm.h
     </code>
     <code class="literal">
      &gt;
     </code>
     as follows:
    </p>
    <div class="blockquote">
     <blockquote class="blockquote">
      <div class="informalexample">
       <pre class="programlisting" xml:space="preserve">
struct shmid_ds {
    struct ipc_perm shm_perm;    /* Ownership and permissions */
    size_t          shm_segsz;   /* Size of segment (bytes) */
    time_t          shm_atime;   /* Last attach time */
    time_t          shm_dtime;   /* Last detach time */
    time_t          shm_ctime;   /* Last change time */
    pid_t           shm_cpid;    /* PID of creator */
    pid_t           shm_lpid;    /* PID of last shmat(2)/shmdt(2) */
    shmatt_t        shm_nattch;  /* No. of current attaches */
    ...
};
</pre>
      </div>
     </blockquote>
    </div>
    <p>
     The
     <em class="replaceable">
      <code>
       ipc_perm
      </code>
     </em>
     structure is defined as follows (the highlighted fields are
      settable using
     <code class="constant">
      IPC_SET
     </code>
     ):
    </p>
    <div class="blockquote">
     <blockquote class="blockquote">
      <div class="structdef">
       <table style="border-collapse: collapse;">
        <colgroup span="1">
         <col class="c1" span="1">
         </col>
         <col class="c2" span="1">
         </col>
         <col class="c3" span="1">
         </col>
         <col class="c4" span="1">
         </col>
         <col class="c5" span="1">
         </col>
        </colgroup>
        <tbody>
         <tr>
          <td align="left" class="structdefhdr" colspan="1" rowspan="1" style="">
           struct
          </td>
          <td align="left" class="structdefhdr" colspan="4" rowspan="1" style="">
           <span class="structname">
            ipc_perm
           </span>
           &nbsp;{
          </td>
         </tr>
         <tr>
          <td colspan="1" rowspan="1" style="">
           &nbsp;
          </td>
          <td align="left" colspan="1" rowspan="1" style="">
           <span class="type">
            key_t
           </span>
          </td>
          <td align="right" class="norightpad" colspan="1" rowspan="1" style="">
           &nbsp;
          </td>
          <td align="left" colspan="1" rowspan="1" style="">
           <em class="structfield">
            <code>
             __key
            </code>
           </em>
           ;
          </td>
          <td align="left" colspan="1" rowspan="1" style="">
           <div class="literallayout">
            /*&nbsp;Key&nbsp;supplied&nbsp;to&nbsp;shmget(2)&nbsp;*/
           </div>
          </td>
         </tr>
         <tr>
          <td colspan="1" rowspan="1" style="">
           &nbsp;
          </td>
          <td align="left" colspan="1" rowspan="1" style="">
           <span class="type">
            uid_t
           </span>
          </td>
          <td align="right" class="norightpad" colspan="1" rowspan="1" style="">
           &nbsp;
          </td>
          <td align="left" colspan="1" rowspan="1" style="">
           <em class="structfield">
            <code>
             uid
            </code>
           </em>
           ;
          </td>
          <td align="left" colspan="1" rowspan="1" style="">
           <div class="literallayout">
            /*&nbsp;Effective&nbsp;UID&nbsp;of&nbsp;owner&nbsp;*/
           </div>
          </td>
         </tr>
         <tr>
          <td colspan="1" rowspan="1" style="">
           &nbsp;
          </td>
          <td align="left" colspan="1" rowspan="1" style="">
           <span class="type">
            gid_t
           </span>
          </td>
          <td align="right" class="norightpad" colspan="1" rowspan="1" style="">
           &nbsp;
          </td>
          <td align="left" colspan="1" rowspan="1" style="">
           <em class="structfield">
            <code>
             gid
            </code>
           </em>
           ;
          </td>
          <td align="left" colspan="1" rowspan="1" style="">
           <div class="literallayout">
            /*&nbsp;Effective&nbsp;GID&nbsp;of&nbsp;owner&nbsp;*/
           </div>
          </td>
         </tr>
         <tr>
          <td colspan="1" rowspan="1" style="">
           &nbsp;
          </td>
          <td align="left" colspan="1" rowspan="1" style="">
           <span class="type">
            uid_t
           </span>
          </td>
          <td align="right" class="norightpad" colspan="1" rowspan="1" style="">
           &nbsp;
          </td>
          <td align="left" colspan="1" rowspan="1" style="">
           <em class="structfield">
            <code>
             cuid
            </code>
           </em>
           ;
          </td>
          <td align="left" colspan="1" rowspan="1" style="">
           <div class="literallayout">
            /*&nbsp;Effective&nbsp;UID&nbsp;of&nbsp;creator&nbsp;*/
           </div>
          </td>
         </tr>
         <tr>
          <td colspan="1" rowspan="1" style="">
           &nbsp;
          </td>
          <td align="left" colspan="1" rowspan="1" style="">
           <span class="type">
            gid_t
           </span>
          </td>
          <td align="right" class="norightpad" colspan="1" rowspan="1" style="">
           &nbsp;
          </td>
          <td align="left" colspan="1" rowspan="1" style="">
           <em class="structfield">
            <code>
             cgid
            </code>
           </em>
           ;
          </td>
          <td align="left" colspan="1" rowspan="1" style="">
           <div class="literallayout">
            /*&nbsp;Effective&nbsp;GID&nbsp;of&nbsp;creator&nbsp;*/
           </div>
          </td>
         </tr>
         <tr>
          <td colspan="1" rowspan="1" style="">
           &nbsp;
          </td>
          <td align="left" colspan="1" rowspan="1" style="">
           <span class="type">
            unsigned&nbsp;short
           </span>
          </td>
          <td align="right" class="norightpad" colspan="1" rowspan="1" style="">
           &nbsp;
          </td>
          <td align="left" colspan="1" rowspan="1" style="">
           <em class="structfield">
            <code>
             mode
            </code>
           </em>
           ;
          </td>
          <td align="left" colspan="1" rowspan="1" style="">
           <div class="literallayout">
            /*&nbsp;Permissions&nbsp;+&nbsp;SHM_DEST&nbsp;and
            <br/>
            SHM_LOCKED&nbsp;flags&nbsp;*/
           </div>
          </td>
         </tr>
         <tr>
          <td colspan="1" rowspan="1" style="">
           &nbsp;
          </td>
          <td align="left" colspan="1" rowspan="1" style="">
           <span class="type">
            unsigned&nbsp;short
           </span>
          </td>
          <td align="right" class="norightpad" colspan="1" rowspan="1" style="">
           &nbsp;
          </td>
          <td align="left" colspan="1" rowspan="1" style="">
           <em class="structfield">
            <code>
             __seq
            </code>
           </em>
           ;
          </td>
          <td align="left" colspan="1" rowspan="1" style="">
           <div class="literallayout">
            /*&nbsp;Sequence&nbsp;number&nbsp;*/
           </div>
          </td>
         </tr>
         <tr>
          <td align="left" class="structdefftr" colspan="5" rowspan="1" style="">
           };
          </td>
         </tr>
        </tbody>
       </table>
      </div>
     </blockquote>
    </div>
    <p>
     Valid values for
     <em class="parameter">
      <code>
       cmd
      </code>
     </em>
     are:
    </p>
    <div class="variablelist">
     <dl class="variablelist">
      <dt>
       <span class="term">
        <code class="constant">
         IPC_STAT
        </code>
       </span>
      </dt>
      <dd>
       <p>
        Copy information from the kernel data structure
            associated with
        <em class="parameter">
         <code>
          shmid
         </code>
        </em>
        into the
        <span class="structname">
         shmid_ds
        </span>
        structure
            pointed to by
        <em class="parameter">
         <code>
          buf
         </code>
        </em>
        . The caller must have
            read permission on the shared memory segment.
       </p>
      </dd>
      <dt>
       <span class="term">
        <code class="constant">
         IPC_SET
        </code>
       </span>
      </dt>
      <dd>
       <p>
        Write the values of some members of the
        <span class="structname">
         shmid_ds
        </span>
        structure pointed to by
        <em class="parameter">
         <code>
          buf
         </code>
        </em>
        to the
            kernel data structure associated with this shared
            memory segment, updating also its
        <em class="replaceable">
         <code>
          shm_ctime
         </code>
        </em>
        member. The
            following fields can be changed:
        <em class="replaceable">
         <code>
          shm_perm.uid
         </code>
        </em>
        ,
        <em class="replaceable">
         <code>
          shm_perm.gid
         </code>
        </em>
        ,
            and (the least significant 9 bits of)
        <em class="replaceable">
         <code>
          shm_perm.mode
         </code>
        </em>
        . The
            effective UID of the calling process must match the
            owner (
        <em class="replaceable">
         <code>
          shm_perm.uid
         </code>
        </em>
        ) or
            creator (
        <em class="replaceable">
         <code>
          shm_perm.cuid
         </code>
        </em>
        ) of the
            shared memory segment, or the caller must be
            privileged.
       </p>
      </dd>
      <dt>
       <span class="term">
        <code class="constant">
         IPC_RMID
        </code>
       </span>
      </dt>
      <dd>
       <p>
        Mark the segment to be destroyed. The segment will
            only actually be destroyed after the last process
            detaches it (i.e., when the
        <em class="replaceable">
         <code>
          shm_nattch
         </code>
        </em>
        member of
            the associated structure
        <span class="structname">
         shmid_ds
        </span>
        is zero). The caller must
            be the owner or creator of the segment, or be
            privileged. The
        <em class="parameter">
         <code>
          buf
         </code>
        </em>
        argument is
            ignored.
       </p>
       <p>
        If a segment has been marked for destruction, then
            the (nonstandard)
        <code class="constant">
         SHM_DEST
        </code>
        flag of the
        <em class="replaceable">
         <code>
          shm_perm.mode
         </code>
        </em>
        field in
            the associated data structure retrieved by
        <code class="constant">
         IPC_STAT
        </code>
        will be set.
       </p>
       <p>
        The caller
        <em class="replaceable">
         <code>
          must
         </code>
        </em>
        ensure that a
            segment is eventually destroyed; otherwise its pages
            that were faulted in will remain in memory or swap.
       </p>
       <p>
        See also the description of
        <code class="filename">
         /proc/sys/kernel/shm_rmid_forced
        </code>
        in
        <a class="link" href="../htmlman5/proc.5.html" shape="rect" target="_top">
         <span class="citerefentry">
          <span class="refentrytitle">
           proc
          </span>
          (5)
         </span>
        </a>
        .
       </p>
      </dd>
      <dt>
       <span class="term">
        <code class="constant">
         IPC_INFO
        </code>
        (Linux-specific)
       </span>
      </dt>
      <dd>
       <p>
        Return information about system-wide shared memory
            limits and parameters in the structure pointed to by
        <em class="parameter">
         <code>
          buf
         </code>
        </em>
        . This
            structure is of type
        <em class="replaceable">
         <code>
          shminfo
         </code>
        </em>
        (thus, a cast
            is required), defined in
        <code class="literal">
         &lt;
        </code>
        <code class="filename">
         sys/shm.h
        </code>
        <code class="literal">
         &gt;
        </code>
        if the
        <code class="constant">
         _GNU_SOURCE
        </code>
        feature test macro is
            defined:
       </p>
       <div class="blockquote">
        <blockquote class="blockquote">
         <div class="structdef">
          <table style="border-collapse: collapse;">
           <colgroup span="1">
            <col class="c1" span="1">
            </col>
            <col class="c2" span="1">
            </col>
            <col class="c3" span="1">
            </col>
            <col class="c4" span="1">
            </col>
            <col class="c5" span="1">
            </col>
           </colgroup>
           <tbody>
            <tr>
             <td align="left" class="structdefhdr" colspan="1" rowspan="1" style="">
              struct
             </td>
             <td align="left" class="structdefhdr" colspan="4" rowspan="1" style="">
              <span class="structname">
               shminfo
              </span>
              &nbsp;{
             </td>
            </tr>
            <tr>
             <td colspan="1" rowspan="1" style="">
              &nbsp;
             </td>
             <td align="left" colspan="1" rowspan="1" style="">
              <span class="type">
               unsigned&nbsp;long
              </span>
             </td>
             <td align="right" class="norightpad" colspan="1" rowspan="1" style="">
              &nbsp;
             </td>
             <td align="left" colspan="1" rowspan="1" style="">
              <em class="structfield">
               <code>
                shmmax
               </code>
              </em>
              ;
             </td>
             <td align="left" colspan="1" rowspan="1" style="">
              <div class="literallayout">
               /*&nbsp;Maximum&nbsp;segment&nbsp;size&nbsp;*/
              </div>
             </td>
            </tr>
            <tr>
             <td colspan="1" rowspan="1" style="">
              &nbsp;
             </td>
             <td align="left" colspan="1" rowspan="1" style="">
              <span class="type">
               unsigned&nbsp;long
              </span>
             </td>
             <td align="right" class="norightpad" colspan="1" rowspan="1" style="">
              &nbsp;
             </td>
             <td align="left" colspan="1" rowspan="1" style="">
              <em class="structfield">
               <code>
                shmmin
               </code>
              </em>
              ;
             </td>
             <td align="left" colspan="1" rowspan="1" style="">
              <div class="literallayout">
               /*&nbsp;Minimum&nbsp;segment&nbsp;size;
               <br/>
               always&nbsp;1&nbsp;*/
              </div>
             </td>
            </tr>
            <tr>
             <td colspan="1" rowspan="1" style="">
              &nbsp;
             </td>
             <td align="left" colspan="1" rowspan="1" style="">
              <span class="type">
               unsigned&nbsp;long
              </span>
             </td>
             <td align="right" class="norightpad" colspan="1" rowspan="1" style="">
              &nbsp;
             </td>
             <td align="left" colspan="1" rowspan="1" style="">
              <em class="structfield">
               <code>
                shmmni
               </code>
              </em>
              ;
             </td>
             <td align="left" colspan="1" rowspan="1" style="">
              <div class="literallayout">
               /*&nbsp;Maximum&nbsp;number&nbsp;of&nbsp;segments&nbsp;*/
              </div>
             </td>
            </tr>
            <tr>
             <td colspan="1" rowspan="1" style="">
              &nbsp;
             </td>
             <td align="left" colspan="1" rowspan="1" style="">
              <span class="type">
               unsigned&nbsp;long
              </span>
             </td>
             <td align="right" class="norightpad" colspan="1" rowspan="1" style="">
              &nbsp;
             </td>
             <td align="left" colspan="1" rowspan="1" style="">
              <em class="structfield">
               <code>
                shmseg
               </code>
              </em>
              ;
             </td>
             <td align="left" colspan="1" rowspan="1" style="">
              <div class="literallayout">
               /*&nbsp;Maximum&nbsp;number&nbsp;of&nbsp;segments
               <br/>
               that&nbsp;a&nbsp;process&nbsp;can&nbsp;attach;
               <br/>
               unused&nbsp;within&nbsp;kernel&nbsp;*/
              </div>
             </td>
            </tr>
            <tr>
             <td colspan="1" rowspan="1" style="">
              &nbsp;
             </td>
             <td align="left" colspan="1" rowspan="1" style="">
              <span class="type">
               unsigned&nbsp;long
              </span>
             </td>
             <td align="right" class="norightpad" colspan="1" rowspan="1" style="">
              &nbsp;
             </td>
             <td align="left" colspan="1" rowspan="1" style="">
              <em class="structfield">
               <code>
                shmall
               </code>
              </em>
              ;
             </td>
             <td align="left" colspan="1" rowspan="1" style="">
              <div class="literallayout">
               /*&nbsp;Maximum&nbsp;number&nbsp;of&nbsp;pages&nbsp;of
               <br/>
               shared&nbsp;memory,&nbsp;system-wide&nbsp;*/
              </div>
             </td>
            </tr>
            <tr>
             <td align="left" class="structdefftr" colspan="5" rowspan="1" style="">
              };
             </td>
            </tr>
           </tbody>
          </table>
         </div>
        </blockquote>
       </div>
       <p>
        The
        <em class="parameter">
         <code>
          shmmni
         </code>
        </em>
        ,
        <em class="parameter">
         <code>
          shmmax
         </code>
        </em>
        , and
        <em class="parameter">
         <code>
          shmall
         </code>
        </em>
        settings
            can be changed via
        <code class="filename">
         /proc
        </code>
        files of the same name; see
        <a class="link" href="../htmlman5/proc.5.html" shape="rect" target="_top">
         <span class="citerefentry">
          <span class="refentrytitle">
           proc
          </span>
          (5)
         </span>
        </a>
        for
            details.
       </p>
      </dd>
      <dt>
       <span class="term">
        <code class="constant">
         SHM_INFO
        </code>
        (Linux-specific)
       </span>
      </dt>
      <dd>
       <p>
        Return a
        <em class="replaceable">
         <code>
          shm_info
         </code>
        </em>
        structure
            whose fields contain information about system resources
            consumed by shared memory. This structure is defined in
        <code class="literal">
         &lt;
        </code>
        <code class="filename">
         sys/shm.h
        </code>
        <code class="literal">
         &gt;
        </code>
        if the
        <code class="constant">
         _GNU_SOURCE
        </code>
        feature test macro is
            defined:
       </p>
       <div class="blockquote">
        <blockquote class="blockquote">
         <div class="structdef">
          <table style="border-collapse: collapse;">
           <colgroup span="1">
            <col class="c1" span="1">
            </col>
            <col class="c2" span="1">
            </col>
            <col class="c3" span="1">
            </col>
            <col class="c4" span="1">
            </col>
            <col class="c5" span="1">
            </col>
           </colgroup>
           <tbody>
            <tr>
             <td align="left" class="structdefhdr" colspan="1" rowspan="1" style="">
              struct
             </td>
             <td align="left" class="structdefhdr" colspan="4" rowspan="1" style="">
              <span class="structname">
               shm_info
              </span>
              &nbsp;{
             </td>
            </tr>
            <tr>
             <td colspan="1" rowspan="1" style="">
              &nbsp;
             </td>
             <td align="left" colspan="1" rowspan="1" style="">
              <span class="type">
               int
              </span>
             </td>
             <td align="right" class="norightpad" colspan="1" rowspan="1" style="">
              &nbsp;
             </td>
             <td align="left" colspan="1" rowspan="1" style="">
              <em class="structfield">
               <code>
                used_ids
               </code>
              </em>
              ;
             </td>
             <td align="left" colspan="1" rowspan="1" style="">
              <div class="literallayout">
               /*&nbsp;#&nbsp;of&nbsp;currently&nbsp;existing
               <br/>
               segments&nbsp;*/
              </div>
             </td>
            </tr>
            <tr>
             <td colspan="1" rowspan="1" style="">
              &nbsp;
             </td>
             <td align="left" colspan="1" rowspan="1" style="">
              <span class="type">
               unsigned&nbsp;long
              </span>
             </td>
             <td align="right" class="norightpad" colspan="1" rowspan="1" style="">
              &nbsp;
             </td>
             <td align="left" colspan="1" rowspan="1" style="">
              <em class="structfield">
               <code>
                shm_tot
               </code>
              </em>
              ;
             </td>
             <td align="left" colspan="1" rowspan="1" style="">
              <div class="literallayout">
               /*&nbsp;Total&nbsp;number&nbsp;of&nbsp;shared
               <br/>
               memory&nbsp;pages&nbsp;*/
              </div>
             </td>
            </tr>
            <tr>
             <td colspan="1" rowspan="1" style="">
              &nbsp;
             </td>
             <td align="left" colspan="1" rowspan="1" style="">
              <span class="type">
               unsigned&nbsp;long
              </span>
             </td>
             <td align="right" class="norightpad" colspan="1" rowspan="1" style="">
              &nbsp;
             </td>
             <td align="left" colspan="1" rowspan="1" style="">
              <em class="structfield">
               <code>
                shm_rss
               </code>
              </em>
              ;
             </td>
             <td align="left" colspan="1" rowspan="1" style="">
              <div class="literallayout">
               /*&nbsp;#&nbsp;of&nbsp;resident&nbsp;shared
               <br/>
               memory&nbsp;pages&nbsp;*/
              </div>
             </td>
            </tr>
            <tr>
             <td colspan="1" rowspan="1" style="">
              &nbsp;
             </td>
             <td align="left" colspan="1" rowspan="1" style="">
              <span class="type">
               unsigned&nbsp;long
              </span>
             </td>
             <td align="right" class="norightpad" colspan="1" rowspan="1" style="">
              &nbsp;
             </td>
             <td align="left" colspan="1" rowspan="1" style="">
              <em class="structfield">
               <code>
                shm_swp
               </code>
              </em>
              ;
             </td>
             <td align="left" colspan="1" rowspan="1" style="">
              <div class="literallayout">
               /*&nbsp;#&nbsp;of&nbsp;swapped&nbsp;shared
               <br/>
               memory&nbsp;pages&nbsp;*/
              </div>
             </td>
            </tr>
            <tr>
             <td colspan="1" rowspan="1" style="">
              &nbsp;
             </td>
             <td align="left" colspan="1" rowspan="1" style="">
              <span class="type">
               unsigned&nbsp;long
              </span>
             </td>
             <td align="right" class="norightpad" colspan="1" rowspan="1" style="">
              &nbsp;
             </td>
             <td align="left" colspan="1" rowspan="1" style="">
              <em class="structfield">
               <code>
                swap_attempts
               </code>
              </em>
              ;
             </td>
             <td align="left" colspan="1" rowspan="1" style="">
              <div class="literallayout">
               /*&nbsp;Unused&nbsp;since&nbsp;Linux&nbsp;2.4&nbsp;*/
              </div>
             </td>
            </tr>
            <tr>
             <td colspan="1" rowspan="1" style="">
              &nbsp;
             </td>
             <td align="left" colspan="1" rowspan="1" style="">
              <span class="type">
               unsigned&nbsp;long
              </span>
             </td>
             <td align="right" class="norightpad" colspan="1" rowspan="1" style="">
              &nbsp;
             </td>
             <td align="left" colspan="1" rowspan="1" style="">
              <em class="structfield">
               <code>
                swap_successes
               </code>
              </em>
              ;
             </td>
             <td align="left" colspan="1" rowspan="1" style="">
              <div class="literallayout">
               /*&nbsp;Unused&nbsp;since&nbsp;Linux&nbsp;2.4&nbsp;*/
              </div>
             </td>
            </tr>
            <tr>
             <td align="left" class="structdefftr" colspan="5" rowspan="1" style="">
              };
             </td>
            </tr>
           </tbody>
          </table>
         </div>
        </blockquote>
       </div>
      </dd>
      <dt>
       <span class="term">
        <code class="constant">
         SHM_STAT
        </code>
        (Linux-specific)
       </span>
      </dt>
      <dd>
       <p>
        Return a
        <span class="structname">
         shmid_ds
        </span>
        structure as for
        <code class="constant">
         IPC_STAT
        </code>
        . However, the
        <em class="parameter">
         <code>
          shmid
         </code>
        </em>
        argument is not a
            segment identifier, but instead an index into the
            kernel's internal array that maintains information
            about all shared memory segments on the system.
       </p>
      </dd>
     </dl>
    </div>
    <p>
     The caller can prevent or allow swapping of a shared
      memory segment with the following
     <em class="parameter">
      <code>
       cmd
      </code>
     </em>
     values:
    </p>
    <div class="variablelist">
     <dl class="variablelist">
      <dt>
       <span class="term">
        <code class="constant">
         SHM_LOCK
        </code>
        (Linux-specific)
       </span>
      </dt>
      <dd>
       <p>
        Prevent swapping of the shared memory segment. The
            caller must fault in any pages that are required to be
            present after locking is enabled. If a segment has been
            locked, then the (nonstandard)
        <code class="constant">
         SHM_LOCKED
        </code>
        flag of the
        <em class="replaceable">
         <code>
          shm_perm.mode
         </code>
        </em>
        field in
            the associated data structure retrieved by
        <code class="constant">
         IPC_STAT
        </code>
        will be set.
       </p>
      </dd>
      <dt>
       <span class="term">
        <code class="constant">
         SHM_UNLOCK
        </code>
        (Linux-specific)
       </span>
      </dt>
      <dd>
       <p>
        Unlock the segment, allowing it to be swapped
            out.
       </p>
      </dd>
     </dl>
    </div>
    <p>
     In kernels before 2.6.10, only a privileged process could
      employ
     <code class="constant">
      SHM_LOCK
     </code>
     and
     <code class="constant">
      SHM_UNLOCK
     </code>
     . Since kernel
      2.6.10, an unprivileged process can employ these operations
      if its effective UID matches the owner or creator UID of the
      segment, and (for
     <code class="constant">
      SHM_LOCK
     </code>
     ) the
      amount of memory to be locked falls within the
     <code class="constant">
      RLIMIT_MEMLOCK
     </code>
     resource limit (see
     <a class="link" href="../htmlman2/getrlimit.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        setrlimit
       </span>
       (2)
      </span>
     </a>
     ).
    </p>
   </div>
   <div class="refsect1">
    <a id="shmctl-2_sect2" name="shmctl-2_sect2" shape="rect">
    </a>
    <h2>
     RETURN VALUE
    </h2>
    <p>
     A successful
     <code class="constant">
      IPC_INFO
     </code>
     or
     <code class="constant">
      SHM_INFO
     </code>
     operation returns the
      index of the highest used entry in the kernel's internal
      array recording information about all shared memory segments.
      (This information can be used with repeated
     <code class="constant">
      SHM_STAT
     </code>
     operations to obtain information
      about all shared memory segments on the system.) A successful
     <code class="constant">
      SHM_STAT
     </code>
     operation returns the
      identifier of the shared memory segment whose index was given
      in
     <em class="parameter">
      <code>
       shmid
      </code>
     </em>
     . Other
      operations return 0 on success.
    </p>
    <p>
     On error, &minus;1 is returned, and
     <code class="varname">
      errno
     </code>
     is set appropriately.
    </p>
   </div>
   <div class="refsect1">
    <a id="shmctl-2_sect3" name="shmctl-2_sect3" shape="rect">
    </a>
    <h2>
     ERRORS
    </h2>
    <div class="variablelist">
     <dl class="variablelist">
      <dt>
       <span class="term">
        <span class="errorname">
         EACCES
        </span>
       </span>
      </dt>
      <dd>
       <p>
        <code class="constant">
         IPC_STAT
        </code>
        or
        <code class="constant">
         SHM_STAT
        </code>
        is requested and
        <em class="replaceable">
         <code>
          shm_perm.mode
         </code>
        </em>
        does not allow read access for
        <em class="parameter">
         <code>
          shmid
         </code>
        </em>
        , and the calling
            process does not have the
        <code class="constant">
         CAP_IPC_OWNER
        </code>
        capability.
       </p>
      </dd>
      <dt>
       <span class="term">
        <span class="errorname">
         EFAULT
        </span>
       </span>
      </dt>
      <dd>
       <p>
        The argument
        <em class="parameter">
         <code>
          cmd
         </code>
        </em>
        has value
        <code class="constant">
         IPC_SET
        </code>
        or
        <code class="constant">
         IPC_STAT
        </code>
        but the address pointed to
            by
        <em class="parameter">
         <code>
          buf
         </code>
        </em>
        isn't
            accessible.
       </p>
      </dd>
      <dt>
       <span class="term">
        <span class="errorname">
         EIDRM
        </span>
       </span>
      </dt>
      <dd>
       <p>
        <em class="parameter">
         <code>
          shmid
         </code>
        </em>
        points
            to a removed identifier.
       </p>
      </dd>
      <dt>
       <span class="term">
        <span class="errorname">
         EINVAL
        </span>
       </span>
      </dt>
      <dd>
       <p>
        <em class="parameter">
         <code>
          shmid
         </code>
        </em>
        is not
            a valid identifier, or
        <em class="parameter">
         <code>
          cmd
         </code>
        </em>
        is not a valid
            command. Or: for a
        <code class="constant">
         SHM_STAT
        </code>
        operation, the index value
            specified in
        <em class="parameter">
         <code>
          shmid
         </code>
        </em>
        referred to an
            array slot that is currently unused.
       </p>
      </dd>
      <dt>
       <span class="term">
        <span class="errorname">
         ENOMEM
        </span>
       </span>
      </dt>
      <dd>
       <p>
        (In kernels since 2.6.9),
        <code class="constant">
         SHM_LOCK
        </code>
        was specified and the size
            of the to-be-locked segment would mean that the total
            bytes in locked shared memory segments would exceed the
            limit for the real user ID of the calling process. This
            limit is defined by the
        <code class="constant">
         RLIMIT_MEMLOCK
        </code>
        soft resource limit
            (see
        <a class="link" href="../htmlman2/getrlimit.2.html" shape="rect" target="_top">
         <span class="citerefentry">
          <span class="refentrytitle">
           setrlimit
          </span>
          (2)
         </span>
        </a>
        ).
       </p>
      </dd>
      <dt>
       <span class="term">
        <span class="errorname">
         EOVERFLOW
        </span>
       </span>
      </dt>
      <dd>
       <p>
        <code class="constant">
         IPC_STAT
        </code>
        is attempted,
            and the GID or UID value is too large to be stored in
            the structure pointed to by
        <em class="parameter">
         <code>
          buf
         </code>
        </em>
        .
       </p>
      </dd>
      <dt>
       <span class="term">
        <span class="errorname">
         EPERM
        </span>
       </span>
      </dt>
      <dd>
       <p>
        <code class="constant">
         IPC_SET
        </code>
        or
        <code class="constant">
         IPC_RMID
        </code>
        is attempted,
            and the effective user ID of the calling process is not
            that of the creator (found in
        <em class="replaceable">
         <code>
          shm_perm.cuid
         </code>
        </em>
        ), or the
            owner (found in
        <em class="replaceable">
         <code>
          shm_perm.uid
         </code>
        </em>
        ), and the
            process was not privileged (Linux: did not have the
        <code class="constant">
         CAP_SYS_ADMIN
        </code>
        capability).
       </p>
       <p>
        Or (in kernels before 2.6.9),
        <code class="constant">
         SHM_LOCK
        </code>
        or
        <code class="constant">
         SHM_UNLOCK
        </code>
        was specified, but the
            process was not privileged (Linux: did not have the
        <code class="constant">
         CAP_IPC_LOCK
        </code>
        capability).
            (Since Linux 2.6.9, this error can also occur if the
        <code class="constant">
         RLIMIT_MEMLOCK
        </code>
        is 0 and
            the caller is not privileged.)
       </p>
      </dd>
     </dl>
    </div>
   </div>
   <div class="refsect1">
    <a id="shmctl-2_sect4" name="shmctl-2_sect4" shape="rect">
    </a>
    <h2>
     CONFORMING TO
    </h2>
    <p>
     SVr4, POSIX.1-2001.
    </p>
   </div>
   <div class="refsect1">
    <a id="shmctl-2_sect5" name="shmctl-2_sect5" shape="rect">
    </a>
    <h2>
     NOTES
    </h2>
    <p>
     The inclusion of
     <code class="literal">
      &lt;
     </code>
     <code class="filename">
      sys/types.h
     </code>
     <code class="literal">
      &gt;
     </code>
     and
     <code class="literal">
      &lt;
     </code>
     <code class="filename">
      sys/ipc.h
     </code>
     <code class="literal">
      &gt;
     </code>
     isn't required on Linux or by any version of POSIX. However,
      some old implementations required the inclusion of these
      header files, and the SVID also documented their inclusion.
      Applications intended to be portable to such old systems may
      need to include these header files.
    </p>
    <p>
     The
     <code class="constant">
      IPC_INFO
     </code>
     ,
     <code class="constant">
      SHM_STAT
     </code>
     and
     <code class="constant">
      SHM_INFO
     </code>
     operations are used by the
     <a class="link" href="../htmlman1/ipcs.1.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        ipcs
       </span>
       (1)
      </span>
     </a>
     program to provide
      information on allocated resources. In the future, these may
      modified or moved to a
     <code class="filename">
      /proc
     </code>
     filesystem interface.
    </p>
    <p>
     Linux permits a process to attach (
     <a class="link" href="../htmlman2/shmop.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        shmat
       </span>
       (2)
      </span>
     </a>
     ) a shared memory
      segment that has already been marked for deletion using
     <em class="replaceable">
      <code>
       shmctl(IPC_RMID)
      </code>
     </em>
     .
      This feature is not available on other UNIX implementations;
      portable applications should avoid relying on it.
    </p>
    <p>
     Various fields in a
     <span class="emphasis">
      <em>
       struct
      shmid_ds
      </em>
     </span>
     were typed as
     <span class="type">
      short
     </span>
     under Linux 2.2 and have become
     <span class="type">
      long
     </span>
     under Linux 2.4. To take
      advantage of this, a recompilation under glibc-2.1.91 or
      later should suffice. (The kernel distinguishes old and new
      calls by an
     <code class="constant">
      IPC_64
     </code>
     flag in
     <em class="parameter">
      <code>
       cmd
      </code>
     </em>
     .)
    </p>
   </div>
   <div class="refsect1">
    <a id="shmctl-2_sect6" name="shmctl-2_sect6" shape="rect">
    </a>
    <h2>
     SEE ALSO
    </h2>
    <p>
     <a class="link" href="../htmlman2/mlock.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        mlock
       </span>
       (2)
      </span>
     </a>
     ,
     <a class="link" href="../htmlman2/getrlimit.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        setrlimit
       </span>
       (2)
      </span>
     </a>
     ,
     <a class="link" href="../htmlman2/shmget.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        shmget
       </span>
       (2)
      </span>
     </a>
     ,
     <a class="link" href="../htmlman2/shmop.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        shmop
       </span>
       (2)
      </span>
     </a>
     ,
     <a class="link" href="../htmlman7/capabilities.7.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        capabilities
       </span>
       (7)
      </span>
     </a>
     ,
     <a class="link" href="../htmlman7/svipc.7.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        svipc
       </span>
       (7)
      </span>
     </a>
    </p>
   </div>
   <div class="colophon">
    <a id="shmctl-2_sect7" name="shmctl-2_sect7" shape="rect">
    </a>
    <h2>
     COLOPHON
    </h2>
    <p>
     This page is part of release 3.72 of the Linux
     <em class="replaceable">
      <code>
       man-pages
      </code>
     </em>
     project. A
      description of the project, information about reporting bugs,
      and the latest version of this page, can be found at
      http://www.kernel.org/doc/man&minus;pages/.
    </p>
   </div>
  </div>
 </body>
</html>
