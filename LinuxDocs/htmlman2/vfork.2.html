<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
  <title>
   vfork(2) &mdash; Linux manual pages
  </title>
  <link href="../stylesheet/manpages.css" rel="stylesheet" type="text/css"/>
  <link href="../index.html" rel="home" title="vfork(2) &mdash; Linux manual pages"/>
  <script src="../stylesheet/manpages.js" type="text/javascript" xml:space="preserve">
  </script>
  <link href="../stylesheet/icon.gif" rel="icon" type="image/gif"/>
 </head>
 <body>
  <div class="refentry">
   <a id="vfork.2" name="vfork.2" shape="rect">
   </a>
   <div class="titlepage">
   </div>
   <div class="refnamediv">
    <h2>
     Name
    </h2>
    <p>
     vfork &mdash; create a child process and block parent
    </p>
   </div>
   <div class="refsynopsisdiv">
    <h2>
     Synopsis
    </h2>
    <div class="informalexample">
     <pre class="programlisting" xml:space="preserve">
#include &lt;sys/types.h&gt;
#include &lt;unistd.h&gt;
</pre>
    </div>
    <div class="funcsynopsis">
     <table border="0" class="funcprototype-table" style="cellspacing: 0; cellpadding: 0;" summary="Function synopsis">
      <tr>
       <td colspan="1" rowspan="1">
        <code class="funcdef">
         pid_t
         <strong>
          vfork
         </strong>
         (
        </code>
       </td>
       <td colspan="1" rowspan="1">
        <code>
         void)
        </code>
        ;
       </td>
       <td colspan="1" rowspan="1">
        &nbsp;
       </td>
      </tr>
     </table>
     <div class="funcprototype-spacer">
      &nbsp;
     </div>
    </div>
    <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tr>
       <td align="center" colspan="1" rowspan="2" valign="top" width="25">
        <img alt="[Note]" src="../stylesheet/note.png"/>
       </td>
       <th align="left" colspan="1" rowspan="1">
        Note
       </th>
      </tr>
      <tr>
       <td align="left" colspan="1" rowspan="1" valign="top">
        <div class="featuretests">
         <table style="border-collapse: collapse;">
          <colgroup span="1">
           <col span="1">
           </col>
          </colgroup>
          <thead>
           <tr>
            <th colspan="1" rowspan="1" style="">
             Feature Test Macro Requirements
                      for glibc (see
             <a class="link" href="../htmlman7/feature_test_macros.7.html" shape="rect" target="_top">
              <span class="citerefentry">
               <span class="refentrytitle">
                feature_test_macros
               </span>
               (7)
              </span>
             </a>
             ):
            </th>
           </tr>
          </thead>
          <tbody>
           <tr>
            <td colspan="1" rowspan="1" style="">
             <code class="function">
              vfork
             </code>
             ():
            </td>
           </tr>
           <tr>
            <td class="featuretestver" colspan="1" rowspan="1" style="">
             Since
                      glibc 2.12:
            </td>
           </tr>
           <tr>
            <td class="featuretestdef" colspan="1" rowspan="1" style="">
             <code class="constant">
              _BSD_SOURCE
             </code>
             ||
                      (
             <code class="constant">
              _XOPEN_SOURCE
             </code>
             &gt;= 500 ||
             <code class="constant">
              _XOPEN_SOURCE
             </code>
             &amp;&amp;
             <code class="constant">
              _XOPEN_SOURCE_EXTENDED
             </code>
             )
                      &amp;&amp; !(
             <code class="constant">
              _POSIX_C_SOURCE
             </code>
             &gt;=
                      200809L ||
             <code class="constant">
              _XOPEN_SOURCE
             </code>
             &gt;=
                      700)
            </td>
           </tr>
           <tr>
            <td class="featuretestver" colspan="1" rowspan="1" style="">
             Before
                      glibc 2.12:
            </td>
           </tr>
           <tr>
            <td class="featuretestdef" colspan="1" rowspan="1" style="">
             <code class="constant">
              _BSD_SOURCE
             </code>
             ||
             <code class="constant">
              _XOPEN_SOURCE
             </code>
             &gt;= 500 ||
             <code class="constant">
              _XOPEN_SOURCE
             </code>
             &amp;&amp;
             <code class="constant">
              _XOPEN_SOURCE_EXTENDED
             </code>
            </td>
           </tr>
          </tbody>
         </table>
        </div>
       </td>
      </tr>
     </table>
    </div>
   </div>
   <div class="refsect1">
    <a id="vfork-2_sect1" name="vfork-2_sect1" shape="rect">
    </a>
    <h2>
     DESCRIPTION
    </h2>
    <div class="refsect2">
     <a id="vfork-2_sect2" name="vfork-2_sect2" shape="rect">
     </a>
     <h3>
      Standard description
     </h3>
     <p>
      (From POSIX.1) The
      <code class="function">
       vfork
      </code>
      ()
        function has the same effect as
      <a class="link" href="../htmlman2/fork.2.html" shape="rect" target="_top">
       <span class="citerefentry">
        <span class="refentrytitle">
         fork
        </span>
        (2)
       </span>
      </a>
      , except that the
        behavior is undefined if the process created by
      <code class="function">
       vfork
      </code>
      () either modifies any
        data other than a variable of type
      <span class="type">
       pid_t
      </span>
      used to store the return value from
      <code class="function">
       vfork
      </code>
      (), or returns from the
        function in which
      <code class="function">
       vfork
      </code>
      () was
        called, or calls any other function before successfully
        calling
      <a class="link" href="../htmlman2/_exit.2.html" shape="rect" target="_top">
       <span class="citerefentry">
        <span class="refentrytitle">
         _exit
        </span>
        (2)
       </span>
      </a>
      or one of the
      <a class="link" href="../htmlman3/exec.3.html" shape="rect" target="_top">
       <span class="citerefentry">
        <span class="refentrytitle">
         exec
        </span>
        (3)
       </span>
      </a>
      family of
        functions.
     </p>
    </div>
    <div class="refsect2">
     <a id="vfork-2_sect3" name="vfork-2_sect3" shape="rect">
     </a>
     <h3>
      Linux description
     </h3>
     <p>
      <code class="function">
       vfork
      </code>
      (), just like
      <a class="link" href="../htmlman2/fork.2.html" shape="rect" target="_top">
       <span class="citerefentry">
        <span class="refentrytitle">
         fork
        </span>
        (2)
       </span>
      </a>
      , creates a child
        process of the calling process. For details and return
        value and errors, see
      <a class="link" href="../htmlman2/fork.2.html" shape="rect" target="_top">
       <span class="citerefentry">
        <span class="refentrytitle">
         fork
        </span>
        (2)
       </span>
      </a>
      .
     </p>
     <p>
      <code class="function">
       vfork
      </code>
      () is a special case
        of
      <a class="link" href="../htmlman2/clone.2.html" shape="rect" target="_top">
       <span class="citerefentry">
        <span class="refentrytitle">
         clone
        </span>
        (2)
       </span>
      </a>
      . It is used to
        create new processes without copying the page tables of the
        parent process. It may be useful in performance-sensitive
        applications where a child is created which then
        immediately issues an
      <a class="link" href="../htmlman2/execve.2.html" shape="rect" target="_top">
       <span class="citerefentry">
        <span class="refentrytitle">
         execve
        </span>
        (2)
       </span>
      </a>
      .
     </p>
     <p>
      <code class="function">
       vfork
      </code>
      () differs from
      <a class="link" href="../htmlman2/fork.2.html" shape="rect" target="_top">
       <span class="citerefentry">
        <span class="refentrytitle">
         fork
        </span>
        (2)
       </span>
      </a>
      in that the
        calling thread is suspended until the child terminates
        (either normally, by calling
      <a class="link" href="../htmlman2/_exit.2.html" shape="rect" target="_top">
       <span class="citerefentry">
        <span class="refentrytitle">
         _exit
        </span>
        (2)
       </span>
      </a>
      , or abnormally,
        after delivery of a fatal signal), or it makes a call to
      <a class="link" href="../htmlman2/execve.2.html" shape="rect" target="_top">
       <span class="citerefentry">
        <span class="refentrytitle">
         execve
        </span>
        (2)
       </span>
      </a>
      . Until that
        point, the child shares all memory with its parent,
        including the stack. The child must not return from the
        current function or call
      <a class="link" href="../htmlman3/exit.3.html" shape="rect" target="_top">
       <span class="citerefentry">
        <span class="refentrytitle">
         exit
        </span>
        (3)
       </span>
      </a>
      , but may call
      <a class="link" href="../htmlman2/_exit.2.html" shape="rect" target="_top">
       <span class="citerefentry">
        <span class="refentrytitle">
         _exit
        </span>
        (2)
       </span>
      </a>
      .
     </p>
     <p>
      As with
      <a class="link" href="../htmlman2/fork.2.html" shape="rect" target="_top">
       <span class="citerefentry">
        <span class="refentrytitle">
         fork
        </span>
        (2)
       </span>
      </a>
      , the child
        process created by
      <code class="function">
       vfork
      </code>
      ()
        inherits copies of various of the caller's process
        attributes (e.g., file descriptors, signal dispositions,
        and current working directory); the
      <code class="function">
       vfork
      </code>
      () call differs only in the
        treatment of the virtual address space, as described
        above.
     </p>
     <p>
      Signals sent to the parent arrive after the child
        releases the parent's memory (i.e., after the child
        terminates or calls
      <a class="link" href="../htmlman2/execve.2.html" shape="rect" target="_top">
       <span class="citerefentry">
        <span class="refentrytitle">
         execve
        </span>
        (2)
       </span>
      </a>
      ).
     </p>
    </div>
    <div class="refsect2">
     <a id="vfork-2_sect4" name="vfork-2_sect4" shape="rect">
     </a>
     <h3>
      Historic description
     </h3>
     <p>
      Under Linux,
      <a class="link" href="../htmlman2/fork.2.html" shape="rect" target="_top">
       <span class="citerefentry">
        <span class="refentrytitle">
         fork
        </span>
        (2)
       </span>
      </a>
      is implemented
        using copy-on-write pages, so the only penalty incurred by
      <a class="link" href="../htmlman2/fork.2.html" shape="rect" target="_top">
       <span class="citerefentry">
        <span class="refentrytitle">
         fork
        </span>
        (2)
       </span>
      </a>
      is the time and
        memory required to duplicate the parent's page tables, and
        to create a unique task structure for the child. However,
        in the bad old days a
      <a class="link" href="../htmlman2/fork.2.html" shape="rect" target="_top">
       <span class="citerefentry">
        <span class="refentrytitle">
         fork
        </span>
        (2)
       </span>
      </a>
      would require
        making a complete copy of the caller's data space, often
        needlessly, since usually immediately afterward an
      <a class="link" href="../htmlman3/exec.3.html" shape="rect" target="_top">
       <span class="citerefentry">
        <span class="refentrytitle">
         exec
        </span>
        (3)
       </span>
      </a>
      is done. Thus,
        for greater efficiency, BSD introduced the
      <code class="function">
       vfork
      </code>
      () system call, which did not fully
        copy the address space of the parent process, but borrowed
        the parent's memory and thread of control until a call to
      <a class="link" href="../htmlman2/execve.2.html" shape="rect" target="_top">
       <span class="citerefentry">
        <span class="refentrytitle">
         execve
        </span>
        (2)
       </span>
      </a>
      or an exit
        occurred. The parent process was suspended while the child
        was using its resources. The use of
      <code class="function">
       vfork
      </code>
      () was tricky: for example, not
        modifying data in the parent process depended on knowing
        which variables were held in a register.
     </p>
    </div>
   </div>
   <div class="refsect1">
    <a id="vfork-2_sect5" name="vfork-2_sect5" shape="rect">
    </a>
    <h2>
     CONFORMING TO
    </h2>
    <p>
     4.3BSD; POSIX.1-2001 (but marked OBSOLETE). POSIX.1-2008
      removes the specification of
     <code class="function">
      vfork
     </code>
     ().
    </p>
    <p>
     The requirements put on
     <code class="function">
      vfork
     </code>
     () by the standards are weaker than
      those put on
     <a class="link" href="../htmlman2/fork.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        fork
       </span>
       (2)
      </span>
     </a>
     , so an
      implementation where the two are synonymous is compliant. In
      particular, the programmer cannot rely on the parent
      remaining blocked until the child either terminates or calls
     <a class="link" href="../htmlman2/execve.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        execve
       </span>
       (2)
      </span>
     </a>
     , and cannot rely
      on any specific behavior with respect to shared memory.
    </p>
   </div>
   <div class="refsect1">
    <a id="vfork-2_sect6" name="vfork-2_sect6" shape="rect">
    </a>
    <h2>
     NOTES
    </h2>
    <p>
     Some consider the semantics of
     <code class="function">
      vfork
     </code>
     () to be an architectural blemish, and
      the 4.2BSD man page stated: "This system call will be
      eliminated when proper system sharing mechanisms are
      implemented. Users should not depend on the memory sharing
      semantics of
     <code class="function">
      vfork
     </code>
     () as it
      will, in that case, be made synonymous to
     <a class="link" href="../htmlman2/fork.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        fork
       </span>
       (2)
      </span>
     </a>
     ." However, even
      though modern memory management hardware has decreased the
      performance difference between
     <a class="link" href="../htmlman2/fork.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        fork
       </span>
       (2)
      </span>
     </a>
     and
     <code class="function">
      vfork
     </code>
     (), there are various reasons why
      Linux and other systems have retained
     <code class="function">
      vfork
     </code>
     ():
    </p>
    <div class="itemizedlist">
     <ul class="itemizedlist" style="list-style-type: disc;">
      <li class="listitem">
       <p>
        Some performance-critical applications require the
            small performance advantage conferred by
        <code class="function">
         vfork
        </code>
        ().
       </p>
      </li>
      <li class="listitem">
       <p>
        <code class="function">
         vfork
        </code>
        () can be
            implemented on systems that lack a memory-management
            unit (MMU), but
        <a class="link" href="../htmlman2/fork.2.html" shape="rect" target="_top">
         <span class="citerefentry">
          <span class="refentrytitle">
           fork
          </span>
          (2)
         </span>
        </a>
        can't be
            implemented on such systems. (POSIX.1-2008 removed
        <code class="function">
         vfork
        </code>
        () from the
            standard; the POSIX rationale for the
        <span class="citerefentry">
         <span class="refentrytitle">
          posix_spawn
         </span>
         (3)
        </span>
        function
            notes that that function, which provides functionality
            equivalent to
        <a class="link" href="../htmlman2/fork.2.html" shape="rect" target="_top">
         <span class="citerefentry">
          <span class="refentrytitle">
           fork
          </span>
          (2)
         </span>
        </a>
        +
        <a class="link" href="../htmlman3/exec.3.html" shape="rect" target="_top">
         <span class="citerefentry">
          <span class="refentrytitle">
           exec
          </span>
          (3)
         </span>
        </a>
        , is designed
            to be implementable on systems that lack an MMU.)
       </p>
      </li>
     </ul>
    </div>
    <div class="refsect2">
     <a id="vfork-2_sect7" name="vfork-2_sect7" shape="rect">
     </a>
     <h3>
      Linux notes
     </h3>
     <p>
      Fork handlers established using
      <span class="citerefentry">
       <span class="refentrytitle">
        pthread_atfork
       </span>
       (3)
      </span>
      are not
        called when a multithreaded program employing the NPTL
        threading library calls
      <code class="function">
       vfork
      </code>
      (). Fork handlers are called in this
        case in a program using the LinuxThreads threading library.
        (See
      <a class="link" href="../htmlman7/pthreads.7.html" shape="rect" target="_top">
       <span class="citerefentry">
        <span class="refentrytitle">
         pthreads
        </span>
        (7)
       </span>
      </a>
      for a
        description of Linux threading libraries.)
     </p>
     <p>
      A call to
      <code class="function">
       vfork
      </code>
      () is
        equivalent to calling
      <a class="link" href="../htmlman2/clone.2.html" shape="rect" target="_top">
       <span class="citerefentry">
        <span class="refentrytitle">
         clone
        </span>
        (2)
       </span>
      </a>
      with
      <em class="replaceable">
       <code>
        flags
       </code>
      </em>
      specified as:
     </p>
     <p>
      CLONE_VM | CLONE_VFORK | SIGCHLD
     </p>
    </div>
    <div class="refsect2">
     <a id="vfork-2_sect8" name="vfork-2_sect8" shape="rect">
     </a>
     <h3>
      History
     </h3>
     <p>
      The
      <code class="function">
       vfork
      </code>
      () system call
        appeared in 3.0BSD. In 4.4BSD it was made synonymous to
      <a class="link" href="../htmlman2/fork.2.html" shape="rect" target="_top">
       <span class="citerefentry">
        <span class="refentrytitle">
         fork
        </span>
        (2)
       </span>
      </a>
      but NetBSD
        introduced it again, cf.
      <a class="literalurl" href="http://www.netbsd.org/Documentation/kernel/vfork.html" shape="rect" target="_top">
       http://www.netbsd.org/Documentation/kernel/vfork.html
      </a>
      In Linux, it has been equivalent to
      <a class="link" href="../htmlman2/fork.2.html" shape="rect" target="_top">
       <span class="citerefentry">
        <span class="refentrytitle">
         fork
        </span>
        (2)
       </span>
      </a>
      until 2.2.0-pre6
        or so. Since 2.2.0-pre9 (on i386, somewhat later on other
        architectures) it is an independent system call. Support
        was added in glibc 2.0.112.
     </p>
    </div>
   </div>
   <div class="refsect1">
    <a id="vfork-2_sect9" name="vfork-2_sect9" shape="rect">
    </a>
    <h2>
     BUGS
    </h2>
    <p>
     Details of the signal handling are obscure and differ
      between systems. The BSD man page states: "To avoid a
      possible deadlock situation, processes that are children in
      the middle of a
     <code class="function">
      vfork
     </code>
     () are
      never sent
     <code class="constant">
      SIGTTOU
     </code>
     or
     <code class="constant">
      SIGTTIN
     </code>
     signals; rather, output
      or
     <em class="replaceable">
      <code>
       ioctl
      </code>
     </em>
     s are
      allowed and input attempts result in an end-of-file
      indication."
    </p>
   </div>
   <div class="refsect1">
    <a id="vfork-2_sect10" name="vfork-2_sect10" shape="rect">
    </a>
    <h2>
     SEE ALSO
    </h2>
    <p>
     <a class="link" href="../htmlman2/clone.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        clone
       </span>
       (2)
      </span>
     </a>
     ,
     <a class="link" href="../htmlman2/execve.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        execve
       </span>
       (2)
      </span>
     </a>
     ,
     <a class="link" href="../htmlman2/fork.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        fork
       </span>
       (2)
      </span>
     </a>
     ,
     <a class="link" href="../htmlman2/unshare.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        unshare
       </span>
       (2)
      </span>
     </a>
     ,
     <a class="link" href="../htmlman2/wait.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        wait
       </span>
       (2)
      </span>
     </a>
    </p>
   </div>
   <div class="colophon">
    <a id="vfork-2_sect11" name="vfork-2_sect11" shape="rect">
    </a>
    <h2>
     COLOPHON
    </h2>
    <p>
     This page is part of release 3.72 of the Linux
     <em class="replaceable">
      <code>
       man-pages
      </code>
     </em>
     project. A
      description of the project, information about reporting bugs,
      and the latest version of this page, can be found at
      http://www.kernel.org/doc/man&minus;pages/.
    </p>
   </div>
  </div>
 </body>
</html>
