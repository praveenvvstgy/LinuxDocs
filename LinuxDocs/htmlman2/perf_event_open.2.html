<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

  <title>perf_event_open(2) — Linux manual pages</title>
  <link rel="stylesheet" type="text/css" href="../stylesheet/manpages.css" />
  
  <link rel="home" href="../index.html" title="perf_event_open(2) — Linux manual pages" />
  <script type="text/javascript" src="../stylesheet/manpages.js" xml:space="preserve">
</script>
  <link rel="icon" href="../stylesheet/icon.gif" type="image/gif" />
</head>

<body>

  <div class="refentry">
    <a id="perf-event-open.2" name="perf-event-open.2" shape="rect"> </a>

    <div class="titlepage"> </div>

    <div class="refnamediv">
      <h2>Name</h2>

      <p>perf_event_open — set up performance monitoring</p>
    </div>

    <div class="refsynopsisdiv">
      <h2>Synopsis</h2>

      <div class="informalexample">
        <pre class="programlisting" xml:space="preserve">
#include &lt;linux/perf_event.h&gt;
#include &lt;linux/hw_breakpoint.h&gt;
</pre>
      </div>

      <div class="funcsynopsis">
        <table border="0" class="funcprototype-table" summary="Function synopsis" style="cellspacing: 0; cellpadding: 0;">
          <tr>
            <td rowspan="1" colspan="1"><code class="funcdef">int
            <strong>perf_event_open</strong>(</code></td>

            <td rowspan="1" colspan="1">struct perf_event_attr *<var class="pdparam">attr</var>,</td>
          </tr>

          <tr>
            <td rowspan="1" colspan="1"> </td>

            <td rowspan="1" colspan="1">pid_t <var class="pdparam">pid</var>,</td>
          </tr>

          <tr>
            <td rowspan="1" colspan="1"> </td>

            <td rowspan="1" colspan="1">int <var class="pdparam">cpu</var>,</td>
          </tr>

          <tr>
            <td rowspan="1" colspan="1"> </td>

            <td rowspan="1" colspan="1">int <var class="pdparam">group_fd</var>,</td>
          </tr>

          <tr>
            <td rowspan="1" colspan="1"> </td>

            <td rowspan="1" colspan="1">unsigned long <var class="pdparam">flags</var><code>)</code>;</td>
          </tr>
        </table>

        <div class="funcprototype-spacer">
           
        </div>
      </div>

      <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
        <table border="0" summary="Note">
          <tr>
            <td rowspan="2" align="center" valign="top" width="25" colspan="1">
            <img alt="[Note]" src="../stylesheet/note.png" /></td>

            <th align="left" rowspan="1" colspan="1">Note</th>
          </tr>

          <tr>
            <td align="left" valign="top" rowspan="1" colspan="1">There is no glibc wrapper
            for this system call; see NOTES.</td>
          </tr>
        </table>
      </div>
    </div>

    <div class="refsect1">
      <a id="perf-event-open-2_sect1" name="perf-event-open-2_sect1" shape="rect"> </a>

      <h2>DESCRIPTION</h2>

      <p>Given a list of parameters, <code class="function">perf_event_open</code>() returns a file
      descriptor, for use in subsequent system calls (<a class="link" href="../htmlman2/read.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">read</span>(2)</span></a>, <a class="link" href="../htmlman2/mmap.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">mmap</span>(2)</span></a>, <a class="link" href="../htmlman2/prctl.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">prctl</span>(2)</span></a>, <a class="link" href="../htmlman2/fcntl.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">fcntl</span>(2)</span></a>, etc.).</p>

      <p>A call to <code class="function">perf_event_open</code>()
      creates a file descriptor that allows measuring performance
      information. Each file descriptor corresponds to one event
      that is measured; these can be grouped together to measure
      multiple events simultaneously.</p>

      <p>Events can be enabled and disabled in two ways: via
      <a class="link" href="../htmlman2/ioctl.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">ioctl</span>(2)</span></a> and via <a class="link" href="../htmlman2/prctl.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">prctl</span>(2)</span></a>. When an event is
      disabled it does not count or generate overflows but does
      continue to exist and maintain its count value.</p>

      <p>Events come in two flavors: counting and sampled. A
      <em class="replaceable"><code>counting</code></em> event is
      one that is used for counting the aggregate number of events
      that occur. In general, counting event results are gathered
      with a <a class="link" href="../htmlman2/read.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">read</span>(2)</span></a> call. A <em class="replaceable"><code>sampling</code></em> event periodically
      writes measurements to a buffer that can then be accessed via
      <a class="link" href="../htmlman2/mmap.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">mmap</span>(2)</span></a>.</p>

      <div class="refsect2">
        <a id="perf-event-open-2_sect2" name="perf-event-open-2_sect2" shape="rect"> </a>

        <h3>Arguments</h3>

        <p>The <em class="parameter"><code>pid</code></em> and
        <em class="parameter"><code>cpu</code></em> arguments allow
        specifying which process and CPU to monitor:</p>

        <div class="variablelist">
          <dl class="variablelist">
            <dt><span class="term"><span class="emphasis"><em>pid
            == 0</em></span> and <span class="emphasis"><em>cpu ==
            −1</em></span></span></dt>

            <dd>
              <p>This measures the calling process/thread on any
              CPU.</p>
            </dd>

            <dt><span class="term"><span class="emphasis"><em>pid
            == 0</em></span> and <span class="emphasis"><em>cpu
            &gt;= 0</em></span></span></dt>

            <dd>
              <p>This measures the calling process/thread only when
              running on the specified CPU.</p>
            </dd>

            <dt><span class="term"><span class="emphasis"><em>pid
            &gt; 0</em></span> and <span class="emphasis"><em>cpu
            == −1</em></span></span></dt>

            <dd>
              <p>This measures the specified process/thread on any
              CPU.</p>
            </dd>

            <dt><span class="term"><span class="emphasis"><em>pid
            &gt; 0</em></span> and <span class="emphasis"><em>cpu
            &gt;= 0</em></span></span></dt>

            <dd>
              <p>This measures the specified process/thread only
              when running on the specified CPU.</p>
            </dd>

            <dt><span class="term"><span class="emphasis"><em>pid
            == −1</em></span> and <span class="emphasis"><em>cpu &gt;= 0</em></span></span></dt>

            <dd>
              <p>This measures all processes/threads on the
              specified CPU. This requires <code class="constant">CAP_SYS_ADMIN</code> capability or a
              <code class="filename">/proc/sys/kernel/perf_event_paranoid</code>
              value of less than 1.</p>
            </dd>

            <dt><span class="term"><span class="emphasis"><em>pid
            == −1</em></span> and <span class="emphasis"><em>cpu == −1</em></span></span></dt>

            <dd>
              <p>This setting is invalid and will return an
              error.</p>
            </dd>
          </dl>
        </div>

        <p>The <em class="parameter"><code>group_fd</code></em>
        argument allows event groups to be created. An event group
        has one event which is the group leader. The leader is
        created first, with <em class="parameter"><code>group_fd</code></em> = −1. The rest
        of the group members are created with subsequent
        <code class="function">perf_event_open</code>() calls with
        <em class="parameter"><code>group_fd</code></em> being set
        to the file descriptor of the group leader. (A single event
        on its own is created with <em class="parameter"><code>group_fd</code></em> = −1 and is
        considered to be a group with only 1 member.) An event
        group is scheduled onto the CPU as a unit: it will be put
        onto the CPU only if all of the events in the group can be
        put onto the CPU. This means that the values of the member
        events can be meaningfully compared—added, divided
        (to get ratios), and so on—with each other, since
        they have counted events for the same set of executed
        instructions.</p>

        <p>The <em class="parameter"><code>flags</code></em>
        argument is formed by ORing together zero or more of the
        following values:</p>

        <div class="variablelist">
          <dl class="variablelist">
            <dt><span class="term"><code class="constant">PERF_FLAG_FD_CLOEXEC</code> (since Linux
            3.14).</span></dt>

            <dd>
              <p>This flag enables the close-on-exec flag for the
              created event file descriptor, so that the file
              descriptor is automatically closed on <a class="link" href="../htmlman2/execve.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">execve</span>(2)</span></a>. Setting
              the close-on-exec flags at creation time, rather than
              later with <a class="link" href="../htmlman2/fcntl.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">fcntl</span>(2)</span></a>, avoids
              potential race conditions where the calling thread
              invokes <code class="function">perf_event_open</code>() and <a class="link" href="../htmlman2/fcntl.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">fcntl</span>(2)</span></a> at the
              same time as another thread calls <a class="link" href="../htmlman2/fork.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">fork</span>(2)</span></a> then
              <a class="link" href="../htmlman2/execve.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">execve</span>(2)</span></a>.</p>
            </dd>

            <dt><span class="term"><code class="constant">PERF_FLAG_FD_NO_GROUP</code></span></dt>

            <dd>
              <p>This flag allows creating an event as part of an
              event group but having no group leader. It is unclear
              why this is useful.</p>
            </dd>

            <dt><span class="term"><code class="constant">PERF_FLAG_FD_OUTPUT</code></span></dt>

            <dd>
              <p>This flag reroutes the output from an event to the
              group leader.</p>
            </dd>

            <dt><span class="term"><code class="constant">PERF_FLAG_PID_CGROUP</code> (since Linux
            2.6.39).</span></dt>

            <dd>
              <p>This flag activates per-container system-wide
              monitoring. A container is an abstraction that
              isolates a set of resources for finer-grained control
              (CPUs, memory, etc.). In this mode, the event is
              measured only if the thread running on the monitored
              CPU belongs to the designated container (cgroup). The
              cgroup is identified by passing a file descriptor
              opened on its directory in the cgroupfs filesystem.
              For instance, if the cgroup to monitor is called
              <em class="replaceable"><code>test</code></em>, then
              a file descriptor opened on <code class="filename">/dev/cgroup/test</code> (assuming cgroupfs
              is mounted on <code class="filename">/dev/cgroup</code>) must be passed as the
              <em class="parameter"><code>pid</code></em>
              parameter. cgroup monitoring is available only for
              system-wide events and may therefore require extra
              permissions.</p>
            </dd>
          </dl>
        </div>

        <p>The <span class="structname">perf_event_attr</span>
        structure provides detailed configuration information for
        the event being created.</p>

        <div class="blockquote">
          <blockquote class="blockquote">
            <div class="informalexample">
              <pre class="programlisting" xml:space="preserve">
struct perf_event_attr {
    __u32 type;         /* Type of event */
    __u32 size;         /* Size of attribute structure */
    __u64 config;       /* Type-specific configuration */

    union {
        __u64 sample_period;    /* Period of sampling */
        __u64 sample_freq;      /* Frequency of sampling */
    };

    __u64 sample_type;  /* Specifies values included in sample */
    __u64 read_format;  /* Specifies values returned in read */

    __u64 disabled       : 1,   /* off by default */
          inherit        : 1,   /* children inherit it */
          pinned         : 1,   /* must always be on PMU */
          exclusive      : 1,   /* only group on PMU */
          exclude_user   : 1,   /* don't count user */
          exclude_kernel : 1,   /* don't count kernel */
          exclude_hv     : 1,   /* don't count hypervisor */
          exclude_idle   : 1,   /* don't count when idle */
          mmap           : 1,   /* include mmap data */
          comm           : 1,   /* include comm data */
          freq           : 1,   /* use freq, not period */
          inherit_stat   : 1,   /* per task counts */
          enable_on_exec : 1,   /* next exec enables */
          task           : 1,   /* trace fork/exit */
          watermark      : 1,   /* wakeup_watermark */
          precise_ip     : 2,   /* skid constraint */
          mmap_data      : 1,   /* non-exec mmap data */
          sample_id_all  : 1,   /* sample_type all events */
          exclude_host   : 1,   /* don't count in host */
          exclude_guest  : 1,   /* don't count in guest */
          exclude_callchain_kernel : 1,
                                /* exclude kernel callchains */
          exclude_callchain_user   : 1,
                                /* exclude user callchains */
          mmap2          :  1,  /* include mmap with inode data */
          comm_exec      :  1,  /* flag comm events that are due to exec */
          __reserved_1   : 39;

    union {
        __u32 wakeup_events;    /* wakeup every n events */
        __u32 wakeup_watermark; /* bytes before wakeup */
    };

    __u32     bp_type;          /* breakpoint type */

    union {
        __u64 bp_addr;          /* breakpoint address */
        __u64 config1;          /* extension of config */
    };

    union {
        __u64 bp_len;           /* breakpoint length */
        __u64 config2;          /* extension of config1 */
    };
    __u64 branch_sample_type;   /* enum perf_branch_sample_type */
    __u64 sample_regs_user;     /* user regs to dump on samples */
    __u32 sample_stack_user;    /* size of stack to dump on
                                   samples */
    __u32 __reserved_2;         /* Align to u64 */

};
</pre>
            </div>
          </blockquote>
        </div>

        <p>The fields of the <span class="structname">perf_event_attr</span> structure are described
        in more detail below:</p>

        <div class="variablelist">
          <dl class="variablelist">
            <dt><span class="term"><em class="replaceable"><code>type</code></em></span></dt>

            <dd>
              <p>This field specifies the overall event type. It
              has one of the following values:</p>

              <div class="blockquote">
                <blockquote class="blockquote">
                  <div class="variablelist">
                    <dl class="variablelist">
                      <dt><span class="term"><code class="constant">PERF_TYPE_HARDWARE</code></span></dt>

                      <dd>
                        <p>This indicates one of the "generalized"
                        hardware events provided by the kernel. See
                        the <em class="replaceable"><code>config</code></em>
                        field definition for more details.</p>
                      </dd>

                      <dt><span class="term"><code class="constant">PERF_TYPE_SOFTWARE</code></span></dt>

                      <dd>
                        <p>This indicates one of the
                        software-defined events provided by the
                        kernel (even if no hardware support is
                        available).</p>
                      </dd>

                      <dt><span class="term"><code class="constant">PERF_TYPE_TRACEPOINT</code></span></dt>

                      <dd>
                        <p>This indicates a tracepoint provided by
                        the kernel tracepoint infrastructure.</p>
                      </dd>

                      <dt><span class="term"><code class="constant">PERF_TYPE_HW_CACHE</code></span></dt>

                      <dd>
                        <p>This indicates a hardware cache event.
                        This has a special encoding, described in
                        the <em class="replaceable"><code>config</code></em>
                        field definition.</p>
                      </dd>

                      <dt><span class="term"><code class="constant">PERF_TYPE_RAW</code></span></dt>

                      <dd>
                        <p>This indicates a "raw"
                        implementation-specific event in the
                        <em class="replaceable"><code>config</code></em>
                        field.</p>
                      </dd>

                      <dt><span class="term"><code class="constant">PERF_TYPE_BREAKPOINT</code> (since
                      Linux 2.6.33)</span></dt>

                      <dd>
                        <p>This indicates a hardware breakpoint as
                        provided by the CPU. Breakpoints can be
                        read/write accesses to an address as well
                        as execution of an instruction address.</p>
                      </dd>

                      <dt><span class="term"><span class="emphasis"><em>dynamic
                      PMU</em></span></span></dt>

                      <dd>
                        <p>Since Linux 2.6.39, <code class="function">perf_event_open</code>() can
                        support multiple PMUs. To enable this, a
                        value exported by the kernel can be used in
                        the <em class="replaceable"><code>type</code></em> field
                        to indicate which PMU to use. The value to
                        use can be found in the sysfs filesystem:
                        there is a subdirectory per PMU instance
                        under <code class="filename">/sys/bus/event_source/devices</code>.
                        In each subdirectory there is a <em class="replaceable"><code>type</code></em> file
                        whose content is an integer that can be
                        used in the <em class="replaceable"><code>type</code></em> field.
                        For instance, <code class="filename">/sys/bus/event_source/devices/cpu/type</code>
                        contains the value for the core CPU PMU,
                        which is usually 4.</p>
                      </dd>
                    </dl>
                  </div>
                </blockquote>
              </div>
            </dd>

            <dt><span class="term"><em class="replaceable"><code>size</code></em></span></dt>

            <dd>
              <p>The size of the <span class="structname">perf_event_attr</span> structure for
              forward/backward compatibility. Set this using
              <span class="emphasis"><em>sizeof(struct
              perf_event_attr)</em></span> to allow the kernel to
              see the struct size at the time of compilation.</p>

              <p>The related define <code class="constant">PERF_ATTR_SIZE_VER0</code> is set to 64;
              this was the size of the first published struct.
              <code class="constant">PERF_ATTR_SIZE_VER1</code> is
              72, corresponding to the addition of breakpoints in
              Linux 2.6.33. <code class="constant">PERF_ATTR_SIZE_VER2</code> is 80
              corresponding to the addition of branch sampling in
              Linux 3.4. <code class="constant">PERF_ATR_SIZE_VER3</code> is 96
              corresponding to the addition of <em class="replaceable"><code>sample_regs_user</code></em> and
              <em class="replaceable"><code>sample_stack_user</code></em> in
              Linux 3.7.</p>
            </dd>

            <dt><span class="term"><em class="replaceable"><code>config</code></em></span></dt>

            <dd>
              <p>This specifies which event you want, in
              conjunction with the <em class="replaceable"><code>type</code></em> field. The
              <em class="replaceable"><code>config1</code></em> and
              <em class="replaceable"><code>config2</code></em>
              fields are also taken into account in cases where 64
              bits is not enough to fully specify the event. The
              encoding of these fields are event dependent.</p>

              <p>The most significant bit (bit 63) of <em class="replaceable"><code>config</code></em> signifies
              CPU-specific (raw) counter configuration data; if the
              most significant bit is unset, the next 7 bits are an
              event type and the rest of the bits are the event
              identifier.</p>

              <p>There are various ways to set the <em class="replaceable"><code>config</code></em> field that are
              dependent on the value of the previously described
              <em class="replaceable"><code>type</code></em> field.
              What follows are various possible settings for
              <em class="replaceable"><code>config</code></em>
              separated out by <em class="replaceable"><code>type</code></em>.</p>

              <p>If <em class="replaceable"><code>type</code></em>
              is <code class="constant">PERF_TYPE_HARDWARE</code>,
              we are measuring one of the generalized hardware CPU
              events. Not all of these are available on all
              platforms. Set <em class="replaceable"><code>config</code></em> to one of the
              following:</p>

              <div class="blockquote">
                <blockquote class="blockquote">
                  <div class="variablelist">
                    <dl class="variablelist">
                      <dt><span class="term"><code class="constant">PERF_COUNT_HW_CPU_CYCLES</code></span></dt>

                      <dd>
                        <p>Total cycles. Be wary of what happens
                        during CPU frequency scaling.</p>
                      </dd>

                      <dt><span class="term"><code class="constant">PERF_COUNT_HW_INSTRUCTIONS</code></span></dt>

                      <dd>
                        <p>Retired instructions. Be careful, these
                        can be affected by various issues, most
                        notably hardware interrupt counts.</p>
                      </dd>

                      <dt><span class="term"><code class="constant">PERF_COUNT_HW_CACHE_REFERENCES</code></span></dt>

                      <dd>
                        <p>Cache accesses. Usually this indicates
                        Last Level Cache accesses but this may vary
                        depending on your CPU. This may include
                        prefetches and coherency messages; again
                        this depends on the design of your CPU.</p>
                      </dd>

                      <dt><span class="term"><code class="constant">PERF_COUNT_HW_CACHE_MISSES</code></span></dt>

                      <dd>
                        <p>Cache misses. Usually this indicates
                        Last Level Cache misses; this is intended
                        to be used in conjunction with the
                        <code class="constant">PERF_COUNT_HW_CACHE_REFERENCES</code>
                        event to calculate cache miss rates.</p>
                      </dd>

                      <dt><span class="term"><code class="constant">PERF_COUNT_HW_BRANCH_INSTRUCTIONS</code></span></dt>

                      <dd>
                        <p>Retired branch instructions. Prior to
                        Linux 2.6.34, this used the wrong event on
                        AMD processors.</p>
                      </dd>

                      <dt><span class="term"><code class="constant">PERF_COUNT_HW_BRANCH_MISSES</code></span></dt>

                      <dd>
                        <p>Mispredicted branch instructions.</p>
                      </dd>

                      <dt><span class="term"><code class="constant">PERF_COUNT_HW_BUS_CYCLES</code></span></dt>

                      <dd>
                        <p>Bus cycles, which can be different from
                        total cycles.</p>
                      </dd>

                      <dt><span class="term"><code class="constant">PERF_COUNT_HW_STALLED_CYCLES_FRONTEND</code>
                      (since Linux 3.0)</span></dt>

                      <dd>
                        <p>Stalled cycles during issue.</p>
                      </dd>

                      <dt><span class="term"><code class="constant">PERF_COUNT_HW_STALLED_CYCLES_BACKEND</code>
                      (since Linux 3.0)</span></dt>

                      <dd>
                        <p>Stalled cycles during retirement.</p>
                      </dd>

                      <dt><span class="term"><code class="constant">PERF_COUNT_HW_REF_CPU_CYCLES</code>
                      (since Linux 3.3)</span></dt>

                      <dd>
                        <p>Total cycles; not affected by CPU
                        frequency scaling.</p>
                      </dd>
                    </dl>
                  </div>
                </blockquote>
              </div>

              <p>If <em class="replaceable"><code>type</code></em>
              is <code class="constant">PERF_TYPE_SOFTWARE</code>,
              we are measuring software events provided by the
              kernel. Set <em class="replaceable"><code>config</code></em> to one of the
              following:</p>

              <div class="blockquote">
                <blockquote class="blockquote">
                  <div class="variablelist">
                    <dl class="variablelist">
                      <dt><span class="term"><code class="constant">PERF_COUNT_SW_CPU_CLOCK</code></span></dt>

                      <dd>
                        <p>This reports the CPU clock, a
                        high-resolution per-CPU timer.</p>
                      </dd>

                      <dt><span class="term"><code class="constant">PERF_COUNT_SW_TASK_CLOCK</code></span></dt>

                      <dd>
                        <p>This reports a clock count specific to
                        the task that is running.</p>
                      </dd>

                      <dt><span class="term"><code class="constant">PERF_COUNT_SW_PAGE_FAULTS</code></span></dt>

                      <dd>
                        <p>This reports the number of page
                        faults.</p>
                      </dd>

                      <dt><span class="term"><code class="constant">PERF_COUNT_SW_CONTEXT_SWITCHES</code></span></dt>

                      <dd>
                        <p>This counts context switches. Until
                        Linux 2.6.34, these were all reported as
                        user-space events, after that they are
                        reported as happening in the kernel.</p>
                      </dd>

                      <dt><span class="term"><code class="constant">PERF_COUNT_SW_CPU_MIGRATIONS</code></span></dt>

                      <dd>
                        <p>This reports the number of times the
                        process has migrated to a new CPU.</p>
                      </dd>

                      <dt><span class="term"><code class="constant">PERF_COUNT_SW_PAGE_FAULTS_MIN</code></span></dt>

                      <dd>
                        <p>This counts the number of minor page
                        faults. These did not require disk I/O to
                        handle.</p>
                      </dd>

                      <dt><span class="term"><code class="constant">PERF_COUNT_SW_PAGE_FAULTS_MAJ</code></span></dt>

                      <dd>
                        <p>This counts the number of major page
                        faults. These required disk I/O to
                        handle.</p>
                      </dd>

                      <dt><span class="term"><code class="constant">PERF_COUNT_SW_ALIGNMENT_FAULTS</code>
                      (since Linux 2.6.33)</span></dt>

                      <dd>
                        <p>This counts the number of alignment
                        faults. These happen when unaligned memory
                        accesses happen; the kernel can handle
                        these but it reduces performance. This
                        happens only on some architectures (never
                        on x86).</p>
                      </dd>

                      <dt><span class="term"><code class="constant">PERF_COUNT_SW_EMULATION_FAULTS</code>
                      (since Linux 2.6.33)</span></dt>

                      <dd>
                        <p>This counts the number of emulation
                        faults. The kernel sometimes traps on
                        unimplemented instructions and emulates
                        them for user space. This can negatively
                        impact performance.</p>
                      </dd>

                      <dt><span class="term"><code class="constant">PERF_COUNT_SW_DUMMY</code> (since
                      Linux 3.12)</span></dt>

                      <dd>
                        <p>This is a placeholder event that counts
                        nothing. Informational sample record types
                        such as mmap or comm must be associated
                        with an active event. This dummy event
                        allows gathering such records without
                        requiring a counting event.</p>
                      </dd>
                    </dl>
                  </div>
                </blockquote>
              </div>

              <div class="blockquote">
                <blockquote class="blockquote">
                  <p>If <em class="replaceable"><code>type</code></em> is
                  <code class="constant">PERF_TYPE_TRACEPOINT</code>, then we
                  are measuring kernel tracepoints. The value to
                  use in <em class="replaceable"><code>config</code></em> can be
                  obtained from under debugfs <em class="replaceable"><code>tracing/events/*/*/id</code></em>
                  if ftrace is enabled in the kernel.</p>
                </blockquote>
              </div>

              <div class="blockquote">
                <blockquote class="blockquote">
                  <p>If <em class="replaceable"><code>type</code></em> is
                  <code class="constant">PERF_TYPE_HW_CACHE</code>,
                  then we are measuring a hardware CPU cache event.
                  To calculate the appropriate <em class="replaceable"><code>config</code></em> value use
                  the following equation:</p>

                  <div class="blockquote">
                    <blockquote class="blockquote">
                      <div class="informalexample">
                        <pre class="programlisting" xml:space="preserve">
    (perf_hw_cache_id) | (perf_hw_cache_op_id &lt;&lt; 8) |
    (perf_hw_cache_op_result_id &lt;&lt; 16)
</pre>
                      </div>

                      <p>where <em class="replaceable"><code>perf_hw_cache_id</code></em>
                      is one of:</p>

                      <div class="blockquote">
                        <blockquote class="blockquote">
                          <div class="variablelist">
                            <dl class="variablelist">
                              <dt><span class="term"><code class="constant">PERF_COUNT_HW_CACHE_L1D</code></span></dt>

                              <dd>
                                <p>for measuring Level 1 Data
                                Cache</p>
                              </dd>

                              <dt><span class="term"><code class="constant">PERF_COUNT_HW_CACHE_L1I</code></span></dt>

                              <dd>
                                <p>for measuring Level 1
                                Instruction Cache</p>
                              </dd>

                              <dt><span class="term"><code class="constant">PERF_COUNT_HW_CACHE_LL</code></span></dt>

                              <dd>
                                <p>for measuring Last-Level
                                Cache</p>
                              </dd>

                              <dt><span class="term"><code class="constant">PERF_COUNT_HW_CACHE_DTLB</code></span></dt>

                              <dd>
                                <p>for measuring the Data TLB</p>
                              </dd>

                              <dt><span class="term"><code class="constant">PERF_COUNT_HW_CACHE_ITLB</code></span></dt>

                              <dd>
                                <p>for measuring the Instruction
                                TLB</p>
                              </dd>

                              <dt><span class="term"><code class="constant">PERF_COUNT_HW_CACHE_BPU</code></span></dt>

                              <dd>
                                <p>for measuring the branch
                                prediction unit</p>
                              </dd>

                              <dt><span class="term"><code class="constant">PERF_COUNT_HW_CACHE_NODE</code>
                              (since Linux 3.0)</span></dt>

                              <dd>
                                <p>for measuring local memory
                                accesses</p>
                              </dd>
                            </dl>
                          </div>
                        </blockquote>
                      </div>

                      <p>and <em class="replaceable"><code>perf_hw_cache_op_id</code></em>
                      is one of</p>

                      <div class="blockquote">
                        <blockquote class="blockquote">
                          <div class="variablelist">
                            <dl class="variablelist">
                              <dt><span class="term"><code class="constant">PERF_COUNT_HW_CACHE_OP_READ</code></span></dt>

                              <dd>
                                <p>for read accesses</p>
                              </dd>

                              <dt><span class="term"><code class="constant">PERF_COUNT_HW_CACHE_OP_WRITE</code></span></dt>

                              <dd>
                                <p>for write accesses</p>
                              </dd>

                              <dt><span class="term"><code class="constant">PERF_COUNT_HW_CACHE_OP_PREFETCH</code></span></dt>

                              <dd>
                                <p>for prefetch accesses</p>
                              </dd>
                            </dl>
                          </div>
                        </blockquote>
                      </div>

                      <p>and <em class="replaceable"><code>perf_hw_cache_op_result_id</code></em>
                      is one of</p>

                      <div class="blockquote">
                        <blockquote class="blockquote">
                          <div class="variablelist">
                            <dl class="variablelist">
                              <dt><span class="term"><code class="constant">PERF_COUNT_HW_CACHE_RESULT_ACCESS</code></span></dt>

                              <dd>
                                <p>to measure accesses</p>
                              </dd>

                              <dt><span class="term"><code class="constant">PERF_COUNT_HW_CACHE_RESULT_MISS</code></span></dt>

                              <dd>
                                <p>to measure misses</p>
                              </dd>
                            </dl>
                          </div>
                        </blockquote>
                      </div>
                    </blockquote>
                  </div>

                  <p>If <em class="replaceable"><code>type</code></em> is
                  <code class="constant">PERF_TYPE_RAW</code>, then
                  a custom "raw" <em class="replaceable"><code>config</code></em> value is
                  needed. Most CPUs support events that are not
                  covered by the "generalized" events. These are
                  implementation defined; see your CPU manual (for
                  example the Intel Volume 3B documentation or the
                  AMD BIOS and Kernel Developer Guide). The libpfm4
                  library can be used to translate from the name in
                  the architectural manuals to the raw hex value
                  <code class="function">perf_event_open</code>()
                  expects in this field.</p>

                  <p>If <em class="replaceable"><code>type</code></em> is
                  <code class="constant">PERF_TYPE_BREAKPOINT</code>, then
                  leave <em class="replaceable"><code>config</code></em> set to
                  zero. Its parameters are set in other places.</p>
                </blockquote>
              </div>
            </dd>

            <dt><span class="term"><em class="replaceable"><code>sample_period</code></em>,
            <em class="replaceable"><code>sample_freq</code></em></span></dt>

            <dd>
              <p>A "sampling" counter is one that generates an
              interrupt every N events, where N is given by
              <em class="replaceable"><code>sample_period</code></em>. A
              sampling counter has <em class="replaceable"><code>sample_period</code></em> &gt; 0.
              When an overflow interrupt occurs, requested data is
              recorded in the mmap buffer. The <em class="replaceable"><code>sample_type</code></em> field
              controls what data is recorded on each interrupt.</p>

              <p><em class="replaceable"><code>sample_freq</code></em> can be
              used if you wish to use frequency rather than period.
              In this case, you set the <em class="replaceable"><code>freq</code></em> flag. The kernel
              will adjust the sampling period to try and achieve
              the desired rate. The rate of adjustment is a timer
              tick.</p>
            </dd>

            <dt><span class="term"><em class="replaceable"><code>sample_type</code></em></span></dt>

            <dd>
              <p>The various bits in this field specify which
              values to include in the sample. They will be
              recorded in a ring-buffer, which is available to user
              space using <a class="link" href="../htmlman2/mmap.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">mmap</span>(2)</span></a>. The order
              in which the values are saved in the sample are
              documented in the MMAP Layout subsection below; it is
              not the <span class="emphasis"><em>enum
              perf_event_sample_format</em></span> order.</p>

              <div class="blockquote">
                <blockquote class="blockquote">
                  <div class="variablelist">
                    <dl class="variablelist">
                      <dt><span class="term"><code class="constant">PERF_SAMPLE_IP</code></span></dt>

                      <dd>
                        <p>Records instruction pointer.</p>
                      </dd>

                      <dt><span class="term"><code class="constant">PERF_SAMPLE_TID</code></span></dt>

                      <dd>
                        <p>Records the process and thread IDs.</p>
                      </dd>

                      <dt><span class="term"><code class="constant">PERF_SAMPLE_TIME</code></span></dt>

                      <dd>
                        <p>Records a timestamp.</p>
                      </dd>

                      <dt><span class="term"><code class="constant">PERF_SAMPLE_ADDR</code></span></dt>

                      <dd>
                        <p>Records an address, if applicable.</p>
                      </dd>

                      <dt><span class="term"><code class="constant">PERF_SAMPLE_READ</code></span></dt>

                      <dd>
                        <p>Record counter values for all events in
                        a group, not just the group leader.</p>
                      </dd>

                      <dt><span class="term"><code class="constant">PERF_SAMPLE_CALLCHAIN</code></span></dt>

                      <dd>
                        <p>Records the callchain (stack
                        backtrace).</p>
                      </dd>

                      <dt><span class="term"><code class="constant">PERF_SAMPLE_ID</code></span></dt>

                      <dd>
                        <p>Records a unique ID for the opened
                        event's group leader.</p>
                      </dd>

                      <dt><span class="term"><code class="constant">PERF_SAMPLE_CPU</code></span></dt>

                      <dd>
                        <p>Records CPU number.</p>
                      </dd>

                      <dt><span class="term"><code class="constant">PERF_SAMPLE_PERIOD</code></span></dt>

                      <dd>
                        <p>Records the current sampling period.</p>
                      </dd>

                      <dt><span class="term"><code class="constant">PERF_SAMPLE_STREAM_ID</code></span></dt>

                      <dd>
                        <p>Records a unique ID for the opened
                        event. Unlike <code class="constant">PERF_SAMPLE_ID</code> the actual
                        ID is returned, not the group leader. This
                        ID is the same as the one returned by
                        <code class="constant">PERF_FORMAT_ID</code>.</p>
                      </dd>

                      <dt><span class="term"><code class="constant">PERF_SAMPLE_RAW</code></span></dt>

                      <dd>
                        <p>Records additional data, if applicable.
                        Usually returned by tracepoint events.</p>
                      </dd>

                      <dt><span class="term"><code class="constant">PERF_SAMPLE_BRANCH_STACK</code>
                      (since Linux 3.4)</span></dt>

                      <dd>
                        <p>This provides a record of recent
                        branches, as provided by CPU branch
                        sampling hardware (such as Intel Last
                        Branch Record). Not all hardware supports
                        this feature.</p>

                        <p>See the <em class="replaceable"><code>branch_sample_type</code></em>
                        field for how to filter which branches are
                        reported.</p>
                      </dd>

                      <dt><span class="term"><code class="constant">PERF_SAMPLE_REGS_USER</code>
                      (since Linux 3.7)</span></dt>

                      <dd>
                        <p>Records the current user-level CPU
                        register state (the values in the process
                        before the kernel was called).</p>
                      </dd>

                      <dt><span class="term"><code class="constant">PERF_SAMPLE_STACK_USER</code>
                      (since Linux 3.7)</span></dt>

                      <dd>
                        <p>Records the user level stack, allowing
                        stack unwinding.</p>
                      </dd>

                      <dt><span class="term"><code class="constant">PERF_SAMPLE_WEIGHT</code> (since
                      Linux 3.10)</span></dt>

                      <dd>
                        <p>Records a hardware provided weight value
                        that expresses how costly the sampled event
                        was. This allows the hardware to highlight
                        expensive events in a profile.</p>
                      </dd>

                      <dt><span class="term"><code class="constant">PERF_SAMPLE_DATA_SRC</code> (since
                      Linux 3.10)</span></dt>

                      <dd>
                        <p>Records the data source: where in the
                        memory hierarchy the data associated with
                        the sampled instruction came from. This is
                        only available if the underlying hardware
                        supports this feature.</p>
                      </dd>

                      <dt><span class="term"><code class="constant">PERF_SAMPLE_IDENTIFIER</code>
                      (since Linux 3.12)</span></dt>

                      <dd>
                        <p>Places the <code class="constant">SAMPLE_ID</code> value in a
                        fixed position in the record, either at the
                        beginning (for sample events) or at the end
                        (if a non-sample event).</p>

                        <p>This was necessary because a sample
                        stream may have records from various
                        different event sources with different
                        <em class="replaceable"><code>sample_type</code></em>
                        settings. Parsing the event stream properly
                        was not possible because the format of the
                        record was needed to find <code class="constant">SAMPLE_ID</code>, but the format
                        could not be found without knowing what
                        event the sample belonged to (causing a
                        circular dependency).</p>

                        <p>This new <code class="constant">PERF_SAMPLE_IDENTIFIER</code>
                        setting makes the event stream always
                        parsable by putting <code class="constant">SAMPLE_ID</code> in a fixed
                        location, even though it means having
                        duplicate <code class="constant">SAMPLE_ID</code> values in
                        records.</p>
                      </dd>

                      <dt><span class="term"><code class="constant">PERF_SAMPLE_TRANSACTION</code>
                      (Since Linux 3.13)</span></dt>

                      <dd>
                        <p>Records reasons for transactional memory
                        abort events (for example, from Intel TSX
                        transactional memory support).</p>

                        <p>The <em class="replaceable"><code>precise_ip</code></em>
                        setting must be greater than 0 and a
                        transactional memory abort event must be
                        measured or no values will be recorded.
                        Also note that some perf_event
                        measurements, such as sampled cycle
                        counting, may cause extraneous aborts (by
                        causing an interrupt during a
                        transaction).</p>
                      </dd>
                    </dl>
                  </div>
                </blockquote>
              </div>
            </dd>

            <dt><span class="term"><em class="replaceable"><code>read_format</code></em></span></dt>

            <dd>
              <p>This field specifies the format of the data
              returned by <a class="link" href="../htmlman2/read.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">read</span>(2)</span></a> on a
              <code class="function">perf_event_open</code>() file
              descriptor.</p>

              <div class="blockquote">
                <blockquote class="blockquote">
                  <div class="variablelist">
                    <dl class="variablelist">
                      <dt><span class="term"><code class="constant">PERF_FORMAT_TOTAL_TIME_ENABLED</code></span></dt>

                      <dd>
                        <p>Adds the 64-bit <em class="replaceable"><code>time_enabled</code></em>
                        field. This can be used to calculate
                        estimated totals if the PMU is
                        overcommitted and multiplexing is
                        happening.</p>
                      </dd>

                      <dt><span class="term"><code class="constant">PERF_FORMAT_TOTAL_TIME_RUNNING</code></span></dt>

                      <dd>
                        <p>Adds the 64-bit <em class="replaceable"><code>time_running</code></em>
                        field. This can be used to calculate
                        estimated totals if the PMU is
                        overcommitted and multiplexing is
                        happening.</p>
                      </dd>

                      <dt><span class="term"><code class="constant">PERF_FORMAT_ID</code></span></dt>

                      <dd>
                        <p>Adds a 64-bit unique value that
                        corresponds to the event group.</p>
                      </dd>

                      <dt><span class="term"><code class="constant">PERF_FORMAT_GROUP</code></span></dt>

                      <dd>
                        <p>Allows all counter values in an event
                        group to be read with one read.</p>
                      </dd>
                    </dl>
                  </div>
                </blockquote>
              </div>
            </dd>

            <dt><span class="term"><em class="replaceable"><code>disabled</code></em></span></dt>

            <dd>
              <p>The <em class="replaceable"><code>disabled</code></em> bit
              specifies whether the counter starts out disabled or
              enabled. If disabled, the event can later be enabled
              by <a class="link" href="../htmlman2/ioctl.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">ioctl</span>(2)</span></a>, <a class="link" href="../htmlman2/prctl.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">prctl</span>(2)</span></a>, or
              <em class="replaceable"><code>enable_on_exec</code></em>.</p>

              <p>When creating an event group, typically the group
              leader is initialized with <em class="replaceable"><code>disabled</code></em> set to 1 and
              any child events are initialized with <em class="replaceable"><code>disabled</code></em> set to 0.
              Despite <em class="replaceable"><code>disabled</code></em> being 0, the
              child events will not start until the group leader is
              enabled.</p>
            </dd>

            <dt><span class="term"><em class="replaceable"><code>inherit</code></em></span></dt>

            <dd>
              <p>The <em class="replaceable"><code>inherit</code></em> bit specifies
              that this counter should count events of child tasks
              as well as the task specified. This applies only to
              new children, not to any existing children at the
              time the counter is created (nor to any new children
              of existing children).</p>

              <p>Inherit does not work for some combinations of
              <em class="replaceable"><code>read_format</code></em>s, such as
              <code class="constant">PERF_FORMAT_GROUP</code>.</p>
            </dd>

            <dt><span class="term"><em class="replaceable"><code>pinned</code></em></span></dt>

            <dd>
              <p>The <em class="replaceable"><code>pinned</code></em> bit specifies
              that the counter should always be on the CPU if at
              all possible. It applies only to hardware counters
              and only to group leaders. If a pinned counter cannot
              be put onto the CPU (e.g., because there are not
              enough hardware counters or because of a conflict
              with some other event), then the counter goes into an
              'error' state, where reads return end-of-file (i.e.,
              <a class="link" href="../htmlman2/read.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">read</span>(2)</span></a> returns 0)
              until the counter is subsequently enabled or
              disabled.</p>
            </dd>

            <dt><span class="term"><em class="replaceable"><code>exclusive</code></em></span></dt>

            <dd>
              <p>The <em class="replaceable"><code>exclusive</code></em> bit
              specifies that when this counter's group is on the
              CPU, it should be the only group using the CPU's
              counters. In the future this may allow monitoring
              programs to support PMU features that need to run
              alone so that they do not disrupt other hardware
              counters.</p>

              <p>Note that many unexpected situations may prevent
              events with the <em class="replaceable"><code>exclusive</code></em> bit set
              from ever running. This includes any users running a
              system-wide measurement as well as any kernel use of
              the performance counters (including the commonly
              enabled NMI Watchdog Timer interface).</p>
            </dd>

            <dt><span class="term"><em class="replaceable"><code>exclude_user</code></em></span></dt>

            <dd>
              <p>If this bit is set, the count excludes events that
              happen in user space.</p>
            </dd>

            <dt><span class="term"><em class="replaceable"><code>exclude_kernel</code></em></span></dt>

            <dd>
              <p>If this bit is set, the count excludes events that
              happen in kernel-space.</p>
            </dd>

            <dt><span class="term"><em class="replaceable"><code>exclude_hv</code></em></span></dt>

            <dd>
              <p>If this bit is set, the count excludes events that
              happen in the hypervisor. This is mainly for PMUs
              that have built-in support for handling this (such as
              POWER). Extra support is needed for handling
              hypervisor measurements on most machines.</p>
            </dd>

            <dt><span class="term"><em class="replaceable"><code>exclude_idle</code></em></span></dt>

            <dd>
              <p>If set, don't count when the CPU is idle.</p>
            </dd>

            <dt><span class="term"><em class="replaceable"><code>mmap</code></em></span></dt>

            <dd>
              <p>The <em class="replaceable"><code>mmap</code></em>
              bit enables generation of <code class="constant">PERF_RECORD_MMAP</code> samples for every
              <a class="link" href="../htmlman2/mmap.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">mmap</span>(2)</span></a> call that
              has <code class="constant">PROT_EXEC</code> set. This
              allows tools to notice new executable code being
              mapped into a program (dynamic shared libraries for
              example) so that addresses can be mapped back to the
              original code.</p>
            </dd>

            <dt><span class="term"><em class="replaceable"><code>comm</code></em></span></dt>

            <dd>
              <p>The <em class="replaceable"><code>comm</code></em>
              bit enables tracking of process command name as
              modified by the <span class="citerefentry"><span class="refentrytitle">exec</span>(2)</span> and
              <code class="function">prctl</code>(PR_SET_NAME)
              system calls as well as writing to <code class="filename">/proc/self/comm</code>. If the <em class="replaceable"><code>comm_exec</code></em> flag is
              also successfully set (possible since Linux 3.16),
              then the misc flag <code class="constant">PERF_RECORD_MISC_COMM_EXEC</code> can be
              used to differentiate the <span class="citerefentry"><span class="refentrytitle">exec</span>(2)</span> case from the
              others.</p>
            </dd>

            <dt><span class="term"><em class="replaceable"><code>freq</code></em></span></dt>

            <dd>
              <p>If this bit is set, then <em class="replaceable"><code>sample_frequency</code></em> not
              <em class="replaceable"><code>sample_period</code></em> is used
              when setting up the sampling interval.</p>
            </dd>

            <dt><span class="term"><em class="replaceable"><code>inherit_stat</code></em></span></dt>

            <dd>
              <p>This bit enables saving of event counts on context
              switch for inherited tasks. This is meaningful only
              if the <em class="replaceable"><code>inherit</code></em> field is
              set.</p>
            </dd>

            <dt><span class="term"><em class="replaceable"><code>enable_on_exec</code></em></span></dt>

            <dd>
              <p>If this bit is set, a counter is automatically
              enabled after a call to <span class="citerefentry"><span class="refentrytitle">exec</span>(2)</span>.</p>
            </dd>

            <dt><span class="term"><em class="replaceable"><code>task</code></em></span></dt>

            <dd>
              <p>If this bit is set, then fork/exit notifications
              are included in the ring buffer.</p>
            </dd>

            <dt><span class="term"><em class="replaceable"><code>watermark</code></em></span></dt>

            <dd>
              <p>If set, have a sampling interrupt happen when we
              cross the <em class="replaceable"><code>wakeup_watermark</code></em>
              boundary. Otherwise, interrupts happen after
              <em class="replaceable"><code>wakeup_events</code></em>
              samples.</p>
            </dd>

            <dt><span class="term"><em class="replaceable"><code>precise_ip</code></em> (since Linux
            2.6.35)</span></dt>

            <dd>
              <p>This controls the amount of skid. Skid is how many
              instructions execute between an event of interest
              happening and the kernel being able to stop and
              record the event. Smaller skid is better and allows
              more accurate reporting of which events correspond to
              which instructions, but hardware is often limited
              with how small this can be.</p>

              <p>The values of this are the following:</p>

              <div class="blockquote">
                <blockquote class="blockquote">
                  <div class="variablelist">
                    <dl class="variablelist">
                      <dt><span class="term">0 -</span></dt>

                      <dd>
                        <p><code class="constant">SAMPLE_IP</code>
                        can have arbitrary skid.</p>
                      </dd>

                      <dt><span class="term">1 -</span></dt>

                      <dd>
                        <p><code class="constant">SAMPLE_IP</code>
                        must have constant skid.</p>
                      </dd>

                      <dt><span class="term">2 -</span></dt>

                      <dd>
                        <p><code class="constant">SAMPLE_IP</code>
                        requested to have 0 skid.</p>
                      </dd>

                      <dt><span class="term">3 -</span></dt>

                      <dd>
                        <p><code class="constant">SAMPLE_IP</code>
                        must have 0 skid. See also <code class="constant">PERF_RECORD_MISC_EXACT_IP</code>.</p>
                      </dd>
                    </dl>
                  </div>
                </blockquote>
              </div>
            </dd>

            <dt><span class="term"><em class="replaceable"><code>mmap_data</code></em> (since Linux
            2.6.36)</span></dt>

            <dd>
              <p>The counterpart of the <em class="replaceable"><code>mmap</code></em> field. This
              enables generation of <code class="constant">PERF_RECORD_MMAP</code> samples for
              <a class="link" href="../htmlman2/mmap.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">mmap</span>(2)</span></a> calls that
              do not have <code class="constant">PROT_EXEC</code>
              set (for example data and SysV shared memory).</p>
            </dd>

            <dt><span class="term"><em class="replaceable"><code>sample_id_all</code></em> (since
            Linux 2.6.38)</span></dt>

            <dd>
              <p>If set, then TID, TIME, ID, STREAM_ID, and CPU can
              additionally be included in non-<code class="constant">PERF_RECORD_SAMPLE</code>s if the
              corresponding <em class="replaceable"><code>sample_type</code></em> is
              selected.</p>

              <p>If <code class="constant">PERF_SAMPLE_IDENTIFIER</code> is
              specified, then an additional ID value is included as
              the last value to ease parsing the record stream.
              This may lead to the <em class="replaceable"><code>id</code></em> value appearing
              twice.</p>

              <p>The layout is described by this
              pseudo-structure:</p>

              <div class="blockquote">
                <blockquote class="blockquote">
                  <div class="informalexample">
                    <pre class="programlisting" xml:space="preserve">
struct sample_id {
    { u32 pid, tid; } /* if PERF_SAMPLE_TID set        */
    { u64 time;     } /* if PERF_SAMPLE_TIME set       */
    { u64 id;       } /* if PERF_SAMPLE_ID set         */
    { u64 stream_id;} /* if PERF_SAMPLE_STREAM_ID set  */
    { u32 cpu, res; } /* if PERF_SAMPLE_CPU set        */
    { u64 id;       } /* if PERF_SAMPLE_IDENTIFIER set */
};
</pre>
                  </div>

                  <div class="variablelist">
                    <dl class="variablelist">
                      <dt><span class="term"><em class="replaceable"><code>exclude_host</code></em>
                      (since Linux 3.2)</span></dt>

                      <dd>
                        <p>Do not measure time spent in VM
                        host.</p>
                      </dd>

                      <dt><span class="term"><em class="replaceable"><code>exclude_guest</code></em>
                      (since Linux 3.2)</span></dt>

                      <dd>
                        <p>Do not measure time spent in VM
                        guest.</p>
                      </dd>

                      <dt><span class="term"><em class="replaceable"><code>exclude_callchain_kernel</code></em>
                      (since Linux 3.7)</span></dt>

                      <dd>
                        <p>Do not include kernel callchains.</p>
                      </dd>

                      <dt><span class="term"><em class="replaceable"><code>exclude_callchain_user</code></em>
                      (since Linux 3.7)</span></dt>

                      <dd>
                        <p>Do not include user callchains.</p>
                      </dd>

                      <dt><span class="term"><em class="replaceable"><code>mmap2</code></em> (since
                      Linux 3.16)</span></dt>

                      <dd>
                        <p>Generate an extended executable mmap
                        record that contains enough additional
                        information to uniquely identify shared
                        mappings. The <em class="replaceable"><code>mmap</code></em> flag
                        must also be set for this to work.</p>
                      </dd>

                      <dt><span class="term"><em class="replaceable"><code>comm_exec</code></em>
                      (since Linux 3.16)</span></dt>

                      <dd>
                        <p>This is purely a feature-detection flag,
                        it does not change kernel behavior. If this
                        flag can successfully be set, then, when
                        <em class="replaceable"><code>comm</code></em> is
                        enabled, the <code class="constant">PERF_RECORD_MISC_COMM_EXEC</code>
                        flag will be set in the <em class="replaceable"><code>misc</code></em> field
                        of a comm record header if the rename event
                        being reported was caused by a call to
                        <span class="citerefentry"><span class="refentrytitle">exec</span>(2)</span>. This
                        allows tools to distinguish between the
                        various types of process renaming.</p>
                      </dd>

                      <dt><span class="term"><em class="replaceable"><code>wakeup_events</code></em>,
                      <em class="replaceable"><code>wakeup_watermark</code></em></span></dt>

                      <dd>
                        <p>This union sets how many samples
                        (<em class="replaceable"><code>wakeup_events</code></em>)
                        or bytes (<em class="replaceable"><code>wakeup_watermark</code></em>)
                        happen before an overflow signal happens.
                        Which one is used is selected by the
                        <em class="replaceable"><code>watermark</code></em>
                        bit flag.</p>

                        <p><em class="replaceable"><code>wakeup_events</code></em>
                        only counts <code class="constant">PERF_RECORD_SAMPLE</code> record
                        types. To receive a signal for every
                        incoming <code class="constant">PERF_RECORD</code> type set
                        <em class="replaceable"><code>wakeup_watermark</code></em>
                        to 1.</p>
                      </dd>

                      <dt><span class="term"><em class="replaceable"><code>bp_type</code></em>
                      (since Linux 2.6.33)</span></dt>

                      <dd>
                        <p>This chooses the breakpoint type. It is
                        one of:</p>

                        <div class="blockquote">
                          <blockquote class="blockquote">
                            <div class="variablelist">
                              <dl class="variablelist">
                                <dt><span class="term"><code class="constant">HW_BREAKPOINT_EMPTY</code></span></dt>

                                <dd>
                                  <p>No breakpoint.</p>
                                </dd>

                                <dt><span class="term"><code class="constant">HW_BREAKPOINT_R</code></span></dt>

                                <dd>
                                  <p>Count when we read the memory
                                  location.</p>
                                </dd>

                                <dt><span class="term"><code class="constant">HW_BREAKPOINT_W</code></span></dt>

                                <dd>
                                  <p>Count when we write the memory
                                  location.</p>
                                </dd>

                                <dt><span class="term"><code class="constant">HW_BREAKPOINT_RW</code></span></dt>

                                <dd>
                                  <p>Count when we read or write
                                  the memory location.</p>
                                </dd>

                                <dt><span class="term"><code class="constant">HW_BREAKPOINT_X</code></span></dt>

                                <dd>
                                  <p>Count when we execute code at
                                  the memory location.</p>
                                </dd>
                              </dl>
                            </div>

                            <p>The values can be combined via a
                            bitwise or, but the combination of
                            <code class="constant">HW_BREAKPOINT_R</code> or
                            <code class="constant">HW_BREAKPOINT_W</code> with
                            <code class="constant">HW_BREAKPOINT_X</code> is
                            not allowed.</p>
                          </blockquote>
                        </div>
                      </dd>

                      <dt><span class="term"><em class="replaceable"><code>bp_addr</code></em>
                      (since Linux 2.6.33)</span></dt>

                      <dd>
                        <p><em class="replaceable"><code>bp_addr</code></em>
                        address of the breakpoint. For execution
                        breakpoints this is the memory address of
                        the instruction of interest; for read and
                        write breakpoints it is the memory address
                        of the memory location of interest.</p>
                      </dd>

                      <dt><span class="term"><em class="replaceable"><code>config1</code></em>
                      (since Linux 2.6.39)</span></dt>

                      <dd>
                        <p><em class="replaceable"><code>config1</code></em> is
                        used for setting events that need an extra
                        register or otherwise do not fit in the
                        regular config field. Raw OFFCORE_EVENTS on
                        Nehalem/Westmere/SandyBridge use this field
                        on 3.3 and later kernels.</p>
                      </dd>

                      <dt><span class="term"><em class="replaceable"><code>bp_len</code></em> (since
                      Linux 2.6.33)</span></dt>

                      <dd>
                        <p><em class="replaceable"><code>bp_len</code></em> is
                        the length of the breakpoint being measured
                        if <em class="replaceable"><code>type</code></em> is
                        <code class="constant">PERF_TYPE_BREAKPOINT</code>.
                        Options are <code class="constant">HW_BREAKPOINT_LEN_1</code>,
                        <code class="constant">HW_BREAKPOINT_LEN_2</code>,
                        <code class="constant">HW_BREAKPOINT_LEN_4</code>,
                        <code class="constant">HW_BREAKPOINT_LEN_8</code>. For
                        an execution breakpoint, set this to
                        <em class="replaceable"><code>sizeof(long)</code></em>.</p>
                      </dd>

                      <dt><span class="term"><em class="replaceable"><code>config2</code></em>
                      (since Linux 2.6.39)</span></dt>

                      <dd>
                        <p><em class="replaceable"><code>config2</code></em> is
                        a further extension of the <em class="replaceable"><code>config1</code></em>
                        field.</p>
                      </dd>

                      <dt><span class="term"><em class="replaceable"><code>branch_sample_type</code></em>
                      (since Linux 3.4)</span></dt>

                      <dd>
                        <p>If <code class="constant">PERF_SAMPLE_BRANCH_STACK</code>
                        is enabled, then this specifies what
                        branches to include in the branch
                        record.</p>

                        <p>The first part of the value is the
                        privilege level, which is a combination of
                        one of the following values. If the user
                        does not set privilege level explicitly,
                        the kernel will use the event's privilege
                        level. Event and branch privilege levels do
                        not have to match.</p>

                        <div class="blockquote">
                          <blockquote class="blockquote">
                            <div class="variablelist">
                              <dl class="variablelist">
                                <dt><span class="term"><code class="constant">PERF_SAMPLE_BRANCH_USER</code></span></dt>

                                <dd>
                                  <p>Branch target is in user
                                  space.</p>
                                </dd>

                                <dt><span class="term"><code class="constant">PERF_SAMPLE_BRANCH_KERNEL</code></span></dt>

                                <dd>
                                  <p>Branch target is in kernel
                                  space.</p>
                                </dd>

                                <dt><span class="term"><code class="constant">PERF_SAMPLE_BRANCH_HV</code></span></dt>

                                <dd>
                                  <p>Branch target is in
                                  hypervisor.</p>
                                </dd>

                                <dt><span class="term"><code class="constant">PERF_SAMPLE_BRANCH_PLM_ALL</code></span></dt>

                                <dd>
                                  <p>A convenience value that is
                                  the three preceding values ORed
                                  together.</p>

                                  <p>In addition to the privilege
                                  value, at least one or more of
                                  the following bits must be
                                  set.</p>
                                </dd>

                                <dt><span class="term"><code class="constant">PERF_SAMPLE_BRANCH_ANY</code></span></dt>

                                <dd>
                                  <p>Any branch type.</p>
                                </dd>

                                <dt><span class="term"><code class="constant">PERF_SAMPLE_BRANCH_ANY_CALL</code></span></dt>

                                <dd>
                                  <p>Any call branch.</p>
                                </dd>

                                <dt><span class="term"><code class="constant">PERF_SAMPLE_BRANCH_ANY_RETURN</code></span></dt>

                                <dd>
                                  <p>Any return branch.</p>
                                </dd>

                                <dt><span class="term"><code class="constant">PERF_SAMPLE_BRANCH_IND_CALL</code></span></dt>

                                <dd>
                                  <p>Indirect calls.</p>
                                </dd>

                                <dt><span class="term"><code class="constant">PERF_SAMPLE_BRANCH_COND</code>
                                (since Linux 3.16)</span></dt>

                                <dd>
                                  <p>Conditional branches.</p>
                                </dd>

                                <dt><span class="term"><code class="constant">PERF_SAMPLE_BRANCH_ABORT_TX</code>
                                (since Linux 3.11)</span></dt>

                                <dd>
                                  <p>Transactional memory
                                  aborts.</p>
                                </dd>

                                <dt><span class="term"><code class="constant">PERF_SAMPLE_BRANCH_IN_TX</code>
                                (since Linux 3.11)</span></dt>

                                <dd>
                                  <p>Branch in transactional memory
                                  transaction.</p>
                                </dd>

                                <dt><span class="term"><code class="constant">PERF_SAMPLE_BRANCH_NO_TX</code>
                                (since Linux 3.11)</span></dt>

                                <dd>
                                  <p>Branch not in transactional
                                  memory transaction.</p>
                                </dd>
                              </dl>
                            </div>
                          </blockquote>
                        </div>
                      </dd>

                      <dt><span class="term"><em class="replaceable"><code>sample_regs_user</code></em>
                      (since Linux 3.7)</span></dt>

                      <dd>
                        <p>This bit mask defines the set of user
                        CPU registers to dump on samples. The
                        layout of the register mask is
                        architecture-specific and described in the
                        kernel header <code class="filename">arch/ARCH/include/uapi/asm/perf_regs.h</code>.</p>
                      </dd>

                      <dt><span class="term"><em class="replaceable"><code>sample_stack_user</code></em>
                      (since Linux 3.7)</span></dt>

                      <dd>
                        <p>This defines the size of the user stack
                        to dump if <code class="constant">PERF_SAMPLE_STACK_USER</code> is
                        specified.</p>
                      </dd>
                    </dl>
                  </div>
                </blockquote>
              </div>
            </dd>
          </dl>
        </div>
      </div>

      <div class="refsect2">
        <a id="perf-event-open-2_sect3" name="perf-event-open-2_sect3" shape="rect"> </a>

        <h3>Reading results</h3>

        <p>Once a <code class="function">perf_event_open</code>()
        file descriptor has been opened, the values of the events
        can be read from the file descriptor. The values that are
        there are specified by the <em class="replaceable"><code>read_format</code></em> field in the
        <em class="parameter"><code>attr</code></em> structure at
        open time.</p>

        <p>If you attempt to read into a buffer that is not big
        enough to hold the data <span class="errorname">ENOSPC</span> is returned</p>

        <p>Here is the layout of the data returned by a read:</p>

        <div class="itemizedlist">
          <ul class="itemizedlist" style="list-style-type: disc;">
            <li class="listitem">
              <p>If <code class="constant">PERF_FORMAT_GROUP</code>
              was specified to allow reading all events in a group
              at once:</p>

              <div class="blockquote">
                <blockquote class="blockquote">
                  <div class="informalexample">
                    <pre class="programlisting" xml:space="preserve">
struct read_format {
    u64 nr;            /* The number of events */
    u64 time_enabled;  /* if PERF_FORMAT_TOTAL_TIME_ENABLED */
    u64 time_running;  /* if PERF_FORMAT_TOTAL_TIME_RUNNING */
    struct
        u64 value;     /* The value of the event */
        u64 id;        /* if PERF_FORMAT_ID */
    } values[nr];
};
</pre>
                  </div>
                </blockquote>
              </div>
            </li>

            <li class="listitem">
              <p>If <code class="constant">PERF_FORMAT_GROUP</code>
              was <em class="replaceable"><code>not</code></em>
              specified:</p>

              <div class="blockquote">
                <blockquote class="blockquote">
                  <div class="structdef">
                    <table style="border-collapse: collapse;">
                      <colgroup span="1">
                        <col class="c1" span="1" />
                        <col class="c2" span="1" />
                        <col class="c3" span="1" />
                        <col class="c4" span="1" />
                        <col class="c5" span="1" />
                      </colgroup>

                      <tbody>
                        <tr>
                          <td class="structdefhdr" style="" align="left" rowspan="1" colspan="1">struct</td>

                          <td class="structdefhdr" style="" colspan="4" align="left" rowspan="1"><span class="structname">read_format</span> {</td>
                        </tr>

                        <tr>
                          <td style="" rowspan="1" colspan="1"> </td>

                          <td style="" align="left" rowspan="1" colspan="1"><span class="type">u64</span></td>

                          <td class="norightpad" style="" align="right" rowspan="1" colspan="1"> </td>

                          <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>value</code></em>;</td>

                          <td style="" align="left" rowspan="1" colspan="1">
                            <div class="literallayout">
                              
                              /* The value of the event */
                            </div>
                          </td>
                        </tr>

                        <tr>
                          <td style="" rowspan="1" colspan="1"> </td>

                          <td style="" align="left" rowspan="1" colspan="1"><span class="type">u64</span></td>

                          <td class="norightpad" style="" align="right" rowspan="1" colspan="1"> </td>

                          <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>time_enabled</code></em>;</td>

                          <td style="" align="left" rowspan="1" colspan="1">
                            <div class="literallayout">
                              
                              /* if PERF_FORMAT_TOTAL_TIME_ENABLED */
                            </div>
                          </td>
                        </tr>

                        <tr>
                          <td style="" rowspan="1" colspan="1"> </td>

                          <td style="" align="left" rowspan="1" colspan="1"><span class="type">u64</span></td>

                          <td class="norightpad" style="" align="right" rowspan="1" colspan="1"> </td>

                          <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>time_running</code></em>;</td>

                          <td style="" align="left" rowspan="1" colspan="1">
                            <div class="literallayout">
                              
                              /* if PERF_FORMAT_TOTAL_TIME_RUNNING */
                            </div>
                          </td>
                        </tr>

                        <tr>
                          <td style="" rowspan="1" colspan="1"> </td>

                          <td style="" align="left" rowspan="1" colspan="1"><span class="type">u64</span></td>

                          <td class="norightpad" style="" align="right" rowspan="1" colspan="1"> </td>

                          <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>id</code></em>;</td>

                          <td style="" align="left" rowspan="1" colspan="1">
                            <div class="literallayout">
                              
                              /* if PERF_FORMAT_ID */
                            </div>
                          </td>
                        </tr>

                        <tr>
                          <td class="structdefftr" style="" colspan="5" align="left" rowspan="1">};</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </blockquote>
              </div>
            </li>
          </ul>
        </div>

        <p>The values read are as follows:</p>

        <div class="variablelist">
          <dl class="variablelist">
            <dt><span class="term"><em class="replaceable"><code>nr</code></em></span></dt>

            <dd>
              <p>The number of events in this file descriptor. Only
              available if <code class="constant">PERF_FORMAT_GROUP</code> was
              specified.</p>
            </dd>

            <dt><span class="term"><em class="parameter"><code>time_enabled</code></em>, <em class="parameter"><code>time_running</code></em></span></dt>

            <dd>
              <p>Total time the event was enabled and running.
              Normally these are the same. If more events are
              started, then available counter slots on the PMU,
              then multiplexing happens and events run only part of
              the time. In that case, the <em class="parameter"><code>time_enabled</code></em> and
              <span class="emphasis"><em>time running</em></span>
              values can be used to scale an estimated value for
              the count.</p>
            </dd>

            <dt><span class="term"><em class="parameter"><code>value</code></em></span></dt>

            <dd>
              <p>An unsigned 64-bit value containing the counter
              result.</p>
            </dd>

            <dt><span class="term"><em class="parameter"><code>id</code></em></span></dt>

            <dd>
              <p>A globally unique value for this particular event,
              only there if <code class="constant">PERF_FORMAT_ID</code> was specified in
              <em class="replaceable"><code>read_format</code></em>.</p>
            </dd>
          </dl>
        </div>
      </div>

      <div class="refsect2">
        <a id="perf-event-open-2_sect4" name="perf-event-open-2_sect4" shape="rect"> </a>

        <h3>MMAP layout</h3>

        <p>When using <code class="function">perf_event_open</code>() in sampled mode,
        asynchronous events (like counter overflow or <code class="constant">PROT_EXEC</code> mmap tracking) are logged into
        a ring-buffer. This ring-buffer is created and accessed
        through <a class="link" href="../htmlman2/mmap.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">mmap</span>(2)</span></a>.</p>

        <p>The mmap size should be 1+2^n pages, where the first
        page is a metadata page (<span class="emphasis"><em>struct
        perf_event_mmap_page</em></span>) that contains various
        bits of information such as where the ring-buffer head
        is.</p>

        <p>Before kernel 2.6.39, there is a bug that means you must
        allocate a mmap ring buffer when sampling even if you do
        not plan to access it.</p>

        <p>The structure of the first metadata mmap page is as
        follows:</p>

        <div class="blockquote">
          <blockquote class="blockquote">
            <div class="informalexample">
              <pre class="programlisting" xml:space="preserve">
struct perf_event_mmap_page {
    __u32 version;        /* version number of this structure */
    __u32 compat_version; /* lowest version this is compat with */
    __u32 lock;           /* seqlock for synchronization */
    __u32 index;          /* hardware counter identifier */
    __s64 offset;         /* add to hardware counter value */
    __u64 time_enabled;   /* time event active */
    __u64 time_running;   /* time event on CPU */
    union {
        __u64   capabilities;
        struct {
            __u64 cap_usr_time / cap_usr_rdpmc / cap_bit0 : 1,
                  cap_bit0_is_deprecated : 1,
                  cap_user_rdpmc         : 1,
                  cap_user_time          : 1,
                  cap_user_time_zero     : 1,
        };
    };
    __u16 pmc_width;
    __u16 time_shift;
    __u32 time_mult;
    __u64 time_offset;
    __u64 __reserved[120];   /* Pad to 1k */
    __u64 data_head;         /* head in the data section */
    __u64 data_tail;         /* user-space written tail */
}
</pre>
            </div>
          </blockquote>
        </div>

        <p>The following list describes the fields in the
        <em class="replaceable"><code>perf_event_mmap_page</code></em>
        structure in more detail:</p>

        <div class="variablelist">
          <dl class="variablelist">
            <dt><span class="term"><em class="replaceable"><code>version</code></em></span></dt>

            <dd>
              <p>Version number of this structure.</p>
            </dd>

            <dt><span class="term"><em class="replaceable"><code>compat_version</code></em></span></dt>

            <dd>
              <p>The lowest version this is compatible with.</p>
            </dd>

            <dt><span class="term"><em class="replaceable"><code>lock</code></em></span></dt>

            <dd>
              <p>A seqlock for synchronization.</p>
            </dd>

            <dt><span class="term"><em class="replaceable"><code>index</code></em></span></dt>

            <dd>
              <p>A unique hardware counter identifier.</p>
            </dd>

            <dt><span class="term"><em class="replaceable"><code>offset</code></em></span></dt>

            <dd>
              <p>When using rdpmc for reads this offset value must
              be added to the one returned by rdpmc to get the
              current total event count.</p>
            </dd>

            <dt><span class="term"><em class="parameter"><code>time_enabled</code></em></span></dt>

            <dd>
              <p>Time the event was active.</p>
            </dd>

            <dt><span class="term"><em class="parameter"><code>time_running</code></em></span></dt>

            <dd>
              <p>Time the event was running.</p>
            </dd>

            <dt><span class="term"><em class="replaceable"><code>cap_usr_time</code></em> /
            <em class="replaceable"><code>cap_usr_rdpmc</code></em>
            / <em class="replaceable"><code>cap_bit0</code></em>
            (since Linux 3.4)</span></dt>

            <dd>
              <p>There was a bug in the definition of <em class="replaceable"><code>cap_usr_time</code></em> and
              <em class="replaceable"><code>cap_usr_rdpmc</code></em> from
              Linux 3.4 until Linux 3.11. Both bits were defined to
              point to the same location, so it was impossible to
              know if <em class="replaceable"><code>cap_usr_time</code></em> or
              <em class="replaceable"><code>cap_usr_rdpmc</code></em> were
              actually set.</p>

              <p>Starting with 3.12 these are renamed to <em class="replaceable"><code>cap_bit0</code></em> and you
              should use the new <em class="replaceable"><code>cap_user_time</code></em> and
              <em class="replaceable"><code>cap_user_rdpmc</code></em> fields
              instead.</p>
            </dd>

            <dt><span class="term"><em class="replaceable"><code>cap_bit0_is_deprecated</code></em>
            (since Linux 3.12)</span></dt>

            <dd>
              <p>If set, this bit indicates that the kernel
              supports the properly separated <em class="replaceable"><code>cap_user_time</code></em> and
              <em class="replaceable"><code>cap_user_rdpmc</code></em>
              bits.</p>

              <p>If not-set, it indicates an older kernel where
              <em class="replaceable"><code>cap_usr_time</code></em> and
              <em class="replaceable"><code>cap_usr_rdpmc</code></em> map to
              the same bit and thus both features should be used
              with caution.</p>
            </dd>

            <dt><span class="term"><em class="replaceable"><code>cap_user_rdpmc</code></em> (since
            Linux 3.12)</span></dt>

            <dd>
              <p>If the hardware supports user-space read of
              performance counters without syscall (this is the
              "rdpmc" instruction on x86), then the following code
              can be used to do a read:</p>

              <div class="blockquote">
                <blockquote class="blockquote">
                  <div class="informalexample">
                    <pre class="programlisting" xml:space="preserve">
u32 seq, time_mult, time_shift, idx, width;
u64 count, enabled, running;
u64 cyc, time_offset;

do {
    seq = pc−&gt;lock;
    barrier();
    enabled = pc−&gt;time_enabled;
    running = pc−&gt;time_running;

    if (pc−&gt;cap_usr_time &amp;&amp; enabled != running) {
        cyc = rdtsc();
        time_offset = pc−&gt;time_offset;
        time_mult   = pc−&gt;time_mult;
        time_shift  = pc−&gt;time_shift;
    }

    idx = pc−&gt;index;
    count = pc−&gt;offset;

    if (pc−&gt;cap_usr_rdpmc &amp;&amp; idx) {
        width = pc−&gt;pmc_width;
        count += rdpmc(idx − 1);
    }

    barrier();
} while (pc−&gt;lock != seq);
</pre>
                  </div>
                </blockquote>
              </div>
            </dd>

            <dt><span class="term"><span class="emphasis"><em>cap_user_time (since Linux
            3.12)</em></span></span></dt>

            <dd>
              <p>This bit indicates the hardware has a constant,
              nonstop timestamp counter (TSC on x86).</p>
            </dd>

            <dt><span class="term"><em class="replaceable"><code>cap_user_time_zero</code></em>
            (since Linux 3.12)</span></dt>

            <dd>
              <p>Indicates the presence of <em class="replaceable"><code>time_zero</code></em> which
              allows mapping timestamp values to the hardware
              clock.</p>
            </dd>

            <dt><span class="term"><em class="replaceable"><code>pmc_width</code></em></span></dt>

            <dd>
              <p>If <em class="replaceable"><code>cap_usr_rdpmc</code></em>, this
              field provides the bit-width of the value read using
              the rdpmc or equivalent instruction. This can be used
              to sign extend the result like:</p>

              <div class="blockquote">
                <blockquote class="blockquote">
                  <div class="informalexample">
                    <pre class="programlisting" xml:space="preserve">
pmc &lt;&lt;= 64 − pmc_width;
pmc &gt;&gt;= 64 − pmc_width; // signed shift right
count += pmc;
</pre>
                  </div>
                </blockquote>
              </div>
            </dd>

            <dt><span class="term"><em class="replaceable"><code>time_shift</code></em>, <em class="replaceable"><code>time_mult</code></em>, <em class="replaceable"><code>time_offset</code></em></span></dt>

            <dd>
              <p>If <em class="replaceable"><code>cap_usr_time</code></em>, these
              fields can be used to compute the time delta since
              time_enabled (in nanoseconds) using rdtsc or
              similar.</p>

              <div class="informalexample">
                <pre class="programlisting" xml:space="preserve">
    u64 quot, rem;
    u64 delta;
    quot = (cyc &gt;&gt; time_shift);
    rem = cyc &amp; ((1 &lt;&lt; time_shift) − 1);
    delta = time_offset + quot * time_mult +
            ((rem * time_mult) &gt;&gt; time_shift);
</pre>
              </div>

              <p>Where <em class="replaceable"><code>time_offset</code></em>,
              <em class="replaceable"><code>time_mult</code></em>,
              <em class="replaceable"><code>time_shift</code></em>,
              and <em class="replaceable"><code>cyc</code></em> are
              read in the seqcount loop described above. This delta
              can then be added to enabled and possible running (if
              idx), improving the scaling:</p>

              <div class="informalexample">
                <pre class="programlisting" xml:space="preserve">
    enabled += delta;
    if (idx)
        running += delta;
    quot = count / running;
    rem  = count % running;
    count = quot * enabled + (rem * enabled) / running;
</pre>
              </div>
            </dd>

            <dt><span class="term"><em class="replaceable"><code>time_zero</code></em> (since Linux
            3.12)</span></dt>

            <dd>
              <p>If <em class="replaceable"><code>cap_usr_time_zero</code></em> is
              set, then the hardware clock (the TSC timestamp
              counter on x86) can be calculated from the <em class="replaceable"><code>time_zero</code></em>, <em class="replaceable"><code>time_mult</code></em>, and
              <em class="replaceable"><code>time_shift</code></em>
              values:</p>

              <div class="informalexample">
                <pre class="programlisting" xml:space="preserve">
    time = timestamp - time_zero;
    quot = time / time_mult;
    rem  = time % time_mult;
    cyc = (quot &lt;&lt; time_shift) + (rem &lt;&lt; time_shift) / time_mult;
</pre>
              </div>

              <p>And vice versa:</p>

              <div class="informalexample">
                <pre class="programlisting" xml:space="preserve">
    quot = cyc &gt;&gt; time_shift;
    rem  = cyc &amp; ((1 &lt;&lt; time_shift) - 1);
    timestamp = time_zero + quot * time_mult +
        ((rem * time_mult) &gt;&gt; time_shift);
</pre>
              </div>
            </dd>

            <dt><span class="term"><em class="replaceable"><code>data_head</code></em></span></dt>

            <dd>
              <p>This points to the head of the data section. The
              value continuously increases, it does not wrap. The
              value needs to be manually wrapped by the size of the
              mmap buffer before accessing the samples.</p>

              <p>On SMP-capable platforms, after reading the
              <em class="replaceable"><code>data_head</code></em>
              value, user space should issue an rmb().</p>
            </dd>

            <dt><span class="term"><em class="replaceable"><code>data_tail</code></em></span></dt>

            <dd>
              <p>When the mapping is <code class="constant">PROT_WRITE</code>, the <em class="replaceable"><code>data_tail</code></em> value
              should be written by user space to reflect the last
              read data. In this case, the kernel will not
              overwrite unread data.</p>
            </dd>
          </dl>
        </div>

        <p>The following 2^n ring-buffer pages have the layout
        described below.</p>

        <p>If <em class="replaceable"><code>perf_event_attr.sample_id_all</code></em>
        is set, then all event types will have the sample_type
        selected fields related to where/when (identity) an event
        took place (TID, TIME, ID, CPU, STREAM_ID) described in
        <code class="constant">PERF_RECORD_SAMPLE</code> below, it
        will be stashed just after the <em class="replaceable"><code>perf_event_header</code></em> and the
        fields already present for the existing fields, that is, at
        the end of the payload. That way a newer perf.data file
        will be supported by older perf tools, with these new
        optional fields being ignored.</p>

        <p>The mmap values start with a header:</p>

        <div class="blockquote">
          <blockquote class="blockquote">
            <div class="structdef">
              <table style="border-collapse: collapse;">
                <colgroup span="1">
                  <col class="c1" span="1" />
                  <col class="c2" span="1" />
                  <col class="c3" span="1" />
                  <col class="c4" span="1" />
                  <col class="c5" span="1" />
                </colgroup>

                <tbody>
                  <tr>
                    <td class="structdefhdr" style="" align="left" rowspan="1" colspan="1">
                    struct</td>

                    <td class="structdefhdr" style="" colspan="4" align="left" rowspan="1"><span class="structname">perf_event_header</span> {</td>
                  </tr>

                  <tr>
                    <td style="" rowspan="1" colspan="1"> </td>

                    <td style="" align="left" rowspan="1" colspan="1"><span class="type">__u32</span></td>

                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                     </td>

                    <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>type</code></em>;</td>

                    <td style="" align="left" rowspan="1" colspan="1"> </td>
                  </tr>

                  <tr>
                    <td style="" rowspan="1" colspan="1"> </td>

                    <td style="" align="left" rowspan="1" colspan="1"><span class="type">__u16</span></td>

                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                     </td>

                    <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>misc</code></em>;</td>

                    <td style="" align="left" rowspan="1" colspan="1"> </td>
                  </tr>

                  <tr>
                    <td style="" rowspan="1" colspan="1"> </td>

                    <td style="" align="left" rowspan="1" colspan="1"><span class="type">__u16</span></td>

                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                     </td>

                    <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>size</code></em>;</td>

                    <td style="" align="left" rowspan="1" colspan="1"> </td>
                  </tr>

                  <tr>
                    <td class="structdefftr" style="" colspan="5" align="left" rowspan="1">};</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </blockquote>
        </div>

        <p>Below, we describe the <em class="replaceable"><code>perf_event_header</code></em> fields in
        more detail. For ease of reading, the fields with shorter
        descriptions are presented first.</p>

        <div class="variablelist">
          <dl class="variablelist">
            <dt><span class="term"><em class="parameter"><code>size</code></em></span></dt>

            <dd>
              <p>This indicates the size of the record.</p>
            </dd>

            <dt><span class="term"><em class="parameter"><code>misc</code></em></span></dt>

            <dd>
              <p>The <em class="parameter"><code>misc</code></em>
              field contains additional information about the
              sample.</p>

              <p>The CPU mode can be determined from this value by
              masking with <code class="constant">PERF_RECORD_MISC_CPUMODE_MASK</code> and
              looking for one of the following (note these are not
              bit masks, only one can be set at a time):</p>

              <div class="blockquote">
                <blockquote class="blockquote">
                  <div class="variablelist">
                    <dl class="variablelist">
                      <dt><span class="term"><code class="constant">PERF_RECORD_MISC_CPUMODE_UNKNOWN</code></span></dt>

                      <dd>
                        <p>Unknown CPU mode.</p>
                      </dd>

                      <dt><span class="term"><code class="constant">PERF_RECORD_MISC_KERNEL</code></span></dt>

                      <dd>
                        <p>Sample happened in the kernel.</p>
                      </dd>

                      <dt><span class="term"><code class="constant">PERF_RECORD_MISC_USER</code></span></dt>

                      <dd>
                        <p>Sample happened in user code.</p>
                      </dd>

                      <dt><span class="term"><code class="constant">PERF_RECORD_MISC_HYPERVISOR</code></span></dt>

                      <dd>
                        <p>Sample happened in the hypervisor.</p>
                      </dd>

                      <dt><span class="term"><code class="constant">PERF_RECORD_MISC_GUEST_KERNEL</code></span></dt>

                      <dd>
                        <p>Sample happened in the guest kernel.</p>
                      </dd>

                      <dt><span class="term"><code class="constant">PERF_RECORD_MISC_GUEST_USER</code></span></dt>

                      <dd>
                        <p>Sample happened in guest user code.</p>
                      </dd>
                    </dl>
                  </div>
                </blockquote>
              </div>

              <div class="blockquote">
                <blockquote class="blockquote">
                  <p>In addition, one of the following bits can be
                  set:</p>

                  <div class="variablelist">
                    <dl class="variablelist">
                      <dt><span class="term"><code class="constant">PERF_RECORD_MISC_MMAP_DATA</code></span></dt>

                      <dd>
                        <p>This is set when the mapping is not
                        executable; otherwise the mapping is
                        executable.</p>
                      </dd>

                      <dt><span class="term"><code class="constant">PERF_RECORD_MISC_COMM_EXEC</code></span></dt>

                      <dd>
                        <p>This is set for a <code class="constant">PERF_RECORD_COMM</code> record
                        on kernels more recent than Linux 3.16 if a
                        process name change was caused by an
                        <span class="citerefentry"><span class="refentrytitle">exec</span>(2)</span>
                        system call. It is an alias for
                        <code class="constant">PERF_RECORD_MISC_MMAP_DATA</code>
                        since the two values would not be set in
                        the same record.</p>
                      </dd>

                      <dt><span class="term"><code class="constant">PERF_RECORD_MISC_EXACT_IP</code></span></dt>

                      <dd>
                        <p>This indicates that the content of
                        <code class="constant">PERF_SAMPLE_IP</code> points to
                        the actual instruction that triggered the
                        event. See also <em class="replaceable"><code>perf_event_attr.precise_ip</code></em>.</p>
                      </dd>

                      <dt><span class="term"><code class="constant">PERF_RECORD_MISC_EXT_RESERVED</code></span></dt>

                      <dd>
                        <p>This indicates there is extended data
                        available (currently not used).</p>
                      </dd>
                    </dl>
                  </div>
                </blockquote>
              </div>
            </dd>

            <dt><span class="term"><em class="parameter"><code>type</code></em></span></dt>

            <dd>
              <p>The <em class="parameter"><code>type</code></em>
              value is one of the below. The values in the
              corresponding record (that follows the header) depend
              on the <em class="parameter"><code>type</code></em>
              selected as shown.</p>

              <div class="blockquote">
                <blockquote class="blockquote">
                  <div class="variablelist">
                    <dl class="variablelist">
                      <dt><span class="term"><code class="constant">PERF_RECORD_MMAP</code></span></dt>

                      <dd>
                        <p>The MMAP events record the <code class="constant">PROT_EXEC</code> mappings so
                        that we can correlate user-space IPs to
                        code. They have the following
                        structure:</p>

                        <div class="blockquote">
                          <blockquote class="blockquote">
                            <div class="structdef">
                              <table style="border-collapse: collapse;">
                                <colgroup span="1">
                                  <col class="c1" span="1" />
                                  <col class="c2" span="1" />
                                  <col class="c3" span="1" />
                                  <col class="c4" span="1" />
                                  <col class="c5" span="1" />
                                </colgroup>

                                <tbody>
                                  <tr>
                                    <td class="structdefhdr" style="" align="left" rowspan="1" colspan="1">struct</td>

                                    <td class="structdefhdr" style="" colspan="4" align="left" rowspan="1">
                                    {</td>
                                  </tr>

                                  <tr>
                                    <td style="" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <span class="type">struct perf_event_header</span></td>

                                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <em class="structfield"><code>header</code></em>;</td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                     </td>
                                  </tr>

                                  <tr>
                                    <td style="" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <span class="type">u32</span></td>

                                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <em class="structfield"><code>pid</code></em>,</td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                     </td>
                                  </tr>

                                  <tr>
                                    <td style="" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                     </td>

                                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <em class="structfield"><code>tid</code></em>;</td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                     </td>
                                  </tr>

                                  <tr>
                                    <td style="" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <span class="type">u64</span></td>

                                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <em class="structfield"><code>addr</code></em>;</td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                     </td>
                                  </tr>

                                  <tr>
                                    <td style="" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <span class="type">u64</span></td>

                                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <em class="structfield"><code>len</code></em>;</td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                     </td>
                                  </tr>

                                  <tr>
                                    <td style="" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <span class="type">u64</span></td>

                                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <em class="structfield"><code>pgoff</code></em>;</td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                     </td>
                                  </tr>

                                  <tr>
                                    <td style="" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <span class="type">char</span></td>

                                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <em class="structfield"><code>filename</code></em>[];</td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                     </td>
                                  </tr>

                                  <tr>
                                    <td class="structdefftr" style="" colspan="5" align="left" rowspan="1">
                                    };</td>
                                  </tr>
                                </tbody>
                              </table>
                            </div>
                          </blockquote>
                        </div>

                        <div class="blockquote">
                          <blockquote class="blockquote">
                            <div class="variablelist">
                              <dl class="variablelist">
                                <dt><span class="term"><em class="parameter"><code>pid</code></em></span></dt>

                                <dd>
                                  <p>is the process ID.</p>
                                </dd>

                                <dt><span class="term"><em class="parameter"><code>tid</code></em></span></dt>

                                <dd>
                                  <p>is the thread ID.</p>
                                </dd>

                                <dt><span class="term"><em class="parameter"><code>addr</code></em></span></dt>

                                <dd>
                                  <p>is the address of the
                                  allocated memory. <em class="parameter"><code>len</code></em>
                                  is the length of the allocated
                                  memory. <em class="parameter"><code>pgoff</code></em>
                                  is the page offset of the
                                  allocated memory. <em class="parameter"><code>filename</code></em>
                                  is a string describing the
                                  backing of the allocated
                                  memory.</p>
                                </dd>
                              </dl>
                            </div>
                          </blockquote>
                        </div>
                      </dd>

                      <dt><span class="term"><code class="constant">PERF_RECORD_LOST</code></span></dt>

                      <dd>
                        <p>This record indicates when events are
                        lost.</p>

                        <div class="blockquote">
                          <blockquote class="blockquote">
                            <div class="structdef">
                              <table style="border-collapse: collapse;">
                                <colgroup span="1">
                                  <col class="c1" span="1" />
                                  <col class="c2" span="1" />
                                  <col class="c3" span="1" />
                                  <col class="c4" span="1" />
                                  <col class="c5" span="1" />
                                </colgroup>

                                <tbody>
                                  <tr>
                                    <td class="structdefhdr" style="" align="left" rowspan="1" colspan="1">struct</td>

                                    <td class="structdefhdr" style="" colspan="4" align="left" rowspan="1">
                                    {</td>
                                  </tr>

                                  <tr>
                                    <td style="" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <span class="type">struct perf_event_header</span></td>

                                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <em class="structfield"><code>header</code></em>;</td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                     </td>
                                  </tr>

                                  <tr>
                                    <td style="" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <span class="type">u64</span></td>

                                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <em class="structfield"><code>id</code></em>;</td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                     </td>
                                  </tr>

                                  <tr>
                                    <td style="" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <span class="type">u64</span></td>

                                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <em class="structfield"><code>lost</code></em>;</td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                     </td>
                                  </tr>

                                  <tr>
                                    <td style="" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <span class="type">struct sample_id</span></td>

                                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <em class="structfield"><code>sample_id</code></em>;</td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                     </td>
                                  </tr>

                                  <tr>
                                    <td class="structdefftr" style="" colspan="5" align="left" rowspan="1">
                                    };</td>
                                  </tr>
                                </tbody>
                              </table>
                            </div>
                          </blockquote>
                        </div>

                        <div class="blockquote">
                          <blockquote class="blockquote">
                            <div class="variablelist">
                              <dl class="variablelist">
                                <dt><span class="term"><em class="parameter"><code>id</code></em></span></dt>

                                <dd>
                                  <p>is the unique event ID for the
                                  samples that were lost.</p>
                                </dd>

                                <dt><span class="term"><em class="parameter"><code>lost</code></em></span></dt>

                                <dd>
                                  <p>is the number of events that
                                  were lost.</p>
                                </dd>
                              </dl>
                            </div>
                          </blockquote>
                        </div>
                      </dd>

                      <dt><span class="term"><code class="constant">PERF_RECORD_COMM</code></span></dt>

                      <dd>
                        <p>This record indicates a change in the
                        process name.</p>

                        <div class="blockquote">
                          <blockquote class="blockquote">
                            <div class="structdef">
                              <table style="border-collapse: collapse;">
                                <colgroup span="1">
                                  <col class="c1" span="1" />
                                  <col class="c2" span="1" />
                                  <col class="c3" span="1" />
                                  <col class="c4" span="1" />
                                  <col class="c5" span="1" />
                                </colgroup>

                                <tbody>
                                  <tr>
                                    <td class="structdefhdr" style="" align="left" rowspan="1" colspan="1">struct</td>

                                    <td class="structdefhdr" style="" colspan="4" align="left" rowspan="1">
                                    {</td>
                                  </tr>

                                  <tr>
                                    <td style="" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <span class="type">struct perf_event_header</span></td>

                                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <em class="structfield"><code>header</code></em>;</td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                     </td>
                                  </tr>

                                  <tr>
                                    <td style="" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <span class="type">u32</span></td>

                                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <em class="structfield"><code>pid</code></em>;</td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                     </td>
                                  </tr>

                                  <tr>
                                    <td style="" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <span class="type">u32</span></td>

                                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <em class="structfield"><code>tid</code></em>;</td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                     </td>
                                  </tr>

                                  <tr>
                                    <td style="" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <span class="type">char</span></td>

                                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <em class="structfield"><code>comm</code></em>[];</td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                     </td>
                                  </tr>

                                  <tr>
                                    <td style="" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <span class="type">struct sample_id</span></td>

                                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <em class="structfield"><code>sample_id</code></em>;</td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                     </td>
                                  </tr>

                                  <tr>
                                    <td class="structdefftr" style="" colspan="5" align="left" rowspan="1">
                                    };</td>
                                  </tr>
                                </tbody>
                              </table>
                            </div>
                          </blockquote>
                        </div>

                        <div class="blockquote">
                          <blockquote class="blockquote">
                            <div class="variablelist">
                              <dl class="variablelist">
                                <dt><span class="term"><em class="parameter"><code>pid</code></em></span></dt>

                                <dd>
                                  <p>is the process ID.</p>
                                </dd>

                                <dt><span class="term"><em class="parameter"><code>tid</code></em></span></dt>

                                <dd>
                                  <p>is the thread ID.</p>
                                </dd>

                                <dt><span class="term"><em class="parameter"><code>comm</code></em></span></dt>

                                <dd>
                                  <p>is a string containing the new
                                  name of the process.</p>
                                </dd>
                              </dl>
                            </div>
                          </blockquote>
                        </div>
                      </dd>

                      <dt><span class="term"><code class="constant">PERF_RECORD_EXIT</code></span></dt>

                      <dd>
                        <p>This record indicates a process exit
                        event.</p>

                        <div class="blockquote">
                          <blockquote class="blockquote">
                            <div class="structdef">
                              <table style="border-collapse: collapse;">
                                <colgroup span="1">
                                  <col class="c1" span="1" />
                                  <col class="c2" span="1" />
                                  <col class="c3" span="1" />
                                  <col class="c4" span="1" />
                                  <col class="c5" span="1" />
                                </colgroup>

                                <tbody>
                                  <tr>
                                    <td class="structdefhdr" style="" align="left" rowspan="1" colspan="1">struct</td>

                                    <td class="structdefhdr" style="" colspan="4" align="left" rowspan="1">
                                    {</td>
                                  </tr>

                                  <tr>
                                    <td style="" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <span class="type">struct perf_event_header</span></td>

                                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <em class="structfield"><code>header</code></em>;</td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                     </td>
                                  </tr>

                                  <tr>
                                    <td style="" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <span class="type">u32</span></td>

                                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <em class="structfield"><code>pid</code></em>,</td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                     </td>
                                  </tr>

                                  <tr>
                                    <td style="" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                     </td>

                                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <em class="structfield"><code>ppid</code></em>;</td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                     </td>
                                  </tr>

                                  <tr>
                                    <td style="" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <span class="type">u32</span></td>

                                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <em class="structfield"><code>tid</code></em>,</td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                     </td>
                                  </tr>

                                  <tr>
                                    <td style="" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                     </td>

                                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <em class="structfield"><code>ptid</code></em>;</td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                     </td>
                                  </tr>

                                  <tr>
                                    <td style="" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <span class="type">u64</span></td>

                                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <em class="structfield"><code>time</code></em>;</td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                     </td>
                                  </tr>

                                  <tr>
                                    <td style="" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <span class="type">struct sample_id</span></td>

                                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <em class="structfield"><code>sample_id</code></em>;</td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                     </td>
                                  </tr>

                                  <tr>
                                    <td class="structdefftr" style="" colspan="5" align="left" rowspan="1">
                                    };</td>
                                  </tr>
                                </tbody>
                              </table>
                            </div>
                          </blockquote>
                        </div>
                      </dd>

                      <dt><span class="term"><code class="constant">PERF_RECORD_THROTTLE</code>,
                      <code class="constant">PERF_RECORD_UNTHROTTLE</code></span></dt>

                      <dd>
                        <p>This record indicates a
                        throttle/unthrottle event.</p>

                        <div class="blockquote">
                          <blockquote class="blockquote">
                            <div class="structdef">
                              <table style="border-collapse: collapse;">
                                <colgroup span="1">
                                  <col class="c1" span="1" />
                                  <col class="c2" span="1" />
                                  <col class="c3" span="1" />
                                  <col class="c4" span="1" />
                                  <col class="c5" span="1" />
                                </colgroup>

                                <tbody>
                                  <tr>
                                    <td class="structdefhdr" style="" align="left" rowspan="1" colspan="1">struct</td>

                                    <td class="structdefhdr" style="" colspan="4" align="left" rowspan="1">
                                    {</td>
                                  </tr>

                                  <tr>
                                    <td style="" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <span class="type">struct perf_event_header</span></td>

                                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <em class="structfield"><code>header</code></em>;</td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                     </td>
                                  </tr>

                                  <tr>
                                    <td style="" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <span class="type">u64</span></td>

                                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <em class="structfield"><code>time</code></em>;</td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                     </td>
                                  </tr>

                                  <tr>
                                    <td style="" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <span class="type">u64</span></td>

                                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <em class="structfield"><code>id</code></em>;</td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                     </td>
                                  </tr>

                                  <tr>
                                    <td style="" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <span class="type">u64</span></td>

                                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <em class="structfield"><code>stream_id</code></em>;</td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                     </td>
                                  </tr>

                                  <tr>
                                    <td style="" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <span class="type">struct sample_id</span></td>

                                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <em class="structfield"><code>sample_id</code></em>;</td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                     </td>
                                  </tr>

                                  <tr>
                                    <td class="structdefftr" style="" colspan="5" align="left" rowspan="1">
                                    };</td>
                                  </tr>
                                </tbody>
                              </table>
                            </div>
                          </blockquote>
                        </div>
                      </dd>

                      <dt><span class="term"><code class="constant">PERF_RECORD_FORK</code></span></dt>

                      <dd>
                        <p>This record indicates a fork event.</p>

                        <div class="blockquote">
                          <blockquote class="blockquote">
                            <div class="structdef">
                              <table style="border-collapse: collapse;">
                                <colgroup span="1">
                                  <col class="c1" span="1" />
                                  <col class="c2" span="1" />
                                  <col class="c3" span="1" />
                                  <col class="c4" span="1" />
                                  <col class="c5" span="1" />
                                </colgroup>

                                <tbody>
                                  <tr>
                                    <td class="structdefhdr" style="" align="left" rowspan="1" colspan="1">struct</td>

                                    <td class="structdefhdr" style="" colspan="4" align="left" rowspan="1">
                                    {</td>
                                  </tr>

                                  <tr>
                                    <td style="" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <span class="type">struct perf_event_header</span></td>

                                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <em class="structfield"><code>header</code></em>;</td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                     </td>
                                  </tr>

                                  <tr>
                                    <td style="" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <span class="type">u32</span></td>

                                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <em class="structfield"><code>pid</code></em>,</td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                     </td>
                                  </tr>

                                  <tr>
                                    <td style="" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                     </td>

                                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <em class="structfield"><code>ppid</code></em>;</td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                     </td>
                                  </tr>

                                  <tr>
                                    <td style="" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <span class="type">u32</span></td>

                                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <em class="structfield"><code>tid</code></em>,</td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                     </td>
                                  </tr>

                                  <tr>
                                    <td style="" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                     </td>

                                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <em class="structfield"><code>ptid</code></em>;</td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                     </td>
                                  </tr>

                                  <tr>
                                    <td style="" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <span class="type">u64</span></td>

                                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <em class="structfield"><code>time</code></em>;</td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                     </td>
                                  </tr>

                                  <tr>
                                    <td style="" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <span class="type">struct sample_id</span></td>

                                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <em class="structfield"><code>sample_id</code></em>;</td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                     </td>
                                  </tr>

                                  <tr>
                                    <td class="structdefftr" style="" colspan="5" align="left" rowspan="1">
                                    };</td>
                                  </tr>
                                </tbody>
                              </table>
                            </div>
                          </blockquote>
                        </div>
                      </dd>

                      <dt><span class="term"><code class="constant">PERF_RECORD_READ</code></span></dt>

                      <dd>
                        <p>This record indicates a read event.</p>

                        <div class="blockquote">
                          <blockquote class="blockquote">
                            <div class="structdef">
                              <table style="border-collapse: collapse;">
                                <colgroup span="1">
                                  <col class="c1" span="1" />
                                  <col class="c2" span="1" />
                                  <col class="c3" span="1" />
                                  <col class="c4" span="1" />
                                  <col class="c5" span="1" />
                                </colgroup>

                                <tbody>
                                  <tr>
                                    <td class="structdefhdr" style="" align="left" rowspan="1" colspan="1">struct</td>

                                    <td class="structdefhdr" style="" colspan="4" align="left" rowspan="1">
                                    {</td>
                                  </tr>

                                  <tr>
                                    <td style="" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <span class="type">struct perf_event_header</span></td>

                                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <em class="structfield"><code>header</code></em>;</td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                     </td>
                                  </tr>

                                  <tr>
                                    <td style="" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <span class="type">u32</span></td>

                                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <em class="structfield"><code>pid</code></em>,</td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                     </td>
                                  </tr>

                                  <tr>
                                    <td style="" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                     </td>

                                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <em class="structfield"><code>tid</code></em>;</td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                     </td>
                                  </tr>

                                  <tr>
                                    <td style="" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <span class="type">struct read_format</span></td>

                                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <em class="structfield"><code>values</code></em>;</td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                     </td>
                                  </tr>

                                  <tr>
                                    <td style="" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <span class="type">struct sample_id</span></td>

                                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1"> </td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <em class="structfield"><code>sample_id</code></em>;</td>

                                    <td style="" align="left" rowspan="1" colspan="1">
                                     </td>
                                  </tr>

                                  <tr>
                                    <td class="structdefftr" style="" colspan="5" align="left" rowspan="1">
                                    };</td>
                                  </tr>
                                </tbody>
                              </table>
                            </div>
                          </blockquote>
                        </div>
                      </dd>

                      <dt><span class="term"><code class="constant">PERF_RECORD_SAMPLE</code></span></dt>

                      <dd>
                        <p>This record indicates a sample.</p>

                        <div class="blockquote">
                          <blockquote class="blockquote">
                            <div class="informalexample">
                              <pre class="programlisting" xml:space="preserve">
struct {
    struct perf_event_header header;
    u64   sample_id;  /* if PERF_SAMPLE_IDENTIFIER */
    u64   ip;         /* if PERF_SAMPLE_IP */
    u32   pid, tid;   /* if PERF_SAMPLE_TID */
    u64   time;       /* if PERF_SAMPLE_TIME */
    u64   addr;       /* if PERF_SAMPLE_ADDR */
    u64   id;         /* if PERF_SAMPLE_ID */
    u64   stream_id;  /* if PERF_SAMPLE_STREAM_ID */
    u32   cpu, res;   /* if PERF_SAMPLE_CPU */
    u64   period;     /* if PERF_SAMPLE_PERIOD */
    struct read_format v; /* if PERF_SAMPLE_READ */
    u64   nr;         /* if PERF_SAMPLE_CALLCHAIN */
    u64   ips[nr];    /* if PERF_SAMPLE_CALLCHAIN */
    u32   size;       /* if PERF_SAMPLE_RAW */
    char  data[size]; /* if PERF_SAMPLE_RAW */
    u64   bnr;        /* if PERF_SAMPLE_BRANCH_STACK */
    struct perf_branch_entry lbr[bnr];
                      /* if PERF_SAMPLE_BRANCH_STACK */
    u64   abi;        /* if PERF_SAMPLE_REGS_USER */
    u64   regs[weight(mask)];
                      /* if PERF_SAMPLE_REGS_USER */
    u64   size;       /* if PERF_SAMPLE_STACK_USER */
    char  data[size]; /* if PERF_SAMPLE_STACK_USER */
    u64   dyn_size;   /* if PERF_SAMPLE_STACK_USER */
    u64   weight;     /* if PERF_SAMPLE_WEIGHT */
    u64   data_src;   /* if PERF_SAMPLE_DATA_SRC */
    u64   transaction;/* if PERF_SAMPLE_TRANSACTION */
};
</pre>
                            </div>

                            <div class="blockquote">
                              <blockquote class="blockquote">
                                <div class="variablelist">
                                  <dl class="variablelist">
                                    <dt><span class="term"><em class="parameter"><code>sample_id</code></em></span></dt>

                                    <dd>
                                      <p>If <code class="constant">PERF_SAMPLE_IDENTIFIER</code>
                                      is enabled, a 64-bit unique
                                      ID is included. This is a
                                      duplication of the
                                      <code class="constant">PERF_SAMPLE_ID</code>
                                      <em class="parameter"><code>id</code></em>
                                      value, but included at the
                                      beginning of the sample so
                                      parsers can easily obtain the
                                      value.</p>
                                    </dd>

                                    <dt><span class="term"><em class="replaceable"><code>ip</code></em></span></dt>

                                    <dd>
                                      <p>If <code class="constant">PERF_SAMPLE_IP</code>
                                      is enabled, then a 64-bit
                                      instruction pointer value is
                                      included.</p>
                                    </dd>

                                    <dt><span class="term"><em class="parameter"><code>pid</code></em>,
                                    <em class="parameter"><code>tid</code></em></span></dt>

                                    <dd>
                                      <p>If <code class="constant">PERF_SAMPLE_TID</code>
                                      is enabled, then a 32-bit
                                      process ID and 32-bit thread
                                      ID are included.</p>
                                    </dd>

                                    <dt><span class="term"><em class="parameter"><code>time</code></em></span></dt>

                                    <dd>
                                      <p>If <code class="constant">PERF_SAMPLE_TIME</code>
                                      is enabled, then a 64-bit
                                      timestamp is included. This
                                      is obtained via local_clock()
                                      which is a hardware timestamp
                                      if available and the jiffies
                                      value if not.</p>
                                    </dd>

                                    <dt><span class="term"><em class="parameter"><code>addr</code></em></span></dt>

                                    <dd>
                                      <p>If <code class="constant">PERF_SAMPLE_ADDR</code>
                                      is enabled, then a 64-bit
                                      address is included. This is
                                      usually the address of a
                                      tracepoint, breakpoint, or
                                      software event; otherwise the
                                      value is 0.</p>
                                    </dd>

                                    <dt><span class="term"><em class="parameter"><code>id</code></em></span></dt>

                                    <dd>
                                      <p>If <code class="constant">PERF_SAMPLE_ID</code>
                                      is enabled, a 64-bit unique
                                      ID is included. If the event
                                      is a member of an event
                                      group, the group leader ID is
                                      returned. This ID is the same
                                      as the one returned by
                                      <code class="constant">PERF_FORMAT_ID</code>.</p>
                                    </dd>

                                    <dt><span class="term"><em class="parameter"><code>stream_id</code></em></span></dt>

                                    <dd>
                                      <p>If <code class="constant">PERF_SAMPLE_STREAM_ID</code>
                                      is enabled, a 64-bit unique
                                      ID is included. Unlike
                                      <code class="constant">PERF_SAMPLE_ID</code>
                                      the actual ID is returned,
                                      not the group leader. This ID
                                      is the same as the one
                                      returned by <code class="constant">PERF_FORMAT_ID</code>.</p>
                                    </dd>

                                    <dt><span class="term"><em class="parameter"><code>cpu</code></em>,
                                    <em class="replaceable"><code>res</code></em></span></dt>

                                    <dd>
                                      <p>If <code class="constant">PERF_SAMPLE_CPU</code>
                                      is enabled, this is a 32-bit
                                      value indicating which CPU
                                      was being used, in addition
                                      to a reserved (unused) 32-bit
                                      value.</p>
                                    </dd>

                                    <dt><span class="term"><em class="replaceable"><code>period</code></em></span></dt>

                                    <dd>
                                      <p>If <code class="constant">PERF_SAMPLE_PERIOD</code>
                                      is enabled, a 64-bit value
                                      indicating the current
                                      sampling period is
                                      written.</p>
                                    </dd>

                                    <dt><span class="term"><em class="replaceable"><code>v</code></em></span></dt>

                                    <dd>
                                      <p>If <code class="constant">PERF_SAMPLE_READ</code>
                                      is enabled, a structure of
                                      type read_format is included
                                      which has values for all
                                      events in the event group.
                                      The values included depend on
                                      the <em class="replaceable"><code>read_format</code></em>
                                      value used at <code class="function">perf_event_open</code>()
                                      time.</p>
                                    </dd>

                                    <dt><span class="term"><em class="replaceable"><code>nr</code></em>,
                                    <em class="replaceable"><code>ips[nr]</code></em></span></dt>

                                    <dd>
                                      <p>If <code class="constant">PERF_SAMPLE_CALLCHAIN</code>
                                      is enabled, then a 64-bit
                                      number is included which
                                      indicates how many following
                                      64-bit instruction pointers
                                      will follow. This is the
                                      current callchain.</p>
                                    </dd>

                                    <dt><span class="term"><em class="parameter"><code>size</code></em>,
                                    <em class="replaceable"><code>data[size]</code></em></span></dt>

                                    <dd>
                                      <p>If <code class="constant">PERF_SAMPLE_RAW</code>
                                      is enabled, then a 32-bit
                                      value indicating size is
                                      included followed by an array
                                      of 8-bit values of length
                                      size. The values are padded
                                      with 0 to have 64-bit
                                      alignment.</p>

                                      <p>This RAW record data is
                                      opaque with respect to the
                                      ABI. The ABI doesn't make any
                                      promises with respect to the
                                      stability of its content, it
                                      may vary depending on event,
                                      hardware, and kernel
                                      version.</p>
                                    </dd>

                                    <dt><span class="term"><em class="replaceable"><code>bnr</code></em>,
                                    <em class="replaceable"><code>lbr[bnr]</code></em></span></dt>

                                    <dd>
                                      <p>If <code class="constant">PERF_SAMPLE_BRANCH_STACK</code>
                                      is enabled, then a 64-bit
                                      value indicating the number
                                      of records is included,
                                      followed by <em class="replaceable"><code>bnr</code></em>
                                      <em class="replaceable"><code>perf_branch_entry</code></em>
                                      structures which each include
                                      the fields:</p>

                                      <div class="blockquote">
                                        <blockquote class="blockquote">
                                          <div class="variablelist">
                                            <dl class="variablelist">
                                              <dt><span class="term"><em class="replaceable"><code>from</code></em></span></dt>

                                              <dd>
                                                <p>This indicates
                                                the source
                                                instruction (may
                                                not be a
                                                branch).</p>
                                              </dd>

                                              <dt><span class="term"><em class="replaceable"><code>to</code></em></span></dt>

                                              <dd>
                                                <p>The branch
                                                target.</p>
                                              </dd>

                                              <dt><span class="term"><em class="replaceable"><code>mispred</code></em></span></dt>

                                              <dd>
                                                <p>The branch
                                                target was
                                                mispredicted.</p>
                                              </dd>

                                              <dt><span class="term"><em class="replaceable"><code>predicted</code></em></span></dt>

                                              <dd>
                                                <p>The branch
                                                target was
                                                predicted.</p>
                                              </dd>

                                              <dt><span class="term"><em class="replaceable"><code>in_tx</code></em>
                                              (since Linux
                                              3.11)</span></dt>

                                              <dd>
                                                <p>The branch was
                                                in a transactional
                                                memory
                                                transaction.</p>
                                              </dd>

                                              <dt><span class="term"><em class="replaceable"><code>abort</code></em>
                                              (since Linux
                                              3.11)</span></dt>

                                              <dd>
                                                <p>The branch was
                                                in an aborted
                                                transactional
                                                memory
                                                transaction.</p>

                                                <p>The entries are
                                                from most to least
                                                recent, so the
                                                first entry has the
                                                most recent
                                                branch.</p>

                                                <p>Support for
                                                <em class="replaceable"><code>
                                                mispred</code></em>
                                                and <em class="replaceable"><code>
                                                predicted</code></em>
                                                is optional; if not
                                                supported, both
                                                values will be
                                                0.</p>

                                                <p>The type of
                                                branches recorded
                                                is specified by the
                                                <em class="replaceable"><code>
                                                branch_sample_type</code></em>
                                                field.</p>
                                              </dd>
                                            </dl>
                                          </div>
                                        </blockquote>
                                      </div>
                                    </dd>

                                    <dt><span class="term"><em class="replaceable"><code>abi</code></em>,
                                    <em class="replaceable"><code>regs[weight(mask)]</code></em></span></dt>

                                    <dd>
                                      <p>If <code class="constant">PERF_SAMPLE_REGS_USER</code>
                                      is enabled, then the user CPU
                                      registers are recorded.</p>

                                      <p>The <em class="replaceable"><code>abi</code></em>
                                      field is one of <code class="constant">PERF_SAMPLE_REGS_ABI_NONE</code>,
                                      <code class="constant">PERF_SAMPLE_REGS_ABI_32</code>
                                      or <code class="constant">PERF_SAMPLE_REGS_ABI_64</code>.</p>

                                      <p>The <em class="replaceable"><code>regs</code></em>
                                      field is an array of the CPU
                                      registers that were specified
                                      by the <em class="replaceable"><code>sample_regs_user</code></em>
                                      attr field. The number of
                                      values is the number of bits
                                      set in the <em class="replaceable"><code>sample_regs_user</code></em>
                                      bit mask.</p>
                                    </dd>

                                    <dt><span class="term"><em class="parameter"><code>size</code></em>,
                                    <em class="replaceable"><code>data[size]</code></em>,
                                    <em class="replaceable"><code>dyn_size</code></em></span></dt>

                                    <dd>
                                      <p>If <code class="constant">PERF_SAMPLE_STACK_USER</code>
                                      is enabled, then the user
                                      stack is recorded. This can
                                      be used to generate stack
                                      backtraces. <em class="parameter"><code>size</code></em>
                                      is the size requested by the
                                      user in <em class="replaceable"><code>sample_stack_user</code></em>
                                      or else the maximum record
                                      size. <em class="replaceable"><code>data</code></em>
                                      is the stack data (a raw dump
                                      of the memory pointed to by
                                      the stack pointer at the time
                                      of sampling). <em class="replaceable"><code>dyn_size</code></em>
                                      is the amount of data
                                      actually dumped (can be less
                                      than <em class="parameter"><code>size</code></em>).</p>
                                    </dd>

                                    <dt><span class="term"><em class="replaceable"><code>weight</code></em></span></dt>

                                    <dd>
                                      <p>If <code class="constant">PERF_SAMPLE_WEIGHT</code>
                                      is enabled, then a 64-bit
                                      value provided by the
                                      hardware is recorded that
                                      indicates how costly the
                                      event was. This allows
                                      expensive events to stand out
                                      more clearly in profiles.</p>
                                    </dd>

                                    <dt><span class="term"><em class="replaceable"><code>data_src</code></em></span></dt>

                                    <dd>
                                      <p>If <code class="constant">PERF_SAMPLE_DATA_SRC</code>
                                      is enabled, then a 64-bit
                                      value is recorded that is
                                      made up of the following
                                      fields:</p>

                                      <div class="blockquote">
                                        <blockquote class="blockquote">
                                          <div class="variablelist">
                                            <dl class="variablelist">
                                              <dt><span class="term"><em class="replaceable"><code>mem_op</code></em></span></dt>

                                              <dd>
                                                <p>Type of opcode,
                                                a bitwise
                                                combination of:</p>

                                                <div class="blockquote">
                                                  <blockquote class="blockquote">
                                                  <div class="variablelist">
                                                      <dl class="variablelist">
                                                      <dt>
                                                      <span class="term">
                                                        <code class="constant">
                                                        PERF_MEM_OP_NA</code></span></dt>

                                                        <dd>
                                                          <p>Not
                                                          available</p>
                                                        </dd>

                                                        <dt>
                                                        <span class="term">
                                                        <code class="constant">
                                                        PERF_MEM_OP_LOAD</code></span></dt>

                                                        <dd>
                                                          <p>Load
                                                          instruction</p>
                                                        </dd>

                                                        <dt>
                                                        <span class="term">
                                                        <code class="constant">
                                                        PERF_MEM_OP_STORE</code></span></dt>

                                                        <dd>
                                                          <p>Store
                                                          instruction</p>
                                                        </dd>

                                                        <dt>
                                                        <span class="term">
                                                        <code class="constant">
                                                        PERF_MEM_OP_PFETCH</code></span></dt>

                                                        <dd>
                                                          <p>
                                                          Prefetch</p>
                                                        </dd>

                                                        <dt>
                                                        <span class="term">
                                                        <code class="constant">
                                                        PERF_MEM_OP_EXEC</code></span></dt>

                                                        <dd>
                                                          <p>
                                                          Executable
                                                          code</p>
                                                        </dd>
                                                      </dl>
                                                    </div>
                                                  </blockquote>
                                                </div>
                                              </dd>

                                              <dt><span class="term"><em class="replaceable"><code>mem_lvl</code></em></span></dt>

                                              <dd>
                                                <p>Memory hierarchy
                                                level hit or miss,
                                                a bitwise
                                                combination of the
                                                following, shifted
                                                left by
                                                <code class="constant">
                                                PERF_MEM_LVL_SHIFT</code>:</p>

                                                <div class="blockquote">
                                                  <blockquote class="blockquote">
                                                  <div class="variablelist">
                                                      <dl class="variablelist">
                                                      <dt>
                                                      <span class="term">
                                                        <code class="constant">
                                                        PERF_MEM_LVL_NA</code></span></dt>

                                                        <dd>
                                                          <p>Not
                                                          available</p>
                                                        </dd>

                                                        <dt>
                                                        <span class="term">
                                                        <code class="constant">
                                                        PERF_MEM_LVL_HIT</code></span></dt>

                                                        <dd>
                                                          <p>
                                                          Hit</p>
                                                        </dd>

                                                        <dt>
                                                        <span class="term">
                                                        <code class="constant">
                                                        PERF_MEM_LVL_MISS</code></span></dt>

                                                        <dd>
                                                          <p>
                                                          Miss</p>
                                                        </dd>

                                                        <dt>
                                                        <span class="term">
                                                        <code class="constant">
                                                        PERF_MEM_LVL_L1</code></span></dt>

                                                        <dd>
                                                          <p>Level
                                                          1
                                                          cache</p>
                                                        </dd>

                                                        <dt>
                                                        <span class="term">
                                                        <code class="constant">
                                                        PERF_MEM_LVL_LFB</code></span></dt>

                                                        <dd>
                                                          <p>Line
                                                          fill
                                                          buffer</p>
                                                        </dd>

                                                        <dt>
                                                        <span class="term">
                                                        <code class="constant">
                                                        PERF_MEM_LVL_L2</code></span></dt>

                                                        <dd>
                                                          <p>Level
                                                          2
                                                          cache</p>
                                                        </dd>

                                                        <dt>
                                                        <span class="term">
                                                        <code class="constant">
                                                        PERF_MEM_LVL_L3</code></span></dt>

                                                        <dd>
                                                          <p>Level
                                                          3
                                                          cache</p>
                                                        </dd>

                                                        <dt>
                                                        <span class="term">
                                                        <code class="constant">
                                                        PERF_MEM_LVL_LOC_RAM</code></span></dt>

                                                        <dd>
                                                          <p>Local
                                                          DRAM</p>
                                                        </dd>

                                                        <dt>
                                                        <span class="term">
                                                        <code class="constant">
                                                        PERF_MEM_LVL_REM_RAM1</code></span></dt>

                                                        <dd>
                                                          <p>Remote
                                                          DRAM 1
                                                          hop</p>
                                                        </dd>

                                                        <dt>
                                                        <span class="term">
                                                        <code class="constant">
                                                        PERF_MEM_LVL_REM_RAM2</code></span></dt>

                                                        <dd>
                                                          <p>Remote
                                                          DRAM 2
                                                          hops</p>
                                                        </dd>

                                                        <dt>
                                                        <span class="term">
                                                        <code class="constant">
                                                        PERF_MEM_LVL_REM_CCE1</code></span></dt>

                                                        <dd>
                                                          <p>Remote
                                                          cache 1
                                                          hop</p>
                                                        </dd>

                                                        <dt>
                                                        <span class="term">
                                                        <code class="constant">
                                                        PERF_MEM_LVL_REM_CCE2</code></span></dt>

                                                        <dd>
                                                          <p>Remote
                                                          cache 2
                                                          hops</p>
                                                        </dd>

                                                        <dt>
                                                        <span class="term">
                                                        <code class="constant">
                                                        PERF_MEM_LVL_IO</code></span></dt>

                                                        <dd>
                                                          <p>I/O
                                                          memory</p>
                                                        </dd>

                                                        <dt>
                                                        <span class="term">
                                                        <code class="constant">
                                                        PERF_MEM_LVL_UNC</code></span></dt>

                                                        <dd>
                                                          <p>
                                                          Uncached
                                                          memory</p>
                                                        </dd>
                                                      </dl>
                                                    </div>
                                                  </blockquote>
                                                </div>
                                              </dd>

                                              <dt><span class="term"><em class="replaceable"><code>mem_snoop</code></em></span></dt>

                                              <dd>
                                                <p>Snoop mode, a
                                                bitwise combination
                                                of the following,
                                                shifted left by
                                                <code class="constant">PERF_MEM_SNOOP_SHIFT</code>:</p>

                                                <div class="blockquote">
                                                  <blockquote class="blockquote">
                                                  <div class="variablelist">
                                                      <dl class="variablelist">
                                                      <dt>
                                                      <span class="term">
                                                        <code class="constant">
                                                        PERF_MEM_SNOOP_NA</code></span></dt>

                                                        <dd>
                                                          <p>Not
                                                          available</p>
                                                        </dd>

                                                        <dt>
                                                        <span class="term">
                                                        <code class="constant">
                                                        PERF_MEM_SNOOP_NONE</code></span></dt>

                                                        <dd>
                                                          <p>No
                                                          snoop</p>
                                                        </dd>

                                                        <dt>
                                                        <span class="term">
                                                        <code class="constant">
                                                        PERF_MEM_SNOOP_HIT</code></span></dt>

                                                        <dd>
                                                          <p>Snoop
                                                          hit</p>
                                                        </dd>

                                                        <dt>
                                                        <span class="term">
                                                        <code class="constant">
                                                        PERF_MEM_SNOOP_MISS</code></span></dt>

                                                        <dd>
                                                          <p>Snoop
                                                          miss</p>
                                                        </dd>

                                                        <dt>
                                                        <span class="term">
                                                        <code class="constant">
                                                        PERF_MEM_SNOOP_HITM</code></span></dt>

                                                        <dd>
                                                          <p>Snoop
                                                          hit
                                                          modified</p>
                                                        </dd>
                                                      </dl>
                                                    </div>
                                                  </blockquote>
                                                </div>
                                              </dd>

                                              <dt><span class="term"><em class="replaceable"><code>mem_lock</code></em></span></dt>

                                              <dd>
                                                <p>Lock
                                                instruction, a
                                                bitwise combination
                                                of the following,
                                                shifted left by
                                                <code class="constant">PERF_MEM_LOCK_SHIFT</code>:</p>

                                                <div class="blockquote">
                                                  <blockquote class="blockquote">
                                                  <div class="variablelist">
                                                      <dl class="variablelist">
                                                      <dt>
                                                      <span class="term">
                                                        <code class="constant">
                                                        PERF_MEM_LOCK_NA</code></span></dt>

                                                        <dd>
                                                          <p>Not
                                                          available</p>
                                                        </dd>

                                                        <dt>
                                                        <span class="term">
                                                        <code class="constant">
                                                        PERF_MEM_LOCK_LOCKED</code></span></dt>

                                                        <dd>
                                                          <p>Locked
                                                          transaction</p>
                                                        </dd>
                                                      </dl>
                                                    </div>
                                                  </blockquote>
                                                </div>
                                              </dd>

                                              <dt><span class="term"><em class="replaceable"><code>mem_dtlb</code></em></span></dt>

                                              <dd>
                                                <p>TLB access hit
                                                or miss, a bitwise
                                                combination of the
                                                following, shifted
                                                left by
                                                <code class="constant">
                                                PERF_MEM_TLB_SHIFT</code>:</p>

                                                <div class="blockquote">
                                                  <blockquote class="blockquote">
                                                  <div class="variablelist">
                                                      <dl class="variablelist">
                                                      <dt>
                                                      <span class="term">
                                                        <code class="constant">
                                                        PERF_MEM_TLB_NA</code></span></dt>

                                                        <dd>
                                                          <p>Not
                                                          available</p>
                                                        </dd>

                                                        <dt>
                                                        <span class="term">
                                                        <code class="constant">
                                                        PERF_MEM_TLB_HIT</code></span></dt>

                                                        <dd>
                                                          <p>
                                                          Hit</p>
                                                        </dd>

                                                        <dt>
                                                        <span class="term">
                                                        <code class="constant">
                                                        PERF_MEM_TLB_MISS</code></span></dt>

                                                        <dd>
                                                          <p>
                                                          Miss</p>
                                                        </dd>

                                                        <dt>
                                                        <span class="term">
                                                        <code class="constant">
                                                        PERF_MEM_TLB_L1</code></span></dt>

                                                        <dd>
                                                          <p>Level
                                                          1 TLB</p>
                                                        </dd>

                                                        <dt>
                                                        <span class="term">
                                                        <code class="constant">
                                                        PERF_MEM_TLB_L2</code></span></dt>

                                                        <dd>
                                                          <p>Level
                                                          2 TLB</p>
                                                        </dd>

                                                        <dt>
                                                        <span class="term">
                                                        <code class="constant">
                                                        PERF_MEM_TLB_WK</code></span></dt>

                                                        <dd>
                                                          <p>
                                                          Hardware
                                                          walker</p>
                                                        </dd>

                                                        <dt>
                                                        <span class="term">
                                                        <code class="constant">
                                                        PERF_MEM_TLB_OS</code></span></dt>

                                                        <dd>
                                                          <p>OS
                                                          fault
                                                          handler</p>
                                                        </dd>
                                                      </dl>
                                                    </div>
                                                  </blockquote>
                                                </div>
                                              </dd>
                                            </dl>
                                          </div>
                                        </blockquote>
                                      </div>
                                    </dd>

                                    <dt><span class="term"><em class="replaceable"><code>transaction</code></em></span></dt>

                                    <dd>
                                      <p>If the <code class="constant">PERF_SAMPLE_TRANSACTION</code>
                                      flag is set, then a 64-bit
                                      field is recorded describing
                                      the sources of any
                                      transactional memory
                                      aborts.</p>

                                      <p>The field is a bitwise
                                      combination of the following
                                      values:</p>

                                      <div class="blockquote">
                                        <blockquote class="blockquote">
                                          <div class="variablelist">
                                            <dl class="variablelist">
                                              <dt><span class="term"><code class="constant">PERF_TXN_ELISION</code></span></dt>

                                              <dd>
                                                <p>Abort from an
                                                elision type
                                                transaction
                                                (Intel-CPU-specific).</p>
                                              </dd>

                                              <dt><span class="term"><code class="constant">PERF_TXN_TRANSACTION</code></span></dt>

                                              <dd>
                                                <p>Abort from a
                                                generic
                                                transaction.</p>
                                              </dd>

                                              <dt><span class="term"><code class="constant">PERF_TXN_SYNC</code></span></dt>

                                              <dd>
                                                <p>Synchronous
                                                abort (related to
                                                the reported
                                                instruction).</p>
                                              </dd>

                                              <dt><span class="term"><code class="constant">PERF_TXN_ASYNC</code></span></dt>

                                              <dd>
                                                <p>Asynchronous
                                                abort (not related
                                                to the reported
                                                instruction).</p>
                                              </dd>

                                              <dt><span class="term"><code class="constant">PERF_TXN_RETRY</code></span></dt>

                                              <dd>
                                                <p>Retryable abort
                                                (retrying the
                                                transaction may
                                                have
                                                succeeded).</p>
                                              </dd>

                                              <dt><span class="term"><code class="constant">PERF_TXN_CONFLICT</code></span></dt>

                                              <dd>
                                                <p>Abort due to
                                                memory conflicts
                                                with other
                                                threads.</p>
                                              </dd>

                                              <dt><span class="term"><code class="constant">PERF_TXN_CAPACITY_WRITE</code></span></dt>

                                              <dd>
                                                <p>Abort due to
                                                write capacity
                                                overflow.</p>
                                              </dd>

                                              <dt><span class="term"><code class="constant">PERF_TXN_CAPACITY_READ</code></span></dt>

                                              <dd>
                                                <p>Abort due to
                                                read capacity
                                                overflow.</p>
                                              </dd>
                                            </dl>
                                          </div>
                                        </blockquote>
                                      </div>

                                      <p>In addition, a
                                      user-specified abort code can
                                      be obtained from the high 32
                                      bits of the field by shifting
                                      right by <code class="constant">PERF_TXN_ABORT_SHIFT</code>
                                      and masking with <code class="constant">PERF_TXN_ABORT_MASK</code>.</p>
                                    </dd>
                                  </dl>
                                </div>
                              </blockquote>
                            </div>

                            <div class="variablelist">
                              <dl class="variablelist">
                                <dt><span class="term"><code class="constant">PERF_RECORD_MMAP2</code></span></dt>

                                <dd>
                                  <p>This record includes extended
                                  information on <a class="link" href="../htmlman2/mmap.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">mmap</span>(2)</span></a>
                                  calls returning executable
                                  mappings. The format is similar
                                  to that of the <code class="constant">PERF_RECORD_MMAP</code>
                                  record, but includes extra values
                                  that allow uniquely identifying
                                  shared mappings.</p>

                                  <div class="blockquote">
                                    <blockquote class="blockquote">
                                      <div class="structdef">
                                        <table style="border-collapse: collapse;">
                                        <colgroup span="1">
                                            <col class="c1" span="1" />
                                            <col class="c2" span="1" />
                                            <col class="c3" span="1" />
                                            <col class="c4" span="1" />
                                            <col class="c5" span="1" />
                                          </colgroup>

                                          <tbody>
                                            <tr>
                                              <td class="structdefhdr" style="" align="left" rowspan="1" colspan="1">
                                              struct</td>

                                              <td class="structdefhdr" style="" colspan="4" align="left" rowspan="1">{</td>
                                            </tr>

                                            <tr>
                                              <td style="" rowspan="1" colspan="1">
                                               </td>

                                              <td style="" align="left" rowspan="1" colspan="1"><span class="type">struct perf_event_header</span></td>

                                              <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                                               </td>

                                              <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>header</code></em>;</td>

                                              <td style="" align="left" rowspan="1" colspan="1"> </td>
                                            </tr>

                                            <tr>
                                              <td style="" rowspan="1" colspan="1">
                                               </td>

                                              <td style="" align="left" rowspan="1" colspan="1"><span class="type">u32</span></td>

                                              <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                                               </td>

                                              <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>pid</code></em>;</td>

                                              <td style="" align="left" rowspan="1" colspan="1"> </td>
                                            </tr>

                                            <tr>
                                              <td style="" rowspan="1" colspan="1">
                                               </td>

                                              <td style="" align="left" rowspan="1" colspan="1"><span class="type">u32</span></td>

                                              <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                                               </td>

                                              <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>tid</code></em>;</td>

                                              <td style="" align="left" rowspan="1" colspan="1"> </td>
                                            </tr>

                                            <tr>
                                              <td style="" rowspan="1" colspan="1">
                                               </td>

                                              <td style="" align="left" rowspan="1" colspan="1"><span class="type">u64</span></td>

                                              <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                                               </td>

                                              <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>addr</code></em>;</td>

                                              <td style="" align="left" rowspan="1" colspan="1"> </td>
                                            </tr>

                                            <tr>
                                              <td style="" rowspan="1" colspan="1">
                                               </td>

                                              <td style="" align="left" rowspan="1" colspan="1"><span class="type">u64</span></td>

                                              <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                                               </td>

                                              <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>len</code></em>;</td>

                                              <td style="" align="left" rowspan="1" colspan="1"> </td>
                                            </tr>

                                            <tr>
                                              <td style="" rowspan="1" colspan="1">
                                               </td>

                                              <td style="" align="left" rowspan="1" colspan="1"><span class="type">u64</span></td>

                                              <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                                               </td>

                                              <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>pgoff</code></em>;</td>

                                              <td style="" align="left" rowspan="1" colspan="1"> </td>
                                            </tr>

                                            <tr>
                                              <td style="" rowspan="1" colspan="1">
                                               </td>

                                              <td style="" align="left" rowspan="1" colspan="1"><span class="type">u32</span></td>

                                              <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                                               </td>

                                              <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>maj</code></em>;</td>

                                              <td style="" align="left" rowspan="1" colspan="1"> </td>
                                            </tr>

                                            <tr>
                                              <td style="" rowspan="1" colspan="1">
                                               </td>

                                              <td style="" align="left" rowspan="1" colspan="1"><span class="type">u32</span></td>

                                              <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                                               </td>

                                              <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>min</code></em>;</td>

                                              <td style="" align="left" rowspan="1" colspan="1"> </td>
                                            </tr>

                                            <tr>
                                              <td style="" rowspan="1" colspan="1">
                                               </td>

                                              <td style="" align="left" rowspan="1" colspan="1"><span class="type">u64</span></td>

                                              <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                                               </td>

                                              <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>ino</code></em>;</td>

                                              <td style="" align="left" rowspan="1" colspan="1"> </td>
                                            </tr>

                                            <tr>
                                              <td style="" rowspan="1" colspan="1">
                                               </td>

                                              <td style="" align="left" rowspan="1" colspan="1"><span class="type">u64</span></td>

                                              <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                                               </td>

                                              <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>ino_generation</code></em>;</td>

                                              <td style="" align="left" rowspan="1" colspan="1"> </td>
                                            </tr>

                                            <tr>
                                              <td style="" rowspan="1" colspan="1">
                                               </td>

                                              <td style="" align="left" rowspan="1" colspan="1"><span class="type">u32</span></td>

                                              <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                                               </td>

                                              <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>prot</code></em>;</td>

                                              <td style="" align="left" rowspan="1" colspan="1"> </td>
                                            </tr>

                                            <tr>
                                              <td style="" rowspan="1" colspan="1">
                                               </td>

                                              <td style="" align="left" rowspan="1" colspan="1"><span class="type">u32</span></td>

                                              <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                                               </td>

                                              <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>flags</code></em>;</td>

                                              <td style="" align="left" rowspan="1" colspan="1"> </td>
                                            </tr>

                                            <tr>
                                              <td style="" rowspan="1" colspan="1">
                                               </td>

                                              <td style="" align="left" rowspan="1" colspan="1"><span class="type">char</span></td>

                                              <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                                               </td>

                                              <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>filename</code></em>[];</td>

                                              <td style="" align="left" rowspan="1" colspan="1"> </td>
                                            </tr>

                                            <tr>
                                              <td style="" rowspan="1" colspan="1">
                                               </td>

                                              <td style="" align="left" rowspan="1" colspan="1"><span class="type">struct sample_id</span></td>

                                              <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                                               </td>

                                              <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>sample_id</code></em>;</td>

                                              <td style="" align="left" rowspan="1" colspan="1"> </td>
                                            </tr>

                                            <tr>
                                              <td class="structdefftr" style="" colspan="5" align="left" rowspan="1">};</td>
                                            </tr>
                                          </tbody>
                                        </table>
                                      </div>

                                      <div class="blockquote">
                                        <blockquote class="blockquote">
                                          <div class="variablelist">
                                            <dl class="variablelist">
                                              <dt><span class="term"><em class="parameter"><code>pid</code></em></span></dt>

                                              <dd>
                                                <p>is the process
                                                ID.</p>
                                              </dd>

                                              <dt><span class="term"><em class="parameter"><code>tid</code></em></span></dt>

                                              <dd>
                                                <p>is the thread
                                                ID.</p>
                                              </dd>

                                              <dt><span class="term"><em class="parameter"><code>addr</code></em></span></dt>

                                              <dd>
                                                <p>is the address
                                                of the allocated
                                                memory.</p>
                                              </dd>

                                              <dt><span class="term"><em class="parameter"><code>len</code></em></span></dt>

                                              <dd>
                                                <p>is the length of
                                                the allocated
                                                memory.</p>
                                              </dd>

                                              <dt><span class="term"><em class="parameter"><code>pgoff</code></em></span></dt>

                                              <dd>
                                                <p>is the page
                                                offset of the
                                                allocated
                                                memory.</p>
                                              </dd>

                                              <dt><span class="term"><em class="parameter"><code>maj</code></em></span></dt>

                                              <dd>
                                                <p>is the major ID
                                                of the underlying
                                                device.</p>
                                              </dd>

                                              <dt><span class="term"><em class="parameter"><code>min</code></em></span></dt>

                                              <dd>
                                                <p>is the minor ID
                                                of the underlying
                                                device.</p>
                                              </dd>

                                              <dt><span class="term"><em class="parameter"><code>ino</code></em></span></dt>

                                              <dd>
                                                <p>is the inode
                                                number.</p>
                                              </dd>

                                              <dt><span class="term"><em class="parameter"><code>ino_generation</code></em></span></dt>

                                              <dd>
                                                <p>is the inode
                                                generation.</p>
                                              </dd>

                                              <dt><span class="term"><em class="parameter"><code>prot</code></em></span></dt>

                                              <dd>
                                                <p>is the
                                                protection
                                                information.</p>
                                              </dd>

                                              <dt><span class="term"><em class="parameter"><code>flags</code></em></span></dt>

                                              <dd>
                                                <p>is the flags
                                                information.</p>
                                              </dd>

                                              <dt><span class="term"><em class="parameter"><code>filename</code></em></span></dt>

                                              <dd>
                                                <p>is a string
                                                describing the
                                                backing of the
                                                allocated
                                                memory.</p>
                                              </dd>
                                            </dl>
                                          </div>
                                        </blockquote>
                                      </div>
                                    </blockquote>
                                  </div>
                                </dd>
                              </dl>
                            </div>
                          </blockquote>
                        </div>
                      </dd>
                    </dl>
                  </div>
                </blockquote>
              </div>
            </dd>
          </dl>
        </div>
      </div>

      <div class="refsect2">
        <a id="perf-event-open-2_sect5" name="perf-event-open-2_sect5" shape="rect"> </a>

        <h3>Signal overflow</h3>

        <p>Events can be set to deliver a signal when a threshold
        is crossed. The signal handler is set up using the
        <a class="link" href="../htmlman2/poll.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">poll</span>(2)</span></a>, <a class="link" href="../htmlman2/select.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">select</span>(2)</span></a>, <span class="citerefentry"><span class="refentrytitle">epoll</span>(2)</span> and <a class="link" href="../htmlman2/fcntl.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">fcntl</span>(2)</span></a>, system
        calls.</p>

        <p>To generate signals, sampling must be enabled
        (<em class="replaceable"><code>sample_period</code></em>
        must have a nonzero value).</p>

        <p>There are two ways to generate signals.</p>

        <p>The first is to set a <em class="replaceable"><code>wakeup_events</code></em> or <em class="replaceable"><code>wakeup_watermark</code></em> value that
        will generate a signal if a certain number of samples or
        bytes have been written to the mmap ring buffer. In this
        case, a signal of type <code class="constant">POLL_IN</code> is sent.</p>

        <p>The other way is by use of the <code class="constant">PERF_EVENT_IOC_REFRESH</code> ioctl. This ioctl
        adds to a counter that decrements each time the event
        overflows. When nonzero, a <code class="constant">POLL_IN</code> signal is sent on overflow, but
        once the value reaches 0, a signal is sent of type
        <code class="constant">POLL_HUP</code> and the underlying
        event is disabled.</p>

        <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
          <table border="0" summary="Note">
            <tr>
              <td rowspan="2" align="center" valign="top" width="25" colspan="1"><img alt="[Note]" src="../stylesheet/note.png" /></td>

              <th align="left" rowspan="1" colspan="1">Note</th>
            </tr>

            <tr>
              <td align="left" valign="top" rowspan="1" colspan="1">
                <p>On newer kernels (since at least as early as
                Linux 3.2), a signal is provided for every
                overflow, even if <em class="replaceable"><code>wakeup_events</code></em> is
                not set.</p>
              </td>
            </tr>
          </table>
        </div>
      </div>

      <div class="refsect2">
        <a id="perf-event-open-2_sect6" name="perf-event-open-2_sect6" shape="rect"> </a>

        <h3>rdpmc instruction</h3>

        <p>Starting with Linux 3.4 on x86, you can use the
        <em class="replaceable"><code>rdpmc</code></em> instruction
        to get low-latency reads without having to enter the
        kernel. Note that using <em class="replaceable"><code>rdpmc</code></em> is not necessarily
        faster than other methods for reading event values.</p>

        <p>Support for this can be detected with the <em class="replaceable"><code>cap_usr_rdpmc</code></em> field in the
        mmap page; documentation on how to calculate event values
        can be found in that section.</p>
      </div>

      <div class="refsect2">
        <a id="perf-event-open-2_sect7" name="perf-event-open-2_sect7" shape="rect"> </a>

        <h3>perf_event ioctl calls</h3>

        <p>Various ioctls act on <code class="function">perf_event_open</code>() file descriptors:</p>

        <div class="variablelist">
          <dl class="variablelist">
            <dt><span class="term"><code class="constant">PERF_EVENT_IOC_ENABLE</code></span></dt>

            <dd>
              <p>This enables the individual event or event group
              specified by the file descriptor argument.</p>

              <p>If the <code class="constant">PERF_IOC_FLAG_GROUP</code> bit is set in
              the ioctl argument, then all events in a group are
              enabled, even if the event specified is not the group
              leader (but see BUGS).</p>
            </dd>

            <dt><span class="term"><code class="constant">PERF_EVENT_IOC_DISABLE</code></span></dt>

            <dd>
              <p>This disables the individual counter or event
              group specified by the file descriptor argument.</p>

              <p>Enabling or disabling the leader of a group
              enables or disables the entire group; that is, while
              the group leader is disabled, none of the counters in
              the group will count. Enabling or disabling a member
              of a group other than the leader affects only that
              counter; disabling a non-leader stops that counter
              from counting but doesn't affect any other
              counter.</p>

              <p>If the <code class="constant">PERF_IOC_FLAG_GROUP</code> bit is set in
              the ioctl argument, then all events in a group are
              disabled, even if the event specified is not the
              group leader (but see BUGS).</p>
            </dd>

            <dt><span class="term"><code class="constant">PERF_EVENT_IOC_REFRESH</code></span></dt>

            <dd>
              <p>Non-inherited overflow counters can use this to
              enable a counter for a number of overflows specified
              by the argument, after which it is disabled.
              Subsequent calls of this ioctl add the argument value
              to the current count. A signal with <code class="constant">POLL_IN</code> set will happen on each
              overflow until the count reaches 0; when that happens
              a signal with POLL_HUP set is sent and the event is
              disabled. Using an argument of 0 is considered
              undefined behavior.</p>
            </dd>

            <dt><span class="term"><code class="constant">PERF_EVENT_IOC_RESET</code></span></dt>

            <dd>
              <p>Reset the event count specified by the file
              descriptor argument to zero. This resets only the
              counts; there is no way to reset the multiplexing
              <em class="parameter"><code>time_enabled</code></em>
              or <em class="parameter"><code>time_running</code></em>
              values.</p>

              <p>If the <code class="constant">PERF_IOC_FLAG_GROUP</code> bit is set in
              the ioctl argument, then all events in a group are
              reset, even if the event specified is not the group
              leader (but see BUGS).</p>
            </dd>

            <dt><span class="term"><code class="constant">PERF_EVENT_IOC_PERIOD</code></span></dt>

            <dd>
              <p>This updates the overflow period for the
              event.</p>

              <p>Since Linux 3.7 (on ARM) and Linux 3.14 (all other
              architectures), the new period takes effect
              immediately. On older kernels, the new period did not
              take effect until after the next overflow.</p>

              <p>The argument is a pointer to a 64-bit value
              containing the desired new period.</p>

              <p>Prior to Linux 2.6.36 this ioctl always failed due
              to a bug in the kernel.</p>
            </dd>

            <dt><span class="term"><code class="constant">PERF_EVENT_IOC_SET_OUTPUT</code></span></dt>

            <dd>
              <p>This tells the kernel to report event
              notifications to the specified file descriptor rather
              than the default one. The file descriptors must all
              be on the same CPU.</p>

              <p>The argument specifies the desired file
              descriptor, or −1 if output should be
              ignored.</p>
            </dd>

            <dt><span class="term"><code class="constant">PERF_EVENT_IOC_SET_FILTER</code> (since
            Linux 2.6.33)</span></dt>

            <dd>
              <p>This adds an ftrace filter to this event.</p>

              <p>The argument is a pointer to the desired ftrace
              filter.</p>
            </dd>

            <dt><span class="term"><code class="constant">PERF_EVENT_IOC_ID</code> (since Linux
            3.12)</span></dt>

            <dd>
              <p>This returns the event ID value for the given
              event file descriptor.</p>

              <p>The argument is a pointer to a 64-bit unsigned
              integer to hold the result.</p>
            </dd>
          </dl>
        </div>
      </div>

      <div class="refsect2">
        <a id="perf-event-open-2_sect8" name="perf-event-open-2_sect8" shape="rect"> </a>

        <h3>Using prctl</h3>

        <p>A process can enable or disable all the event groups
        that are attached to it using the <a class="link" href="../htmlman2/prctl.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">prctl</span>(2)</span></a> <code class="constant">PR_TASK_PERF_EVENTS_ENABLE</code> and
        <code class="constant">PR_TASK_PERF_EVENTS_DISABLE</code>
        operations. This applies to all counters on the calling
        process, whether created by this process or by another, and
        does not affect any counters that this process has created
        on other processes. It enables or disables only the group
        leaders, not any other members in the groups.</p>
      </div>

      <div class="refsect2">
        <a id="perf-event-open-2_sect9" name="perf-event-open-2_sect9" shape="rect"> </a>

        <h3>perf_event related configuration files</h3>

        <p>Files in <code class="filename">/proc/sys/kernel/</code></p>

        <div class="blockquote">
          <blockquote class="blockquote">
            <div class="variablelist">
              <dl class="variablelist">
                <dt><span class="term"><code class="filename">/proc/sys/kernel/perf_event_paranoid</code></span></dt>

                <dd>
                  <p>The <em class="replaceable"><code>perf_event_paranoid</code></em>
                  file can be set to restrict access to the
                  performance counters.</p>

                  <div class="blockquote">
                    <blockquote class="blockquote">
                      <div class="variablelist">
                        <dl class="variablelist">
                          <dt><span class="term"><code class="constant">2</code></span></dt>

                          <dd>
                            <p>only allow user-space
                            measurements.</p>
                          </dd>

                          <dt><span class="term"><code class="constant">1</code></span></dt>

                          <dd>
                            <p>allow both kernel and user
                            measurements (default).</p>
                          </dd>

                          <dt><span class="term"><code class="constant">0</code></span></dt>

                          <dd>
                            <p>allow access to CPU-specific data
                            but not raw tracepoint samples.</p>
                          </dd>

                          <dt><span class="term"><span class="emphasis"><em>−1</em></span></span></dt>

                          <dd>
                            <p>no restrictions.</p>
                          </dd>
                        </dl>
                      </div>
                    </blockquote>
                  </div>

                  <p>The existence of the <em class="replaceable"><code>perf_event_paranoid</code></em>
                  file is the official method for determining if a
                  kernel supports <code class="function">perf_event_open</code>().</p>
                </dd>

                <dt><span class="term"><code class="filename">/proc/sys/kernel/perf_event_max_sample_rate</code></span></dt>

                <dd>
                  <p>This sets the maximum sample rate. Setting
                  this too high can allow users to sample at a rate
                  that impacts overall machine performance and
                  potentially lock up the machine. The default
                  value is 100000 (samples per second).</p>
                </dd>

                <dt><span class="term"><code class="filename">/proc/sys/kernel/perf_event_mlock_kb</code></span></dt>

                <dd>
                  <p>Maximum number of pages an unprivileged user
                  can <a class="link" href="../htmlman2/mlock.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">mlock</span>(2)</span></a>. The
                  default is 516 (kB).</p>
                </dd>
              </dl>
            </div>
          </blockquote>
        </div>

        <p>Files in <code class="filename">/sys/bus/event_source/devices/</code></p>

        <div class="blockquote">
          <blockquote class="blockquote">
            <p>Since Linux 2.6.34, the kernel supports having
            multiple PMUs available for monitoring. Information on
            how to program these PMUs can be found under
            <code class="filename">/sys/bus/event_source/devices/</code>. Each
            subdirectory corresponds to a different PMU.</p>

            <div class="variablelist">
              <dl class="variablelist">
                <dt><span class="term"><code class="filename">/sys/bus/event_source/devices/*/type</code>
                (since Linux 2.6.38)</span></dt>

                <dd>
                  <p>This contains an integer that can be used in
                  the <em class="parameter"><code>type</code></em>
                  field of <span class="structname">perf_event_attr</span> to indicate
                  that you wish to use this PMU.</p>
                </dd>

                <dt><span class="term"><code class="filename">/sys/bus/event_source/devices/*/rdpmc</code>
                (since Linux 3.4)</span></dt>

                <dd>
                  <p>If this file is 1, then direct user-space
                  access to the performance counter registers is
                  allowed via the rdpmc instruction. This can be
                  disabled by echoing 0 to the file.</p>
                </dd>

                <dt><span class="term"><code class="filename">/sys/bus/event_source/devices/*/format/</code>
                (since Linux 3.4)</span></dt>

                <dd>
                  <p>This subdirectory contains information on the
                  architecture-specific subfields available for
                  programming the various <em class="replaceable"><code>config</code></em> fields in
                  the <span class="structname">perf_event_attr</span> struct.</p>

                  <p>The content of each file is the name of the
                  config field, followed by a colon, followed by a
                  series of integer bit ranges separated by commas.
                  For example, the file <em class="replaceable"><code>event</code></em> may contain
                  the value <em class="replaceable"><code>config1:1,6-10,44</code></em>
                  which indicates that event is an attribute that
                  occupies bits 1,6-10, and 44 of <em class="replaceable"><code>perf_event_attr::config1</code></em>.</p>
                </dd>

                <dt><span class="term"><code class="filename">/sys/bus/event_source/devices/*/events/</code>
                (since Linux 3.4)</span></dt>

                <dd>
                  <p>This subdirectory contains files with
                  predefined events. The contents are strings
                  describing the event settings expressed in terms
                  of the fields found in the previously mentioned
                  <em class="replaceable"><code>./format/</code></em>
                  directory. These are not necessarily complete
                  lists of all events supported by a PMU, but
                  usually a subset of events deemed useful or
                  interesting.</p>

                  <p>The content of each file is a list of
                  attribute names separated by commas. Each entry
                  has an optional value (either hex or decimal). If
                  no value is specified, then it is assumed to be a
                  single-bit field with a value of 1. An example
                  entry may look like this: <em class="replaceable"><code>event=0x2,inv,ldlat=3</code></em>.</p>
                </dd>

                <dt><span class="term"><code class="filename">/sys/bus/event_source/devices/*/uevent</code></span></dt>

                <dd>
                  <p>This file is the standard kernel device
                  interface for injecting hotplug events.</p>
                </dd>

                <dt><span class="term"><code class="filename">/sys/bus/event_source/devices/*/cpumask</code>
                (since Linux 3.7)</span></dt>

                <dd>
                  <p>The <em class="replaceable"><code>cpumask</code></em> file
                  contains a comma-separated list of integers that
                  indicate a representative CPU number for each
                  socket (package) on the motherboard. This is
                  needed when setting up uncore or northbridge
                  events, as those PMUs present socket-wide
                  events.</p>
                </dd>
              </dl>
            </div>
          </blockquote>
        </div>
      </div>
    </div>

    <div class="refsect1">
      <a id="perf-event-open-2_sect10" name="perf-event-open-2_sect10" shape="rect"> </a>

      <h2>RETURN VALUE</h2>

      <p><code class="function">perf_event_open</code>() returns
      the new file descriptor, or −1 if an error occurred (in
      which case, <code class="varname">errno</code> is set
      appropriately).</p>
    </div>

    <div class="refsect1">
      <a id="perf-event-open-2_sect11" name="perf-event-open-2_sect11" shape="rect"> </a>

      <h2>ERRORS</h2>

      <p>The errors returned by <code class="function">perf_event_open</code>() can be inconsistent, and
      may vary across processor architectures and performance
      monitoring units.</p>

      <div class="variablelist">
        <dl class="variablelist">
          <dt><span class="term"><span class="errorname">E2BIG</span></span></dt>

          <dd>
            <p>Returned if the <span class="structname">perf_event_attr</span> <em class="parameter"><code>size</code></em> value is too small
            (smaller than <code class="constant">PERF_ATTR_SIZE_VER0</code>), too big (larger
            than the page size), or larger than the kernel supports
            and the extra bytes are not zero. When <span class="errorname">E2BIG</span> is returned, the <span class="structname">perf_event_attr</span> <em class="parameter"><code>size</code></em> field is overwritten
            by the kernel to be the size of the structure it was
            expecting.</p>
          </dd>

          <dt><span class="term"><span class="errorname">EACCES</span></span></dt>

          <dd>
            <p>Returned when the requested event requires
            <code class="constant">CAP_SYS_ADMIN</code> permissions
            (or a more permissive perf_event paranoid setting).
            Some common cases where an unprivileged process may
            encounter this error: attaching to a process owned by a
            different user; monitoring all processes on a given CPU
            (i.e., specifying the <em class="parameter"><code>pid</code></em> argument as
            −1); and not setting <em class="replaceable"><code>exclude_kernel</code></em> when the
            paranoid setting requires it.</p>
          </dd>

          <dt><span class="term"><span class="errorname">EBADF</span></span></dt>

          <dd>
            <p>Returned if the <em class="parameter"><code>group_fd</code></em> file descriptor
            is not valid, or, if <code class="constant">PERF_FLAG_PID_CGROUP</code> is set, the
            cgroup file descriptor in <em class="parameter"><code>pid</code></em> is not valid.</p>
          </dd>

          <dt><span class="term"><span class="errorname">EFAULT</span></span></dt>

          <dd>
            <p>Returned if the <em class="parameter"><code>attr</code></em> pointer points at an
            invalid memory address.</p>
          </dd>

          <dt><span class="term"><span class="errorname">EINVAL</span></span></dt>

          <dd>
            <p>Returned if the specified event is invalid. There
            are many possible reasons for this. A not-exhaustive
            list: <em class="replaceable"><code>sample_freq</code></em> is higher
            than the maximum setting; the <em class="parameter"><code>cpu</code></em> to monitor does not
            exist; <em class="replaceable"><code>read_format</code></em> is out of
            range; <em class="replaceable"><code>sample_type</code></em> is out of
            range; the <em class="parameter"><code>flags</code></em> value is out of
            range; <em class="replaceable"><code>exclusive</code></em> or <em class="replaceable"><code>pinned</code></em> set and the
            event is not a group leader; the event <em class="replaceable"><code>config</code></em> values are out
            of range or set reserved bits; the generic event
            selected is not supported; or there is not enough room
            to add the selected event.</p>
          </dd>

          <dt><span class="term"><span class="errorname">EMFILE</span></span></dt>

          <dd>
            <p>Each opened event uses one file descriptor. If a
            large number of events are opened the per-user file
            descriptor limit (often 1024) will be hit and no more
            events can be created.</p>
          </dd>

          <dt><span class="term"><span class="errorname">ENODEV</span></span></dt>

          <dd>
            <p>Returned when the event involves a feature not
            supported by the current CPU.</p>
          </dd>

          <dt><span class="term"><span class="errorname">ENOENT</span></span></dt>

          <dd>
            <p>Returned if the <em class="parameter"><code>type</code></em> setting is not
            valid. This error is also returned for some unsupported
            generic events.</p>
          </dd>

          <dt><span class="term"><span class="errorname">ENOSPC</span></span></dt>

          <dd>
            <p>Prior to Linux 3.3, if there was not enough room for
            the event, <span class="errorname">ENOSPC</span> was
            returned. In Linux 3.3, this was changed to
            <span class="errorname">EINVAL</span>. <span class="errorname">ENOSPC</span> is still returned if you try
            to add more breakpoint events than supported by the
            hardware.</p>
          </dd>

          <dt><span class="term"><span class="errorname">ENOSYS</span></span></dt>

          <dd>
            <p>Returned if <code class="constant">PERF_SAMPLE_STACK_USER</code> is set in
            <em class="replaceable"><code>sample_type</code></em>
            and it is not supported by hardware.</p>
          </dd>

          <dt><span class="term"><span class="errorname">EOPNOTSUPP</span></span></dt>

          <dd>
            <p>Returned if an event requiring a specific hardware
            feature is requested but there is no hardware support.
            This includes requesting low-skid events if not
            supported, branch tracing if it is not available,
            sampling if no PMU interrupt is available, and branch
            stacks for software events.</p>
          </dd>

          <dt><span class="term"><span class="errorname">EPERM</span></span></dt>

          <dd>
            <p>Returned on many (but not all) architectures when an
            unsupported <em class="replaceable"><code>exclude_hv</code></em>, <em class="replaceable"><code>exclude_idle</code></em>,
            <em class="replaceable"><code>exclude_user</code></em>,
            or <em class="replaceable"><code>exclude_kernel</code></em> setting
            is specified.</p>

            <p>It can also happen, as with <span class="errorname">EACCES</span>, when the requested event
            requires <code class="constant">CAP_SYS_ADMIN</code>
            permissions (or a more permissive perf_event paranoid
            setting). This includes setting a breakpoint on a
            kernel address, and (since Linux 3.13) setting a kernel
            function-trace tracepoint.</p>
          </dd>

          <dt><span class="term"><span class="errorname">ESRCH</span></span></dt>

          <dd>
            <p>Returned if attempting to attach to a process that
            does not exist.</p>
          </dd>
        </dl>
      </div>
    </div>

    <div class="refsect1">
      <a id="perf-event-open-2_sect12" name="perf-event-open-2_sect12" shape="rect"> </a>

      <h2>VERSION</h2>

      <p><code class="function">perf_event_open</code>() was
      introduced in Linux 2.6.31 but was called <code class="function">perf_counter_open</code>(). It was renamed in
      Linux 2.6.32.</p>
    </div>

    <div class="refsect1">
      <a id="perf-event-open-2_sect13" name="perf-event-open-2_sect13" shape="rect"> </a>

      <h2>CONFORMING TO</h2>

      <p>This <code class="function">perf_event_open</code>()
      system call Linux- specific and should not be used in
      programs intended to be portable.</p>
    </div>

    <div class="refsect1">
      <a id="perf-event-open-2_sect14" name="perf-event-open-2_sect14" shape="rect"> </a>

      <h2>NOTES</h2>

      <p>Glibc does not provide a wrapper for this system call;
      call it using <a class="link" href="../htmlman2/syscall.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">syscall</span>(2)</span></a>. See the example
      below.</p>

      <p>The official way of knowing if <code class="function">perf_event_open</code>() support is enabled is
      checking for the existence of the file <code class="filename">/proc/sys/kernel/perf_event_paranoid</code>.</p>
    </div>

    <div class="refsect1">
      <a id="perf-event-open-2_sect15" name="perf-event-open-2_sect15" shape="rect"> </a>

      <h2>BUGS</h2>

      <p>The <code class="constant">F_SETOWN_EX</code> option to
      <a class="link" href="../htmlman2/fcntl.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">fcntl</span>(2)</span></a> is needed to
      properly get overflow signals in threads. This was introduced
      in Linux 2.6.32.</p>

      <p>Prior to Linux 2.6.33 (at least for x86), the kernel did
      not check if events could be scheduled together until read
      time. The same happens on all known kernels if the NMI
      watchdog is enabled. This means to see if a given set of
      events works you have to <code class="function">perf_event_open</code>(), start, then read before
      you know for sure you can get valid measurements.</p>

      <p>Prior to Linux 2.6.34, event constraints were not enforced
      by the kernel. In that case, some events would silently
      return "0" if the kernel scheduled them in an improper
      counter slot.</p>

      <p>Prior to Linux 2.6.34, there was a bug when multiplexing
      where the wrong results could be returned.</p>

      <p>Kernels from Linux 2.6.35 to Linux 2.6.39 can quickly
      crash the kernel if "inherit" is enabled and many threads are
      started.</p>

      <p>Prior to Linux 2.6.35, <code class="constant">PERF_FORMAT_GROUP</code> did not work with
      attached processes.</p>

      <p>In older Linux 2.6 versions, refreshing an event group
      leader refreshed all siblings, and refreshing with a
      parameter of 0 enabled infinite refresh. This behavior is
      unsupported and should not be relied on.</p>

      <p>There is a bug in the kernel code between Linux 2.6.36 and
      Linux 3.0 that ignores the "watermark" field and acts as if a
      wakeup_event was chosen if the union has a nonzero value in
      it.</p>

      <p>From Linux 2.6.31 to Linux 3.4, the <code class="constant">PERF_IOC_FLAG_GROUP</code> ioctl argument was
      broken and would repeatedly operate on the event specified
      rather than iterating across all sibling events in a
      group.</p>

      <p>From Linux 3.4 to Linux 3.11, the mmap <em class="replaceable"><code>cap_usr_rdpmc</code></em> and <em class="replaceable"><code>cap_usr_time</code></em> bits mapped to
      the same location. Code should migrate to the new <em class="replaceable"><code>cap_user_rdpmc</code></em> and <em class="replaceable"><code>cap_user_time</code></em> fields
      instead.</p>

      <p>Always double-check your results! Various generalized
      events have had wrong values. For example, retired branches
      measured the wrong thing on AMD machines until Linux
      2.6.35.</p>
    </div>

    <div class="refsect1">
      <a id="perf-event-open-2_sect16" name="perf-event-open-2_sect16" shape="rect"> </a>

      <h2>EXAMPLE</h2>

      <p>The following is a short example that measures the total
      instruction count of a call to <a class="link" href="../htmlman3/printf.3.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">printf</span>(3)</span></a>.</p>

      <div class="informalexample">
        <pre class="programlisting" xml:space="preserve">
#include &lt;stdlib.h&gt;
#include &lt;stdio.h&gt;
#include &lt;unistd.h&gt;
#include &lt;string.h&gt;
#include &lt;sys/ioctl.h&gt;
#include &lt;linux/perf_event.h&gt;
#include &lt;asm/unistd.h&gt;

static long
perf_event_open(struct perf_event_attr *hw_event, pid_t pid,
                int cpu, int group_fd, unsigned long flags)
{
    int ret;

    ret = syscall(__NR_perf_event_open, hw_event, pid, cpu,
                   group_fd, flags);
    return ret;
}

int
main(int argc, char **argv)
{
    struct perf_event_attr pe;
    long long count;
    int fd;

    memset(&amp;pe, 0, sizeof(struct perf_event_attr));
    pe.type = PERF_TYPE_HARDWARE;
    pe.size = sizeof(struct perf_event_attr);
    pe.config = PERF_COUNT_HW_INSTRUCTIONS;
    pe.disabled = 1;
    pe.exclude_kernel = 1;
    pe.exclude_hv = 1;

    fd = perf_event_open(&amp;pe, 0, −1, −1, 0);
    if (fd == −1) {
       fprintf(stderr, "Error opening leader %llx\n", pe.config);
       exit(EXIT_FAILURE);
    }

    ioctl(fd, PERF_EVENT_IOC_RESET, 0);
    ioctl(fd, PERF_EVENT_IOC_ENABLE, 0);

    printf("Measuring instruction count for this printf\n");

    ioctl(fd, PERF_EVENT_IOC_DISABLE, 0);
    read(fd, &amp;count, sizeof(long long));

    printf("Used %lld instructions\n", count);

    close(fd);
}
</pre>
      </div>
    </div>

    <div class="refsect1">
      <a id="perf-event-open-2_sect17" name="perf-event-open-2_sect17" shape="rect"> </a>

      <h2>SEE ALSO</h2>

      <p><a class="link" href="../htmlman2/fcntl.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">fcntl</span>(2)</span></a>, <a class="link" href="../htmlman2/mmap.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">mmap</span>(2)</span></a>, <a class="link" href="../htmlman2/open.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">open</span>(2)</span></a>, <a class="link" href="../htmlman2/prctl.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">prctl</span>(2)</span></a>, <a class="link" href="../htmlman2/read.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">read</span>(2)</span></a></p>
    </div>

    <div class="colophon">
      <a id="perf-event-open-2_sect18" name="perf-event-open-2_sect18" shape="rect"> </a>

      <h2>COLOPHON</h2>

      <p>This page is part of release 3.72 of the Linux <em class="replaceable"><code>man-pages</code></em> project. A
      description of the project, information about reporting bugs,
      and the latest version of this page, can be found at
      http://www.kernel.org/doc/man−pages/.</p>
    </div>
  </div>
</body>
</html>
