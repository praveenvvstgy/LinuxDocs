<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
  <title>
   query_module(2) &mdash; Linux manual pages
  </title>
  <link href="../stylesheet/manpages.css" rel="stylesheet" type="text/css"/>
  <link href="../index.html" rel="home" title="query_module(2) &mdash; Linux manual pages"/>
  <script src="../stylesheet/manpages.js" type="text/javascript" xml:space="preserve">
  </script>
  <link href="../stylesheet/icon.gif" rel="icon" type="image/gif"/>
 </head>
 <body>
  <div class="refentry">
   <a id="query-module.2" name="query-module.2" shape="rect">
   </a>
   <div class="titlepage">
   </div>
   <div class="refnamediv">
    <h2>
     Name
    </h2>
    <p>
     query_module &mdash; query the kernel for various bits
      pertaining to modules
    </p>
   </div>
   <div class="refsynopsisdiv">
    <h2>
     Synopsis
    </h2>
    <div class="funcsynopsis">
     <pre class="funcsynopsisinfo" xml:space="preserve">
#include &lt;linux/module.h&gt;
</pre>
     <table border="0" class="funcprototype-table" style="cellspacing: 0; cellpadding: 0;" summary="Function synopsis">
      <tr>
       <td colspan="1" rowspan="1">
        <code class="funcdef">
         int
         <strong>
          query_module
         </strong>
         (
        </code>
       </td>
       <td colspan="1" rowspan="1">
        const char *
        <var class="pdparam">
         name
        </var>
        ,
       </td>
      </tr>
      <tr>
       <td colspan="1" rowspan="1">
        &nbsp;
       </td>
       <td colspan="1" rowspan="1">
        int
        <var class="pdparam">
         which
        </var>
        ,
       </td>
      </tr>
      <tr>
       <td colspan="1" rowspan="1">
        &nbsp;
       </td>
       <td colspan="1" rowspan="1">
        void *
        <var class="pdparam">
         buf
        </var>
        ,
       </td>
      </tr>
      <tr>
       <td colspan="1" rowspan="1">
        &nbsp;
       </td>
       <td colspan="1" rowspan="1">
        size_t
        <var class="pdparam">
         bufsize
        </var>
        ,
       </td>
      </tr>
      <tr>
       <td colspan="1" rowspan="1">
        &nbsp;
       </td>
       <td colspan="1" rowspan="1">
        size_t *
        <var class="pdparam">
         ret
        </var>
        <code>
         )
        </code>
        ;
       </td>
      </tr>
     </table>
     <div class="funcprototype-spacer">
      &nbsp;
     </div>
    </div>
    <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tr>
       <td align="center" colspan="1" rowspan="2" valign="top" width="25">
        <img alt="[Note]" src="../stylesheet/note.png"/>
       </td>
       <th align="left" colspan="1" rowspan="1">
        Note
       </th>
      </tr>
      <tr>
       <td align="left" colspan="1" rowspan="1" valign="top">
        No declaration of this
            function is provided in glibc headers; see NOTES.
       </td>
      </tr>
     </table>
    </div>
   </div>
   <div class="refsect1">
    <a id="query-module-2_sect1" name="query-module-2_sect1" shape="rect">
    </a>
    <h2>
     DESCRIPTION
    </h2>
    <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tr>
       <td align="center" colspan="1" rowspan="2" valign="top" width="25">
        <img alt="[Note]" src="../stylesheet/note.png"/>
       </td>
       <th align="left" colspan="1" rowspan="1">
        Note
       </th>
      </tr>
      <tr>
       <td align="left" colspan="1" rowspan="1" valign="top">
        <p>
         This system call is present only in kernels before
              Linux 2.6.
        </p>
       </td>
      </tr>
     </table>
    </div>
    <p>
     <code class="function">
      query_module
     </code>
     () requests
      information from the kernel about loadable modules. The
      returned information is placed in the buffer pointed to by
     <em class="parameter">
      <code>
       buf
      </code>
     </em>
     . The caller must
      specify the size of
     <em class="parameter">
      <code>
       buf
      </code>
     </em>
     in
     <em class="parameter">
      <code>
       bufsize
      </code>
     </em>
     . The precise nature and
      format of the returned information depend on the operation
      specified by
     <em class="parameter">
      <code>
       which
      </code>
     </em>
     .
      Some operations require
     <em class="parameter">
      <code>
       name
      </code>
     </em>
     to identify a currently
      loaded module, some allow
     <em class="parameter">
      <code>
       name
      </code>
     </em>
     to be NULL, indicating the
      kernel proper.
    </p>
    <p>
     The following values can be specified for
     <em class="parameter">
      <code>
       which
      </code>
     </em>
     :
    </p>
    <div class="variablelist">
     <dl class="variablelist">
      <dt>
       <span class="term">
        <code class="constant">
         0
        </code>
       </span>
      </dt>
      <dd>
       <p>
        Returns success, if the kernel supports
        <code class="function">
         query_module
        </code>
        (). Used to probe for
            availability of the system call.
       </p>
      </dd>
      <dt>
       <span class="term">
        <code class="constant">
         QM_MODULES
        </code>
       </span>
      </dt>
      <dd>
       <p>
        Returns the names of all loaded modules. The
            returned buffer consists of a sequence of
            null-terminated strings;
        <em class="parameter">
         <code>
          ret
         </code>
        </em>
        is set to the number
            of modules.
       </p>
      </dd>
      <dt>
       <span class="term">
        <code class="constant">
         QM_DEPS
        </code>
       </span>
      </dt>
      <dd>
       <p>
        Returns the names of all modules used by the
            indicated module. The returned buffer consists of a
            sequence of null-terminated strings;
        <em class="parameter">
         <code>
          ret
         </code>
        </em>
        is set to the number
            of modules.
       </p>
      </dd>
      <dt>
       <span class="term">
        <code class="constant">
         QM_REFS
        </code>
       </span>
      </dt>
      <dd>
       <p>
        Returns the names of all modules using the indicated
            module. This is the inverse of
        <code class="constant">
         QM_DEPS
        </code>
        . The returned buffer consists
            of a sequence of null-terminated strings;
        <em class="parameter">
         <code>
          ret
         </code>
        </em>
        is set to the number
            of modules.
       </p>
      </dd>
      <dt>
       <span class="term">
        <code class="constant">
         QM_SYMBOLS
        </code>
       </span>
      </dt>
      <dd>
       <p>
        Returns the symbols and values exported by the
            kernel or the indicated module. The returned buffer is
            an array of structures of the following form
       </p>
       <div class="blockquote">
        <blockquote class="blockquote">
         <div class="structdef">
          <table style="border-collapse: collapse;">
           <colgroup span="1">
            <col class="c1" span="1">
            </col>
            <col class="c2" span="1">
            </col>
            <col class="c3" span="1">
            </col>
            <col class="c4" span="1">
            </col>
            <col class="c5" span="1">
            </col>
           </colgroup>
           <tbody>
            <tr>
             <td align="left" class="structdefhdr" colspan="1" rowspan="1" style="">
              struct
             </td>
             <td align="left" class="structdefhdr" colspan="4" rowspan="1" style="">
              <span class="structname">
               module_symbol
              </span>
              &nbsp;{
             </td>
            </tr>
            <tr>
             <td colspan="1" rowspan="1" style="">
              &nbsp;
             </td>
             <td align="left" colspan="1" rowspan="1" style="">
              <span class="type">
               unsigned&nbsp;long
              </span>
             </td>
             <td align="right" class="norightpad" colspan="1" rowspan="1" style="">
              &nbsp;
             </td>
             <td align="left" colspan="1" rowspan="1" style="">
              <em class="structfield">
               <code>
                value
               </code>
              </em>
              ;
             </td>
             <td align="left" colspan="1" rowspan="1" style="">
              &nbsp;
             </td>
            </tr>
            <tr>
             <td colspan="1" rowspan="1" style="">
              &nbsp;
             </td>
             <td align="left" colspan="1" rowspan="1" style="">
              <span class="type">
               unsigned&nbsp;long
              </span>
             </td>
             <td align="right" class="norightpad" colspan="1" rowspan="1" style="">
              &nbsp;
             </td>
             <td align="left" colspan="1" rowspan="1" style="">
              <em class="structfield">
               <code>
                name
               </code>
              </em>
              ;
             </td>
             <td align="left" colspan="1" rowspan="1" style="">
              &nbsp;
             </td>
            </tr>
            <tr>
             <td align="left" class="structdefftr" colspan="5" rowspan="1" style="">
              };
             </td>
            </tr>
           </tbody>
          </table>
         </div>
        </blockquote>
       </div>
       <p>
        followed by null-terminated strings. The value of
        <em class="parameter">
         <code>
          name
         </code>
        </em>
        is the
            character offset of the string relative to the start of
        <em class="parameter">
         <code>
          buf
         </code>
        </em>
        ;
        <em class="parameter">
         <code>
          ret
         </code>
        </em>
        is set to the number
            of symbols.
       </p>
      </dd>
      <dt>
       <span class="term">
        <code class="constant">
         QM_INFO
        </code>
       </span>
      </dt>
      <dd>
       <p>
        Returns miscellaneous information about the
            indicated module. The output buffer format is:
       </p>
       <div class="blockquote">
        <blockquote class="blockquote">
         <div class="structdef">
          <table style="border-collapse: collapse;">
           <colgroup span="1">
            <col class="c1" span="1">
            </col>
            <col class="c2" span="1">
            </col>
            <col class="c3" span="1">
            </col>
            <col class="c4" span="1">
            </col>
            <col class="c5" span="1">
            </col>
           </colgroup>
           <tbody>
            <tr>
             <td align="left" class="structdefhdr" colspan="1" rowspan="1" style="">
              struct
             </td>
             <td align="left" class="structdefhdr" colspan="4" rowspan="1" style="">
              <span class="structname">
               module_info
              </span>
              &nbsp;{
             </td>
            </tr>
            <tr>
             <td colspan="1" rowspan="1" style="">
              &nbsp;
             </td>
             <td align="left" colspan="1" rowspan="1" style="">
              <span class="type">
               unsigned&nbsp;long
              </span>
             </td>
             <td align="right" class="norightpad" colspan="1" rowspan="1" style="">
              &nbsp;
             </td>
             <td align="left" colspan="1" rowspan="1" style="">
              <em class="structfield">
               <code>
                address
               </code>
              </em>
              ;
             </td>
             <td align="left" colspan="1" rowspan="1" style="">
              &nbsp;
             </td>
            </tr>
            <tr>
             <td colspan="1" rowspan="1" style="">
              &nbsp;
             </td>
             <td align="left" colspan="1" rowspan="1" style="">
              <span class="type">
               unsigned&nbsp;long
              </span>
             </td>
             <td align="right" class="norightpad" colspan="1" rowspan="1" style="">
              &nbsp;
             </td>
             <td align="left" colspan="1" rowspan="1" style="">
              <em class="structfield">
               <code>
                size
               </code>
              </em>
              ;
             </td>
             <td align="left" colspan="1" rowspan="1" style="">
              &nbsp;
             </td>
            </tr>
            <tr>
             <td colspan="1" rowspan="1" style="">
              &nbsp;
             </td>
             <td align="left" colspan="1" rowspan="1" style="">
              <span class="type">
               unsigned&nbsp;long
              </span>
             </td>
             <td align="right" class="norightpad" colspan="1" rowspan="1" style="">
              &nbsp;
             </td>
             <td align="left" colspan="1" rowspan="1" style="">
              <em class="structfield">
               <code>
                flags
               </code>
              </em>
              ;
             </td>
             <td align="left" colspan="1" rowspan="1" style="">
              &nbsp;
             </td>
            </tr>
            <tr>
             <td align="left" class="structdefftr" colspan="5" rowspan="1" style="">
              };
             </td>
            </tr>
           </tbody>
          </table>
         </div>
        </blockquote>
       </div>
       <p>
        where
        <em class="parameter">
         <code>
          address
         </code>
        </em>
        is the kernel
            address at which the module resides,
        <em class="parameter">
         <code>
          size
         </code>
        </em>
        is the size of the
            module in bytes, and
        <em class="parameter">
         <code>
          flags
         </code>
        </em>
        is a mask of
        <code class="constant">
         MOD_RUNNING
        </code>
        ,
        <code class="constant">
         MOD_AUTOCLEAN
        </code>
        , and so on, that
            indicates the current status of the module (see the
            Linux kernel source file
        <code class="filename">
         include/linux/module.h
        </code>
        ).
        <em class="parameter">
         <code>
          ret
         </code>
        </em>
        is set to the size of
            the
        <em class="replaceable">
         <code>
          module_info
         </code>
        </em>
        structure.
       </p>
      </dd>
     </dl>
    </div>
   </div>
   <div class="refsect1">
    <a id="query-module-2_sect2" name="query-module-2_sect2" shape="rect">
    </a>
    <h2>
     RETURN VALUE
    </h2>
    <p>
     On success, zero is returned. On error, &minus;1 is
      returned and
     <code class="varname">
      errno
     </code>
     is set
      appropriately.
    </p>
   </div>
   <div class="refsect1">
    <a id="query-module-2_sect3" name="query-module-2_sect3" shape="rect">
    </a>
    <h2>
     ERRORS
    </h2>
    <div class="variablelist">
     <dl class="variablelist">
      <dt>
       <span class="term">
        <span class="errorname">
         EFAULT
        </span>
       </span>
      </dt>
      <dd>
       <p>
        At least one of
        <em class="parameter">
         <code>
          name
         </code>
        </em>
        ,
        <em class="parameter">
         <code>
          buf
         </code>
        </em>
        , or
        <em class="parameter">
         <code>
          ret
         </code>
        </em>
        was outside the
            program's accessible address space.
       </p>
      </dd>
      <dt>
       <span class="term">
        <span class="errorname">
         EINVAL
        </span>
       </span>
      </dt>
      <dd>
       <p>
        Invalid
        <em class="parameter">
         <code>
          which
         </code>
        </em>
        ; or
        <em class="parameter">
         <code>
          name
         </code>
        </em>
        is NULL (indicating
            "the kernel"), but this is not permitted with the
            specified value of
        <em class="parameter">
         <code>
          which
         </code>
        </em>
        .
       </p>
      </dd>
      <dt>
       <span class="term">
        <span class="errorname">
         ENOENT
        </span>
       </span>
      </dt>
      <dd>
       <p>
        No module by that
        <em class="parameter">
         <code>
          name
         </code>
        </em>
        exists.
       </p>
      </dd>
      <dt>
       <span class="term">
        <span class="errorname">
         ENOSPC
        </span>
       </span>
      </dt>
      <dd>
       <p>
        The buffer size provided was too small.
        <em class="parameter">
         <code>
          ret
         </code>
        </em>
        is set to the minimum
            size needed.
       </p>
      </dd>
      <dt>
       <span class="term">
        <span class="errorname">
         ENOSYS
        </span>
       </span>
      </dt>
      <dd>
       <p>
        <code class="function">
         query_module
        </code>
        () is not
            supported in this version of the kernel (e.g., the
            kernel is version 2.6 or later).
       </p>
      </dd>
     </dl>
    </div>
   </div>
   <div class="refsect1">
    <a id="query-module-2_sect4" name="query-module-2_sect4" shape="rect">
    </a>
    <h2>
     VERSIONS
    </h2>
    <p>
     This system call is present on Linux only up until kernel
      2.4; it was removed in Linux 2.6.
    </p>
   </div>
   <div class="refsect1">
    <a id="query-module-2_sect5" name="query-module-2_sect5" shape="rect">
    </a>
    <h2>
     CONFORMING TO
    </h2>
    <p>
     <code class="function">
      query_module
     </code>
     () is
      Linux-specific.
    </p>
   </div>
   <div class="refsect1">
    <a id="query-module-2_sect6" name="query-module-2_sect6" shape="rect">
    </a>
    <h2>
     NOTES
    </h2>
    <p>
     Some of the information that was formerly available via
     <code class="function">
      query_module
     </code>
     () can be obtained
      from
     <code class="filename">
      /proc/modules
     </code>
     ,
     <code class="filename">
      /proc/kallsyms
     </code>
     , and the files
      under the directory
     <code class="filename">
      /sys/module
     </code>
     .
    </p>
    <p>
     The
     <code class="function">
      query_module
     </code>
     () system
      call is not supported by glibc. No declaration is provided in
      glibc headers, but, through a quirk of history, glibc does
      export an ABI for this system call. Therefore, in order to
      employ this system call, it is sufficient to manually declare
      the interface in your code; alternatively, you can invoke the
      system call using
     <a class="link" href="../htmlman2/syscall.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        syscall
       </span>
       (2)
      </span>
     </a>
     .
    </p>
   </div>
   <div class="refsect1">
    <a id="query-module-2_sect7" name="query-module-2_sect7" shape="rect">
    </a>
    <h2>
     SEE ALSO
    </h2>
    <p>
     <a class="link" href="../htmlman2/create_module.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        create_module
       </span>
       (2)
      </span>
     </a>
     ,
     <a class="link" href="../htmlman2/delete_module.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        delete_module
       </span>
       (2)
      </span>
     </a>
     ,
     <a class="link" href="../htmlman2/get_kernel_syms.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        get_kernel_syms
       </span>
       (2)
      </span>
     </a>
     ,
     <a class="link" href="../htmlman2/init_module.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        init_module
       </span>
       (2)
      </span>
     </a>
     ,
     <span class="citerefentry">
      <span class="refentrytitle">
       lsmod
      </span>
      (8)
     </span>
     ,
     <span class="citerefentry">
      <span class="refentrytitle">
       modinfo
      </span>
      (8)
     </span>
    </p>
   </div>
   <div class="colophon">
    <a id="query-module-2_sect8" name="query-module-2_sect8" shape="rect">
    </a>
    <h2>
     COLOPHON
    </h2>
    <p>
     This page is part of release 3.72 of the Linux
     <em class="replaceable">
      <code>
       man-pages
      </code>
     </em>
     project. A
      description of the project, information about reporting bugs,
      and the latest version of this page, can be found at
      http://www.kernel.org/doc/man&minus;pages/.
    </p>
   </div>
  </div>
 </body>
</html>
