<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
  <title>
   open(2) &mdash; Linux manual pages
  </title>
  <link href="../stylesheet/manpages.css" rel="stylesheet" type="text/css"/>
  <link href="../index.html" rel="home" title="open(2) &mdash; Linux manual pages"/>
  <script src="../stylesheet/manpages.js" type="text/javascript" xml:space="preserve">
  </script>
  <link href="../stylesheet/icon.gif" rel="icon" type="image/gif"/>
 </head>
 <body>
  <div class="refentry">
   <a id="open.2" name="open.2" shape="rect">
   </a>
   <div class="titlepage">
   </div>
   <div class="refnamediv">
    <h2>
     Name
    </h2>
    <p>
     open, openat, creat &mdash; open and possibly create a
      file
    </p>
   </div>
   <div class="refsynopsisdiv">
    <h2>
     Synopsis
    </h2>
    <div class="informalexample">
     <pre class="programlisting" xml:space="preserve">
#include &lt;sys/types.h&gt;
#include &lt;sys/stat.h&gt;
#include &lt;fcntl.h&gt;
</pre>
    </div>
    <div class="funcsynopsis">
     <table border="0" class="funcprototype-table" style="cellspacing: 0; cellpadding: 0;" summary="Function synopsis">
      <tr>
       <td colspan="1" rowspan="1">
        <code class="funcdef">
         int
         <strong>
          open
         </strong>
         (
        </code>
       </td>
       <td colspan="1" rowspan="1">
        const char *
        <var class="pdparam">
         pathname
        </var>
        ,
       </td>
      </tr>
      <tr>
       <td colspan="1" rowspan="1">
        &nbsp;
       </td>
       <td colspan="1" rowspan="1">
        int
        <var class="pdparam">
         flags
        </var>
        <code>
         )
        </code>
        ;
       </td>
      </tr>
     </table>
     <div class="funcprototype-spacer">
      &nbsp;
     </div>
    </div>
    <div class="funcsynopsis">
     <table border="0" class="funcprototype-table" style="cellspacing: 0; cellpadding: 0;" summary="Function synopsis">
      <tr>
       <td colspan="1" rowspan="1">
        <code class="funcdef">
         int
         <strong>
          open
         </strong>
         (
        </code>
       </td>
       <td colspan="1" rowspan="1">
        const char *
        <var class="pdparam">
         pathname
        </var>
        ,
       </td>
      </tr>
      <tr>
       <td colspan="1" rowspan="1">
        &nbsp;
       </td>
       <td colspan="1" rowspan="1">
        int
        <var class="pdparam">
         flags
        </var>
        ,
       </td>
      </tr>
      <tr>
       <td colspan="1" rowspan="1">
        &nbsp;
       </td>
       <td colspan="1" rowspan="1">
        mode_t
        <var class="pdparam">
         mode
        </var>
        <code>
         )
        </code>
        ;
       </td>
      </tr>
     </table>
     <div class="funcprototype-spacer">
      &nbsp;
     </div>
    </div>
    <div class="funcsynopsis">
     <table border="0" class="funcprototype-table" style="cellspacing: 0; cellpadding: 0;" summary="Function synopsis">
      <tr>
       <td colspan="1" rowspan="1">
        <code class="funcdef">
         int
         <strong>
          creat
         </strong>
         (
        </code>
       </td>
       <td colspan="1" rowspan="1">
        const char *
        <var class="pdparam">
         pathname
        </var>
        ,
       </td>
      </tr>
      <tr>
       <td colspan="1" rowspan="1">
        &nbsp;
       </td>
       <td colspan="1" rowspan="1">
        mode_t
        <var class="pdparam">
         mode
        </var>
        <code>
         )
        </code>
        ;
       </td>
      </tr>
     </table>
     <div class="funcprototype-spacer">
      &nbsp;
     </div>
    </div>
    <div class="funcsynopsis">
     <table border="0" class="funcprototype-table" style="cellspacing: 0; cellpadding: 0;" summary="Function synopsis">
      <tr>
       <td colspan="1" rowspan="1">
        <code class="funcdef">
         int
         <strong>
          openat
         </strong>
         (
        </code>
       </td>
       <td colspan="1" rowspan="1">
        int
        <var class="pdparam">
         dirfd
        </var>
        ,
       </td>
      </tr>
      <tr>
       <td colspan="1" rowspan="1">
        &nbsp;
       </td>
       <td colspan="1" rowspan="1">
        const char *
        <var class="pdparam">
         pathname
        </var>
        ,
       </td>
      </tr>
      <tr>
       <td colspan="1" rowspan="1">
        &nbsp;
       </td>
       <td colspan="1" rowspan="1">
        int
        <var class="pdparam">
         flags
        </var>
        <code>
         )
        </code>
        ;
       </td>
      </tr>
     </table>
     <div class="funcprototype-spacer">
      &nbsp;
     </div>
    </div>
    <div class="funcsynopsis">
     <table border="0" class="funcprototype-table" style="cellspacing: 0; cellpadding: 0;" summary="Function synopsis">
      <tr>
       <td colspan="1" rowspan="1">
        <code class="funcdef">
         int
         <strong>
          openat
         </strong>
         (
        </code>
       </td>
       <td colspan="1" rowspan="1">
        int
        <var class="pdparam">
         dirfd
        </var>
        ,
       </td>
      </tr>
      <tr>
       <td colspan="1" rowspan="1">
        &nbsp;
       </td>
       <td colspan="1" rowspan="1">
        const char *
        <var class="pdparam">
         pathname
        </var>
        ,
       </td>
      </tr>
      <tr>
       <td colspan="1" rowspan="1">
        &nbsp;
       </td>
       <td colspan="1" rowspan="1">
        int
        <var class="pdparam">
         flags
        </var>
        ,
       </td>
      </tr>
      <tr>
       <td colspan="1" rowspan="1">
        &nbsp;
       </td>
       <td colspan="1" rowspan="1">
        mode_t
        <var class="pdparam">
         mode
        </var>
        <code>
         )
        </code>
        ;
       </td>
      </tr>
     </table>
     <div class="funcprototype-spacer">
      &nbsp;
     </div>
    </div>
    <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tr>
       <td align="center" colspan="1" rowspan="2" valign="top" width="25">
        <img alt="[Note]" src="../stylesheet/note.png"/>
       </td>
       <th align="left" colspan="1" rowspan="1">
        Note
       </th>
      </tr>
      <tr>
       <td align="left" colspan="1" rowspan="1" valign="top">
        <div class="featuretests">
         <table style="border-collapse: collapse;">
          <colgroup span="1">
           <col span="1">
           </col>
          </colgroup>
          <thead>
           <tr>
            <th colspan="1" rowspan="1" style="">
             Feature Test Macro Requirements
                      for glibc (see
             <a class="link" href="../htmlman7/feature_test_macros.7.html" shape="rect" target="_top">
              <span class="citerefentry">
               <span class="refentrytitle">
                feature_test_macros
               </span>
               (7)
              </span>
             </a>
             ):
            </th>
           </tr>
          </thead>
          <tbody>
           <tr>
            <td colspan="1" rowspan="1" style="">
             <code class="function">
              openat
             </code>
             ():
            </td>
           </tr>
           <tr>
            <td class="featuretestver" colspan="1" rowspan="1" style="">
             Since
                      glibc 2.10:
            </td>
           </tr>
           <tr>
            <td class="featuretestdef" colspan="1" rowspan="1" style="">
             <code class="constant">
              _XOPEN_SOURCE
             </code>
             &gt;= 700 ||
             <code class="constant">
              _POSIX_C_SOURCE
             </code>
             &gt;=
                      200809L
            </td>
           </tr>
           <tr>
            <td class="featuretestver" colspan="1" rowspan="1" style="">
             Before
                      glibc 2.10:
            </td>
           </tr>
           <tr>
            <td class="featuretestdef" colspan="1" rowspan="1" style="">
             <code class="constant">
              _ATFILE_SOURCE
             </code>
            </td>
           </tr>
          </tbody>
         </table>
        </div>
       </td>
      </tr>
     </table>
    </div>
   </div>
   <div class="refsect1">
    <a id="open-2_sect1" name="open-2_sect1" shape="rect">
    </a>
    <h2>
     DESCRIPTION
    </h2>
    <p>
     Given a
     <em class="parameter">
      <code>
       pathname
      </code>
     </em>
     for a file,
     <code class="function">
      open
     </code>
     () returns a
      file descriptor, a small, nonnegative integer for use in
      subsequent system calls (
     <a class="link" href="../htmlman2/read.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        read
       </span>
       (2)
      </span>
     </a>
     ,
     <a class="link" href="../htmlman2/write.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        write
       </span>
       (2)
      </span>
     </a>
     ,
     <a class="link" href="../htmlman2/lseek.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        lseek
       </span>
       (2)
      </span>
     </a>
     ,
     <a class="link" href="../htmlman2/fcntl.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        fcntl
       </span>
       (2)
      </span>
     </a>
     , etc.). The file
      descriptor returned by a successful call will be the
      lowest-numbered file descriptor not currently open for the
      process.
    </p>
    <p>
     By default, the new file descriptor is set to remain open
      across an
     <a class="link" href="../htmlman2/execve.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        execve
       </span>
       (2)
      </span>
     </a>
     (i.e., the
     <code class="constant">
      FD_CLOEXEC
     </code>
     file descriptor flag
      described in
     <a class="link" href="../htmlman2/fcntl.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        fcntl
       </span>
       (2)
      </span>
     </a>
     is initially
      disabled); the
     <code class="constant">
      O_CLOEXEC
     </code>
     flag,
      described below, can be used to change this default. The file
      offset is set to the beginning of the file (see
     <a class="link" href="../htmlman2/lseek.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        lseek
       </span>
       (2)
      </span>
     </a>
     ).
    </p>
    <p>
     A call to
     <code class="function">
      open
     </code>
     () creates a
      new
     <span class="emphasis">
      <em>
       open file
      description
      </em>
     </span>
     , an entry in the system-wide table of
      open files. The open file description records the file offset
      and the file status flags (see below). A file descriptor is a
      reference to an open file description; this reference is
      unaffected if
     <em class="parameter">
      <code>
       pathname
      </code>
     </em>
     is subsequently
      removed or modified to refer to a different file. For further
      details on open file descriptions, see NOTES.
    </p>
    <p>
     The argument
     <em class="parameter">
      <code>
       flags
      </code>
     </em>
     must include one of the following
     <span class="emphasis">
      <em>
       access modes
      </em>
     </span>
     :
     <code class="constant">
      O_RDONLY
     </code>
     ,
     <code class="constant">
      O_WRONLY
     </code>
     , or
     <code class="constant">
      O_RDWR
     </code>
     . These request opening the file
      read-only, write-only, or read/write, respectively.
    </p>
    <p>
     In addition, zero or more file creation flags and file
      status flags can be bitwise-
     <em class="replaceable">
      <code>
       or
      </code>
     </em>
     'd in
     <em class="parameter">
      <code>
       flags
      </code>
     </em>
     . The
     <span class="emphasis">
      <em>
       file creation flags
      </em>
     </span>
     are
     <code class="constant">
      O_CLOEXEC
     </code>
     ,
     <code class="constant">
      O_CREAT
     </code>
     ,
     <code class="constant">
      O_DIRECTORY
     </code>
     ,
     <code class="constant">
      O_EXCL
     </code>
     ,
     <code class="constant">
      O_NOCTTY
     </code>
     ,
     <code class="constant">
      O_NOFOLLOW
     </code>
     ,
     <code class="constant">
      O_TMPFILE
     </code>
     ,
     <code class="constant">
      O_TRUNC
     </code>
     , and
     <code class="constant">
      O_TTY_INIT
     </code>
     . The
     <span class="emphasis">
      <em>
       file status flags
      </em>
     </span>
     are all of the
      remaining flags listed below. The distinction between these
      two groups of flags is that the file status flags can be
      retrieved and (in some cases) modified; see
     <a class="link" href="../htmlman2/fcntl.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        fcntl
       </span>
       (2)
      </span>
     </a>
     for details.
    </p>
    <p>
     The full list of file creation flags and file status flags
      is as follows:
    </p>
    <div class="variablelist">
     <dl class="variablelist">
      <dt>
       <span class="term">
        <code class="constant">
         O_APPEND
        </code>
       </span>
      </dt>
      <dd>
       <p>
        The file is opened in append mode. Before each
        <a class="link" href="../htmlman2/write.2.html" shape="rect" target="_top">
         <span class="citerefentry">
          <span class="refentrytitle">
           write
          </span>
          (2)
         </span>
        </a>
        , the file
            offset is positioned at the end of the file, as if with
        <a class="link" href="../htmlman2/lseek.2.html" shape="rect" target="_top">
         <span class="citerefentry">
          <span class="refentrytitle">
           lseek
          </span>
          (2)
         </span>
        </a>
        .
        <code class="constant">
         O_APPEND
        </code>
        may lead to
            corrupted files on NFS filesystems if more than one
            process appends data to a file at once. This is because
            NFS does not support appending to a file, so the client
            kernel has to simulate it, which can't be done without
            a race condition.
       </p>
      </dd>
      <dt>
       <span class="term">
        <code class="constant">
         O_ASYNC
        </code>
       </span>
      </dt>
      <dd>
       <p>
        Enable signal-driven I/O: generate a signal
            (
        <code class="constant">
         SIGIO
        </code>
        by default, but
            this can be changed via
        <a class="link" href="../htmlman2/fcntl.2.html" shape="rect" target="_top">
         <span class="citerefentry">
          <span class="refentrytitle">
           fcntl
          </span>
          (2)
         </span>
        </a>
        ) when input
            or output becomes possible on this file descriptor.
            This feature is available only for terminals,
            pseudoterminals, sockets, and (since Linux 2.6) pipes
            and FIFOs. See
        <a class="link" href="../htmlman2/fcntl.2.html" shape="rect" target="_top">
         <span class="citerefentry">
          <span class="refentrytitle">
           fcntl
          </span>
          (2)
         </span>
        </a>
        for further
            details. See also BUGS, below.
       </p>
      </dd>
      <dt>
       <span class="term">
        <code class="constant">
         O_CLOEXEC
        </code>
        (since Linux
          2.6.23)
       </span>
      </dt>
      <dd>
       <p>
        Enable the close-on-exec flag for the new file
            descriptor. Specifying this flag permits a program to
            avoid additional
        <a class="link" href="../htmlman2/fcntl.2.html" shape="rect" target="_top">
         <span class="citerefentry">
          <span class="refentrytitle">
           fcntl
          </span>
          (2)
         </span>
        </a>
        <code class="constant">
         F_SETFD
        </code>
        operations to set the
        <code class="constant">
         FD_CLOEXEC
        </code>
        flag.
       </p>
       <p>
        Note that the use of this flag is essential in some
            multithreaded programs, because using a separate
        <a class="link" href="../htmlman2/fcntl.2.html" shape="rect" target="_top">
         <span class="citerefentry">
          <span class="refentrytitle">
           fcntl
          </span>
          (2)
         </span>
        </a>
        <code class="constant">
         F_SETFD
        </code>
        operation to set the
        <code class="constant">
         FD_CLOEXEC
        </code>
        flag does not
            suffice to avoid race conditions where one thread opens
            a file descriptor and attempts to set its close-on-exec
            flag using
        <a class="link" href="../htmlman2/fcntl.2.html" shape="rect" target="_top">
         <span class="citerefentry">
          <span class="refentrytitle">
           fcntl
          </span>
          (2)
         </span>
        </a>
        at the same
            time as another thread does a
        <a class="link" href="../htmlman2/fork.2.html" shape="rect" target="_top">
         <span class="citerefentry">
          <span class="refentrytitle">
           fork
          </span>
          (2)
         </span>
        </a>
        plus
        <a class="link" href="../htmlman2/execve.2.html" shape="rect" target="_top">
         <span class="citerefentry">
          <span class="refentrytitle">
           execve
          </span>
          (2)
         </span>
        </a>
        . Depending
            on the order of execution, the race may lead to the
            file descriptor returned by
        <code class="function">
         open
        </code>
        () being unintentionally leaked
            to the program executed by the child process created by
        <a class="link" href="../htmlman2/fork.2.html" shape="rect" target="_top">
         <span class="citerefentry">
          <span class="refentrytitle">
           fork
          </span>
          (2)
         </span>
        </a>
        . (This kind
            of race is in principle possible for any system call
            that creates a file descriptor whose close-on-exec flag
            should be set, and various other Linux system calls
            provide an equivalent of the
        <code class="constant">
         O_CLOEXEC
        </code>
        flag to deal with this
            problem.)
       </p>
      </dd>
      <dt>
       <span class="term">
        <code class="constant">
         O_CREAT
        </code>
       </span>
      </dt>
      <dd>
       <p>
        If the file does not exist, it will be created. The
            owner (user ID) of the file is set to the effective
            user ID of the process. The group ownership (group ID)
            is set either to the effective group ID of the process
            or to the group ID of the parent directory (depending
            on filesystem type and mount options, and the mode of
            the parent directory; see the mount options
        <em class="replaceable">
         <code>
          bsdgroups
         </code>
        </em>
        and
        <em class="replaceable">
         <code>
          sysvgroups
         </code>
        </em>
        described in
        <a class="link" href="../htmlman8/mount.8.html" shape="rect" target="_top">
         <span class="citerefentry">
          <span class="refentrytitle">
           mount
          </span>
          (8)
         </span>
        </a>
        ).
       </p>
       <div class="blockquote">
        <blockquote class="blockquote">
         <p>
          <em class="parameter">
           <code>
            mode
           </code>
          </em>
          specifies the permissions to use in case a new file
                is created. This argument must be supplied when
          <code class="constant">
           O_CREAT
          </code>
          or
          <code class="constant">
           O_TMPFILE
          </code>
          is
                specified in
          <em class="parameter">
           <code>
            flags
           </code>
          </em>
          ; if neither
          <code class="constant">
           O_CREAT
          </code>
          nor
          <code class="constant">
           O_TMPFILE
          </code>
          is
                specified, then
          <em class="parameter">
           <code>
            mode
           </code>
          </em>
          is ignored. The
                effective permissions are modified by the process's
          <code class="literal">
           umask
          </code>
          in the usual
                way: The permissions of the created file are
          <span class="emphasis">
           <em>
            (mode &amp;
                ~umask)
           </em>
          </span>
          . Note that this mode applies
                only to future accesses of the newly created file;
                the
          <code class="function">
           open
          </code>
          () call that
                creates a read-only file may well return a
                read/write file descriptor.
         </p>
         <p>
          The following symbolic constants are provided
                for
          <em class="parameter">
           <code>
            mode
           </code>
          </em>
          :
         </p>
         <div class="variablelist">
          <dl class="variablelist">
           <dt>
            <span class="term">
             <code class="constant">
              S_IRWXU
             </code>
            </span>
           </dt>
           <dd>
            <p>
             00700 user (file owner) has read, write
                      and execute permission
            </p>
           </dd>
           <dt>
            <span class="term">
             <code class="constant">
              S_IRUSR
             </code>
            </span>
           </dt>
           <dd>
            <p>
             00400 user has read permission
            </p>
           </dd>
           <dt>
            <span class="term">
             <code class="constant">
              S_IWUSR
             </code>
            </span>
           </dt>
           <dd>
            <p>
             00200 user has write permission
            </p>
           </dd>
           <dt>
            <span class="term">
             <code class="constant">
              S_IXUSR
             </code>
            </span>
           </dt>
           <dd>
            <p>
             00100 user has execute permission
            </p>
           </dd>
           <dt>
            <span class="term">
             <code class="constant">
              S_IRWXG
             </code>
            </span>
           </dt>
           <dd>
            <p>
             00070 group has read, write and execute
                      permission
            </p>
           </dd>
           <dt>
            <span class="term">
             <code class="constant">
              S_IRGRP
             </code>
            </span>
           </dt>
           <dd>
            <p>
             00040 group has read permission
            </p>
           </dd>
           <dt>
            <span class="term">
             <code class="constant">
              S_IWGRP
             </code>
            </span>
           </dt>
           <dd>
            <p>
             00020 group has write permission
            </p>
           </dd>
           <dt>
            <span class="term">
             <code class="constant">
              S_IXGRP
             </code>
            </span>
           </dt>
           <dd>
            <p>
             00010 group has execute permission
            </p>
           </dd>
           <dt>
            <span class="term">
             <code class="constant">
              S_IRWXO
             </code>
            </span>
           </dt>
           <dd>
            <p>
             00007 others have read, write and execute
                      permission
            </p>
           </dd>
           <dt>
            <span class="term">
             <code class="constant">
              S_IROTH
             </code>
            </span>
           </dt>
           <dd>
            <p>
             00004 others have read permission
            </p>
           </dd>
           <dt>
            <span class="term">
             <code class="constant">
              S_IWOTH
             </code>
            </span>
           </dt>
           <dd>
            <p>
             00002 others have write permission
            </p>
           </dd>
           <dt>
            <span class="term">
             <code class="constant">
              S_IXOTH
             </code>
            </span>
           </dt>
           <dd>
            <p>
             00001 others have execute permission
            </p>
           </dd>
          </dl>
         </div>
        </blockquote>
       </div>
      </dd>
      <dt>
       <span class="term">
        <code class="constant">
         O_DIRECT
        </code>
        (since Linux
          2.4.10)
       </span>
      </dt>
      <dd>
       <p>
        Try to minimize cache effects of the I/O to and from
            this file. In general this will degrade performance,
            but it is useful in special situations, such as when
            applications do their own caching. File I/O is done
            directly to/from user-space buffers. The
        <code class="constant">
         O_DIRECT
        </code>
        flag on its own makes an
            effort to transfer data synchronously, but does not
            give the guarantees of the
        <code class="constant">
         O_SYNC
        </code>
        flag that data and necessary
            metadata are transferred. To guarantee synchronous I/O,
        <code class="constant">
         O_SYNC
        </code>
        must be used in
            addition to
        <code class="constant">
         O_DIRECT
        </code>
        . See
            NOTES below for further discussion.
       </p>
       <p>
        A semantically similar (but deprecated) interface
            for block devices is described in
        <a class="link" href="../htmlman8/raw.8.html" shape="rect" target="_top">
         <span class="citerefentry">
          <span class="refentrytitle">
           raw
          </span>
          (8)
         </span>
        </a>
        .
       </p>
      </dd>
      <dt>
       <span class="term">
        <code class="constant">
         O_DIRECTORY
        </code>
       </span>
      </dt>
      <dd>
       <p>
        If
        <em class="parameter">
         <code>
          pathname
         </code>
        </em>
        is not a directory, cause the open to fail. This flag
            was added in kernel version 2.1.126, to avoid
            denial-of-service problems if
        <a class="link" href="../htmlman3/opendir.3.html" shape="rect" target="_top">
         <span class="citerefentry">
          <span class="refentrytitle">
           opendir
          </span>
          (3)
         </span>
        </a>
        is called
            on a FIFO or tape device.
       </p>
      </dd>
      <dt>
       <span class="term">
        <code class="constant">
         O_DSYNC
        </code>
       </span>
      </dt>
      <dd>
       <p>
        Write operations on the file will complete according
            to the requirements of synchronized I/O
        <em class="replaceable">
         <code>
          data
         </code>
        </em>
        integrity
            completion.
       </p>
       <p>
        By the time
        <a class="link" href="../htmlman2/write.2.html" shape="rect" target="_top">
         <span class="citerefentry">
          <span class="refentrytitle">
           write
          </span>
          (2)
         </span>
        </a>
        (and
            similar) return, the output data has been transferred
            to the underlying hardware, along with any file
            metadata that would be required to retrieve that data
            (i.e., as though each
        <a class="link" href="../htmlman2/write.2.html" shape="rect" target="_top">
         <span class="citerefentry">
          <span class="refentrytitle">
           write
          </span>
          (2)
         </span>
        </a>
        was followed
            by a call to
        <a class="link" href="../htmlman2/fsync.2.html" shape="rect" target="_top">
         <span class="citerefentry">
          <span class="refentrytitle">
           fdatasync
          </span>
          (2)
         </span>
        </a>
        ).
        <span class="emphasis">
         <em>
          See NOTES
            below
         </em>
        </span>
        .
       </p>
      </dd>
      <dt>
       <span class="term">
        <code class="constant">
         O_EXCL
        </code>
       </span>
      </dt>
      <dd>
       <p>
        Ensure that this call creates the file: if this flag
            is specified in conjunction with
        <code class="constant">
         O_CREAT
        </code>
        , and
        <em class="parameter">
         <code>
          pathname
         </code>
        </em>
        already exists,
            then
        <code class="function">
         open
        </code>
        () will
            fail.
       </p>
       <p>
        When these two flags are specified, symbolic links
            are not followed: if
        <em class="parameter">
         <code>
          pathname
         </code>
        </em>
        is a symbolic
            link, then
        <code class="function">
         open
        </code>
        () fails
            regardless of where the symbolic link points to.
       </p>
       <p>
        In general, the behavior of
        <code class="constant">
         O_EXCL
        </code>
        is undefined if it is used
            without
        <code class="constant">
         O_CREAT
        </code>
        . There is
            one exception: on Linux 2.6 and later,
        <code class="constant">
         O_EXCL
        </code>
        can be used without
        <code class="constant">
         O_CREAT
        </code>
        if
        <em class="parameter">
         <code>
          pathname
         </code>
        </em>
        refers to a
            block device. If the block device is in use by the
            system (e.g., mounted),
        <code class="function">
         open
        </code>
        () fails with the error
        <span class="errorname">
         EBUSY
        </span>
        .
       </p>
       <p>
        On NFS,
        <code class="constant">
         O_EXCL
        </code>
        is
            supported only when using NFSv3 or later on kernel 2.6
            or later. In NFS environments where
        <code class="constant">
         O_EXCL
        </code>
        support is not provided,
            programs that rely on it for performing locking tasks
            will contain a race condition. Portable programs that
            want to perform atomic file locking using a lockfile,
            and need to avoid reliance on NFS support for
        <code class="constant">
         O_EXCL
        </code>
        , can create a
            unique file on the same filesystem (e.g., incorporating
            hostname and PID), and use
        <a class="link" href="../htmlman2/link.2.html" shape="rect" target="_top">
         <span class="citerefentry">
          <span class="refentrytitle">
           link
          </span>
          (2)
         </span>
        </a>
        to make a
            link to the lockfile. If
        <a class="link" href="../htmlman2/link.2.html" shape="rect" target="_top">
         <span class="citerefentry">
          <span class="refentrytitle">
           link
          </span>
          (2)
         </span>
        </a>
        returns 0,
            the lock is successful. Otherwise, use
        <a class="link" href="../htmlman2/stat.2.html" shape="rect" target="_top">
         <span class="citerefentry">
          <span class="refentrytitle">
           stat
          </span>
          (2)
         </span>
        </a>
        on the unique
            file to check if its link count has increased to 2, in
            which case the lock is also successful.
       </p>
      </dd>
      <dt>
       <span class="term">
        <code class="constant">
         O_LARGEFILE
        </code>
       </span>
      </dt>
      <dd>
       <p>
        (LFS) Allow files whose sizes cannot be represented
            in an
        <span class="type">
         off_t
        </span>
        (but can be
            represented in an
        <span class="type">
         off64_t
        </span>
        ) to
            be opened. The
        <code class="constant">
         _LARGEFILE64_SOURCE
        </code>
        macro must be
            defined (before including
        <em class="replaceable">
         <code>
          any
         </code>
        </em>
        header files) in
            order to obtain this definition. Setting the
        <code class="constant">
         _FILE_OFFSET_BITS
        </code>
        feature
            test macro to 64 (rather than using
        <code class="constant">
         O_LARGEFILE
        </code>
        ) is the preferred method
            of accessing large files on 32-bit systems (see
        <a class="link" href="../htmlman7/feature_test_macros.7.html" shape="rect" target="_top">
         <span class="citerefentry">
          <span class="refentrytitle">
           feature_test_macros
          </span>
          (7)
         </span>
        </a>
        ).
       </p>
      </dd>
      <dt>
       <span class="term">
        <code class="constant">
         O_NOATIME
        </code>
        (since Linux
          2.6.8)
       </span>
      </dt>
      <dd>
       <p>
        Do not update the file last access time (
        <em class="replaceable">
         <code>
          st_atime
         </code>
        </em>
        in the inode)
            when the file is
        <a class="link" href="../htmlman2/read.2.html" shape="rect" target="_top">
         <span class="citerefentry">
          <span class="refentrytitle">
           read
          </span>
          (2)
         </span>
        </a>
        . This flag is
            intended for use by indexing or backup programs, where
            its use can significantly reduce the amount of disk
            activity. This flag may not be effective on all
            filesystems. One example is NFS, where the server
            maintains the access time.
       </p>
      </dd>
      <dt>
       <span class="term">
        <code class="constant">
         O_NOCTTY
        </code>
       </span>
      </dt>
      <dd>
       <p>
        If
        <em class="parameter">
         <code>
          pathname
         </code>
        </em>
        refers to a terminal device&mdash;see
        <a class="link" href="../htmlman4/tty.4.html" shape="rect" target="_top">
         <span class="citerefentry">
          <span class="refentrytitle">
           tty
          </span>
          (4)
         </span>
        </a>
        \(emit will not
            become the process's controlling terminal even if the
            process does not have one.
       </p>
      </dd>
      <dt>
       <span class="term">
        <code class="constant">
         O_NOFOLLOW
        </code>
       </span>
      </dt>
      <dd>
       <p>
        If
        <em class="parameter">
         <code>
          pathname
         </code>
        </em>
        is a symbolic link, then the open fails. This is a
            FreeBSD extension, which was added to Linux in version
            2.1.126. Symbolic links in earlier components of the
            pathname will still be followed. See also
        <code class="constant">
         O_PATH
        </code>
        below.
       </p>
      </dd>
      <dt>
       <span class="term">
        <code class="constant">
         O_NONBLOCK
        </code>
        or
        <code class="constant">
         O_NDELAY
        </code>
       </span>
      </dt>
      <dd>
       <p>
        When possible, the file is opened in nonblocking
            mode. Neither the
        <code class="function">
         open
        </code>
        ()
            nor any subsequent operations on the file descriptor
            which is returned will cause the calling process to
            wait. For the handling of FIFOs (named pipes), see also
        <a class="link" href="../htmlman7/fifo.7.html" shape="rect" target="_top">
         <span class="citerefentry">
          <span class="refentrytitle">
           fifo
          </span>
          (7)
         </span>
        </a>
        . For a
            discussion of the effect of
        <code class="constant">
         O_NONBLOCK
        </code>
        in conjunction with
            mandatory file locks and with file leases, see
        <a class="link" href="../htmlman2/fcntl.2.html" shape="rect" target="_top">
         <span class="citerefentry">
          <span class="refentrytitle">
           fcntl
          </span>
          (2)
         </span>
        </a>
        .
       </p>
      </dd>
      <dt>
       <span class="term">
        <code class="constant">
         O_PATH
        </code>
        (since Linux 2.6.39)
       </span>
      </dt>
      <dd>
       <p>
        Obtain a file descriptor that can be used for two
            purposes: to indicate a location in the filesystem tree
            and to perform operations that act purely at the file
            descriptor level. The file itself is not opened, and
            other file operations (e.g.,
        <a class="link" href="../htmlman2/read.2.html" shape="rect" target="_top">
         <span class="citerefentry">
          <span class="refentrytitle">
           read
          </span>
          (2)
         </span>
        </a>
        ,
        <a class="link" href="../htmlman2/write.2.html" shape="rect" target="_top">
         <span class="citerefentry">
          <span class="refentrytitle">
           write
          </span>
          (2)
         </span>
        </a>
        ,
        <a class="link" href="../htmlman2/chmod.2.html" shape="rect" target="_top">
         <span class="citerefentry">
          <span class="refentrytitle">
           fchmod
          </span>
          (2)
         </span>
        </a>
        ,
        <a class="link" href="../htmlman2/chown.2.html" shape="rect" target="_top">
         <span class="citerefentry">
          <span class="refentrytitle">
           fchown
          </span>
          (2)
         </span>
        </a>
        ,
        <a class="link" href="../htmlman2/getxattr.2.html" shape="rect" target="_top">
         <span class="citerefentry">
          <span class="refentrytitle">
           fgetxattr
          </span>
          (2)
         </span>
        </a>
        ,
        <a class="link" href="../htmlman2/mmap.2.html" shape="rect" target="_top">
         <span class="citerefentry">
          <span class="refentrytitle">
           mmap
          </span>
          (2)
         </span>
        </a>
        ) fail with
            the error
        <span class="errorname">
         EBADF
        </span>
        .
       </p>
       <p>
        The following operations
        <em class="replaceable">
         <code>
          can
         </code>
        </em>
        be performed on the
            resulting file descriptor:
       </p>
       <div class="blockquote">
        <blockquote class="blockquote">
         <div class="itemizedlist">
          <ul class="itemizedlist" style="list-style-type: disc;">
           <li class="listitem">
            <p>
             <a class="link" href="../htmlman2/close.2.html" shape="rect" target="_top">
              <span class="citerefentry">
               <span class="refentrytitle">
                close
               </span>
               (2)
              </span>
             </a>
             ;
             <a class="link" href="../htmlman2/chdir.2.html" shape="rect" target="_top">
              <span class="citerefentry">
               <span class="refentrytitle">
                fchdir
               </span>
               (2)
              </span>
             </a>
             (since Linux 3.5);
             <a class="link" href="../htmlman2/stat.2.html" shape="rect" target="_top">
              <span class="citerefentry">
               <span class="refentrytitle">
                fstat
               </span>
               (2)
              </span>
             </a>
             (since Linux 3.6).
            </p>
           </li>
           <li class="listitem">
            <p>
             Duplicating the file descriptor (
             <a class="link" href="../htmlman2/dup.2.html" shape="rect" target="_top">
              <span class="citerefentry">
               <span class="refentrytitle">
                dup
               </span>
               (2)
              </span>
             </a>
             ,
             <a class="link" href="../htmlman2/fcntl.2.html" shape="rect" target="_top">
              <span class="citerefentry">
               <span class="refentrytitle">
                fcntl
               </span>
               (2)
              </span>
             </a>
             <code class="constant">
              F_DUPFD
             </code>
             ,
                      etc.).
            </p>
           </li>
           <li class="listitem">
            <p>
             Getting and setting file descriptor flags
                      (
             <a class="link" href="../htmlman2/fcntl.2.html" shape="rect" target="_top">
              <span class="citerefentry">
               <span class="refentrytitle">
                fcntl
               </span>
               (2)
              </span>
             </a>
             <code class="constant">
              F_GETFD
             </code>
             and
             <code class="constant">
              F_SETFD
             </code>
             ).
            </p>
           </li>
           <li class="listitem">
            <p>
             Retrieving open file status flags using
                      the
             <a class="link" href="../htmlman2/fcntl.2.html" shape="rect" target="_top">
              <span class="citerefentry">
               <span class="refentrytitle">
                fcntl
               </span>
               (2)
              </span>
             </a>
             <code class="constant">
              F_GETFL
             </code>
             operation: the returned flags will include
                      the bit
             <code class="constant">
              O_PATH
             </code>
             .
            </p>
           </li>
           <li class="listitem">
            <p>
             Passing the file descriptor as the
             <em class="parameter">
              <code>
               dirfd
              </code>
             </em>
             argument of
             <a class="link" href="../htmlman2/open.2.html" shape="rect" target="_top">
              <span class="citerefentry">
               <span class="refentrytitle">
                openat
               </span>
               (2)
              </span>
             </a>
             and the other "*at()" system calls. This
                      includes
             <a class="link" href="../htmlman2/link.2.html" shape="rect" target="_top">
              <span class="citerefentry">
               <span class="refentrytitle">
                linkat
               </span>
               (2)
              </span>
             </a>
             with
             <code class="constant">
              AT_EMPTY_PATH
             </code>
             (or via
                      procfs using
             <code class="constant">
              AT_SYMLINK_FOLLOW
             </code>
             ) even if
                      the file is not a directory.
            </p>
           </li>
           <li class="listitem">
            <p>
             Passing the file descriptor to another
                      process via a UNIX domain socket (see
             <code class="constant">
              SCM_RIGHTS
             </code>
             in
             <a class="link" href="../htmlman7/unix.7.html" shape="rect" target="_top">
              <span class="citerefentry">
               <span class="refentrytitle">
                unix
               </span>
               (7)
              </span>
             </a>
             ).
            </p>
           </li>
          </ul>
         </div>
        </blockquote>
       </div>
       <p>
        When
        <code class="constant">
         O_PATH
        </code>
        is
            specified in
        <em class="parameter">
         <code>
          flags
         </code>
        </em>
        , flag bits other
            than
        <code class="constant">
         O_CLOEXEC
        </code>
        ,
        <code class="constant">
         O_DIRECTORY
        </code>
        , and
        <code class="constant">
         O_NOFOLLOW
        </code>
        are
            ignored.
       </p>
       <p>
        If
        <em class="parameter">
         <code>
          pathname
         </code>
        </em>
        is a symbolic link and the
        <code class="constant">
         O_NOFOLLOW
        </code>
        flag is also specified,
            then the call returns a file descriptor referring to
            the symbolic link. This file descriptor can be used as
            the
        <em class="parameter">
         <code>
          dirfd
         </code>
        </em>
        argument in calls to
        <a class="link" href="../htmlman2/chown.2.html" shape="rect" target="_top">
         <span class="citerefentry">
          <span class="refentrytitle">
           fchownat
          </span>
          (2)
         </span>
        </a>
        ,
        <a class="link" href="../htmlman2/stat.2.html" shape="rect" target="_top">
         <span class="citerefentry">
          <span class="refentrytitle">
           fstatat
          </span>
          (2)
         </span>
        </a>
        ,
        <a class="link" href="../htmlman2/link.2.html" shape="rect" target="_top">
         <span class="citerefentry">
          <span class="refentrytitle">
           linkat
          </span>
          (2)
         </span>
        </a>
        , and
        <a class="link" href="../htmlman2/readlink.2.html" shape="rect" target="_top">
         <span class="citerefentry">
          <span class="refentrytitle">
           readlinkat
          </span>
          (2)
         </span>
        </a>
        with an
            empty pathname to have the calls operate on the
            symbolic link.
       </p>
      </dd>
      <dt>
       <span class="term">
        <code class="constant">
         O_SYNC
        </code>
       </span>
      </dt>
      <dd>
       <p>
        Write operations on the file will complete according
            to the requirements of synchronized I/O
        <em class="replaceable">
         <code>
          file
         </code>
        </em>
        integrity
            completion (by contrast with the synchronized I/O
        <em class="replaceable">
         <code>
          data
         </code>
        </em>
        integrity completion provided by
        <code class="constant">
         O_DSYNC
        </code>
        .)
       </p>
       <p>
        By the time
        <a class="link" href="../htmlman2/write.2.html" shape="rect" target="_top">
         <span class="citerefentry">
          <span class="refentrytitle">
           write
          </span>
          (2)
         </span>
        </a>
        (and
            similar) return, the output data and associated file
            metadata have been transferred to the underlying
            hardware (i.e., as though each
        <a class="link" href="../htmlman2/write.2.html" shape="rect" target="_top">
         <span class="citerefentry">
          <span class="refentrytitle">
           write
          </span>
          (2)
         </span>
        </a>
        was followed
            by a call to
        <a class="link" href="../htmlman2/fsync.2.html" shape="rect" target="_top">
         <span class="citerefentry">
          <span class="refentrytitle">
           fsync
          </span>
          (2)
         </span>
        </a>
        ).
        <span class="emphasis">
         <em>
          See NOTES
            below
         </em>
        </span>
        .
       </p>
      </dd>
      <dt>
       <span class="term">
        <code class="constant">
         O_TMPFILE
        </code>
        (since Linux
          3.11)
       </span>
      </dt>
      <dd>
       <p>
        Create an unnamed temporary file. The
        <em class="parameter">
         <code>
          pathname
         </code>
        </em>
        argument
            specifies a directory; an unnamed inode will be created
            in that directory's filesystem. Anything written to the
            resulting file will be lost when the last file
            descriptor is closed, unless the file is given a
            name.
       </p>
       <p>
        <code class="constant">
         O_TMPFILE
        </code>
        must be
            specified with one of
        <code class="constant">
         O_RDWR
        </code>
        or
        <code class="constant">
         O_WRONLY
        </code>
        and, optionally,
        <code class="constant">
         O_EXCL
        </code>
        . If
        <code class="constant">
         O_EXCL
        </code>
        is not specified, then
        <a class="link" href="../htmlman2/link.2.html" shape="rect" target="_top">
         <span class="citerefentry">
          <span class="refentrytitle">
           linkat
          </span>
          (2)
         </span>
        </a>
        can be used
            to link the temporary file into the filesystem, making
            it permanent, using code like the following:
       </p>
       <div class="blockquote">
        <blockquote class="blockquote">
         <div class="informalexample">
          <pre class="programlisting" xml:space="preserve">
char path[PATH_MAX];
fd = open("/path/to/dir", O_TMPFILE | O_RDWR,
                        S_IRUSR | S_IWUSR);

/* File I/O on 'fd'... */

snprintf(path, PATH_MAX,  "/proc/self/fd/%d", fd);
linkat(AT_FDCWD, path, AT_FDCWD, "/path/for/file",
                        AT_SYMLINK_FOLLOW);
</pre>
         </div>
        </blockquote>
       </div>
       <p>
        In this case, the
        <code class="function">
         open
        </code>
        ()
        <em class="parameter">
         <code>
          mode
         </code>
        </em>
        argument determines
            the file permission mode, as with
        <code class="constant">
         O_CREAT
        </code>
        .
       </p>
       <p>
        Specifying
        <code class="constant">
         O_EXCL
        </code>
        in
            conjunction with
        <code class="constant">
         O_TMPFILE
        </code>
        prevents a temporary file
            from being linked into the filesystem in the above
            manner. (Note that the meaning of
        <code class="constant">
         O_EXCL
        </code>
        in this case is different from
            the meaning of
        <code class="constant">
         O_EXCL
        </code>
        otherwise.)
       </p>
       <p>
        There are two main use cases for
        <code class="constant">
         O_TMPFILE
        </code>
        :
       </p>
       <div class="blockquote">
        <blockquote class="blockquote">
         <div class="itemizedlist">
          <ul class="itemizedlist" style="list-style-type: disc;">
           <li class="listitem">
            <p>
             Improved
             <a class="link" href="../htmlman3/tmpfile.3.html" shape="rect" target="_top">
              <span class="citerefentry">
               <span class="refentrytitle">
                tmpfile
               </span>
               (3)
              </span>
             </a>
             functionality: race-free creation of
                      temporary files that (1) are automatically
                      deleted when closed; (2) can never be reached
                      via any pathname; (3) are not subject to
                      symlink attacks; and (4) do not require the
                      caller to devise unique names.
            </p>
           </li>
           <li class="listitem">
            <p>
             Creating a file that is initially
                      invisible, which is then populated with data
                      and adjusted to have appropriate filesystem
                      attributes (
             <a class="link" href="../htmlman2/chown.2.html" shape="rect" target="_top">
              <span class="citerefentry">
               <span class="refentrytitle">
                chown
               </span>
               (2)
              </span>
             </a>
             ,
             <a class="link" href="../htmlman2/chmod.2.html" shape="rect" target="_top">
              <span class="citerefentry">
               <span class="refentrytitle">
                chmod
               </span>
               (2)
              </span>
             </a>
             ,
             <a class="link" href="../htmlman2/setxattr.2.html" shape="rect" target="_top">
              <span class="citerefentry">
               <span class="refentrytitle">
                fsetxattr
               </span>
               (2)
              </span>
             </a>
             ,
                      etc.) before being atomically linked into the
                      filesystem in a fully formed state (using
             <a class="link" href="../htmlman2/link.2.html" shape="rect" target="_top">
              <span class="citerefentry">
               <span class="refentrytitle">
                linkat
               </span>
               (2)
              </span>
             </a>
             as described above).
            </p>
           </li>
          </ul>
         </div>
        </blockquote>
       </div>
       <p>
        <code class="constant">
         O_TMPFILE
        </code>
        requires
            support by the underlying filesystem; only a subset of
            Linux filesystems provide that support. In the initial
            implementation, support was provided in the ext2, ext3,
            ext4, UDF, Minix, and shmem filesystems. XFS support
            was added in Linux 3.15.
       </p>
      </dd>
      <dt>
       <span class="term">
        <code class="constant">
         O_TRUNC
        </code>
       </span>
      </dt>
      <dd>
       <p>
        If the file already exists and is a regular file and
            the access mode allows writing (i.e., is
        <code class="constant">
         O_RDWR
        </code>
        or
        <code class="constant">
         O_WRONLY
        </code>
        ) it will be truncated to
            length 0. If the file is a FIFO or terminal device
            file, the
        <code class="constant">
         O_TRUNC
        </code>
        flag is
            ignored. Otherwise, the effect of
        <code class="constant">
         O_TRUNC
        </code>
        is unspecified.
       </p>
      </dd>
     </dl>
    </div>
    <div class="refsect2">
     <a id="open-2_sect2" name="open-2_sect2" shape="rect">
     </a>
     <h3>
      creat()
     </h3>
     <p>
      <code class="function">
       creat
      </code>
      () is equivalent to
      <code class="function">
       open
      </code>
      () with
      <em class="parameter">
       <code>
        flags
       </code>
      </em>
      equal to
      <em class="replaceable">
       <code>
        O_CREAT|O_WRONLY|O_TRUNC
       </code>
      </em>
      .
     </p>
    </div>
    <div class="refsect2">
     <a id="open-2_sect3" name="open-2_sect3" shape="rect">
     </a>
     <h3>
      openat()
     </h3>
     <p>
      The
      <code class="function">
       openat
      </code>
      () system call
        operates in exactly the same way as
      <code class="function">
       open
      </code>
      (), except for the differences
        described here.
     </p>
     <p>
      If the pathname given in
      <em class="parameter">
       <code>
        pathname
       </code>
      </em>
      is relative, then it
        is interpreted relative to the directory referred to by the
        file descriptor
      <em class="parameter">
       <code>
        dirfd
       </code>
      </em>
      (rather than relative
        to the current working directory of the calling process, as
        is done by
      <code class="function">
       open
      </code>
      () for a
        relative pathname).
     </p>
     <p>
      If
      <em class="parameter">
       <code>
        pathname
       </code>
      </em>
      is
        relative and
      <em class="parameter">
       <code>
        dirfd
       </code>
      </em>
      is the special value
      <code class="constant">
       AT_FDCWD
      </code>
      , then
      <em class="parameter">
       <code>
        pathname
       </code>
      </em>
      is interpreted
        relative to the current working directory of the calling
        process (like
      <code class="function">
       open
      </code>
      ()).
     </p>
     <p>
      If
      <em class="parameter">
       <code>
        pathname
       </code>
      </em>
      is
        absolute, then
      <em class="parameter">
       <code>
        dirfd
       </code>
      </em>
      is ignored.
     </p>
    </div>
   </div>
   <div class="refsect1">
    <a id="open-2_sect4" name="open-2_sect4" shape="rect">
    </a>
    <h2>
     RETURN VALUE
    </h2>
    <p>
     <code class="function">
      open
     </code>
     (),
     <code class="function">
      openat
     </code>
     (), and
     <code class="function">
      creat
     </code>
     () return the new file descriptor, or
      &minus;1 if an error occurred (in which case,
     <code class="varname">
      errno
     </code>
     is set appropriately).
    </p>
   </div>
   <div class="refsect1">
    <a id="open-2_sect5" name="open-2_sect5" shape="rect">
    </a>
    <h2>
     ERRORS
    </h2>
    <p>
     <code class="function">
      open
     </code>
     (),
     <code class="function">
      openat
     </code>
     (), and
     <code class="function">
      creat
     </code>
     () can fail with the following
      errors:
    </p>
    <div class="variablelist">
     <dl class="variablelist">
      <dt>
       <span class="term">
        <span class="errorname">
         EACCES
        </span>
       </span>
      </dt>
      <dd>
       <p>
        The requested access to the file is not allowed, or
            search permission is denied for one of the directories
            in the path prefix of
        <em class="parameter">
         <code>
          pathname
         </code>
        </em>
        , or the file did
            not exist yet and write access to the parent directory
            is not allowed. (See also
        <a class="link" href="../htmlman7/path_resolution.7.html" shape="rect" target="_top">
         <span class="citerefentry">
          <span class="refentrytitle">
           path_resolution
          </span>
          (7)
         </span>
        </a>
        .)
       </p>
      </dd>
      <dt>
       <span class="term">
        <span class="errorname">
         EDQUOT
        </span>
       </span>
      </dt>
      <dd>
       <p>
        Where
        <code class="constant">
         O_CREAT
        </code>
        is
            specified, the file does not exist, and the user's
            quota of disk blocks or inodes on the filesystem has
            been exhausted.
       </p>
      </dd>
      <dt>
       <span class="term">
        <span class="errorname">
         EEXIST
        </span>
       </span>
      </dt>
      <dd>
       <p>
        <em class="parameter">
         <code>
          pathname
         </code>
        </em>
        already exists and
        <code class="constant">
         O_CREAT
        </code>
        and
        <code class="constant">
         O_EXCL
        </code>
        were used.
       </p>
      </dd>
      <dt>
       <span class="term">
        <span class="errorname">
         EFAULT
        </span>
       </span>
      </dt>
      <dd>
       <p>
        <em class="parameter">
         <code>
          pathname
         </code>
        </em>
        points outside your accessible address space.
       </p>
      </dd>
      <dt>
       <span class="term">
        <span class="errorname">
         EFBIG
        </span>
       </span>
      </dt>
      <dd>
       <p>
        See
        <span class="errorname">
         EOVERFLOW
        </span>
        .
       </p>
      </dd>
      <dt>
       <span class="term">
        <span class="errorname">
         EINTR
        </span>
       </span>
      </dt>
      <dd>
       <p>
        While blocked waiting to complete an open of a slow
            device (e.g., a FIFO; see
        <a class="link" href="../htmlman7/fifo.7.html" shape="rect" target="_top">
         <span class="citerefentry">
          <span class="refentrytitle">
           fifo
          </span>
          (7)
         </span>
        </a>
        ), the call
            was interrupted by a signal handler; see
        <a class="link" href="../htmlman7/signal.7.html" shape="rect" target="_top">
         <span class="citerefentry">
          <span class="refentrytitle">
           signal
          </span>
          (7)
         </span>
        </a>
        .
       </p>
      </dd>
      <dt>
       <span class="term">
        <span class="errorname">
         EINVAL
        </span>
       </span>
      </dt>
      <dd>
       <p>
        The filesystem does not support the
        <code class="constant">
         O_DIRECT
        </code>
        flag. See
        <code class="constant">
         NOTES
        </code>
        for more information.
       </p>
      </dd>
      <dt>
       <span class="term">
        <span class="errorname">
         EINVAL
        </span>
       </span>
      </dt>
      <dd>
       <p>
        Invalid value in
        <em class="parameter">
         <code>
          flags
         </code>
        </em>
        .
       </p>
      </dd>
      <dt>
       <span class="term">
        <span class="errorname">
         EINVAL
        </span>
       </span>
      </dt>
      <dd>
       <p>
        <code class="constant">
         O_TMPFILE
        </code>
        was
            specified in
        <em class="parameter">
         <code>
          flags
         </code>
        </em>
        , but neither
        <code class="constant">
         O_WRONLY
        </code>
        nor
        <code class="constant">
         O_RDWR
        </code>
        was specified.
       </p>
      </dd>
      <dt>
       <span class="term">
        <span class="errorname">
         EISDIR
        </span>
       </span>
      </dt>
      <dd>
       <p>
        <em class="parameter">
         <code>
          pathname
         </code>
        </em>
        refers to a directory and the access requested involved
            writing (that is,
        <code class="constant">
         O_WRONLY
        </code>
        or
        <code class="constant">
         O_RDWR
        </code>
        is set).
       </p>
      </dd>
      <dt>
       <span class="term">
        <span class="errorname">
         EISDIR
        </span>
       </span>
      </dt>
      <dd>
       <p>
        <em class="parameter">
         <code>
          pathname
         </code>
        </em>
        refers to an existing directory,
        <code class="constant">
         O_TMPFILE
        </code>
        and one of
        <code class="constant">
         O_WRONLY
        </code>
        or
        <code class="constant">
         O_RDWR
        </code>
        were specified in
        <em class="parameter">
         <code>
          flags
         </code>
        </em>
        , but this kernel
            version does not provide the
        <code class="constant">
         O_TMPFILE
        </code>
        functionality.
       </p>
      </dd>
      <dt>
       <span class="term">
        <span class="errorname">
         ELOOP
        </span>
       </span>
      </dt>
      <dd>
       <p>
        Too many symbolic links were encountered in
            resolving
        <em class="parameter">
         <code>
          pathname
         </code>
        </em>
        .
       </p>
      </dd>
      <dt>
       <span class="term">
        <span class="errorname">
         ELOOP
        </span>
       </span>
      </dt>
      <dd>
       <p>
        <em class="parameter">
         <code>
          pathname
         </code>
        </em>
        was
            a symbolic link, and
        <em class="parameter">
         <code>
          flags
         </code>
        </em>
        specified
        <code class="constant">
         O_NOFOLLOW
        </code>
        but not
        <code class="constant">
         O_PATH
        </code>
        .
       </p>
      </dd>
      <dt>
       <span class="term">
        <span class="errorname">
         EMFILE
        </span>
       </span>
      </dt>
      <dd>
       <p>
        The process already has the maximum number of files
            open.
       </p>
      </dd>
      <dt>
       <span class="term">
        <span class="errorname">
         ENAMETOOLONG
        </span>
       </span>
      </dt>
      <dd>
       <p>
        <em class="parameter">
         <code>
          pathname
         </code>
        </em>
        was
            too long.
       </p>
      </dd>
      <dt>
       <span class="term">
        <span class="errorname">
         ENFILE
        </span>
       </span>
      </dt>
      <dd>
       <p>
        The system limit on the total number of open files
            has been reached.
       </p>
      </dd>
      <dt>
       <span class="term">
        <span class="errorname">
         ENODEV
        </span>
       </span>
      </dt>
      <dd>
       <p>
        <em class="parameter">
         <code>
          pathname
         </code>
        </em>
        refers to a device special file and no corresponding
            device exists. (This is a Linux kernel bug; in this
            situation
        <span class="errorname">
         ENXIO
        </span>
        must be
            returned.)
       </p>
      </dd>
      <dt>
       <span class="term">
        <span class="errorname">
         ENOENT
        </span>
       </span>
      </dt>
      <dd>
       <p>
        <code class="constant">
         O_CREAT
        </code>
        is not set and
            the named file does not exist. Or, a directory
            component in
        <em class="parameter">
         <code>
          pathname
         </code>
        </em>
        does not exist
            or is a dangling symbolic link.
       </p>
      </dd>
      <dt>
       <span class="term">
        <span class="errorname">
         ENOENT
        </span>
       </span>
      </dt>
      <dd>
       <p>
        <em class="parameter">
         <code>
          pathname
         </code>
        </em>
        refers to a nonexistent directory,
        <code class="constant">
         O_TMPFILE
        </code>
        and one of
        <code class="constant">
         O_WRONLY
        </code>
        or
        <code class="constant">
         O_RDWR
        </code>
        were specified in
        <em class="parameter">
         <code>
          flags
         </code>
        </em>
        , but this kernel
            version does not provide the
        <code class="constant">
         O_TMPFILE
        </code>
        functionality.
       </p>
      </dd>
      <dt>
       <span class="term">
        <span class="errorname">
         ENOMEM
        </span>
       </span>
      </dt>
      <dd>
       <p>
        Insufficient kernel memory was available.
       </p>
      </dd>
      <dt>
       <span class="term">
        <span class="errorname">
         ENOSPC
        </span>
       </span>
      </dt>
      <dd>
       <p>
        <em class="parameter">
         <code>
          pathname
         </code>
        </em>
        was
            to be created but the device containing
        <em class="parameter">
         <code>
          pathname
         </code>
        </em>
        has no room for
            the new file.
       </p>
      </dd>
      <dt>
       <span class="term">
        <span class="errorname">
         ENOTDIR
        </span>
       </span>
      </dt>
      <dd>
       <p>
        A component used as a directory in
        <em class="parameter">
         <code>
          pathname
         </code>
        </em>
        is not, in fact,
            a directory, or
        <code class="constant">
         O_DIRECTORY
        </code>
        was specified and
        <em class="parameter">
         <code>
          pathname
         </code>
        </em>
        was
            not a directory.
       </p>
      </dd>
      <dt>
       <span class="term">
        <span class="errorname">
         ENXIO
        </span>
       </span>
      </dt>
      <dd>
       <p>
        <code class="constant">
         O_NONBLOCK
        </code>
        |
        <code class="constant">
         O_WRONLY
        </code>
        is set, the
            named file is a FIFO, and no process has the FIFO open
            for reading. Or, the file is a device special file and
            no corresponding device exists.
       </p>
      </dd>
      <dt>
       <span class="term">
        <span class="errorname">
         EOPNOTSUPP
        </span>
       </span>
      </dt>
      <dd>
       <p>
        The filesystem containing
        <em class="parameter">
         <code>
          pathname
         </code>
        </em>
        does not support
        <code class="constant">
         O_TMPFILE
        </code>
        .
       </p>
      </dd>
      <dt>
       <span class="term">
        <span class="errorname">
         EOVERFLOW
        </span>
       </span>
      </dt>
      <dd>
       <p>
        <em class="parameter">
         <code>
          pathname
         </code>
        </em>
        refers to a regular file that is too large to be
            opened. The usual scenario here is that an application
            compiled on a 32-bit platform without
        <code class="option">
         &minus;D_FILE_OFFSET_BITS=64
        </code>
        tried to
            open a file whose size exceeds
        <em class="replaceable">
         <code>
          (2&lt;&lt;31)-1
         </code>
        </em>
        bits;
            see also
        <code class="constant">
         O_LARGEFILE
        </code>
        above. This is the error specified by POSIX.1-2001; in
            kernels before 2.6.24, Linux gave the error
        <span class="errorname">
         EFBIG
        </span>
        for this case.
       </p>
      </dd>
      <dt>
       <span class="term">
        <span class="errorname">
         EPERM
        </span>
       </span>
      </dt>
      <dd>
       <p>
        The
        <code class="constant">
         O_NOATIME
        </code>
        flag was
            specified, but the effective user ID of the caller did
            not match the owner of the file and the caller was not
            privileged (
        <code class="constant">
         CAP_FOWNER
        </code>
        ).
       </p>
      </dd>
      <dt>
       <span class="term">
        <span class="errorname">
         EROFS
        </span>
       </span>
      </dt>
      <dd>
       <p>
        <em class="parameter">
         <code>
          pathname
         </code>
        </em>
        refers to a file on a read-only filesystem and write
            access was requested.
       </p>
      </dd>
      <dt>
       <span class="term">
        <span class="errorname">
         ETXTBSY
        </span>
       </span>
      </dt>
      <dd>
       <p>
        <em class="parameter">
         <code>
          pathname
         </code>
        </em>
        refers to an executable image which is currently being
            executed and write access was requested.
       </p>
      </dd>
      <dt>
       <span class="term">
        <span class="errorname">
         EWOULDBLOCK
        </span>
       </span>
      </dt>
      <dd>
       <p>
        The
        <code class="constant">
         O_NONBLOCK
        </code>
        flag
            was specified, and an incompatible lease was held on
            the file (see
        <a class="link" href="../htmlman2/fcntl.2.html" shape="rect" target="_top">
         <span class="citerefentry">
          <span class="refentrytitle">
           fcntl
          </span>
          (2)
         </span>
        </a>
        ).
       </p>
      </dd>
     </dl>
    </div>
    <p>
     The following additional errors can occur for
     <code class="function">
      openat
     </code>
     ():
    </p>
    <div class="variablelist">
     <dl class="variablelist">
      <dt>
       <span class="term">
        <span class="errorname">
         EBADF
        </span>
       </span>
      </dt>
      <dd>
       <p>
        <em class="parameter">
         <code>
          dirfd
         </code>
        </em>
        is not
            a valid file descriptor.
       </p>
      </dd>
      <dt>
       <span class="term">
        <span class="errorname">
         ENOTDIR
        </span>
       </span>
      </dt>
      <dd>
       <p>
        <em class="parameter">
         <code>
          pathname
         </code>
        </em>
        is
            a relative pathname and
        <em class="parameter">
         <code>
          dirfd
         </code>
        </em>
        is a file
            descriptor referring to a file other than a
            directory.
       </p>
      </dd>
     </dl>
    </div>
   </div>
   <div class="refsect1">
    <a id="open-2_sect6" name="open-2_sect6" shape="rect">
    </a>
    <h2>
     VERSIONS
    </h2>
    <p>
     <code class="function">
      openat
     </code>
     () was added to Linux
      in kernel 2.6.16; library support was added to glibc in
      version 2.4.
    </p>
   </div>
   <div class="refsect1">
    <a id="open-2_sect7" name="open-2_sect7" shape="rect">
    </a>
    <h2>
     CONFORMING TO
    </h2>
    <p>
     <code class="function">
      open
     </code>
     (),
     <code class="function">
      creat
     </code>
     () SVr4, 4.3BSD, POSIX.1-2001,
      POSIX.1-2008.
    </p>
    <p>
     <code class="function">
      openat
     </code>
     (): POSIX.1-2008.
    </p>
    <p>
     The
     <code class="constant">
      O_DIRECT
     </code>
     ,
     <code class="constant">
      O_NOATIME
     </code>
     ,
     <code class="constant">
      O_PATH
     </code>
     , and
     <code class="constant">
      O_TMPFILE
     </code>
     flags are Linux-specific. One
      must define
     <code class="constant">
      _GNU_SOURCE
     </code>
     to
      obtain their definitions.
    </p>
    <p>
     The
     <code class="constant">
      O_CLOEXEC
     </code>
     ,
     <code class="constant">
      O_DIRECTORY
     </code>
     , and
     <code class="constant">
      O_NOFOLLOW
     </code>
     flags are not specified in
      POSIX.1-2001, but are specified in POSIX.1-2008. Since glibc
      2.12, one can obtain their definitions by defining either
     <code class="constant">
      _POSIX_C_SOURCE
     </code>
     with a value
      greater than or equal to 200809L or
     <code class="constant">
      _XOPEN_SOURCE
     </code>
     with a value greater than or
      equal to 700. In glibc 2.11 and earlier, one obtains the
      definitions by defining
     <code class="constant">
      _GNU_SOURCE
     </code>
     .
    </p>
    <p>
     As noted in
     <a class="link" href="../htmlman7/feature_test_macros.7.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        feature_test_macros
       </span>
       (7)
      </span>
     </a>
     ,
      feature test macros such as
     <code class="constant">
      _POSIX_C_SOURCE
     </code>
     ,
     <code class="constant">
      _XOPEN_SOURCE
     </code>
     , and
     <code class="constant">
      _GNU_SOURCE
     </code>
     must be defined before
      including
     <em class="replaceable">
      <code>
       any
      </code>
     </em>
     header files.
    </p>
   </div>
   <div class="refsect1">
    <a id="open-2_sect8" name="open-2_sect8" shape="rect">
    </a>
    <h2>
     NOTES
    </h2>
    <p>
     Under Linux, the
     <code class="constant">
      O_NONBLOCK
     </code>
     flag indicates that one wants to open but does not
      necessarily have the intention to read or write. This is
      typically used to open devices in order to get a file
      descriptor for use with
     <a class="link" href="../htmlman2/ioctl.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        ioctl
       </span>
       (2)
      </span>
     </a>
     .
    </p>
    <p>
     The (undefined) effect of
     <span class="emphasis">
      <em>
       O_RDONLY | O_TRUNC
      </em>
     </span>
     varies among
      implementations. On many systems the file is actually
      truncated.
    </p>
    <p>
     Note that
     <code class="function">
      open
     </code>
     () can open
      device special files, but
     <code class="function">
      creat
     </code>
     () cannot create them; use
     <a class="link" href="../htmlman2/mknod.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        mknod
       </span>
       (2)
      </span>
     </a>
     instead.
    </p>
    <p>
     If the file is newly created, its
     <em class="replaceable">
      <code>
       st_atime
      </code>
     </em>
     ,
     <em class="replaceable">
      <code>
       st_ctime
      </code>
     </em>
     ,
     <em class="replaceable">
      <code>
       st_mtime
      </code>
     </em>
     fields
      (respectively, time of last access, time of last status
      change, and time of last modification; see
     <a class="link" href="../htmlman2/stat.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        stat
       </span>
       (2)
      </span>
     </a>
     ) are set to the
      current time, and so are the
     <em class="replaceable">
      <code>
       st_ctime
      </code>
     </em>
     and
     <em class="replaceable">
      <code>
       st_mtime
      </code>
     </em>
     fields of the parent
      directory. Otherwise, if the file is modified because of the
     <code class="constant">
      O_TRUNC
     </code>
     flag, its st_ctime and
      st_mtime fields are set to the current time.
    </p>
    <div class="refsect2">
     <a id="open-2_sect9" name="open-2_sect9" shape="rect">
     </a>
     <h3>
      Open file descriptions
     </h3>
     <p>
      The term open file description is the one used by POSIX
        to refer to the entries in the system-wide table of open
        files. In other contexts, this object is variously also
        called an "open file object", a "file handle", an "open
        file table entry", or&mdash;in kernel-developer
        parlance&mdash;a
      <span class="emphasis">
       <em>
        struct
        file
       </em>
      </span>
      .
     </p>
     <p>
      When a file descriptor is duplicated (using
      <a class="link" href="../htmlman2/dup.2.html" shape="rect" target="_top">
       <span class="citerefentry">
        <span class="refentrytitle">
         dup
        </span>
        (2)
       </span>
      </a>
      or similar), the
        duplicate refers to the same open file description as the
        original file descriptor, and the two file descriptors
        consequently share the file offset and file status flags.
        Such sharing can also occur between processes: a child
        process created via
      <a class="link" href="../htmlman2/fork.2.html" shape="rect" target="_top">
       <span class="citerefentry">
        <span class="refentrytitle">
         fork
        </span>
        (2)
       </span>
      </a>
      inherits
        duplicates of its parent's file descriptors, and those
        duplicates refer to the same open file descriptions.
     </p>
     <p>
      Each
      <a class="link" href="../htmlman2/open.2.html" shape="rect" target="_top">
       <span class="citerefentry">
        <span class="refentrytitle">
         open
        </span>
        (2)
       </span>
      </a>
      of a file creates
        a new open file description; thus, there may be multiple
        open file descriptions corresponding to a file inode.
     </p>
    </div>
    <div class="refsect2">
     <a id="open-2_sect10" name="open-2_sect10" shape="rect">
     </a>
     <h3>
      Synchronized I/O
     </h3>
     <p>
      The POSIX.1-2008 "synchronized I/O" option specifies
        different variants of synchronized I/O, and specifies the
      <code class="function">
       open
      </code>
      () flags
      <code class="constant">
       O_SYNC
      </code>
      ,
      <code class="constant">
       O_DSYNC
      </code>
      , and
      <code class="constant">
       O_RSYNC
      </code>
      for controlling the behavior.
        Regardless of whether an implementation supports this
        option, it must at least support the use of
      <code class="constant">
       O_SYNC
      </code>
      for regular files.
     </p>
     <p>
      Linux implements
      <code class="constant">
       O_SYNC
      </code>
      and
      <code class="constant">
       O_DSYNC
      </code>
      , but not
      <code class="constant">
       O_RSYNC
      </code>
      . (Somewhat
        incorrectly, glibc defines
      <code class="constant">
       O_RSYNC
      </code>
      to have the same value as
      <code class="constant">
       O_SYNC
      </code>
      .)
     </p>
     <p>
      <code class="constant">
       O_SYNC
      </code>
      provides
        synchronized I/O
      <em class="replaceable">
       <code>
        file
       </code>
      </em>
      integrity completion,
        meaning write operations will flush data and all associated
        metadata to the underlying hardware.
      <code class="constant">
       O_DSYNC
      </code>
      provides synchronized I/O
      <em class="replaceable">
       <code>
        data
       </code>
      </em>
      integrity
        completion, meaning write operations will flush data to the
        underlying hardware, but will only flush metadata updates
        that are required to allow a subsequent read operation to
        complete successfully. Data integrity completion can reduce
        the number of disk operations that are required for
        applications that don't need the guarantees of file
        integrity completion.
     </p>
     <p>
      To understand the difference between the two types of
        completion, consider two pieces of file metadata: the file
        last modification timestamp (
      <em class="replaceable">
       <code>
        st_mtime
       </code>
      </em>
      ) and the file
        length. All write operations will update the last file
        modification timestamp, but only writes that add data to
        the end of the file will change the file length. The last
        modification timestamp is not needed to ensure that a read
        completes successfully, but the file length is. Thus,
      <code class="constant">
       O_DSYNC
      </code>
      would only guarantee
        to flush updates to the file length metadata (whereas
      <code class="constant">
       O_SYNC
      </code>
      would also always
        flush the last modification timestamp metadata).
     </p>
     <p>
      Before Linux 2.6.33, Linux implemented only the
      <code class="constant">
       O_SYNC
      </code>
      flag for
      <code class="function">
       open
      </code>
      (). However, when that flag was
        specified, most filesystems actually provided the
        equivalent of synchronized I/O
      <em class="replaceable">
       <code>
        data
       </code>
      </em>
      integrity completion
        (i.e.,
      <code class="constant">
       O_SYNC
      </code>
      was actually
        implemented as the equivalent of
      <code class="constant">
       O_DSYNC
      </code>
      ).
     </p>
     <p>
      Since Linux 2.6.33, proper
      <code class="constant">
       O_SYNC
      </code>
      support is provided. However, to
        ensure backward binary compatibility,
      <code class="constant">
       O_DSYNC
      </code>
      was defined with the same value
        as the historical
      <code class="constant">
       O_SYNC
      </code>
      , and
      <code class="constant">
       O_SYNC
      </code>
      was defined as a new
        (two-bit) flag value that includes the
      <code class="constant">
       O_DSYNC
      </code>
      flag value. This ensures that
        applications compiled against new headers get at least
      <code class="constant">
       O_DSYNC
      </code>
      semantics on
        pre-2.6.33 kernels.
     </p>
    </div>
    <div class="refsect2">
     <a id="open-2_sect11" name="open-2_sect11" shape="rect">
     </a>
     <h3>
      NFS
     </h3>
     <p>
      There are many infelicities in the protocol underlying
        NFS, affecting amongst others
      <code class="constant">
       O_SYNC
      </code>
      and
      <code class="constant">
       O_NDELAY
      </code>
      .
     </p>
     <p>
      On NFS filesystems with UID mapping enabled,
      <code class="function">
       open
      </code>
      () may return a file
        descriptor but, for example,
      <a class="link" href="../htmlman2/read.2.html" shape="rect" target="_top">
       <span class="citerefentry">
        <span class="refentrytitle">
         read
        </span>
        (2)
       </span>
      </a>
      requests are
        denied with
      <span class="errorname">
       EACCES
      </span>
      . This is
        because the client performs
      <code class="function">
       open
      </code>
      () by checking the permissions, but
        UID mapping is performed by the server upon read and write
        requests.
     </p>
    </div>
    <div class="refsect2">
     <a id="open-2_sect12" name="open-2_sect12" shape="rect">
     </a>
     <h3>
      File access mode
     </h3>
     <p>
      Unlike the other values that can be specified in
      <em class="parameter">
       <code>
        flags
       </code>
      </em>
      , the
      <span class="emphasis">
       <em>
        access mode
       </em>
      </span>
      values
      <code class="constant">
       O_RDONLY
      </code>
      ,
      <code class="constant">
       O_WRONLY
      </code>
      , and
      <code class="constant">
       O_RDWR
      </code>
      do not specify individual bits.
        Rather, they define the low order two bits of
      <em class="parameter">
       <code>
        flags
       </code>
      </em>
      , and are defined
        respectively as 0, 1, and 2. In other words, the
        combination
      <span class="emphasis">
       <em>
        O_RDONLY |
        O_WRONLY
       </em>
      </span>
      is a logical error, and certainly does
        not have the same meaning as
      <code class="constant">
       O_RDWR
      </code>
      .
     </p>
     <p>
      Linux reserves the special, nonstandard access mode 3
        (binary 11) in
      <em class="parameter">
       <code>
        flags
       </code>
      </em>
      to mean: check for read
        and write permission on the file and return a descriptor
        that can't be used for reading or writing. This nonstandard
        access mode is used by some Linux drivers to return a
        descriptor that is to be used only for device-specific
      <a class="link" href="../htmlman2/ioctl.2.html" shape="rect" target="_top">
       <span class="citerefentry">
        <span class="refentrytitle">
         ioctl
        </span>
        (2)
       </span>
      </a>
      operations.
     </p>
    </div>
    <div class="refsect2">
     <a id="open-2_sect13" name="open-2_sect13" shape="rect">
     </a>
     <h3>
      Rationale for openat() and other directory file
        descriptor APIs
     </h3>
     <p>
      <code class="function">
       openat
      </code>
      () and the other
        system calls and library functions that take a directory
        file descriptor argument (i.e.,
      <a class="link" href="../htmlman2/access.2.html" shape="rect" target="_top">
       <span class="citerefentry">
        <span class="refentrytitle">
         faccessat
        </span>
        (2)
       </span>
      </a>
      ,
      <a class="link" href="../htmlman2/fanotify_mark.2.html" shape="rect" target="_top">
       <span class="citerefentry">
        <span class="refentrytitle">
         fanotify_mark
        </span>
        (2)
       </span>
      </a>
      ,
      <a class="link" href="../htmlman2/chmod.2.html" shape="rect" target="_top">
       <span class="citerefentry">
        <span class="refentrytitle">
         fchmodat
        </span>
        (2)
       </span>
      </a>
      ,
      <a class="link" href="../htmlman2/chown.2.html" shape="rect" target="_top">
       <span class="citerefentry">
        <span class="refentrytitle">
         fchownat
        </span>
        (2)
       </span>
      </a>
      ,
      <a class="link" href="../htmlman2/stat.2.html" shape="rect" target="_top">
       <span class="citerefentry">
        <span class="refentrytitle">
         fstatat
        </span>
        (2)
       </span>
      </a>
      ,
      <a class="link" href="../htmlman2/futimesat.2.html" shape="rect" target="_top">
       <span class="citerefentry">
        <span class="refentrytitle">
         futimesat
        </span>
        (2)
       </span>
      </a>
      ,
      <a class="link" href="../htmlman2/link.2.html" shape="rect" target="_top">
       <span class="citerefentry">
        <span class="refentrytitle">
         linkat
        </span>
        (2)
       </span>
      </a>
      ,
      <a class="link" href="../htmlman2/mkdir.2.html" shape="rect" target="_top">
       <span class="citerefentry">
        <span class="refentrytitle">
         mkdirat
        </span>
        (2)
       </span>
      </a>
      ,
      <a class="link" href="../htmlman2/mknod.2.html" shape="rect" target="_top">
       <span class="citerefentry">
        <span class="refentrytitle">
         mknodat
        </span>
        (2)
       </span>
      </a>
      ,
      <a class="link" href="../htmlman2/open_by_handle_at.2.html" shape="rect" target="_top">
       <span class="citerefentry">
        <span class="refentrytitle">
         name_to_handle_at
        </span>
        (2)
       </span>
      </a>
      ,
      <a class="link" href="../htmlman2/readlink.2.html" shape="rect" target="_top">
       <span class="citerefentry">
        <span class="refentrytitle">
         readlinkat
        </span>
        (2)
       </span>
      </a>
      ,
      <a class="link" href="../htmlman2/rename.2.html" shape="rect" target="_top">
       <span class="citerefentry">
        <span class="refentrytitle">
         renameat
        </span>
        (2)
       </span>
      </a>
      ,
      <a class="link" href="../htmlman2/symlink.2.html" shape="rect" target="_top">
       <span class="citerefentry">
        <span class="refentrytitle">
         symlinkat
        </span>
        (2)
       </span>
      </a>
      ,
      <a class="link" href="../htmlman2/unlink.2.html" shape="rect" target="_top">
       <span class="citerefentry">
        <span class="refentrytitle">
         unlinkat
        </span>
        (2)
       </span>
      </a>
      ,
      <a class="link" href="../htmlman2/utimensat.2.html" shape="rect" target="_top">
       <span class="citerefentry">
        <span class="refentrytitle">
         utimensat
        </span>
        (2)
       </span>
      </a>
      <a class="link" href="../htmlman3/mkfifo.3.html" shape="rect" target="_top">
       <span class="citerefentry">
        <span class="refentrytitle">
         mkfifoat
        </span>
        (3)
       </span>
      </a>
      , and
      <a class="link" href="../htmlman3/scandir.3.html" shape="rect" target="_top">
       <span class="citerefentry">
        <span class="refentrytitle">
         scandirat
        </span>
        (3)
       </span>
      </a>
      ) are
        supported for two reasons. Here, the explanation is in
        terms of the
      <code class="function">
       openat
      </code>
      () call,
        but the rationale is analogous for the other
        interfaces.
     </p>
     <p>
      First,
      <code class="function">
       openat
      </code>
      () allows an
        application to avoid race conditions that could occur when
        using
      <code class="function">
       open
      </code>
      () to open files in
        directories other than the current working directory. These
        race conditions result from the fact that some component of
        the directory prefix given to
      <code class="function">
       open
      </code>
      () could be changed in parallel with
        the call to
      <code class="function">
       open
      </code>
      (). Such
        races can be avoided by opening a file descriptor for the
        target directory, and then specifying that file descriptor
        as the
      <em class="parameter">
       <code>
        dirfd
       </code>
      </em>
      argument of
      <code class="function">
       openat
      </code>
      ().
     </p>
     <p>
      Second,
      <code class="function">
       openat
      </code>
      () allows
        the implementation of a per-thread "current working
        directory", via file descriptor(s) maintained by the
        application. (This functionality can also be obtained by
        tricks based on the use of
      <code class="filename">
       /proc/self/fd/
       <em class="parameter">
        <code>
         dirfd
        </code>
       </em>
      </code>
      , but less
        efficiently.)
     </p>
    </div>
    <div class="refsect2">
     <a id="open-2_sect14" name="open-2_sect14" shape="rect">
     </a>
     <h3>
      O_DIRECT
     </h3>
     <p>
      The
      <code class="constant">
       O_DIRECT
      </code>
      flag may
        impose alignment restrictions on the length and address of
        user-space buffers and the file offset of I/Os. In Linux
        alignment restrictions vary by filesystem and kernel
        version and might be absent entirely. However there is
        currently no filesystem&minus;independent interface for an
        application to discover these restrictions for a given file
        or filesystem. Some filesystems provide their own
        interfaces for doing so, for example the
      <code class="constant">
       XFS_IOC_DIOINFO
      </code>
      operation in
      <span class="citerefentry">
       <span class="refentrytitle">
        xfsctl
       </span>
       (3)
      </span>
      .
     </p>
     <p>
      Under Linux 2.4, transfer sizes, and the alignment of
        the user buffer and the file offset must all be multiples
        of the logical block size of the filesystem. Since Linux
        2.6.0, alignment to the logical block size of the
        underlying storage (typically 512 bytes) suffices. The
        logical block size can be determined using the
      <a class="link" href="../htmlman2/ioctl.2.html" shape="rect" target="_top">
       <span class="citerefentry">
        <span class="refentrytitle">
         ioctl
        </span>
        (2)
       </span>
      </a>
      <code class="constant">
       BLKSSZGET
      </code>
      operation or from the shell
        using the command:
     </p>
     <p>
      blockdev &minus;&minus;getss
     </p>
     <p>
      <code class="constant">
       O_DIRECT
      </code>
      I/Os should never
        be run concurrently with the
      <a class="link" href="../htmlman2/fork.2.html" shape="rect" target="_top">
       <span class="citerefentry">
        <span class="refentrytitle">
         fork
        </span>
        (2)
       </span>
      </a>
      system call, if
        the memory buffer is a private mapping (i.e., any mapping
        created with the
      <a class="link" href="../htmlman2/mmap.2.html" shape="rect" target="_top">
       <span class="citerefentry">
        <span class="refentrytitle">
         mmap
        </span>
        (2)
       </span>
      </a>
      <code class="constant">
       MAP_PRIVATE
      </code>
      flag; this includes memory
        allocated on the heap and statically allocated buffers).
        Any such I/Os, whether submitted via an asynchronous I/O
        interface or from another thread in the process, should be
        completed before
      <a class="link" href="../htmlman2/fork.2.html" shape="rect" target="_top">
       <span class="citerefentry">
        <span class="refentrytitle">
         fork
        </span>
        (2)
       </span>
      </a>
      is called.
        Failure to do so can result in data corruption and
        undefined behavior in parent and child processes. This
        restriction does not apply when the memory buffer for the
      <code class="constant">
       O_DIRECT
      </code>
      I/Os was created
        using
      <a class="link" href="../htmlman2/shmop.2.html" shape="rect" target="_top">
       <span class="citerefentry">
        <span class="refentrytitle">
         shmat
        </span>
        (2)
       </span>
      </a>
      or
      <a class="link" href="../htmlman2/mmap.2.html" shape="rect" target="_top">
       <span class="citerefentry">
        <span class="refentrytitle">
         mmap
        </span>
        (2)
       </span>
      </a>
      with the
      <code class="constant">
       MAP_SHARED
      </code>
      flag. Nor does
        this restriction apply when the memory buffer has been
        advised as
      <code class="constant">
       MADV_DONTFORK
      </code>
      with
      <a class="link" href="../htmlman2/madvise.2.html" shape="rect" target="_top">
       <span class="citerefentry">
        <span class="refentrytitle">
         madvise
        </span>
        (2)
       </span>
      </a>
      , ensuring that
        it will not be available to the child after
      <a class="link" href="../htmlman2/fork.2.html" shape="rect" target="_top">
       <span class="citerefentry">
        <span class="refentrytitle">
         fork
        </span>
        (2)
       </span>
      </a>
      .
     </p>
     <p>
      The
      <code class="constant">
       O_DIRECT
      </code>
      flag was
        introduced in SGI IRIX, where it has alignment restrictions
        similar to those of Linux 2.4. IRIX has also a
      <a class="link" href="../htmlman2/fcntl.2.html" shape="rect" target="_top">
       <span class="citerefentry">
        <span class="refentrytitle">
         fcntl
        </span>
        (2)
       </span>
      </a>
      call to query
        appropriate alignments, and sizes. FreeBSD 4.x introduced a
        flag of the same name, but without alignment
        restrictions.
     </p>
     <p>
      <code class="constant">
       O_DIRECT
      </code>
      support was added
        under Linux in kernel version 2.4.10. Older Linux kernels
        simply ignore this flag. Some filesystems may not implement
        the flag and
      <code class="function">
       open
      </code>
      () will fail
        with
      <span class="errorname">
       EINVAL
      </span>
      if it is
        used.
     </p>
     <p>
      Applications should avoid mixing
      <code class="constant">
       O_DIRECT
      </code>
      and normal I/O to the same file,
        and especially to overlapping byte regions in the same
        file. Even when the filesystem correctly handles the
        coherency issues in this situation, overall I/O throughput
        is likely to be slower than using either mode alone.
        Likewise, applications should avoid mixing
      <a class="link" href="../htmlman2/mmap.2.html" shape="rect" target="_top">
       <span class="citerefentry">
        <span class="refentrytitle">
         mmap
        </span>
        (2)
       </span>
      </a>
      of files with
        direct I/O to the same files.
     </p>
     <p>
      The behavior of
      <code class="constant">
       O_DIRECT
      </code>
      with NFS will differ from local filesystems. Older kernels,
        or kernels configured in certain ways, may not support this
        combination. The NFS protocol does not support passing the
        flag to the server, so
      <code class="constant">
       O_DIRECT
      </code>
      I/O will bypass the page cache
        only on the client; the server may still cache the I/O. The
        client asks the server to make the I/O synchronous to
        preserve the synchronous semantics of
      <code class="constant">
       O_DIRECT
      </code>
      . Some servers will perform
        poorly under these circumstances, especially if the I/O
        size is small. Some servers may also be configured to lie
        to clients about the I/O having reached stable storage;
        this will avoid the performance penalty at some risk to
        data integrity in the event of server power failure. The
        Linux NFS client places no alignment restrictions on
      <code class="constant">
       O_DIRECT
      </code>
      I/O.
     </p>
     <p>
      In summary,
      <code class="constant">
       O_DIRECT
      </code>
      is a
        potentially powerful tool that should be used with caution.
        It is recommended that applications treat use of
      <code class="constant">
       O_DIRECT
      </code>
      as a performance
        option which is disabled by default.
     </p>
     <div class="blockquote">
      <blockquote class="blockquote">
       <p>
        "The thing that has always disturbed me about
            O_DIRECT is that the whole interface is just stupid,
            and was probably designed by a deranged monkey on some
            serious mind-controlling substances."&mdash;Linus
       </p>
      </blockquote>
     </div>
    </div>
   </div>
   <div class="refsect1">
    <a id="open-2_sect15" name="open-2_sect15" shape="rect">
    </a>
    <h2>
     BUGS
    </h2>
    <p>
     Currently, it is not possible to enable signal-driven I/O
      by specifying
     <code class="constant">
      O_ASYNC
     </code>
     when
      calling
     <code class="function">
      open
     </code>
     (); use
     <a class="link" href="../htmlman2/fcntl.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        fcntl
       </span>
       (2)
      </span>
     </a>
     to enable this
      flag.
    </p>
    <p>
     One must check for two different error codes,
     <span class="errorname">
      EISDIR
     </span>
     and
     <span class="errorname">
      ENOENT
     </span>
     , when trying to determine whether
      the kernel supports
     <code class="constant">
      O_TMPFILE
     </code>
     functionality.
    </p>
   </div>
   <div class="refsect1">
    <a id="open-2_sect16" name="open-2_sect16" shape="rect">
    </a>
    <h2>
     SEE ALSO
    </h2>
    <p>
     <a class="link" href="../htmlman2/chmod.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        chmod
       </span>
       (2)
      </span>
     </a>
     ,
     <a class="link" href="../htmlman2/chown.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        chown
       </span>
       (2)
      </span>
     </a>
     ,
     <a class="link" href="../htmlman2/close.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        close
       </span>
       (2)
      </span>
     </a>
     ,
     <a class="link" href="../htmlman2/dup.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        dup
       </span>
       (2)
      </span>
     </a>
     ,
     <a class="link" href="../htmlman2/fcntl.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        fcntl
       </span>
       (2)
      </span>
     </a>
     ,
     <a class="link" href="../htmlman2/link.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        link
       </span>
       (2)
      </span>
     </a>
     ,
     <a class="link" href="../htmlman2/lseek.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        lseek
       </span>
       (2)
      </span>
     </a>
     ,
     <a class="link" href="../htmlman2/mknod.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        mknod
       </span>
       (2)
      </span>
     </a>
     ,
     <a class="link" href="../htmlman2/mmap.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        mmap
       </span>
       (2)
      </span>
     </a>
     ,
     <a class="link" href="../htmlman2/mount.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        mount
       </span>
       (2)
      </span>
     </a>
     ,
     <a class="link" href="../htmlman2/open_by_handle_at.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        open_by_handle_at
       </span>
       (2)
      </span>
     </a>
     ,
     <a class="link" href="../htmlman2/read.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        read
       </span>
       (2)
      </span>
     </a>
     ,
     <a class="link" href="../htmlman2/socket.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        socket
       </span>
       (2)
      </span>
     </a>
     ,
     <a class="link" href="../htmlman2/stat.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        stat
       </span>
       (2)
      </span>
     </a>
     ,
     <a class="link" href="../htmlman2/umask.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        umask
       </span>
       (2)
      </span>
     </a>
     ,
     <a class="link" href="../htmlman2/unlink.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        unlink
       </span>
       (2)
      </span>
     </a>
     ,
     <a class="link" href="../htmlman2/write.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        write
       </span>
       (2)
      </span>
     </a>
     ,
     <a class="link" href="../htmlman3/fopen.3.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        fopen
       </span>
       (3)
      </span>
     </a>
     ,
     <a class="link" href="../htmlman7/fifo.7.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        fifo
       </span>
       (7)
      </span>
     </a>
     ,
     <a class="link" href="../htmlman7/path_resolution.7.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        path_resolution
       </span>
       (7)
      </span>
     </a>
     ,
     <a class="link" href="../htmlman7/symlink.7.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        symlink
       </span>
       (7)
      </span>
     </a>
    </p>
   </div>
   <div class="colophon">
    <a id="open-2_sect17" name="open-2_sect17" shape="rect">
    </a>
    <h2>
     COLOPHON
    </h2>
    <p>
     This page is part of release 3.72 of the Linux
     <em class="replaceable">
      <code>
       man-pages
      </code>
     </em>
     project. A
      description of the project, information about reporting bugs,
      and the latest version of this page, can be found at
      http://www.kernel.org/doc/man&minus;pages/.
    </p>
   </div>
  </div>
 </body>
</html>
