<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
  <title>
   sem_wait(3) &mdash; Linux manual pages
  </title>
  <link href="../stylesheet/manpages.css" rel="stylesheet" type="text/css"/>
  <link href="../index.html" rel="home" title="sem_wait(3) &mdash; Linux manual pages"/>
  <script src="../stylesheet/manpages.js" type="text/javascript" xml:space="preserve">
  </script>
  <link href="../stylesheet/icon.gif" rel="icon" type="image/gif"/>
 </head>
 <body>
  <div class="refentry">
   <a id="sem-wait.3" name="sem-wait.3" shape="rect">
   </a>
   <div class="titlepage">
   </div>
   <div class="refnamediv">
    <h2>
     Name
    </h2>
    <p>
     sem_wait, sem_timedwait, sem_trywait &mdash; lock a
      semaphore
    </p>
   </div>
   <div class="refsynopsisdiv">
    <h2>
     Synopsis
    </h2>
    <div class="funcsynopsis">
     <pre class="funcsynopsisinfo" xml:space="preserve">
#include &lt;semaphore.h&gt;
</pre>
     <table border="0" class="funcprototype-table" style="cellspacing: 0; cellpadding: 0;" summary="Function synopsis">
      <tr>
       <td colspan="1" rowspan="1">
        <code class="funcdef">
         int
         <strong>
          sem_wait
         </strong>
         (
        </code>
       </td>
       <td colspan="1" rowspan="1">
        sem_t *
        <var class="pdparam">
         sem
        </var>
        <code>
         )
        </code>
        ;
       </td>
      </tr>
     </table>
     <div class="funcprototype-spacer">
      &nbsp;
     </div>
    </div>
    <div class="funcsynopsis">
     <table border="0" class="funcprototype-table" style="cellspacing: 0; cellpadding: 0;" summary="Function synopsis">
      <tr>
       <td colspan="1" rowspan="1">
        <code class="funcdef">
         int
         <strong>
          sem_trywait
         </strong>
         (
        </code>
       </td>
       <td colspan="1" rowspan="1">
        sem_t *
        <var class="pdparam">
         sem
        </var>
        <code>
         )
        </code>
        ;
       </td>
      </tr>
     </table>
     <div class="funcprototype-spacer">
      &nbsp;
     </div>
    </div>
    <div class="funcsynopsis">
     <table border="0" class="funcprototype-table" style="cellspacing: 0; cellpadding: 0;" summary="Function synopsis">
      <tr>
       <td colspan="1" rowspan="1">
        <code class="funcdef">
         int
         <strong>
          sem_timedwait
         </strong>
         (
        </code>
       </td>
       <td colspan="1" rowspan="1">
        sem_t *
        <var class="pdparam">
         sem
        </var>
        ,
       </td>
      </tr>
      <tr>
       <td colspan="1" rowspan="1">
        &nbsp;
       </td>
       <td colspan="1" rowspan="1">
        const struct timespec *
        <var class="pdparam">
         abs_timeout
        </var>
        <code>
         )
        </code>
        ;
       </td>
      </tr>
     </table>
     <div class="funcprototype-spacer">
      &nbsp;
     </div>
    </div>
    <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tr>
       <td align="center" colspan="1" rowspan="2" valign="top" width="25">
        <img alt="[Note]" src="../stylesheet/note.png"/>
       </td>
       <th align="left" colspan="1" rowspan="1">
        Note
       </th>
      </tr>
      <tr>
       <td align="left" colspan="1" rowspan="1" valign="top">
        <div class="featuretests">
         <table style="border-collapse: collapse;">
          <colgroup span="1">
           <col span="1">
           </col>
          </colgroup>
          <thead>
           <tr>
            <th colspan="1" rowspan="1" style="">
             Feature Test Macro Requirements
                      for glibc (see
             <a class="link" href="../htmlman7/feature_test_macros.7.html" shape="rect" target="_top">
              <span class="citerefentry">
               <span class="refentrytitle">
                feature_test_macros
               </span>
               (7)
              </span>
             </a>
             ):
            </th>
           </tr>
          </thead>
          <tbody>
           <tr>
            <td colspan="1" rowspan="1" style="">
             <code class="function">
              sem_timedwait
             </code>
             ():
            </td>
           </tr>
           <tr>
            <td class="featuretestdef" colspan="1" rowspan="1" style="">
             <code class="constant">
              _POSIX_C_SOURCE
             </code>
             &gt;= 200112L ||
             <code class="constant">
              _XOPEN_SOURCE
             </code>
             &gt;=
                      600
            </td>
           </tr>
          </tbody>
         </table>
        </div>
       </td>
      </tr>
     </table>
    </div>
    <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tr>
       <td align="center" colspan="1" rowspan="2" valign="top" width="25">
        <img alt="[Note]" src="../stylesheet/note.png"/>
       </td>
       <th align="left" colspan="1" rowspan="1">
        Note
       </th>
      </tr>
      <tr>
       <td align="left" colspan="1" rowspan="1" valign="top">
        <p>
         Link with
         <code class="option">
          &minus;pthread
         </code>
         .
        </p>
       </td>
      </tr>
     </table>
    </div>
   </div>
   <div class="refsect1">
    <a id="sem-wait-3_sect1" name="sem-wait-3_sect1" shape="rect">
    </a>
    <h2>
     DESCRIPTION
    </h2>
    <p>
     <code class="function">
      sem_wait
     </code>
     () decrements
      (locks) the semaphore pointed to by
     <em class="parameter">
      <code>
       sem
      </code>
     </em>
     . If the semaphore's value
      is greater than zero, then the decrement proceeds, and the
      function returns, immediately. If the semaphore currently has
      the value zero, then the call blocks until either it becomes
      possible to perform the decrement (i.e., the semaphore value
      rises above zero), or a signal handler interrupts the
      call.
    </p>
    <p>
     <code class="function">
      sem_trywait
     </code>
     () is the same as
     <code class="function">
      sem_wait
     </code>
     (), except that if the
      decrement cannot be immediately performed, then call returns
      an error (
     <code class="varname">
      errno
     </code>
     set to
     <span class="errorname">
      EAGAIN
     </span>
     ) instead of
      blocking.
    </p>
    <p>
     <code class="function">
      sem_timedwait
     </code>
     () is the same
      as
     <code class="function">
      sem_wait
     </code>
     (), except that
     <em class="parameter">
      <code>
       abs_timeout
      </code>
     </em>
     specifies
      a limit on the amount of time that the call should block if
      the decrement cannot be immediately performed. The
     <em class="parameter">
      <code>
       abs_timeout
      </code>
     </em>
     argument points to
      a structure that specifies an absolute timeout in seconds and
      nanoseconds since the Epoch, 1970-01-01 00:00:00 +0000 (UTC).
      This structure is defined as follows:
    </p>
    <div class="blockquote">
     <blockquote class="blockquote">
      <div class="structdef">
       <table style="border-collapse: collapse;">
        <colgroup span="1">
         <col class="c1" span="1">
         </col>
         <col class="c2" span="1">
         </col>
         <col class="c3" span="1">
         </col>
         <col class="c4" span="1">
         </col>
         <col class="c5" span="1">
         </col>
        </colgroup>
        <tbody>
         <tr>
          <td align="left" class="structdefhdr" colspan="1" rowspan="1" style="">
           struct
          </td>
          <td align="left" class="structdefhdr" colspan="4" rowspan="1" style="">
           <span class="structname">
            timespec
           </span>
           &nbsp;{
          </td>
         </tr>
         <tr>
          <td colspan="1" rowspan="1" style="">
           &nbsp;
          </td>
          <td align="left" colspan="1" rowspan="1" style="">
           <span class="type">
            time_t
           </span>
          </td>
          <td align="right" class="norightpad" colspan="1" rowspan="1" style="">
           &nbsp;
          </td>
          <td align="left" colspan="1" rowspan="1" style="">
           <em class="structfield">
            <code>
             tv_sec
            </code>
           </em>
           ;
          </td>
          <td align="left" colspan="1" rowspan="1" style="">
           <div class="literallayout">
            /*&nbsp;Seconds&nbsp;*/
           </div>
          </td>
         </tr>
         <tr>
          <td colspan="1" rowspan="1" style="">
           &nbsp;
          </td>
          <td align="left" colspan="1" rowspan="1" style="">
           <span class="type">
            long
           </span>
          </td>
          <td align="right" class="norightpad" colspan="1" rowspan="1" style="">
           &nbsp;
          </td>
          <td align="left" colspan="1" rowspan="1" style="">
           <em class="structfield">
            <code>
             tv_nsec
            </code>
           </em>
           ;
          </td>
          <td align="left" colspan="1" rowspan="1" style="">
           <div class="literallayout">
            /*&nbsp;Nanoseconds&nbsp;[0&nbsp;..&nbsp;999999999]&nbsp;*/
           </div>
          </td>
         </tr>
         <tr>
          <td align="left" class="structdefftr" colspan="5" rowspan="1" style="">
           };
          </td>
         </tr>
        </tbody>
       </table>
      </div>
     </blockquote>
    </div>
    <p>
     If the timeout has already expired by the time of the
      call, and the semaphore could not be locked immediately, then
     <code class="function">
      sem_timedwait
     </code>
     () fails with a
      timeout error (
     <code class="varname">
      errno
     </code>
     set to
     <span class="errorname">
      ETIMEDOUT
     </span>
     ).
    </p>
    <p>
     If the operation can be performed immediately, then
     <code class="function">
      sem_timedwait
     </code>
     () never fails
      with a timeout error, regardless of the value of
     <em class="parameter">
      <code>
       abs_timeout
      </code>
     </em>
     . Furthermore, the
      validity of
     <em class="parameter">
      <code>
       abs_timeout
      </code>
     </em>
     is not checked in
      this case.
    </p>
   </div>
   <div class="refsect1">
    <a id="sem-wait-3_sect2" name="sem-wait-3_sect2" shape="rect">
    </a>
    <h2>
     RETURN VALUE
    </h2>
    <p>
     All of these functions return 0 on success; on error, the
      value of the semaphore is left unchanged, &minus;1 is
      returned, and
     <code class="varname">
      errno
     </code>
     is set to
      indicate the error.
    </p>
   </div>
   <div class="refsect1">
    <a id="sem-wait-3_sect3" name="sem-wait-3_sect3" shape="rect">
    </a>
    <h2>
     ERRORS
    </h2>
    <div class="variablelist">
     <dl class="variablelist">
      <dt>
       <span class="term">
        <span class="errorname">
         EINTR
        </span>
       </span>
      </dt>
      <dd>
       <p>
        The call was interrupted by a signal handler; see
        <a class="link" href="../htmlman7/signal.7.html" shape="rect" target="_top">
         <span class="citerefentry">
          <span class="refentrytitle">
           signal
          </span>
          (7)
         </span>
        </a>
        .
       </p>
      </dd>
      <dt>
       <span class="term">
        <span class="errorname">
         EINVAL
        </span>
       </span>
      </dt>
      <dd>
       <p>
        <em class="parameter">
         <code>
          sem
         </code>
        </em>
        is not a
            valid semaphore.
       </p>
      </dd>
     </dl>
    </div>
    <p>
     The following additional error can occur for
     <code class="function">
      sem_trywait
     </code>
     ():
    </p>
    <div class="variablelist">
     <dl class="variablelist">
      <dt>
       <span class="term">
        <span class="errorname">
         EAGAIN
        </span>
       </span>
      </dt>
      <dd>
       <p>
        The operation could not be performed without
            blocking (i.e., the semaphore currently has the value
            zero).
       </p>
      </dd>
     </dl>
    </div>
    <p>
     The following additional errors can occur for
     <code class="function">
      sem_timedwait
     </code>
     ():
    </p>
    <div class="variablelist">
     <dl class="variablelist">
      <dt>
       <span class="term">
        <span class="errorname">
         EINVAL
        </span>
       </span>
      </dt>
      <dd>
       <p>
        The value of
        <em class="replaceable">
         <code>
          abs_timeout.tv_nsecs
         </code>
        </em>
        is
            less than 0, or greater than or equal to 1000
            million.
       </p>
      </dd>
      <dt>
       <span class="term">
        <span class="errorname">
         ETIMEDOUT
        </span>
       </span>
      </dt>
      <dd>
       <p>
        The call timed out before the semaphore could be
            locked.
       </p>
      </dd>
     </dl>
    </div>
   </div>
   <div class="refsect1">
    <a id="sem-wait-3_sect4" name="sem-wait-3_sect4" shape="rect">
    </a>
    <h2>
     ATTRIBUTES
    </h2>
    <div class="refsect2">
     <a id="sem-wait-3_sect5" name="sem-wait-3_sect5" shape="rect">
     </a>
     <h3>
      Multithreading (see pthreads(7))
     </h3>
     <p>
      The
      <code class="function">
       sem_wait
      </code>
      (),
      <code class="function">
       sem_trywait
      </code>
      (), and
      <code class="function">
       sem_timedwait
      </code>
      () functions are
        thread-safe.
     </p>
    </div>
   </div>
   <div class="refsect1">
    <a id="sem-wait-3_sect6" name="sem-wait-3_sect6" shape="rect">
    </a>
    <h2>
     CONFORMING TO
    </h2>
    <p>
     POSIX.1-2001.
    </p>
   </div>
   <div class="refsect1">
    <a id="sem-wait-3_sect7" name="sem-wait-3_sect7" shape="rect">
    </a>
    <h2>
     NOTES
    </h2>
    <p>
     A signal handler always interrupts a blocked call to one
      of these functions, regardless of the use of the
     <a class="link" href="../htmlman2/sigaction.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        sigaction
       </span>
       (2)
      </span>
     </a>
     <code class="constant">
      SA_RESTART
     </code>
     flag.
    </p>
   </div>
   <div class="refsect1">
    <a id="sem-wait-3_sect8" name="sem-wait-3_sect8" shape="rect">
    </a>
    <h2>
     EXAMPLE
    </h2>
    <p>
     The (somewhat trivial) program shown below operates on an
      unnamed semaphore. The program expects two command-line
      arguments. The first argument specifies a seconds value that
      is used to set an alarm timer to generate a
     <code class="constant">
      SIGALRM
     </code>
     signal. This handler performs a
     <a class="link" href="../htmlman3/sem_post.3.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        sem_post
       </span>
       (3)
      </span>
     </a>
     to increment
      the semaphore that is being waited on in
     <code class="function">
      main
     </code>
     () using
     <code class="function">
      sem_timedwait
     </code>
     (). The second command-line
      argument specifies the length of the timeout, in seconds, for
     <code class="function">
      sem_timedwait
     </code>
     (). The following
      shows what happens on two different runs of the program:
    </p>
    <div class="blockquote">
     <blockquote class="blockquote">
      <div class="informalexample">
       <pre class="programlisting" xml:space="preserve">
$<span class="emphasis"><em> ./a.out 2 3</em></span>
About to call sem_timedwait()
sem_post() from handler
sem_timedwait() succeeded
$<span class="emphasis"><em> ./a.out 2 1</em></span>
About to call sem_timedwait()
sem_timedwait() timed out
</pre>
      </div>
     </blockquote>
    </div>
    <div class="refsect2">
     <a id="sem-wait-3_sect9" name="sem-wait-3_sect9" shape="rect">
     </a>
     <h3>
      Program source
     </h3>
     <div class="informalexample">
      <pre class="programlisting" xml:space="preserve">
#include &lt;unistd.h&gt;
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;semaphore.h&gt;
#include &lt;time.h&gt;
#include &lt;assert.h&gt;
#include &lt;errno.h&gt;
#include &lt;signal.h&gt;

sem_t sem;

#define handle_error(msg) \
    do { perror(msg); exit(EXIT_FAILURE); } while (0)

static void
handler(int sig)
{
    write(STDOUT_FILENO, "sem_post() from handler\n", 24);
    if (sem_post(&amp;sem) == &minus;1) {
        write(STDERR_FILENO, "sem_post() failed\n", 18);
        _exit(EXIT_FAILURE);
    }
}

int
main(int argc, char *argv[])
{
    struct sigaction sa;
    struct timespec ts;
    int s;

    if (argc != 3) {
        fprintf(stderr, "Usage: %s &lt;alarm&minus;secs&gt; &lt;wait&minus;secs&gt;\n",
                argv[0]);
        exit(EXIT_FAILURE);
    }

    if (sem_init(&amp;sem, 0, 0) == &minus;1)
        handle_error("sem_init");

    /* Establish SIGALRM handler; set alarm timer using argv[1] */

    sa.sa_handler = handler;
    sigemptyset(&amp;sa.sa_mask);
    sa.sa_flags = 0;
    if (sigaction(SIGALRM, &amp;sa, NULL) == &minus;1)
        handle_error("sigaction");

    alarm(atoi(argv[1]));

    /* Calculate relative interval as current time plus
       number of seconds given argv[2] */

    if (clock_gettime(CLOCK_REALTIME, &amp;ts) == &minus;1)
        handle_error("clock_gettime");

    ts.tv_sec += atoi(argv[2]);

    printf("main() about to call sem_timedwait()\n");
    while ((s = sem_timedwait(&amp;sem, &amp;ts)) == &minus;1 &amp;&amp; errno == EINTR)
        continue;       /* Restart if interrupted by handler */

    /* Check what happened */

    if (s == &minus;1) {
        if (errno == ETIMEDOUT)
            printf("sem_timedwait() timed out\n");
        else
            perror("sem_timedwait");
    } else
        printf("sem_timedwait() succeeded\n");

    exit((s == 0) ? EXIT_SUCCESS : EXIT_FAILURE);
}
</pre>
     </div>
    </div>
   </div>
   <div class="refsect1">
    <a id="sem-wait-3_sect10" name="sem-wait-3_sect10" shape="rect">
    </a>
    <h2>
     SEE ALSO
    </h2>
    <p>
     <a class="link" href="../htmlman2/clock_getres.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        clock_gettime
       </span>
       (2)
      </span>
     </a>
     ,
     <a class="link" href="../htmlman3/sem_getvalue.3.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        sem_getvalue
       </span>
       (3)
      </span>
     </a>
     ,
     <a class="link" href="../htmlman3/sem_post.3.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        sem_post
       </span>
       (3)
      </span>
     </a>
     ,
     <a class="link" href="../htmlman7/sem_overview.7.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        sem_overview
       </span>
       (7)
      </span>
     </a>
     ,
     <a class="link" href="../htmlman7/time.7.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        time
       </span>
       (7)
      </span>
     </a>
    </p>
   </div>
   <div class="colophon">
    <a id="sem-wait-3_sect11" name="sem-wait-3_sect11" shape="rect">
    </a>
    <h2>
     COLOPHON
    </h2>
    <p>
     This page is part of release 3.72 of the Linux
     <em class="replaceable">
      <code>
       man-pages
      </code>
     </em>
     project. A
      description of the project, information about reporting bugs,
      and the latest version of this page, can be found at
      http://www.kernel.org/doc/man&minus;pages/.
    </p>
   </div>
  </div>
 </body>
</html>
