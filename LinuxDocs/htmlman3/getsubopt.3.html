<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
  <title>
   getsubopt(3) &mdash; Linux manual pages
  </title>
  <link href="../stylesheet/manpages.css" rel="stylesheet" type="text/css"/>
  <link href="../index.html" rel="home" title="getsubopt(3) &mdash; Linux manual pages"/>
  <script src="../stylesheet/manpages.js" type="text/javascript" xml:space="preserve">
  </script>
  <link href="../stylesheet/icon.gif" rel="icon" type="image/gif"/>
 </head>
 <body>
  <div class="refentry">
   <a id="getsubopt.3" name="getsubopt.3" shape="rect">
   </a>
   <div class="titlepage">
   </div>
   <div class="refnamediv">
    <h2>
     Name
    </h2>
    <p>
     getsubopt &mdash; parse suboption arguments from a
      string
    </p>
   </div>
   <div class="refsynopsisdiv">
    <h2>
     Synopsis
    </h2>
    <div class="funcsynopsis">
     <pre class="funcsynopsisinfo" xml:space="preserve">
#include &lt;stdlib.h&gt;
</pre>
     <table border="0" class="funcprototype-table" style="cellspacing: 0; cellpadding: 0;" summary="Function synopsis">
      <tr>
       <td colspan="1" rowspan="1">
        <code class="funcdef">
         int
         <strong>
          getsubopt
         </strong>
         (
        </code>
       </td>
       <td colspan="1" rowspan="1">
        char **
        <var class="pdparam">
         optionp
        </var>
        ,
       </td>
      </tr>
      <tr>
       <td colspan="1" rowspan="1">
        &nbsp;
       </td>
       <td colspan="1" rowspan="1">
        char * const *
        <var class="pdparam">
         tokens
        </var>
        ,
       </td>
      </tr>
      <tr>
       <td colspan="1" rowspan="1">
        &nbsp;
       </td>
       <td colspan="1" rowspan="1">
        char **
        <var class="pdparam">
         valuep
        </var>
        <code>
         )
        </code>
        ;
       </td>
      </tr>
     </table>
     <div class="funcprototype-spacer">
      &nbsp;
     </div>
    </div>
    <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tr>
       <td align="center" colspan="1" rowspan="2" valign="top" width="25">
        <img alt="[Note]" src="../stylesheet/note.png"/>
       </td>
       <th align="left" colspan="1" rowspan="1">
        Note
       </th>
      </tr>
      <tr>
       <td align="left" colspan="1" rowspan="1" valign="top">
        <div class="featuretests">
         <table style="border-collapse: collapse;">
          <colgroup span="1">
           <col span="1">
           </col>
          </colgroup>
          <thead>
           <tr>
            <th colspan="1" rowspan="1" style="">
             Feature Test Macro Requirements
                      for glibc (see
             <a class="link" href="../htmlman7/feature_test_macros.7.html" shape="rect" target="_top">
              <span class="citerefentry">
               <span class="refentrytitle">
                feature_test_macros
               </span>
               (7)
              </span>
             </a>
             ):
            </th>
           </tr>
          </thead>
          <tbody>
           <tr>
            <td colspan="1" rowspan="1" style="">
             <code class="function">
              getsubopt
             </code>
             ():
            </td>
           </tr>
           <tr>
            <td class="featuretestdef" colspan="1" rowspan="1" style="">
             <code class="constant">
              _XOPEN_SOURCE
             </code>
             &gt;= 500 ||
             <code class="constant">
              _XOPEN_SOURCE
             </code>
             &amp;&amp;
             <code class="constant">
              _XOPEN_SOURCE_EXTENDED
             </code>
            </td>
           </tr>
           <tr>
            <td class="featuretestver" colspan="1" rowspan="1" style="">
             || /*
                      Since glibc 2.12: */
            </td>
           </tr>
           <tr>
            <td class="featuretestdef" colspan="1" rowspan="1" style="">
             <code class="constant">
              _POSIX_C_SOURCE
             </code>
             &gt;= 200809L
            </td>
           </tr>
          </tbody>
         </table>
        </div>
       </td>
      </tr>
     </table>
    </div>
   </div>
   <div class="refsect1">
    <a id="getsubopt-3_sect1" name="getsubopt-3_sect1" shape="rect">
    </a>
    <h2>
     DESCRIPTION
    </h2>
    <p>
     <code class="function">
      getsubopt
     </code>
     () parses the list
      of comma-separated suboptions provided in
     <em class="parameter">
      <code>
       optionp
      </code>
     </em>
     . (Such a suboption list
      is typically produced when
     <a class="link" href="../htmlman3/getopt.3.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        getopt
       </span>
       (3)
      </span>
     </a>
     is used to parse
      a command line; see for example the
     <code class="option">
      &minus;o
     </code>
     option of
     <a class="link" href="../htmlman8/mount.8.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        mount
       </span>
       (8)
      </span>
     </a>
     .) Each suboption
      may include an associated value, which is separated from the
      suboption name by an equal sign. The following is an example
      of the kind of string that might be passed in
     <em class="parameter">
      <code>
       optionp
      </code>
     </em>
     :
    </p>
    <div class="blockquote">
     <blockquote class="blockquote">
      <p>
       <em class="replaceable">
        <code>
         ro,name=xyz
        </code>
       </em>
      </p>
     </blockquote>
    </div>
    <p>
     The
     <em class="parameter">
      <code>
       tokens
      </code>
     </em>
     argument is a pointer to a NULL-terminated array of pointers
      to the tokens that
     <code class="function">
      getsubopt
     </code>
     ()
      will look for in
     <em class="parameter">
      <code>
       optionp
      </code>
     </em>
     . The tokens should be
      distinct, null-terminated strings containing at least one
      character, with no embedded equal signs or commas.
    </p>
    <p>
     Each call to
     <code class="function">
      getsubopt
     </code>
     ()
      returns information about the next unprocessed suboption in
     <em class="parameter">
      <code>
       optionp
      </code>
     </em>
     . The first
      equal sign in a suboption (if any) is interpreted as a
      separator between the name and the value of that suboption.
      The value extends to the next comma, or (for the last
      suboption) to the end of the string. If the name of the
      suboption matches a known name from
     <em class="parameter">
      <code>
       tokens
      </code>
     </em>
     , and a value string was
      found,
     <code class="function">
      getsubopt
     </code>
     () sets
      *
     <em class="parameter">
      <code>
       valuep
      </code>
     </em>
     to the
      address of that string. The first comma in
     <em class="parameter">
      <code>
       optionp
      </code>
     </em>
     is overwritten with a
      null byte, so *
     <em class="parameter">
      <code>
       valuep
      </code>
     </em>
     is precisely the "value string" for that suboption.
    </p>
    <p>
     If the suboption is recognized, but no value string was
      found, *
     <em class="parameter">
      <code>
       valuep
      </code>
     </em>
     is set
      to NULL.
    </p>
    <p>
     When
     <code class="function">
      getsubopt
     </code>
     () returns,
     <em class="parameter">
      <code>
       optionp
      </code>
     </em>
     points to the
      next suboption, or to the null byte ('\0') at the end of the
      string if the last suboption was just processed.
    </p>
   </div>
   <div class="refsect1">
    <a id="getsubopt-3_sect2" name="getsubopt-3_sect2" shape="rect">
    </a>
    <h2>
     RETURN VALUE
    </h2>
    <p>
     If the first suboption in
     <em class="parameter">
      <code>
       optionp
      </code>
     </em>
     is recognized,
     <code class="function">
      getsubopt
     </code>
     () returns the index
      of the matching suboption element in
     <em class="parameter">
      <code>
       tokens
      </code>
     </em>
     . Otherwise, &minus;1 is
      returned and *
     <em class="parameter">
      <code>
       valuep
      </code>
     </em>
     is the entire
     <em class="replaceable">
      <code>
       name
      </code>
     </em>
     [=
     <em class="replaceable">
      <code>
       value
      </code>
     </em>
     ] string.
    </p>
    <p>
     Since *
     <em class="parameter">
      <code>
       optionp
      </code>
     </em>
     is
      changed, the first suboption before the call to
     <code class="function">
      getsubopt
     </code>
     () is not (necessarily) the same
      as the first suboption after
     <code class="function">
      getsubopt
     </code>
     ().
    </p>
   </div>
   <div class="refsect1">
    <a id="getsubopt-3_sect3" name="getsubopt-3_sect3" shape="rect">
    </a>
    <h2>
     ATTRIBUTES
    </h2>
    <div class="refsect2">
     <a id="getsubopt-3_sect4" name="getsubopt-3_sect4" shape="rect">
     </a>
     <h3>
      Multithreading (see pthreads(7))
     </h3>
     <p>
      The
      <code class="function">
       getsubopt
      </code>
      () function
        is thread-safe.
     </p>
    </div>
   </div>
   <div class="refsect1">
    <a id="getsubopt-3_sect5" name="getsubopt-3_sect5" shape="rect">
    </a>
    <h2>
     CONFORMING TO
    </h2>
    <p>
     POSIX.1-2001.
    </p>
   </div>
   <div class="refsect1">
    <a id="getsubopt-3_sect6" name="getsubopt-3_sect6" shape="rect">
    </a>
    <h2>
     NOTES
    </h2>
    <p>
     Since
     <code class="function">
      getsubopt
     </code>
     () overwrites
      any commas it finds in the string *
     <em class="parameter">
      <code>
       optionp
      </code>
     </em>
     , that string must be
      writable; it cannot be a string constant.
    </p>
   </div>
   <div class="refsect1">
    <a id="getsubopt-3_sect7" name="getsubopt-3_sect7" shape="rect">
    </a>
    <h2>
     EXAMPLE
    </h2>
    <p>
     The following program expects suboptions following a
      "&minus;o" option.
    </p>
    <div class="informalexample">
     <pre class="programlisting" xml:space="preserve">
#define _XOPEN_SOURCE 500
#include &lt;stdlib.h&gt;
#include &lt;assert.h&gt;
#include &lt;stdio.h&gt;

int
main(int argc, char **argv)
{
    enum {
        RO_OPT = 0,
        RW_OPT,
        NAME_OPT
    };
    char *const token[] = {
        [RO_OPT]   = "ro",
        [RW_OPT]   = "rw",
        [NAME_OPT] = "name",
        NULL
    };
    char *subopts;
    char *value;
    int opt;

    int readonly = 0;
    int readwrite = 0;
    char *name = NULL;
    int errfnd = 0;

    while ((opt = getopt(argc, argv, "o:")) != &minus;1) {
        switch (opt) {
        case 'o':
            subopts = optarg;
            while (*subopts != '\0' &amp;&amp; !errfnd) {

            switch (getsubopt(&amp;subopts, token, &amp;value)) {
            case RO_OPT:
                readonly = 1;
                break;

            case RW_OPT:
                readwrite = 1;
                break;

            case NAME_OPT:
                if (value == NULL) {
                    fprintf(stderr, "Missing value for "
                            "suboption '%s'\n", token[NAME_OPT]);
                    errfnd = 1;
                    continue;
                }

                name = value;
                break;

            default:
                fprintf(stderr, "No match found "
                        "for token: /%s/\n", value);
                errfnd = 1;
                break;
            }
        }
        if (readwrite &amp;&amp; readonly) {
            fprintf(stderr, "Only one of '%s' and '%s' can be "
                    "specified\n", token[RO_OPT], token[RW_OPT]);
            errfnd = 1;
        }
        break;

        default:
            errfnd = 1;
        }
    }

    if (errfnd || argc == 1) {
        fprintf(stderr, "\nUsage: %s &minus;o &lt;suboptstring&gt;\n", argv[0]);
        fprintf(stderr, "suboptions are 'ro', 'rw', "
                "and 'name=&lt;value&gt;'\n");
        exit(EXIT_FAILURE);
    }

    /* Remainder of program... */

    exit(EXIT_SUCCESS);
}
</pre>
    </div>
   </div>
   <div class="refsect1">
    <a id="getsubopt-3_sect8" name="getsubopt-3_sect8" shape="rect">
    </a>
    <h2>
     SEE ALSO
    </h2>
    <p>
     <a class="link" href="../htmlman3/getopt.3.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        getopt
       </span>
       (3)
      </span>
     </a>
    </p>
   </div>
   <div class="colophon">
    <a id="getsubopt-3_sect9" name="getsubopt-3_sect9" shape="rect">
    </a>
    <h2>
     COLOPHON
    </h2>
    <p>
     This page is part of release 3.72 of the Linux
     <em class="replaceable">
      <code>
       man-pages
      </code>
     </em>
     project. A
      description of the project, information about reporting bugs,
      and the latest version of this page, can be found at
      http://www.kernel.org/doc/man&minus;pages/.
    </p>
   </div>
  </div>
 </body>
</html>
