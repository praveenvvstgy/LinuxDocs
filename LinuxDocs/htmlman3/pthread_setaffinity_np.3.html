<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
  <title>
   pthread_setaffinity_np(3) &mdash; Linux manual
  pages
  </title>
  <link href="../stylesheet/manpages.css" rel="stylesheet" type="text/css"/>
  <link href="../index.html" rel="home" title="pthread_setaffinity_np(3) &mdash; Linux manual pages"/>
  <script src="../stylesheet/manpages.js" type="text/javascript" xml:space="preserve">
  </script>
  <link href="../stylesheet/icon.gif" rel="icon" type="image/gif"/>
 </head>
 <body>
  <div class="refentry">
   <a id="pthread-setaffinity-np.3" name="pthread-setaffinity-np.3" shape="rect">
   </a>
   <div class="titlepage">
   </div>
   <div class="refnamediv">
    <h2>
     Name
    </h2>
    <p>
     pthread_setaffinity_np, pthread_getaffinity_np &mdash;
      set/get CPU affinity of a thread
    </p>
   </div>
   <div class="refsynopsisdiv">
    <h2>
     Synopsis
    </h2>
    <div class="informalexample">
     <pre class="programlisting" xml:space="preserve">
#define _GNU_SOURCE              /* See feature_test_macros(7) */
#include &lt;pthread.h&gt;
</pre>
    </div>
    <div class="funcsynopsis">
     <table border="0" class="funcprototype-table" style="cellspacing: 0; cellpadding: 0;" summary="Function synopsis">
      <tr>
       <td colspan="1" rowspan="1">
        <code class="funcdef">
         int
         <strong>
          pthread_setaffinity_np
         </strong>
         (
        </code>
       </td>
       <td colspan="1" rowspan="1">
        pthread_t
        <var class="pdparam">
         thread
        </var>
        ,
       </td>
      </tr>
      <tr>
       <td colspan="1" rowspan="1">
        &nbsp;
       </td>
       <td colspan="1" rowspan="1">
        size_t
        <var class="pdparam">
         cpusetsize
        </var>
        ,
       </td>
      </tr>
      <tr>
       <td colspan="1" rowspan="1">
        &nbsp;
       </td>
       <td colspan="1" rowspan="1">
        const cpu_set_t *
        <var class="pdparam">
         cpuset
        </var>
        <code>
         )
        </code>
        ;
       </td>
      </tr>
     </table>
     <div class="funcprototype-spacer">
      &nbsp;
     </div>
    </div>
    <div class="funcsynopsis">
     <table border="0" class="funcprototype-table" style="cellspacing: 0; cellpadding: 0;" summary="Function synopsis">
      <tr>
       <td colspan="1" rowspan="1">
        <code class="funcdef">
         int
         <strong>
          pthread_getaffinity_np
         </strong>
         (
        </code>
       </td>
       <td colspan="1" rowspan="1">
        pthread_t
        <var class="pdparam">
         thread
        </var>
        ,
       </td>
      </tr>
      <tr>
       <td colspan="1" rowspan="1">
        &nbsp;
       </td>
       <td colspan="1" rowspan="1">
        size_t
        <var class="pdparam">
         cpusetsize
        </var>
        ,
       </td>
      </tr>
      <tr>
       <td colspan="1" rowspan="1">
        &nbsp;
       </td>
       <td colspan="1" rowspan="1">
        cpu_set_t *
        <var class="pdparam">
         cpuset
        </var>
        <code>
         )
        </code>
        ;
       </td>
      </tr>
     </table>
     <div class="funcprototype-spacer">
      &nbsp;
     </div>
    </div>
    <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tr>
       <td align="center" colspan="1" rowspan="2" valign="top" width="25">
        <img alt="[Note]" src="../stylesheet/note.png"/>
       </td>
       <th align="left" colspan="1" rowspan="1">
        Note
       </th>
      </tr>
      <tr>
       <td align="left" colspan="1" rowspan="1" valign="top">
        <p>
         Compile and link with
         <code class="option">
          &minus;pthread
         </code>
         .
        </p>
       </td>
      </tr>
     </table>
    </div>
   </div>
   <div class="refsect1">
    <a id="pthread-setaffinity-np-3_sect1" name="pthread-setaffinity-np-3_sect1" shape="rect">
    </a>
    <h2>
     DESCRIPTION
    </h2>
    <p>
     The
     <code class="function">
      pthread_setaffinity_np
     </code>
     ()
      function sets the CPU affinity mask of the thread
     <em class="parameter">
      <code>
       thread
      </code>
     </em>
     to the CPU set pointed
      to by
     <em class="parameter">
      <code>
       cpuset
      </code>
     </em>
     . If the
      call is successful, and the thread is not currently running
      on one of the CPUs in
     <em class="parameter">
      <code>
       cpuset
      </code>
     </em>
     , then it is migrated to
      one of those CPUs.
    </p>
    <p>
     The
     <code class="function">
      pthread_getaffinity_np
     </code>
     ()
      function returns the CPU affinity mask of the thread
     <em class="parameter">
      <code>
       thread
      </code>
     </em>
     in the buffer
      pointed to by
     <em class="parameter">
      <code>
       cpuset
      </code>
     </em>
     .
    </p>
    <p>
     For more details on CPU affinity masks, see
     <a class="link" href="../htmlman2/sched_setaffinity.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        sched_setaffinity
       </span>
       (2)
      </span>
     </a>
     . For a
      description of a set of macros that can be used to manipulate
      and inspect CPU sets, see
     <a class="link" href="../htmlman3/CPU_SET.3.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        CPU_SET
       </span>
       (3)
      </span>
     </a>
     .
    </p>
    <p>
     The argument
     <em class="parameter">
      <code>
       cpusetsize
      </code>
     </em>
     is the length (in
      bytes) of the buffer pointed to by
     <em class="parameter">
      <code>
       cpuset
      </code>
     </em>
     . Typically, this
      argument would be specified as
     <em class="replaceable">
      <code>
       sizeof(cpu_set_t)
      </code>
     </em>
     . (It may be
      some other value, if using the macros described in
     <a class="link" href="../htmlman3/CPU_SET.3.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        CPU_SET
       </span>
       (3)
      </span>
     </a>
     for dynamically
      allocating a CPU set.)
    </p>
   </div>
   <div class="refsect1">
    <a id="pthread-setaffinity-np-3_sect2" name="pthread-setaffinity-np-3_sect2" shape="rect">
    </a>
    <h2>
     RETURN VALUE
    </h2>
    <p>
     On success, these functions return 0; on error, they
      return a nonzero error number.
    </p>
   </div>
   <div class="refsect1">
    <a id="pthread-setaffinity-np-3_sect3" name="pthread-setaffinity-np-3_sect3" shape="rect">
    </a>
    <h2>
     ERRORS
    </h2>
    <div class="variablelist">
     <dl class="variablelist">
      <dt>
       <span class="term">
        <span class="errorname">
         EFAULT
        </span>
       </span>
      </dt>
      <dd>
       <p>
        A supplied memory address was invalid.
       </p>
      </dd>
      <dt>
       <span class="term">
        <span class="errorname">
         EINVAL
        </span>
       </span>
      </dt>
      <dd>
       <p>
        (
        <code class="function">
         pthread_setaffinity_np
        </code>
        ()) The
            affinity bit mask
        <code class="function">
         mask
        </code>
        contains no processors that are currently physically on
            the system and permitted to the thread according to any
            restrictions that may be imposed by the "cpuset"
            mechanism described in
        <a class="link" href="../htmlman7/cpuset.7.html" shape="rect" target="_top">
         <span class="citerefentry">
          <span class="refentrytitle">
           cpuset
          </span>
          (7)
         </span>
        </a>
        .
       </p>
      </dd>
      <dt>
       <span class="term">
        <span class="errorname">
         EINVAL
        </span>
       </span>
      </dt>
      <dd>
       <p>
        (
        <code class="function">
         pthread_setaffinity_np
        </code>
        ())
        <em class="parameter">
         <code>
          cpuset
         </code>
        </em>
        specified a CPU
            that was outside the set supported by the kernel. (The
            kernel configuration option
        <code class="constant">
         CONFIG_NR_CPUS
        </code>
        defines the range of
            the set supported by the kernel data type used to
            represent CPU sets.)
       </p>
      </dd>
      <dt>
       <span class="term">
        <span class="errorname">
         EINVAL
        </span>
       </span>
      </dt>
      <dd>
       <p>
        (
        <code class="function">
         pthread_getaffinity_np
        </code>
        ())
        <em class="parameter">
         <code>
          cpusetsize
         </code>
        </em>
        is smaller
            than the size of the affinity mask used by the
            kernel.
       </p>
      </dd>
      <dt>
       <span class="term">
        <span class="errorname">
         ESRCH
        </span>
       </span>
      </dt>
      <dd>
       <p>
        No thread with the ID
        <em class="parameter">
         <code>
          thread
         </code>
        </em>
        could be
            found.
       </p>
      </dd>
     </dl>
    </div>
   </div>
   <div class="refsect1">
    <a id="pthread-setaffinity-np-3_sect4" name="pthread-setaffinity-np-3_sect4" shape="rect">
    </a>
    <h2>
     VERSIONS
    </h2>
    <p>
     These functions are provided by glibc since version
      2.3.4.
    </p>
   </div>
   <div class="refsect1">
    <a id="pthread-setaffinity-np-3_sect5" name="pthread-setaffinity-np-3_sect5" shape="rect">
    </a>
    <h2>
     ATTRIBUTES
    </h2>
    <div class="refsect2">
     <a id="pthread-setaffinity-np-3_sect6" name="pthread-setaffinity-np-3_sect6" shape="rect">
     </a>
     <h3>
      Multithreading (see pthreads(7))
     </h3>
     <p>
      The
      <code class="function">
       pthread_setaffinity_np
      </code>
      () and
      <code class="function">
       pthread_getaffinity_np
      </code>
      () functions are
        thread-safe.
     </p>
    </div>
   </div>
   <div class="refsect1">
    <a id="pthread-setaffinity-np-3_sect7" name="pthread-setaffinity-np-3_sect7" shape="rect">
    </a>
    <h2>
     CONFORMING TO
    </h2>
    <p>
     These functions are nonstandard GNU extensions; hence the
      suffix "_np" (nonportable) in the names.
    </p>
   </div>
   <div class="refsect1">
    <a id="pthread-setaffinity-np-3_sect8" name="pthread-setaffinity-np-3_sect8" shape="rect">
    </a>
    <h2>
     NOTES
    </h2>
    <p>
     After a call to
     <code class="function">
      pthread_setaffinity_np
     </code>
     (), the set of CPUs
      on which the thread will actually run is the intersection of
      the set specified in the
     <em class="parameter">
      <code>
       cpuset
      </code>
     </em>
     argument and the set of
      CPUs actually present on the system. The system may further
      restrict the set of CPUs on which the thread runs if the
      "cpuset" mechanism described in
     <a class="link" href="../htmlman7/cpuset.7.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        cpuset
       </span>
       (7)
      </span>
     </a>
     is being used.
      These restrictions on the actual set of CPUs on which the
      thread will run are silently imposed by the kernel.
    </p>
    <p>
     These functions are implemented on top of the
     <a class="link" href="../htmlman2/sched_setaffinity.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        sched_setaffinity
       </span>
       (2)
      </span>
     </a>
     and
     <a class="link" href="../htmlman2/sched_setaffinity.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        sched_getaffinity
       </span>
       (2)
      </span>
     </a>
     system
      calls.
    </p>
    <p>
     In glibc 2.3.3 only, versions of these functions were
      provided that did not have a
     <em class="parameter">
      <code>
       cpusetsize
      </code>
     </em>
     argument. Instead
      the CPU set size given to the underlying system calls was
      always
     <em class="replaceable">
      <code>
       sizeof(cpu_set_t)
      </code>
     </em>
     .
    </p>
    <p>
     A new thread created by
     <a class="link" href="../htmlman3/pthread_create.3.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        pthread_create
       </span>
       (3)
      </span>
     </a>
     inherits
      a copy of its creator's CPU affinity mask.
    </p>
   </div>
   <div class="refsect1">
    <a id="pthread-setaffinity-np-3_sect9" name="pthread-setaffinity-np-3_sect9" shape="rect">
    </a>
    <h2>
     EXAMPLE
    </h2>
    <p>
     In the following program, the main thread uses
     <code class="function">
      pthread_setaffinity_np
     </code>
     () to set
      its CPU affinity mask to include CPUs 0 to 7 (which may not
      all be available on the system), and then calls
     <code class="function">
      pthread_getaffinity_np
     </code>
     () to check the
      resulting CPU affinity mask of the thread.
    </p>
    <div class="informalexample">
     <pre class="programlisting" xml:space="preserve">
#define _GNU_SOURCE
#include &lt;pthread.h&gt;
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;errno.h&gt;

#define handle_error_en(en, msg) \
        do { errno = en; perror(msg); exit(EXIT_FAILURE); } while (0)

int
main(int argc, char *argv[])
{
    int s, j;
    cpu_set_t cpuset;
    pthread_t thread;

    thread = pthread_self();

    /* Set affinity mask to include CPUs 0 to 7 */

    CPU_ZERO(&amp;cpuset);
    for (j = 0; j &lt; 8; j++)
        CPU_SET(j, &amp;cpuset);

    s = pthread_setaffinity_np(thread, sizeof(cpu_set_t), &amp;cpuset);
    if (s != 0)
        handle_error_en(s, "pthread_setaffinity_np");

    /* Check the actual affinity mask assigned to the thread */

    s = pthread_getaffinity_np(thread, sizeof(cpu_set_t), &amp;cpuset);
    if (s != 0)
        handle_error_en(s, "pthread_getaffinity_np");

    printf("Set returned by pthread_getaffinity_np() contained:\n");
    for (j = 0; j &lt; CPU_SETSIZE; j++)
        if (CPU_ISSET(j, &amp;cpuset))
            printf("    CPU %d\n", j);

    exit(EXIT_SUCCESS);
}
</pre>
    </div>
   </div>
   <div class="refsect1">
    <a id="pthread-setaffinity-np-3_sect10" name="pthread-setaffinity-np-3_sect10" shape="rect">
    </a>
    <h2>
     SEE ALSO
    </h2>
    <p>
     <a class="link" href="../htmlman2/sched_setaffinity.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        sched_setaffinity
       </span>
       (2)
      </span>
     </a>
     ,
     <a class="link" href="../htmlman3/pthread_attr_setaffinity_np.3.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        pthread_attr_setaffinity_np
       </span>
       (3)
      </span>
     </a>
     ,
     <a class="link" href="../htmlman3/pthread_self.3.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        pthread_self
       </span>
       (3)
      </span>
     </a>
     ,
     <a class="link" href="../htmlman3/sched_getcpu.3.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        sched_getcpu
       </span>
       (3)
      </span>
     </a>
     ,
     <a class="link" href="../htmlman7/cpuset.7.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        cpuset
       </span>
       (7)
      </span>
     </a>
     ,
     <a class="link" href="../htmlman7/pthreads.7.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        pthreads
       </span>
       (7)
      </span>
     </a>
     ,
     <a class="link" href="../htmlman7/sched.7.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        sched
       </span>
       (7)
      </span>
     </a>
    </p>
   </div>
   <div class="colophon">
    <a id="pthread-setaffinity-np-3_sect11" name="pthread-setaffinity-np-3_sect11" shape="rect">
    </a>
    <h2>
     COLOPHON
    </h2>
    <p>
     This page is part of release 3.72 of the Linux
     <em class="replaceable">
      <code>
       man-pages
      </code>
     </em>
     project. A
      description of the project, information about reporting bugs,
      and the latest version of this page, can be found at
      http://www.kernel.org/doc/man&minus;pages/.
    </p>
   </div>
  </div>
 </body>
</html>
