<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
  <title>
   fmtmsg(3) &mdash; Linux manual pages
  </title>
  <link href="../stylesheet/manpages.css" rel="stylesheet" type="text/css"/>
  <link href="../index.html" rel="home" title="fmtmsg(3) &mdash; Linux manual pages"/>
  <script src="../stylesheet/manpages.js" type="text/javascript" xml:space="preserve">
  </script>
  <link href="../stylesheet/icon.gif" rel="icon" type="image/gif"/>
 </head>
 <body>
  <div class="refentry">
   <a id="fmtmsg.3" name="fmtmsg.3" shape="rect">
   </a>
   <div class="titlepage">
   </div>
   <div class="refnamediv">
    <h2>
     Name
    </h2>
    <p>
     fmtmsg &mdash; print formatted error messages
    </p>
   </div>
   <div class="refsynopsisdiv">
    <h2>
     Synopsis
    </h2>
    <div class="funcsynopsis">
     <pre class="funcsynopsisinfo" xml:space="preserve">
#include &lt;fmtmsg.h&gt;
</pre>
     <table border="0" class="funcprototype-table" style="cellspacing: 0; cellpadding: 0;" summary="Function synopsis">
      <tr>
       <td colspan="1" rowspan="1">
        <code class="funcdef">
         int
         <strong>
          fmtmsg
         </strong>
         (
        </code>
       </td>
       <td colspan="1" rowspan="1">
        long
        <var class="pdparam">
         classification
        </var>
        ,
       </td>
      </tr>
      <tr>
       <td colspan="1" rowspan="1">
        &nbsp;
       </td>
       <td colspan="1" rowspan="1">
        const char *
        <var class="pdparam">
         label
        </var>
        ,
       </td>
      </tr>
      <tr>
       <td colspan="1" rowspan="1">
        &nbsp;
       </td>
       <td colspan="1" rowspan="1">
        int
        <var class="pdparam">
         severity
        </var>
        ,
       </td>
      </tr>
      <tr>
       <td colspan="1" rowspan="1">
        &nbsp;
       </td>
       <td colspan="1" rowspan="1">
        const char *
        <var class="pdparam">
         text
        </var>
        ,
       </td>
      </tr>
      <tr>
       <td colspan="1" rowspan="1">
        &nbsp;
       </td>
       <td colspan="1" rowspan="1">
        const char *
        <var class="pdparam">
         action
        </var>
        ,
       </td>
      </tr>
      <tr>
       <td colspan="1" rowspan="1">
        &nbsp;
       </td>
       <td colspan="1" rowspan="1">
        const char *
        <var class="pdparam">
         tag
        </var>
        <code>
         )
        </code>
        ;
       </td>
      </tr>
     </table>
     <div class="funcprototype-spacer">
      &nbsp;
     </div>
    </div>
   </div>
   <div class="refsect1">
    <a id="fmtmsg-3_sect1" name="fmtmsg-3_sect1" shape="rect">
    </a>
    <h2>
     DESCRIPTION
    </h2>
    <p>
     This function displays a message described by its
      arguments on the device(s) specified in the
     <em class="parameter">
      <code>
       classification
      </code>
     </em>
     argument. For
      messages written to
     <code class="varname">
      stderr
     </code>
     , the
      format depends on the
     <code class="constant">
      MSGVERB
     </code>
     environment variable.
    </p>
    <p>
     The
     <em class="parameter">
      <code>
       label
      </code>
     </em>
     argument
      identifies the source of the message. The string must consist
      of two colon separated parts where the first part has not
      more than 10 and the second part not more than 14
      characters.
    </p>
    <p>
     The
     <em class="parameter">
      <code>
       text
      </code>
     </em>
     argument
      describes the condition of the error.
    </p>
    <p>
     The
     <em class="parameter">
      <code>
       action
      </code>
     </em>
     argument describes possible steps to recover from the error.
      If it is printed, it is prefixed by "TO FIX: ".
    </p>
    <p>
     The
     <em class="parameter">
      <code>
       tag
      </code>
     </em>
     argument
      is a reference to the online documentation where more
      information can be found. It should contain the
     <em class="parameter">
      <code>
       label
      </code>
     </em>
     value and a unique
      identification number.
    </p>
    <div class="refsect2">
     <a id="fmtmsg-3_sect2" name="fmtmsg-3_sect2" shape="rect">
     </a>
     <h3>
      Dummy arguments
     </h3>
     <p>
      Each of the arguments can have a dummy value. The dummy
        classification value
      <code class="constant">
       MM_NULLMC
      </code>
      (0L) does not specify any
        output, so nothing is printed. The dummy severity value
      <code class="constant">
       NO_SEV
      </code>
      (0) says that no
        severity is supplied. The values
      <code class="constant">
       MM_NULLLBL
      </code>
      ,
      <code class="constant">
       MM_NULLTXT
      </code>
      ,
      <code class="constant">
       MM_NULLACT
      </code>
      ,
      <code class="constant">
       MM_NULLTAG
      </code>
      are synonyms for
      <span class="emphasis">
       <em>
        ((char *) 0)
       </em>
      </span>
      , the empty string,
        and
      <code class="constant">
       MM_NULLSEV
      </code>
      is a synonym
        for
      <code class="constant">
       NO_SEV
      </code>
      .
     </p>
    </div>
    <div class="refsect2">
     <a id="fmtmsg-3_sect3" name="fmtmsg-3_sect3" shape="rect">
     </a>
     <h3>
      The classification argument
     </h3>
     <p>
      The
      <em class="parameter">
       <code>
        classification
       </code>
      </em>
     </p>
     <div class="informalexample">
      <pre class="programlisting" xml:space="preserve">
argument is the sum of values describing 4 types of information.
</pre>
     </div>
     <p>
      The first value defines the output channel.
     </p>
     <div class="variablelist">
      <dl class="variablelist">
       <dt>
        <span class="term">
         <code class="constant">
          MM_PRINT
         </code>
        </span>
       </dt>
       <dd>
        <p>
         Output to
         <code class="varname">
          stderr
         </code>
         .
        </p>
       </dd>
       <dt>
        <span class="term">
         <code class="constant">
          MM_CONSOLE
         </code>
        </span>
       </dt>
       <dd>
        <p>
         Output to the system console.
        </p>
       </dd>
       <dt>
        <span class="term">
         <span class="emphasis">
          <em>
           MM_PRINT |
            MM_CONSOLE
          </em>
         </span>
        </span>
       </dt>
       <dd>
        <p>
         Output to both.
        </p>
       </dd>
      </dl>
     </div>
     <p>
      The second value is the source of the error:
     </p>
     <div class="variablelist">
      <dl class="variablelist">
       <dt>
        <span class="term">
         <code class="constant">
          MM_HARD
         </code>
        </span>
       </dt>
       <dd>
        <p>
         A hardware error occurred.
        </p>
       </dd>
       <dt>
        <span class="term">
         <code class="constant">
          MM_FIRM
         </code>
        </span>
       </dt>
       <dd>
        <p>
         A firmware error occurred.
        </p>
       </dd>
       <dt>
        <span class="term">
         <code class="constant">
          MM_SOFT
         </code>
        </span>
       </dt>
       <dd>
        <p>
         A software error occurred.
        </p>
       </dd>
      </dl>
     </div>
     <p>
      The third value encodes the detector of the problem:
     </p>
     <div class="variablelist">
      <dl class="variablelist">
       <dt>
        <span class="term">
         <code class="constant">
          MM_APPL
         </code>
        </span>
       </dt>
       <dd>
        <p>
         It is detected by an application.
        </p>
       </dd>
       <dt>
        <span class="term">
         <code class="constant">
          MM_UTIL
         </code>
        </span>
       </dt>
       <dd>
        <p>
         It is detected by a utility.
        </p>
       </dd>
       <dt>
        <span class="term">
         <code class="constant">
          MM_OPSYS
         </code>
        </span>
       </dt>
       <dd>
        <p>
         It is detected by the operating system.
        </p>
       </dd>
      </dl>
     </div>
     <p>
      The fourth value shows the severity of the incident:
     </p>
     <div class="variablelist">
      <dl class="variablelist">
       <dt>
        <span class="term">
         <code class="constant">
          MM_RECOVER
         </code>
        </span>
       </dt>
       <dd>
        <p>
         It is a recoverable error.
        </p>
       </dd>
       <dt>
        <span class="term">
         <code class="constant">
          MM_NRECOV
         </code>
        </span>
       </dt>
       <dd>
        <p>
         It is a nonrecoverable error.
        </p>
       </dd>
      </dl>
     </div>
    </div>
    <div class="refsect2">
     <a id="fmtmsg-3_sect4" name="fmtmsg-3_sect4" shape="rect">
     </a>
     <h3>
      The severity argument
     </h3>
     <p>
      The
      <em class="parameter">
       <code>
        severity
       </code>
      </em>
      argument can take one of the following values:
     </p>
     <div class="variablelist">
      <dl class="variablelist">
       <dt>
        <span class="term">
         <code class="constant">
          MM_NOSEV
         </code>
        </span>
       </dt>
       <dd>
        <p>
         No severity is printed.
        </p>
       </dd>
       <dt>
        <span class="term">
         <code class="constant">
          MM_HALT
         </code>
        </span>
       </dt>
       <dd>
        <p>
         This value is printed as HALT.
        </p>
       </dd>
       <dt>
        <span class="term">
         <code class="constant">
          MM_ERROR
         </code>
        </span>
       </dt>
       <dd>
        <p>
         This value is printed as ERROR.
        </p>
       </dd>
       <dt>
        <span class="term">
         <code class="constant">
          MM_WARNING
         </code>
        </span>
       </dt>
       <dd>
        <p>
         This value is printed as WARNING.
        </p>
       </dd>
       <dt>
        <span class="term">
         <code class="constant">
          MM_INFO
         </code>
        </span>
       </dt>
       <dd>
        <p>
         This value is printed as INFO.
        </p>
       </dd>
      </dl>
     </div>
     <p>
      The numeric values are between 0 and 4. Using
      <a class="link" href="../htmlman3/addseverity.3.html" shape="rect" target="_top">
       <span class="citerefentry">
        <span class="refentrytitle">
         addseverity
        </span>
        (3)
       </span>
      </a>
      or the
        environment variable
      <code class="constant">
       SEV_LEVEL
      </code>
      you can add more levels and
        strings to print.
     </p>
    </div>
   </div>
   <div class="refsect1">
    <a id="fmtmsg-3_sect5" name="fmtmsg-3_sect5" shape="rect">
    </a>
    <h2>
     RETURN VALUE
    </h2>
    <p>
     The function can return 4 values:
    </p>
    <div class="variablelist">
     <dl class="variablelist">
      <dt>
       <span class="term">
        <code class="constant">
         MM_OK
        </code>
       </span>
      </dt>
      <dd>
       <p>
        Everything went smooth.
       </p>
      </dd>
      <dt>
       <span class="term">
        <code class="constant">
         MM_NOTOK
        </code>
       </span>
      </dt>
      <dd>
       <p>
        Complete failure.
       </p>
      </dd>
      <dt>
       <span class="term">
        <code class="constant">
         MM_NOMSG
        </code>
       </span>
      </dt>
      <dd>
       <p>
        Error writing to
        <code class="varname">
         stderr
        </code>
        .
       </p>
      </dd>
      <dt>
       <span class="term">
        <code class="constant">
         MM_NOCON
        </code>
       </span>
      </dt>
      <dd>
       <p>
        Error writing to the console.
       </p>
      </dd>
     </dl>
    </div>
   </div>
   <div class="refsect1">
    <a id="fmtmsg-3_sect6" name="fmtmsg-3_sect6" shape="rect">
    </a>
    <h2>
     ENVIRONMENT
    </h2>
    <p>
     The environment variable
     <code class="constant">
      MSGVERB
     </code>
     ("message verbosity") can be used
      to suppress parts of the output to
     <code class="varname">
      stderr
     </code>
     . (It does not influence output to the
      console.) When this variable is defined, is non-NULL, and is
      a colon-separated list of valid keywords, then only the parts
      of the message corresponding to these keywords is printed.
      Valid keywords are "label", "severity", "text", "action" and
      "tag".
    </p>
    <p>
     The environment variable
     <code class="constant">
      SEV_LEVEL
     </code>
     can be used to introduce new
      severity levels. By default, only the five severity levels
      described above are available. Any other numeric value would
      make
     <code class="function">
      fmtmsg
     </code>
     () print nothing. If
      the user puts
     <code class="constant">
      SEV_LEVEL
     </code>
     with a
      format like
    </p>
    <div class="blockquote">
     <blockquote class="blockquote">
      <p>
       SEV_LEVEL=[description[:description[:...]]]
      </p>
     </blockquote>
    </div>
    <p>
     in the environment of the process before the first call to
     <code class="function">
      fmtmsg
     </code>
     (), where each
      description is of the form
    </p>
    <div class="blockquote">
     <blockquote class="blockquote">
      <p>
       severity-keyword,level,printstring
      </p>
     </blockquote>
    </div>
    <p>
     then
     <code class="function">
      fmtmsg
     </code>
     () will also
      accept the indicated values for the level (in addition to the
      standard levels 0-4), and use the indicated printstring when
      such a level occurs.
    </p>
    <p>
     The severity-keyword part is not used by
     <code class="function">
      fmtmsg
     </code>
     () but it has to be present. The
      level part is a string representation of a number. The
      numeric value must be a number greater than 4. This value
      must be used in the severity argument of
     <code class="function">
      fmtmsg
     </code>
     () to select this class. It is not
      possible to overwrite any of the predefined classes. The
      printstring is the string printed when a message of this
      class is processed by
     <code class="function">
      fmtmsg
     </code>
     ().
    </p>
   </div>
   <div class="refsect1">
    <a id="fmtmsg-3_sect7" name="fmtmsg-3_sect7" shape="rect">
    </a>
    <h2>
     VERSIONS
    </h2>
    <p>
     <code class="function">
      fmtmsg
     </code>
     () is provided in
      glibc since version 2.1.
    </p>
   </div>
   <div class="refsect1">
    <a id="fmtmsg-3_sect8" name="fmtmsg-3_sect8" shape="rect">
    </a>
    <h2>
     ATTRIBUTES
    </h2>
    <div class="refsect2">
     <a id="fmtmsg-3_sect9" name="fmtmsg-3_sect9" shape="rect">
     </a>
     <h3>
      Multithreading (see pthreads(7))
     </h3>
     <p>
      Before glibc 2.16, the
      <code class="function">
       fmtmsg
      </code>
      () function uses a static variable
        that is not protected, so it is not thread-safe.
     </p>
     <p>
      Since glibc 2.16, the
      <code class="function">
       fmtmsg
      </code>
      () function uses a lock to protect
        the static variable, so it is thread-safe.
     </p>
    </div>
   </div>
   <div class="refsect1">
    <a id="fmtmsg-3_sect10" name="fmtmsg-3_sect10" shape="rect">
    </a>
    <h2>
     CONFORMING TO
    </h2>
    <p>
     The functions
     <code class="function">
      fmtmsg
     </code>
     () and
     <a class="link" href="../htmlman3/addseverity.3.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        addseverity
       </span>
       (3)
      </span>
     </a>
     , and
      environment variables
     <code class="constant">
      MSGVERB
     </code>
     and
     <code class="constant">
      SEV_LEVEL
     </code>
     come from System
      V. The function
     <code class="function">
      fmtmsg
     </code>
     () and
      the environment variable
     <code class="constant">
      MSGVERB
     </code>
     are described in POSIX.1-2001.
    </p>
   </div>
   <div class="refsect1">
    <a id="fmtmsg-3_sect11" name="fmtmsg-3_sect11" shape="rect">
    </a>
    <h2>
     NOTES
    </h2>
    <p>
     System V and UnixWare man pages tell us that these
      functions have been replaced by "pfmt() and addsev()" or by
      "pfmt(), vpfmt(), lfmt(), and vlfmt()", and will be removed
      later.
    </p>
   </div>
   <div class="refsect1">
    <a id="fmtmsg-3_sect12" name="fmtmsg-3_sect12" shape="rect">
    </a>
    <h2>
     EXAMPLE
    </h2>
    <div class="informalexample">
     <pre class="programlisting" xml:space="preserve">
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;fmtmsg.h&gt;

int
main(void)
{
    long class = MM_PRINT | MM_SOFT | MM_OPSYS | MM_RECOVER;
    int err;

    err = fmtmsg(class, "util&minus;linux:mount", MM_ERROR,
                "unknown mount option", "See mount(8).",
                "util&minus;linux:mount:017");
    switch (err) {
    case MM_OK:
        break;
    case MM_NOTOK:
        printf("Nothing printed\n");
        break;
    case MM_NOMSG:
        printf("Nothing printed to stderr\n");
        break;
    case MM_NOCON:
        printf("No console output\n");
        break;
    default:
        printf("Unknown error from fmtmsg()\n");
    }
    exit(EXIT_SUCCESS);
}
</pre>
    </div>
    <p>
     The output should be:
    </p>
    <div class="informalexample">
     <pre class="programlisting" xml:space="preserve">
    util&minus;linux:mount: ERROR: unknown mount option
    TO FIX: See mount(8).  util&minus;linux:mount:017
</pre>
    </div>
    <p>
     and after
    </p>
    <div class="informalexample">
     <pre class="programlisting" xml:space="preserve">
    MSGVERB=text:action; export MSGVERB
</pre>
    </div>
    <p>
     the output becomes:
    </p>
    <div class="informalexample">
     <pre class="programlisting" xml:space="preserve">
    unknown mount option
    TO FIX: See mount(8).
</pre>
    </div>
   </div>
   <div class="refsect1">
    <a id="fmtmsg-3_sect13" name="fmtmsg-3_sect13" shape="rect">
    </a>
    <h2>
     SEE ALSO
    </h2>
    <p>
     <a class="link" href="../htmlman3/addseverity.3.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        addseverity
       </span>
       (3)
      </span>
     </a>
     ,
     <a class="link" href="../htmlman3/perror.3.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        perror
       </span>
       (3)
      </span>
     </a>
    </p>
   </div>
   <div class="colophon">
    <a id="fmtmsg-3_sect14" name="fmtmsg-3_sect14" shape="rect">
    </a>
    <h2>
     COLOPHON
    </h2>
    <p>
     This page is part of release 3.72 of the Linux
     <em class="replaceable">
      <code>
       man-pages
      </code>
     </em>
     project. A
      description of the project, information about reporting bugs,
      and the latest version of this page, can be found at
      http://www.kernel.org/doc/man&minus;pages/.
    </p>
   </div>
  </div>
 </body>
</html>
