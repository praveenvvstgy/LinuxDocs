<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
  <title>
   stdarg(3) &mdash; Linux manual pages
  </title>
  <link href="../stylesheet/manpages.css" rel="stylesheet" type="text/css"/>
  <link href="../index.html" rel="home" title="stdarg(3) &mdash; Linux manual pages"/>
  <script src="../stylesheet/manpages.js" type="text/javascript" xml:space="preserve">
  </script>
  <link href="../stylesheet/icon.gif" rel="icon" type="image/gif"/>
 </head>
 <body>
  <div class="refentry">
   <a id="stdarg.3" name="stdarg.3" shape="rect">
   </a>
   <div class="titlepage">
   </div>
   <div class="refnamediv">
    <h2>
     Name
    </h2>
    <p>
     stdarg, va_start, va_arg, va_end, va_copy &mdash; variable
      argument lists
    </p>
   </div>
   <div class="refsynopsisdiv">
    <h2>
     Synopsis
    </h2>
    <div class="funcsynopsis">
     <pre class="funcsynopsisinfo" xml:space="preserve">
#include &lt;stdarg.h&gt;
</pre>
     <table border="0" class="funcprototype-table" style="cellspacing: 0; cellpadding: 0;" summary="Function synopsis">
      <tr>
       <td colspan="1" rowspan="1">
        <code class="funcdef">
         void
         <strong>
          va_start
         </strong>
         (
        </code>
       </td>
       <td colspan="1" rowspan="1">
        va_list
        <var class="pdparam">
         ap
        </var>
        ,
       </td>
      </tr>
      <tr>
       <td colspan="1" rowspan="1">
        &nbsp;
       </td>
       <td colspan="1" rowspan="1">
        <var class="pdparam">
         last
        </var>
        <code>
         )
        </code>
        ;
       </td>
      </tr>
     </table>
     <div class="funcprototype-spacer">
      &nbsp;
     </div>
    </div>
    <div class="funcsynopsis">
     <table border="0" class="funcprototype-table" style="cellspacing: 0; cellpadding: 0;" summary="Function synopsis">
      <tr>
       <td colspan="1" rowspan="1">
        <code class="funcdef">
         type
         <strong>
          va_arg
         </strong>
         (
        </code>
       </td>
       <td colspan="1" rowspan="1">
        va_list
        <var class="pdparam">
         ap
        </var>
        ,
       </td>
      </tr>
      <tr>
       <td colspan="1" rowspan="1">
        &nbsp;
       </td>
       <td colspan="1" rowspan="1">
        <var class="pdparam">
         type
        </var>
        <code>
         )
        </code>
        ;
       </td>
      </tr>
     </table>
     <div class="funcprototype-spacer">
      &nbsp;
     </div>
    </div>
    <div class="funcsynopsis">
     <table border="0" class="funcprototype-table" style="cellspacing: 0; cellpadding: 0;" summary="Function synopsis">
      <tr>
       <td colspan="1" rowspan="1">
        <code class="funcdef">
         void
         <strong>
          va_end
         </strong>
         (
        </code>
       </td>
       <td colspan="1" rowspan="1">
        va_list
        <var class="pdparam">
         ap
        </var>
        <code>
         )
        </code>
        ;
       </td>
      </tr>
     </table>
     <div class="funcprototype-spacer">
      &nbsp;
     </div>
    </div>
    <div class="funcsynopsis">
     <table border="0" class="funcprototype-table" style="cellspacing: 0; cellpadding: 0;" summary="Function synopsis">
      <tr>
       <td colspan="1" rowspan="1">
        <code class="funcdef">
         void
         <strong>
          va_copy
         </strong>
         (
        </code>
       </td>
       <td colspan="1" rowspan="1">
        va_list
        <var class="pdparam">
         dest
        </var>
        ,
       </td>
      </tr>
      <tr>
       <td colspan="1" rowspan="1">
        &nbsp;
       </td>
       <td colspan="1" rowspan="1">
        va_list
        <var class="pdparam">
         src
        </var>
        <code>
         )
        </code>
        ;
       </td>
      </tr>
     </table>
     <div class="funcprototype-spacer">
      &nbsp;
     </div>
    </div>
   </div>
   <div class="refsect1">
    <a id="stdarg-3_sect1" name="stdarg-3_sect1" shape="rect">
    </a>
    <h2>
     DESCRIPTION
    </h2>
    <p>
     A function may be called with a varying number of
      arguments of varying types. The include file
     <code class="literal">
      &lt;
     </code>
     <code class="filename">
      stdarg.h
     </code>
     <code class="literal">
      &gt;
     </code>
     declares a type
     <span class="type">
      va_list
     </span>
     and defines
      three macros for stepping through a list of arguments whose
      number and types are not known to the called function.
    </p>
    <p>
     The called function must declare an object of type
     <span class="type">
      va_list
     </span>
     which is used by the macros
     <code class="function">
      va_start
     </code>
     (),
     <code class="function">
      va_arg
     </code>
     (), and
     <code class="function">
      va_end
     </code>
     ().
    </p>
    <div class="refsect2">
     <a id="stdarg-3_sect2" name="stdarg-3_sect2" shape="rect">
     </a>
     <h3>
      va_start()
     </h3>
     <p>
      The
      <code class="function">
       va_start
      </code>
      () macro
        initializes
      <em class="parameter">
       <code>
        ap
       </code>
      </em>
      for
        subsequent use by
      <code class="function">
       va_arg
      </code>
      ()
        and
      <code class="function">
       va_end
      </code>
      (), and must be
        called first.
     </p>
     <p>
      The argument
      <em class="parameter">
       <code>
        last
       </code>
      </em>
      is the name of the last
        argument before the variable argument list, that is, the
        last argument of which the calling function knows the
        type.
     </p>
     <p>
      Because the address of this argument may be used in the
      <code class="function">
       va_start
      </code>
      () macro, it should
        not be declared as a register variable, or as a function or
        an array type.
     </p>
    </div>
    <div class="refsect2">
     <a id="stdarg-3_sect3" name="stdarg-3_sect3" shape="rect">
     </a>
     <h3>
      va_arg()
     </h3>
     <p>
      The
      <code class="function">
       va_arg
      </code>
      () macro expands
        to an expression that has the type and value of the next
        argument in the call. The argument
      <em class="parameter">
       <code>
        ap
       </code>
      </em>
      is the
      <span class="type">
       va_list
      </span>
      <em class="parameter">
       <code>
        ap
       </code>
      </em>
      initialized by
      <code class="function">
       va_start
      </code>
      (). Each call to
      <code class="function">
       va_arg
      </code>
      () modifies
      <em class="parameter">
       <code>
        ap
       </code>
      </em>
      so that the next call
        returns the next argument. The argument
      <em class="parameter">
       <code>
        type
       </code>
      </em>
      is a type name specified
        so that the type of a pointer to an object that has the
        specified type can be obtained simply by adding a * to
      <em class="parameter">
       <code>
        type
       </code>
      </em>
      .
     </p>
     <p>
      The first use of the
      <code class="function">
       va_arg
      </code>
      () macro after that of the
      <code class="function">
       va_start
      </code>
      () macro returns the
        argument after
      <em class="parameter">
       <code>
        last
       </code>
      </em>
      . Successive invocations
        return the values of the remaining arguments.
     </p>
     <p>
      If there is no next argument, or if
      <em class="parameter">
       <code>
        type
       </code>
      </em>
      is not compatible with
        the type of the actual next argument (as promoted according
        to the default argument promotions), random errors will
        occur.
     </p>
     <p>
      If
      <em class="parameter">
       <code>
        ap
       </code>
      </em>
      is passed
        to a function that uses
      <em class="replaceable">
       <code>
        va_arg(
       </code>
      </em>
      <em class="parameter">
       <code>
        ap
       </code>
      </em>
      ,
      <em class="parameter">
       <code>
        type
       </code>
      </em>
      ), then the value of
      <em class="parameter">
       <code>
        ap
       </code>
      </em>
      is undefined
        after the return of that function.
     </p>
    </div>
    <div class="refsect2">
     <a id="stdarg-3_sect4" name="stdarg-3_sect4" shape="rect">
     </a>
     <h3>
      va_end()
     </h3>
     <p>
      Each invocation of
      <code class="function">
       va_start
      </code>
      () must be matched by a
        corresponding invocation of
      <code class="function">
       va_end
      </code>
      () in the same function. After the
        call
      <code class="function">
       va_end
      </code>
      (
      <em class="parameter">
       <code>
        ap
       </code>
      </em>
      ) the variable
      <em class="parameter">
       <code>
        ap
       </code>
      </em>
      is undefined. Multiple
        traversals of the list, each bracketed by
      <code class="function">
       va_start
      </code>
      () and
      <code class="function">
       va_end
      </code>
      () are possible.
      <code class="function">
       va_end
      </code>
      () may be a macro or a
        function.
     </p>
    </div>
    <div class="refsect2">
     <a id="stdarg-3_sect5" name="stdarg-3_sect5" shape="rect">
     </a>
     <h3>
      va_copy()
     </h3>
     <p>
      The
      <code class="function">
       va_copy
      </code>
      () macro copies
        the (previously initialized) variable argument list
      <em class="parameter">
       <code>
        src
       </code>
      </em>
      to
      <em class="parameter">
       <code>
        dest
       </code>
      </em>
      . The behavior is as if
      <code class="function">
       va_start
      </code>
      () were applied to
      <em class="parameter">
       <code>
        dest
       </code>
      </em>
      with the same
      <em class="parameter">
       <code>
        last
       </code>
      </em>
      argument,
        followed by the same number of
      <code class="function">
       va_arg
      </code>
      () invocations that was used to
        reach the current state of
      <em class="parameter">
       <code>
        src
       </code>
      </em>
      .
     </p>
     <p>
      An obvious implementation would have a
      <span class="type">
       va_list
      </span>
      be a pointer to the stack frame of
        the variadic function. In such a setup (by far the most
        common) there seems nothing against an assignment
     </p>
     <div class="blockquote">
      <blockquote class="blockquote">
       <div class="informalexample">
        <pre class="programlisting" xml:space="preserve">
va_list aq = ap;
</pre>
       </div>
      </blockquote>
     </div>
     <p>
      Unfortunately, there are also systems that make it an
        array of pointers (of length 1), and there one needs
     </p>
     <div class="blockquote">
      <blockquote class="blockquote">
       <div class="informalexample">
        <pre class="programlisting" xml:space="preserve">
va_list aq;
*aq = *ap;
</pre>
       </div>
      </blockquote>
     </div>
     <p>
      Finally, on systems where arguments are passed in
        registers, it may be necessary for
      <code class="function">
       va_start
      </code>
      () to allocate memory, store the
        arguments there, and also an indication of which argument
        is next, so that
      <code class="function">
       va_arg
      </code>
      () can
        step through the list. Now
      <code class="function">
       va_end
      </code>
      () can free the allocated memory
        again. To accommodate this situation, C99 adds a macro
      <code class="function">
       va_copy
      </code>
      (), so that the above
        assignment can be replaced by
     </p>
     <div class="blockquote">
      <blockquote class="blockquote">
       <div class="informalexample">
        <pre class="programlisting" xml:space="preserve">
va_list aq;
va_copy(aq, ap);
...
va_end(aq);
</pre>
       </div>
      </blockquote>
     </div>
     <p>
      Each invocation of
      <code class="function">
       va_copy
      </code>
      () must be matched by a
        corresponding invocation of
      <code class="function">
       va_end
      </code>
      () in the same function. Some
        systems that do not supply
      <code class="function">
       va_copy
      </code>
      () have
      <code class="function">
       __va_copy
      </code>
      instead, since that was the
        name used in the draft proposal.
     </p>
    </div>
   </div>
   <div class="refsect1">
    <a id="stdarg-3_sect6" name="stdarg-3_sect6" shape="rect">
    </a>
    <h2>
     ATTRIBUTES
    </h2>
    <div class="refsect2">
     <a id="stdarg-3_sect7" name="stdarg-3_sect7" shape="rect">
     </a>
     <h3>
      Multithreading (see pthreads(7))
     </h3>
     <p>
      The
      <code class="function">
       va_start
      </code>
      (),
      <code class="function">
       va_arg
      </code>
      (),
      <code class="function">
       va_end
      </code>
      (), and
      <code class="function">
       va_copy
      </code>
      () macros are thread-safe.
     </p>
    </div>
   </div>
   <div class="refsect1">
    <a id="stdarg-3_sect8" name="stdarg-3_sect8" shape="rect">
    </a>
    <h2>
     CONFORMING TO
    </h2>
    <p>
     The
     <code class="function">
      va_start
     </code>
     (),
     <code class="function">
      va_arg
     </code>
     (), and
     <code class="function">
      va_end
     </code>
     () macros conform to C89. C99 defines
      the
     <code class="function">
      va_copy
     </code>
     () macro.
    </p>
   </div>
   <div class="refsect1">
    <a id="stdarg-3_sect9" name="stdarg-3_sect9" shape="rect">
    </a>
    <h2>
     NOTES
    </h2>
    <p>
     These macros are
     <span class="emphasis">
      <em>
       not
      </em>
     </span>
     compatible with the historic
      macros they replace. A backward-compatible version can be
      found in the include file
     <code class="literal">
      &lt;
     </code>
     <code class="filename">
      varargs.h
     </code>
     <code class="literal">
      &gt;
     </code>
    </p>
    <p>
     The historic setup is:
    </p>
    <div class="blockquote">
     <blockquote class="blockquote">
      <div class="informalexample">
       <pre class="programlisting" xml:space="preserve">
#include &lt;varargs.h&gt;

void
foo(va_alist)
    va_dcl
{
    va_list ap;

    va_start(ap);
    while (...) {
        ...
        x = va_arg(ap, type);
        ...
    }
    va_end(ap);
}
</pre>
      </div>
     </blockquote>
    </div>
    <p>
     On some systems,
     <code class="function">
      va_end
     </code>
     contains a closing '}' matching a '{' in
     <code class="function">
      va_start
     </code>
     , so that both macros must occur in
      the same function, and in a way that allows this.
    </p>
   </div>
   <div class="refsect1">
    <a id="stdarg-3_sect10" name="stdarg-3_sect10" shape="rect">
    </a>
    <h2>
     BUGS
    </h2>
    <p>
     Unlike the
     <code class="function">
      varargs
     </code>
     macros,
      the
     <code class="function">
      stdarg
     </code>
     macros do not permit
      programmers to code a function with no fixed arguments. This
      problem generates work mainly when converting
     <code class="function">
      varargs
     </code>
     code to
     <code class="function">
      stdarg
     </code>
     code, but it also creates
      difficulties for variadic functions that wish to pass all of
      their arguments on to a function that takes a
     <span class="type">
      va_list
     </span>
     argument, such as
     <a class="link" href="../htmlman3/printf.3.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        vfprintf
       </span>
       (3)
      </span>
     </a>
     .
    </p>
   </div>
   <div class="refsect1">
    <a id="stdarg-3_sect11" name="stdarg-3_sect11" shape="rect">
    </a>
    <h2>
     EXAMPLE
    </h2>
    <p>
     The function
     <code class="function">
      foo
     </code>
     takes a
      string of format characters and prints out the argument
      associated with each format character based on the type.
    </p>
    <div class="informalexample">
     <pre class="programlisting" xml:space="preserve">
#include &lt;stdio.h&gt;
#include &lt;stdarg.h&gt;

void
foo(char *fmt, ...)
{
    va_list ap;
    int d;
    char c, *s;

    va_start(ap, fmt);
    while (*fmt)
        switch (*fmt++) {
        case 's':              /* string */
            s = va_arg(ap, char *);
            printf("string %s\n", s);
            break;
        case 'd':              /* int */
            d = va_arg(ap, int);
            printf("int %d\n", d);
            break;
        case 'c':              /* char */
            /* need a cast here since va_arg only
               takes fully promoted types */
            c = (char) va_arg(ap, int);
            printf("char %c\n", c);
            break;
        }
    va_end(ap);
}
</pre>
    </div>
   </div>
   <div class="colophon">
    <a id="stdarg-3_sect12" name="stdarg-3_sect12" shape="rect">
    </a>
    <h2>
     COLOPHON
    </h2>
    <p>
     This page is part of release 3.72 of the Linux
     <em class="replaceable">
      <code>
       man-pages
      </code>
     </em>
     project. A
      description of the project, information about reporting bugs,
      and the latest version of this page, can be found at
      http://www.kernel.org/doc/man&minus;pages/.
    </p>
   </div>
  </div>
 </body>
</html>
