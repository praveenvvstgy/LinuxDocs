<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
  <title>
   getutent(3) &mdash; Linux manual pages
  </title>
  <link href="../stylesheet/manpages.css" rel="stylesheet" type="text/css"/>
  <link href="../index.html" rel="home" title="getutent(3) &mdash; Linux manual pages"/>
  <script src="../stylesheet/manpages.js" type="text/javascript" xml:space="preserve">
  </script>
  <link href="../stylesheet/icon.gif" rel="icon" type="image/gif"/>
 </head>
 <body>
  <div class="refentry">
   <a id="getutent.3" name="getutent.3" shape="rect">
   </a>
   <div class="titlepage">
   </div>
   <div class="refnamediv">
    <h2>
     Name
    </h2>
    <p>
     getutent, getutid, getutline, pututline, setutent,
      endutent, utmpname &mdash; access utmp file entries
    </p>
   </div>
   <div class="refsynopsisdiv">
    <h2>
     Synopsis
    </h2>
    <div class="funcsynopsis">
     <pre class="funcsynopsisinfo" xml:space="preserve">
#include &lt;utmp.h&gt;
</pre>
     <table border="0" class="funcprototype-table" style="cellspacing: 0; cellpadding: 0;" summary="Function synopsis">
      <tr>
       <td colspan="1" rowspan="1">
        <code class="funcdef">
         struct utmp
            *
         <strong>
          getutent
         </strong>
         (
        </code>
       </td>
       <td colspan="1" rowspan="1">
        <code>
         void)
        </code>
        ;
       </td>
       <td colspan="1" rowspan="1">
        &nbsp;
       </td>
      </tr>
     </table>
     <div class="funcprototype-spacer">
      &nbsp;
     </div>
    </div>
    <div class="funcsynopsis">
     <table border="0" class="funcprototype-table" style="cellspacing: 0; cellpadding: 0;" summary="Function synopsis">
      <tr>
       <td colspan="1" rowspan="1">
        <code class="funcdef">
         struct utmp
            *
         <strong>
          getutid
         </strong>
         (
        </code>
       </td>
       <td colspan="1" rowspan="1">
        const struct utmp *
        <var class="pdparam">
         ut
        </var>
        <code>
         )
        </code>
        ;
       </td>
      </tr>
     </table>
     <div class="funcprototype-spacer">
      &nbsp;
     </div>
    </div>
    <div class="funcsynopsis">
     <table border="0" class="funcprototype-table" style="cellspacing: 0; cellpadding: 0;" summary="Function synopsis">
      <tr>
       <td colspan="1" rowspan="1">
        <code class="funcdef">
         struct utmp
            *
         <strong>
          getutline
         </strong>
         (
        </code>
       </td>
       <td colspan="1" rowspan="1">
        const struct utmp *
        <var class="pdparam">
         ut
        </var>
        <code>
         )
        </code>
        ;
       </td>
      </tr>
     </table>
     <div class="funcprototype-spacer">
      &nbsp;
     </div>
    </div>
    <div class="funcsynopsis">
     <table border="0" class="funcprototype-table" style="cellspacing: 0; cellpadding: 0;" summary="Function synopsis">
      <tr>
       <td colspan="1" rowspan="1">
        <code class="funcdef">
         struct utmp
            *
         <strong>
          pututline
         </strong>
         (
        </code>
       </td>
       <td colspan="1" rowspan="1">
        const struct utmp *
        <var class="pdparam">
         ut
        </var>
        <code>
         )
        </code>
        ;
       </td>
      </tr>
     </table>
     <div class="funcprototype-spacer">
      &nbsp;
     </div>
    </div>
    <div class="funcsynopsis">
     <table border="0" class="funcprototype-table" style="cellspacing: 0; cellpadding: 0;" summary="Function synopsis">
      <tr>
       <td colspan="1" rowspan="1">
        <code class="funcdef">
         void
         <strong>
          setutent
         </strong>
         (
        </code>
       </td>
       <td colspan="1" rowspan="1">
        <code>
         void)
        </code>
        ;
       </td>
       <td colspan="1" rowspan="1">
        &nbsp;
       </td>
      </tr>
     </table>
     <div class="funcprototype-spacer">
      &nbsp;
     </div>
    </div>
    <div class="funcsynopsis">
     <table border="0" class="funcprototype-table" style="cellspacing: 0; cellpadding: 0;" summary="Function synopsis">
      <tr>
       <td colspan="1" rowspan="1">
        <code class="funcdef">
         void
         <strong>
          endutent
         </strong>
         (
        </code>
       </td>
       <td colspan="1" rowspan="1">
        <code>
         void)
        </code>
        ;
       </td>
       <td colspan="1" rowspan="1">
        &nbsp;
       </td>
      </tr>
     </table>
     <div class="funcprototype-spacer">
      &nbsp;
     </div>
    </div>
    <div class="funcsynopsis">
     <table border="0" class="funcprototype-table" style="cellspacing: 0; cellpadding: 0;" summary="Function synopsis">
      <tr>
       <td colspan="1" rowspan="1">
        <code class="funcdef">
         int
         <strong>
          utmpname
         </strong>
         (
        </code>
       </td>
       <td colspan="1" rowspan="1">
        const char *
        <var class="pdparam">
         file
        </var>
        <code>
         )
        </code>
        ;
       </td>
      </tr>
     </table>
     <div class="funcprototype-spacer">
      &nbsp;
     </div>
    </div>
   </div>
   <div class="refsect1">
    <a id="getutent-3_sect1" name="getutent-3_sect1" shape="rect">
    </a>
    <h2>
     DESCRIPTION
    </h2>
    <p>
     New applications should use the POSIX.1-specified "utmpx"
      versions of these functions; see CONFORMING TO.
    </p>
    <p>
     <code class="function">
      utmpname
     </code>
     () sets the name of
      the utmp-format file for the other utmp functions to access.
      If
     <code class="function">
      utmpname
     </code>
     () is not used to
      set the filename before the other functions are used, they
      assume
     <code class="constant">
      _PATH_UTMP
     </code>
     , as defined
      in
     <code class="literal">
      &lt;
     </code>
     <code class="filename">
      paths.h
     </code>
     <code class="literal">
      &gt;
     </code>
    </p>
    <p>
     <code class="function">
      setutent
     </code>
     () rewinds the file
      pointer to the beginning of the utmp file. It is generally a
      good idea to call it before any of the other functions.
    </p>
    <p>
     <code class="function">
      endutent
     </code>
     () closes the utmp
      file. It should be called when the user code is done
      accessing the file with the other functions.
    </p>
    <p>
     <code class="function">
      getutent
     </code>
     () reads a line from
      the current file position in the utmp file. It returns a
      pointer to a structure containing the fields of the line. The
      definition of this structure is shown in
     <a class="link" href="../htmlman5/utmp.5.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        utmp
       </span>
       (5)
      </span>
     </a>
     .
    </p>
    <p>
     <code class="function">
      getutid
     </code>
     () searches forward
      from the current file position in the utmp file based upon
     <em class="parameter">
      <code>
       ut
      </code>
     </em>
     . If
     <em class="replaceable">
      <code>
       ut&minus;&gt;ut_type
      </code>
     </em>
     is one
      of
     <code class="constant">
      RUN_LVL
     </code>
     ,
     <code class="constant">
      BOOT_TIME
     </code>
     ,
     <code class="constant">
      NEW_TIME
     </code>
     , or
     <code class="constant">
      OLD_TIME
     </code>
     ,
     <code class="function">
      getutid
     </code>
     () will find the first entry whose
     <code class="varname">
      ut_type
     </code>
     field matches
     <em class="replaceable">
      <code>
       ut&minus;&gt;ut_type
      </code>
     </em>
     . If
     <em class="replaceable">
      <code>
       ut&minus;&gt;ut_type
      </code>
     </em>
     is one
      of
     <code class="constant">
      INIT_PROCESS
     </code>
     ,
     <code class="constant">
      LOGIN_PROCESS
     </code>
     ,
     <code class="constant">
      USER_PROCESS
     </code>
     , or
     <code class="constant">
      DEAD_PROCESS
     </code>
     ,
     <code class="function">
      getutid
     </code>
     () will find the first entry whose
     <code class="function">
      ut_id
     </code>
     field matches
     <em class="replaceable">
      <code>
       ut&minus;&gt;ut_id
      </code>
     </em>
     .
    </p>
    <p>
     <code class="function">
      getutline
     </code>
     () searches forward
      from the current file position in the utmp file. It scans
      entries whose
     <code class="varname">
      ut_type
     </code>
     is
     <code class="constant">
      USER_PROCESS
     </code>
     or
     <code class="constant">
      LOGIN_PROCESS
     </code>
     and returns the first one
      whose
     <code class="function">
      ut_line
     </code>
     field matches
     <em class="replaceable">
      <code>
       ut&minus;&gt;ut_line
      </code>
     </em>
     .
    </p>
    <p>
     <code class="function">
      pututline
     </code>
     () writes the
     <span class="structname">
      utmp
     </span>
     structure
     <em class="parameter">
      <code>
       ut
      </code>
     </em>
     into the utmp file. It uses
     <code class="function">
      getutid
     </code>
     () to search for the
      proper place in the file to insert the new entry. If it
      cannot find an appropriate slot for
     <em class="parameter">
      <code>
       ut
      </code>
     </em>
     ,
     <code class="function">
      pututline
     </code>
     () will append the new entry to
      the end of the file.
    </p>
   </div>
   <div class="refsect1">
    <a id="getutent-3_sect2" name="getutent-3_sect2" shape="rect">
    </a>
    <h2>
     RETURN VALUE
    </h2>
    <p>
     <code class="function">
      getutent
     </code>
     (),
     <code class="function">
      getutid
     </code>
     (), and
     <code class="function">
      getutline
     </code>
     () return a pointer to a
     <span class="emphasis">
      <em>
       struct utmp
      </em>
     </span>
     on
      success, and NULL on failure (which includes the "record not
      found" case). This
     <span class="emphasis">
      <em>
       struct
      utmp
      </em>
     </span>
     is allocated in static storage, and may be
      overwritten by subsequent calls.
    </p>
    <p>
     On success
     <code class="function">
      pututline
     </code>
     ()
      returns
     <em class="parameter">
      <code>
       ut
      </code>
     </em>
     ; on
      failure, it returns NULL.
    </p>
    <p>
     <code class="function">
      utmpname
     </code>
     () returns 0 if the
      new name was successfully stored, or &minus;1 on failure.
    </p>
    <p>
     In the event of an error, these functions
     <code class="varname">
      errno
     </code>
     set to indicate the cause.
    </p>
   </div>
   <div class="refsect1">
    <a id="getutent-3_sect3" name="getutent-3_sect3" shape="rect">
    </a>
    <h2>
     ERRORS
    </h2>
    <div class="variablelist">
     <dl class="variablelist">
      <dt>
       <span class="term">
        <span class="errorname">
         ENOMEM
        </span>
       </span>
      </dt>
      <dd>
       <p>
        Out of memory.
       </p>
      </dd>
      <dt>
       <span class="term">
        <span class="errorname">
         ESRCH
        </span>
       </span>
      </dt>
      <dd>
       <p>
        Record not found.
       </p>
      </dd>
     </dl>
    </div>
    <p>
     <code class="function">
      setutent
     </code>
     (),
     <code class="function">
      pututline
     </code>
     (), and the
     <code class="function">
      getut*
     </code>
     () functions can also fail for the
      reasons described in
     <a class="link" href="../htmlman2/open.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        open
       </span>
       (2)
      </span>
     </a>
     .
    </p>
   </div>
   <div class="refsect1">
    <a id="getutent-3_sect4" name="getutent-3_sect4" shape="rect">
    </a>
    <h2>
     FILES
    </h2>
    <p>
     /var/run/utmp database of currently logged-in users
    </p>
    <p>
     /var/log/wtmp database of past user logins
    </p>
   </div>
   <div class="refsect1">
    <a id="getutent-3_sect5" name="getutent-3_sect5" shape="rect">
    </a>
    <h2>
     CONFORMING TO
    </h2>
    <p>
     XPG2, SVr4.
    </p>
    <p>
     In XPG2 and SVID 2 the function
     <code class="function">
      pututline
     </code>
     () is documented to return void,
      and that is what it does on many systems (AIX, HP-UX). HP-UX
      introduces a new function
     <code class="function">
      _pututline
     </code>
     () with the prototype given above
      for
     <code class="function">
      pututline
     </code>
     ().
    </p>
    <p>
     All these functions are obsolete now on non-Linux systems.
      POSIX.1-2001, following SUSv1, does not have any of these
      functions, but instead uses
    </p>
    <div class="informalexample">
     <pre class="programlisting" xml:space="preserve">
<span class="emphasis"><em>#include &lt;utmpx.h&gt;</em></span>

<span class="emphasis"><em>struct utmpx *getutxent(void);</em></span>
<span class="emphasis"><em>struct utmpx *getutxid(const struct utmpx *);</em></span>
<span class="emphasis"><em>struct utmpx *getutxline(const struct utmpx *);</em></span>
<span class="emphasis"><em>struct utmpx *pututxline(const struct utmpx *);</em></span>
<span class="emphasis"><em>void setutxent(void);</em></span>
</pre>
    </div>
    <p>
     <span class="emphasis">
      <em>
       void
      endutxent(void);
      </em>
     </span>
    </p>
    <p>
     These functions are provided by glibc, and perform the
      same task as their equivalents without the "x", but use
     <span class="emphasis">
      <em>
       struct utmpx
      </em>
     </span>
     , defined
      on Linux to be the same as
     <span class="emphasis">
      <em>
       struct
      utmp
      </em>
     </span>
     . For completeness, glibc also provides
     <code class="function">
      utmpxname
     </code>
     (), although this
      function is not specified by POSIX.1.
    </p>
    <p>
     On some other systems, the
     <span class="structname">
      utmpx
     </span>
     structure is a superset of the
     <span class="structname">
      utmp
     </span>
     structure, with
      additional fields, and larger versions of the existing
      fields, and parallel files are maintained, often
     <code class="filename">
      /var/*/utmpx
     </code>
     and
     <code class="filename">
      /var/*/wtmpx
     </code>
     .
    </p>
    <p>
     Linux glibc on the other hand does not use a parallel
     <span class="structname">
      utmpx
     </span>
     file since its
     <span class="structname">
      utmp
     </span>
     structure is already
      large enough. The "x" functions listed above are just aliases
      for their counterparts without the "x" (e.g.,
     <code class="function">
      getutxent
     </code>
     () is an alias for
     <code class="function">
      getutent
     </code>
     ()).
    </p>
   </div>
   <div class="refsect1">
    <a id="getutent-3_sect6" name="getutent-3_sect6" shape="rect">
    </a>
    <h2>
     NOTES
    </h2>
    <div class="refsect2">
     <a id="getutent-3_sect7" name="getutent-3_sect7" shape="rect">
     </a>
     <h3>
      Glibc notes
     </h3>
     <p>
      The above functions are not thread-safe. Glibc adds
        reentrant versions
     </p>
     <div class="informalexample">
      <pre class="programlisting" xml:space="preserve">
<span class="emphasis"><em>#define _GNU_SOURCE</em></span>    /* or _SVID_SOURCE or _BSD_SOURCE;
                           see <a class="link" href="../htmlman7/feature_test_macros.7.html" shape="rect" target="_top"><span class="citerefentry"><span class="refentrytitle">feature_test_macros</span>(7)</span></a> */
<span class="emphasis"><em>#include &lt;utmp.h&gt;</em></span>

  <code class="function">int getutent_r</code>(<em class="parameter"><code>struct utmp *ubuf</code></em>, <em class="parameter"><code>struct utmp **ubufp</code></em>);

  <code class="function">int getutid_r</code>(<em class="parameter"><code>struct utmp *ut</code></em>, <em class="parameter"><code>struct utmp *ubuf</code></em>, <em class="parameter"><code>struct utmp **ubufp</code></em>);

  <code class="function">int getutline_r</code>(<em class="parameter"><code>struct utmp *ut</code></em>, <em class="parameter"><code>struct utmp *ubuf</code></em>, <em class="parameter"><code>struct utmp **ubufp</code></em>);
</pre>
     </div>
     <p>
      These functions are GNU extensions, analogs of the
        functions of the same name without the _r suffix. The
      <em class="parameter">
       <code>
        ubuf
       </code>
      </em>
      argument gives
        these functions a place to store their result. On success
        they return 0, and a pointer to the result is written in
        *
      <em class="parameter">
       <code>
        ubufp
       </code>
      </em>
      . On error,
        these functions return &minus;1. There are no utmpx
        equivalents of the above functions. (POSIX.1 does not
        specify such functions.)
     </p>
    </div>
   </div>
   <div class="refsect1">
    <a id="getutent-3_sect8" name="getutent-3_sect8" shape="rect">
    </a>
    <h2>
     EXAMPLE
    </h2>
    <p>
     The following example adds and removes a utmp record,
      assuming it is run from within a pseudo terminal. For usage
      in a real application, you should check the return values of
     <a class="link" href="../htmlman3/getpwnam.3.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        getpwuid
       </span>
       (3)
      </span>
     </a>
     and
     <a class="link" href="../htmlman3/ttyname.3.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        ttyname
       </span>
       (3)
      </span>
     </a>
     .
    </p>
    <div class="informalexample">
     <pre class="programlisting" xml:space="preserve">
#include &lt;string.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;pwd.h&gt;
#include &lt;unistd.h&gt;
#include &lt;utmp.h&gt;

int
main(int argc, char *argv[])
{
    struct utmp entry;

    system("echo before adding entry:;who");

    entry.ut_type = USER_PROCESS;
    entry.ut_pid = getpid();
    strcpy(entry.ut_line, ttyname(STDIN_FILENO) + strlen("/dev/"));
    /* only correct for ptys named /dev/tty[pqr][0&minus;9a&minus;z] */
    strcpy(entry.ut_id, ttyname(STDIN_FILENO) + strlen("/dev/tty"));
    time(&amp;entry.ut_time);
    strcpy(entry.ut_user, getpwuid(getuid())&minus;&gt;pw_name);
    memset(entry.ut_host, 0, UT_HOSTSIZE);
    entry.ut_addr = 0;
    setutent();
    pututline(&amp;entry);

    system("echo after adding entry:;who");

    entry.ut_type = DEAD_PROCESS;
    memset(entry.ut_line, 0, UT_LINESIZE);
    entry.ut_time = 0;
    memset(entry.ut_user, 0, UT_NAMESIZE);
    setutent();
    pututline(&amp;entry);

    system("echo after removing entry:;who");

    endutent();
    exit(EXIT_SUCCESS);
}
</pre>
    </div>
   </div>
   <div class="refsect1">
    <a id="getutent-3_sect9" name="getutent-3_sect9" shape="rect">
    </a>
    <h2>
     SEE ALSO
    </h2>
    <p>
     <a class="link" href="../htmlman3/getutmp.3.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        getutmp
       </span>
       (3)
      </span>
     </a>
     ,
     <a class="link" href="../htmlman5/utmp.5.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        utmp
       </span>
       (5)
      </span>
     </a>
    </p>
   </div>
   <div class="colophon">
    <a id="getutent-3_sect10" name="getutent-3_sect10" shape="rect">
    </a>
    <h2>
     COLOPHON
    </h2>
    <p>
     This page is part of release 3.72 of the Linux
     <em class="replaceable">
      <code>
       man-pages
      </code>
     </em>
     project. A
      description of the project, information about reporting bugs,
      and the latest version of this page, can be found at
      http://www.kernel.org/doc/man&minus;pages/.
    </p>
   </div>
  </div>
 </body>
</html>
