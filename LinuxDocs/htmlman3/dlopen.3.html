<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
  <title>
   dlopen(3) &mdash; Linux manual pages
  </title>
  <link href="../stylesheet/manpages.css" rel="stylesheet" type="text/css"/>
  <link href="../index.html" rel="home" title="dlopen(3) &mdash; Linux manual pages"/>
  <script src="../stylesheet/manpages.js" type="text/javascript" xml:space="preserve">
  </script>
  <link href="../stylesheet/icon.gif" rel="icon" type="image/gif"/>
 </head>
 <body>
  <div class="refentry">
   <a id="dlopen.3" name="dlopen.3" shape="rect">
   </a>
   <div class="titlepage">
   </div>
   <div class="refnamediv">
    <h2>
     Name
    </h2>
    <p>
     dladdr, dlclose, dlerror, dlopen, dlsym, dlvsym &mdash;
      programming interface to dynamic linking loader
    </p>
   </div>
   <div class="refsynopsisdiv">
    <h2>
     Synopsis
    </h2>
    <div class="funcsynopsis">
     <pre class="funcsynopsisinfo" xml:space="preserve">
#include &lt;dlfcn.h&gt;
</pre>
     <table border="0" class="funcprototype-table" style="cellspacing: 0; cellpadding: 0;" summary="Function synopsis">
      <tr>
       <td colspan="1" rowspan="1">
        <code class="funcdef">
         void
            *
         <strong>
          dlopen
         </strong>
         (
        </code>
       </td>
       <td colspan="1" rowspan="1">
        const char *
        <var class="pdparam">
         filename
        </var>
        ,
       </td>
      </tr>
      <tr>
       <td colspan="1" rowspan="1">
        &nbsp;
       </td>
       <td colspan="1" rowspan="1">
        int
        <var class="pdparam">
         flag
        </var>
        <code>
         )
        </code>
        ;
       </td>
      </tr>
     </table>
     <div class="funcprototype-spacer">
      &nbsp;
     </div>
    </div>
    <div class="funcsynopsis">
     <table border="0" class="funcprototype-table" style="cellspacing: 0; cellpadding: 0;" summary="Function synopsis">
      <tr>
       <td colspan="1" rowspan="1">
        <code class="funcdef">
         char
            *
         <strong>
          dlerror
         </strong>
         (
        </code>
       </td>
       <td colspan="1" rowspan="1">
        <code>
         void)
        </code>
        ;
       </td>
       <td colspan="1" rowspan="1">
        &nbsp;
       </td>
      </tr>
     </table>
     <div class="funcprototype-spacer">
      &nbsp;
     </div>
    </div>
    <div class="funcsynopsis">
     <table border="0" class="funcprototype-table" style="cellspacing: 0; cellpadding: 0;" summary="Function synopsis">
      <tr>
       <td colspan="1" rowspan="1">
        <code class="funcdef">
         void
            *
         <strong>
          dlsym
         </strong>
         (
        </code>
       </td>
       <td colspan="1" rowspan="1">
        void *
        <var class="pdparam">
         handle
        </var>
        ,
       </td>
      </tr>
      <tr>
       <td colspan="1" rowspan="1">
        &nbsp;
       </td>
       <td colspan="1" rowspan="1">
        const char *
        <var class="pdparam">
         symbol
        </var>
        <code>
         )
        </code>
        ;
       </td>
      </tr>
     </table>
     <div class="funcprototype-spacer">
      &nbsp;
     </div>
    </div>
    <div class="funcsynopsis">
     <table border="0" class="funcprototype-table" style="cellspacing: 0; cellpadding: 0;" summary="Function synopsis">
      <tr>
       <td colspan="1" rowspan="1">
        <code class="funcdef">
         int
         <strong>
          dlclose
         </strong>
         (
        </code>
       </td>
       <td colspan="1" rowspan="1">
        void *
        <var class="pdparam">
         handle
        </var>
        <code>
         )
        </code>
        ;
       </td>
      </tr>
     </table>
     <div class="funcprototype-spacer">
      &nbsp;
     </div>
    </div>
    <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tr>
       <td align="center" colspan="1" rowspan="2" valign="top" width="25">
        <img alt="[Note]" src="../stylesheet/note.png"/>
       </td>
       <th align="left" colspan="1" rowspan="1">
        Note
       </th>
      </tr>
      <tr>
       <td align="left" colspan="1" rowspan="1" valign="top">
        <p>
         Link with
         <code class="option">
          &minus;ldl
         </code>
         .
        </p>
       </td>
      </tr>
     </table>
    </div>
   </div>
   <div class="refsect1">
    <a id="dlopen-3_sect1" name="dlopen-3_sect1" shape="rect">
    </a>
    <h2>
     DESCRIPTION
    </h2>
    <p>
     The four functions
     <code class="function">
      dlopen
     </code>
     (),
     <code class="function">
      dlsym
     </code>
     (),
     <code class="function">
      dlclose
     </code>
     (),
     <code class="function">
      dlerror
     </code>
     () implement the interface to the
      dynamic linking loader.
    </p>
    <div class="refsect2">
     <a id="dlopen-3_sect2" name="dlopen-3_sect2" shape="rect">
     </a>
     <h3>
      dlerror()
     </h3>
     <p>
      The function
      <code class="function">
       dlerror
      </code>
      ()
        returns a human-readable string describing the most recent
        error that occurred from
      <code class="function">
       dlopen
      </code>
      (),
      <code class="function">
       dlsym
      </code>
      () or
      <code class="function">
       dlclose
      </code>
      () since the last call to
      <code class="function">
       dlerror
      </code>
      (). It returns NULL if
        no errors have occurred since initialization or since it
        was last called.
     </p>
    </div>
    <div class="refsect2">
     <a id="dlopen-3_sect3" name="dlopen-3_sect3" shape="rect">
     </a>
     <h3>
      dlopen()
     </h3>
     <p>
      The function
      <code class="function">
       dlopen
      </code>
      ()
        loads the dynamic library file named by the null-terminated
        string
      <em class="parameter">
       <code>
        filename
       </code>
      </em>
      and
        returns an opaque "handle" for the dynamic library. If
      <em class="parameter">
       <code>
        filename
       </code>
      </em>
      is NULL,
        then the returned handle is for the main program. If
      <em class="parameter">
       <code>
        filename
       </code>
      </em>
      contains a
        slash ("/"), then it is interpreted as a (relative or
        absolute) pathname. Otherwise, the dynamic linker searches
        for the library as follows (see
      <a class="link" href="../htmlman8/ld.so.8.html" shape="rect" target="_top">
       <span class="citerefentry">
        <span class="refentrytitle">
         ld.so
        </span>
        (8)
       </span>
      </a>
      for further
        details):
     </p>
     <div class="itemizedlist">
      <ul class="itemizedlist" style="list-style-type: disc;">
       <li class="listitem">
        <p>
         (ELF only) If the executable file for the calling
              program contains a DT_RPATH tag, and does not contain
              a DT_RUNPATH tag, then the directories listed in the
              DT_RPATH tag are searched.
        </p>
       </li>
       <li class="listitem">
        <p>
         If, at the time that the program was started, the
              environment variable
         <code class="envar">
          LD_LIBRARY_PATH
         </code>
         was defined to contain
              a colon-separated list of directories, then these are
              searched. (As a security measure this variable is
              ignored for set-user-ID and set-group-ID
              programs.)
        </p>
       </li>
       <li class="listitem">
        <p>
         (ELF only) If the executable file for the calling
              program contains a DT_RUNPATH tag, then the
              directories listed in that tag are searched.
        </p>
       </li>
       <li class="listitem">
        <p>
         The cache file
         <code class="filename">
          /etc/ld.so.cache
         </code>
         (maintained by
         <a class="link" href="../htmlman8/ldconfig.8.html" shape="rect" target="_top">
          <span class="citerefentry">
           <span class="refentrytitle">
            ldconfig
           </span>
           (8)
          </span>
         </a>
         ) is
              checked to see whether it contains an entry for
         <em class="parameter">
          <code>
           filename
          </code>
         </em>
         .
        </p>
       </li>
       <li class="listitem">
        <p>
         The directories
         <code class="filename">
          /lib
         </code>
         and
         <code class="filename">
          /usr/lib
         </code>
         are
              searched (in that order).
        </p>
       </li>
      </ul>
     </div>
     <p>
      If the library has dependencies on other shared
        libraries, then these are also automatically loaded by the
        dynamic linker using the same rules. (This process may
        occur recursively, if those libraries in turn have
        dependencies, and so on.)
     </p>
     <p>
      One of the following two values must be included in
      <em class="parameter">
       <code>
        flag
       </code>
      </em>
      :
     </p>
     <div class="variablelist">
      <dl class="variablelist">
       <dt>
        <span class="term">
         <code class="constant">
          RTLD_LAZY
         </code>
        </span>
       </dt>
       <dd>
        <p>
         Perform lazy binding. Only resolve symbols as the
              code that references them is executed. If the symbol
              is never referenced, then it is never resolved. (Lazy
              binding is performed only for function references;
              references to variables are always immediately bound
              when the library is loaded.)
        </p>
       </dd>
       <dt>
        <span class="term">
         <code class="constant">
          RTLD_NOW
         </code>
        </span>
       </dt>
       <dd>
        <p>
         If this value is specified, or the environment
              variable
         <code class="constant">
          LD_BIND_NOW
         </code>
         is
              set to a nonempty string, all undefined symbols in
              the library are resolved before
         <code class="function">
          dlopen
         </code>
         () returns. If this cannot be
              done, an error is returned.
        </p>
       </dd>
      </dl>
     </div>
     <p>
      Zero or more of the following values may also be ORed in
      <em class="parameter">
       <code>
        flag
       </code>
      </em>
      :
     </p>
     <div class="variablelist">
      <dl class="variablelist">
       <dt>
        <span class="term">
         <code class="constant">
          RTLD_GLOBAL
         </code>
        </span>
       </dt>
       <dd>
        <p>
         The symbols defined by this library will be made
              available for symbol resolution of subsequently
              loaded libraries.
        </p>
       </dd>
       <dt>
        <span class="term">
         <code class="constant">
          RTLD_LOCAL
         </code>
        </span>
       </dt>
       <dd>
        <p>
         This is the converse of
         <code class="constant">
          RTLD_GLOBAL
         </code>
         , and the default if
              neither flag is specified. Symbols defined in this
              library are not made available to resolve references
              in subsequently loaded libraries.
        </p>
       </dd>
       <dt>
        <span class="term">
         <code class="constant">
          RTLD_NODELETE
         </code>
         (since glibc
            2.2)
        </span>
       </dt>
       <dd>
        <p>
         Do not unload the library during
         <code class="function">
          dlclose
         </code>
         (). Consequently, the
              library's static variables are not reinitialized if
              the library is reloaded with
         <code class="function">
          dlopen
         </code>
         () at a later time. This flag
              is not specified in POSIX.1-2001.
        </p>
       </dd>
       <dt>
        <span class="term">
         <code class="constant">
          RTLD_NOLOAD
         </code>
         (since glibc
            2.2)
        </span>
       </dt>
       <dd>
        <p>
         Don't load the library. This can be used to test
              if the library is already resident (
         <code class="function">
          dlopen
         </code>
         () returns NULL if it is not,
              or the library's handle if it is resident). This flag
              can also be used to promote the flags on a library
              that is already loaded. For example, a library that
              was previously loaded with
         <code class="constant">
          RTLD_LOCAL
         </code>
         can be reopened with
         <span class="emphasis">
          <em>
           RTLD_NOLOAD |
              RTLD_GLOBAL
          </em>
         </span>
         . This flag is not specified
              in POSIX.1-2001.
        </p>
       </dd>
       <dt>
        <span class="term">
         <code class="constant">
          RTLD_DEEPBIND
         </code>
         (since glibc
            2.3.4)
        </span>
       </dt>
       <dd>
        <p>
         Place the lookup scope of the symbols in this
              library ahead of the global scope. This means that a
              self-contained library will use its own symbols in
              preference to global symbols with the same name
              contained in libraries that have already been loaded.
              This flag is not specified in POSIX.1-2001.
        </p>
       </dd>
      </dl>
     </div>
     <p>
      If
      <em class="parameter">
       <code>
        filename
       </code>
      </em>
      is
        NULL, then the returned handle is for the main program.
        When given to
      <code class="function">
       dlsym
      </code>
      (), this
        handle causes a search for a symbol in the main program,
        followed by all shared libraries loaded at program startup,
        and then all shared libraries loaded by
      <code class="function">
       dlopen
      </code>
      () with the flag
      <code class="constant">
       RTLD_GLOBAL
      </code>
      .
     </p>
     <p>
      External references in the library are resolved using
        the libraries in that library's dependency list and any
        other libraries previously opened with the
      <code class="constant">
       RTLD_GLOBAL
      </code>
      flag. If the executable was
        linked with the flag "&minus;rdynamic" (or, synonymously,
        "&minus;&minus;export&minus;dynamic"), then the global
        symbols in the executable will also be used to resolve
        references in a dynamically loaded library.
     </p>
     <p>
      If the same library is loaded again with
      <code class="function">
       dlopen
      </code>
      (), the same library handle is
        returned. The dl library maintains reference counts for
        library handles, so a dynamic library is not deallocated
        until
      <code class="function">
       dlclose
      </code>
      () has been
        called on it as many times as
      <code class="function">
       dlopen
      </code>
      () has succeeded on it. The
      <code class="function">
       _init
      </code>
      () routine, if present,
        is called only once. But a subsequent call with
      <code class="constant">
       RTLD_NOW
      </code>
      may force symbol
        resolution for a library earlier loaded with
      <code class="constant">
       RTLD_LAZY
      </code>
      .
     </p>
     <p>
      If
      <code class="function">
       dlopen
      </code>
      () fails for any
        reason, it returns NULL.
     </p>
    </div>
    <div class="refsect2">
     <a id="dlopen-3_sect4" name="dlopen-3_sect4" shape="rect">
     </a>
     <h3>
      dlsym()
     </h3>
     <p>
      The function
      <code class="function">
       dlsym
      </code>
      () takes
        a "handle" of a dynamic library returned by
      <code class="function">
       dlopen
      </code>
      () and the null-terminated symbol
        name, returning the address where that symbol is loaded
        into memory. If the symbol is not found, in the specified
        library or any of the libraries that were automatically
        loaded by
      <code class="function">
       dlopen
      </code>
      () when that
        library was loaded,
      <code class="function">
       dlsym
      </code>
      ()
        returns NULL. (The search performed by
      <code class="function">
       dlsym
      </code>
      () is breadth first through the
        dependency tree of these libraries.) Since the value of the
        symbol could actually be NULL (so that a NULL return from
      <code class="function">
       dlsym
      </code>
      () need not indicate an
        error), the correct way to test for an error is to call
      <code class="function">
       dlerror
      </code>
      () to clear any old
        error conditions, then call
      <code class="function">
       dlsym
      </code>
      (), and then call
      <code class="function">
       dlerror
      </code>
      () again, saving its return value
        into a variable, and check whether this saved value is not
        NULL.
     </p>
     <p>
      There are two special pseudo-handles,
      <code class="constant">
       RTLD_DEFAULT
      </code>
      and
      <code class="constant">
       RTLD_NEXT
      </code>
      . The former will find the first
        occurrence of the desired symbol using the default library
        search order. The latter will find the next occurrence of a
        function in the search order after the current library.
        This allows one to provide a wrapper around a function in
        another shared library.
     </p>
    </div>
    <div class="refsect2">
     <a id="dlopen-3_sect5" name="dlopen-3_sect5" shape="rect">
     </a>
     <h3>
      dlclose()
     </h3>
     <p>
      The function
      <code class="function">
       dlclose
      </code>
      ()
        decrements the reference count on the dynamic library
        handle
      <em class="parameter">
       <code>
        handle
       </code>
      </em>
      . If
        the reference count drops to zero and no other loaded
        libraries use symbols in it, then the dynamic library is
        unloaded.
     </p>
     <p>
      The function
      <code class="function">
       dlclose
      </code>
      ()
        returns 0 on success, and nonzero on error.
     </p>
    </div>
    <div class="refsect2">
     <a id="dlopen-3_sect6" name="dlopen-3_sect6" shape="rect">
     </a>
     <h3>
      The obsolete symbols _init() and _fini()
     </h3>
     <p>
      The linker recognizes special symbols
      <code class="function">
       _init
      </code>
      and
      <code class="function">
       _fini
      </code>
      . If a dynamic library exports a
        routine named
      <code class="function">
       _init
      </code>
      (), then
        that code is executed after the loading, before
      <code class="function">
       dlopen
      </code>
      () returns. If the
        dynamic library exports a routine named
      <code class="function">
       _fini
      </code>
      (), then that routine is called just
        before the library is unloaded. In case you need to avoid
        linking against the system startup files, this can be done
        by using the
      <span class="citerefentry">
       <span class="refentrytitle">
        gcc
       </span>
       (1)
      </span>
      <code class="option">
       &minus;nostartfiles
      </code>
      command-line
        option.
     </p>
     <p>
      Using these routines, or the gcc
      <code class="option">
       &minus;nostartfiles
      </code>
      or
      <code class="option">
       &minus;nostdlib
      </code>
      options, is not
        recommended. Their use may result in undesired behavior,
        since the constructor/destructor routines will not be
        executed (unless special measures are taken).
     </p>
     <p>
      Instead, libraries should export routines using the
      <code class="constant">
       __attribute__((constructor))
      </code>
      and
      <code class="constant">
       __attribute__((destructor))
      </code>
      function
        attributes. See the gcc info pages for information on
        these. Constructor routines are executed before
      <code class="function">
       dlopen
      </code>
      () returns, and
        destructor routines are executed before
      <code class="function">
       dlclose
      </code>
      () returns.
     </p>
    </div>
    <div class="refsect2">
     <a id="dlopen-3_sect7" name="dlopen-3_sect7" shape="rect">
     </a>
     <h3>
      Glibc extensions: dladdr() and dlvsym()
     </h3>
     <p>
      Glibc adds two functions not described by POSIX, with
        prototypes
     </p>
     <div class="informalexample">
      <pre class="programlisting" xml:space="preserve">
<span class="emphasis"><em>#define _GNU_SOURCE</em></span>         /* See feature_test_macros(7) */
<span class="emphasis"><em>#include &lt;dlfcn.h&gt;</em></span>

  <code class="function">int dladdr</code>(<em class="parameter"><code>void *addr</code></em>, <em class="parameter"><code>Dl_info *info</code></em>);

  <code class="function">void *dlvsym</code>(<em class="parameter"><code>void *handle</code></em>, <em class="parameter"><code>char *symbol</code></em>, <em class="parameter"><code>char *version</code></em>);
</pre>
     </div>
     <p>
      The function
      <code class="function">
       dladdr
      </code>
      ()
        takes a function pointer and tries to resolve name and file
        where it is located. Information is stored in the
      <span class="structname">
       Dl_info
      </span>
      structure:
     </p>
     <div class="blockquote">
      <blockquote class="blockquote">
       <div class="structdef">
        <table style="border-collapse: collapse;">
         <colgroup span="1">
          <col class="c1" span="1">
          </col>
          <col class="c2" span="1">
          </col>
          <col class="c3" span="1">
          </col>
          <col class="c4" span="1">
          </col>
          <col class="c5" span="1">
          </col>
         </colgroup>
         <tbody>
          <tr>
           <td align="left" class="structdefhdr" colspan="1" rowspan="1" style="">
            typedef
           </td>
           <td align="left" class="structdefhdr" colspan="4" rowspan="1" style="">
            struct&nbsp;{
           </td>
          </tr>
          <tr>
           <td colspan="1" rowspan="1" style="">
            &nbsp;
           </td>
           <td align="left" colspan="1" rowspan="1" style="">
            <span class="type">
             const&nbsp;char
            </span>
           </td>
           <td align="right" class="norightpad" colspan="1" rowspan="1" style="">
            *
           </td>
           <td align="left" colspan="1" rowspan="1" style="">
            <em class="structfield">
             <code>
              dli_fname
             </code>
            </em>
            ;
           </td>
           <td align="left" colspan="1" rowspan="1" style="">
            <div class="literallayout">
             /*&nbsp;Pathname&nbsp;of&nbsp;shared&nbsp;object&nbsp;that
             <br/>
             contains&nbsp;address&nbsp;*/
            </div>
           </td>
          </tr>
          <tr>
           <td colspan="1" rowspan="1" style="">
            &nbsp;
           </td>
           <td align="left" colspan="1" rowspan="1" style="">
            <span class="type">
             void
            </span>
           </td>
           <td align="right" class="norightpad" colspan="1" rowspan="1" style="">
            *
           </td>
           <td align="left" colspan="1" rowspan="1" style="">
            <em class="structfield">
             <code>
              dli_fbase
             </code>
            </em>
            ;
           </td>
           <td align="left" colspan="1" rowspan="1" style="">
            <div class="literallayout">
             /*&nbsp;Address&nbsp;at&nbsp;which&nbsp;shared&nbsp;object
             <br/>
             is&nbsp;loaded&nbsp;*/
            </div>
           </td>
          </tr>
          <tr>
           <td colspan="1" rowspan="1" style="">
            &nbsp;
           </td>
           <td align="left" colspan="1" rowspan="1" style="">
            <span class="type">
             const&nbsp;char
            </span>
           </td>
           <td align="right" class="norightpad" colspan="1" rowspan="1" style="">
            *
           </td>
           <td align="left" colspan="1" rowspan="1" style="">
            <em class="structfield">
             <code>
              dli_sname
             </code>
            </em>
            ;
           </td>
           <td align="left" colspan="1" rowspan="1" style="">
            <div class="literallayout">
             /*&nbsp;Name&nbsp;of&nbsp;symbol&nbsp;whose&nbsp;definition
             <br/>
             overlaps&nbsp;addr&nbsp;*/
            </div>
           </td>
          </tr>
          <tr>
           <td colspan="1" rowspan="1" style="">
            &nbsp;
           </td>
           <td align="left" colspan="1" rowspan="1" style="">
            <span class="type">
             void
            </span>
           </td>
           <td align="right" class="norightpad" colspan="1" rowspan="1" style="">
            *
           </td>
           <td align="left" colspan="1" rowspan="1" style="">
            <em class="structfield">
             <code>
              dli_saddr
             </code>
            </em>
            ;
           </td>
           <td align="left" colspan="1" rowspan="1" style="">
            <div class="literallayout">
             /*&nbsp;Exact&nbsp;address&nbsp;of&nbsp;symbol&nbsp;named
             <br/>
             in&nbsp;dli_sname&nbsp;*/
            </div>
           </td>
          </tr>
          <tr>
           <td align="left" class="structdefftr" colspan="5" rowspan="1" style="">
            } Dl_info;
           </td>
          </tr>
         </tbody>
        </table>
       </div>
      </blockquote>
     </div>
     <p>
      If no symbol matching
      <code class="function">
       addr
      </code>
      could be found, then
      <em class="parameter">
       <code>
        dli_sname
       </code>
      </em>
      and
      <em class="parameter">
       <code>
        dli_saddr
       </code>
      </em>
      are set to
        NULL.
     </p>
     <p>
      <code class="function">
       dladdr
      </code>
      () returns 0 on
        error, and nonzero on success.
     </p>
     <p>
      The function
      <code class="function">
       dlvsym
      </code>
      (),
        provided by glibc since version 2.1, does the same as
      <code class="function">
       dlsym
      </code>
      () but takes a version
        string as an additional argument.
     </p>
    </div>
   </div>
   <div class="refsect1">
    <a id="dlopen-3_sect8" name="dlopen-3_sect8" shape="rect">
    </a>
    <h2>
     CONFORMING TO
    </h2>
    <p>
     POSIX.1-2001 describes
     <code class="function">
      dlclose
     </code>
     (),
     <code class="function">
      dlerror
     </code>
     (),
     <code class="function">
      dlopen
     </code>
     (), and
     <code class="function">
      dlsym
     </code>
     ().
    </p>
   </div>
   <div class="refsect1">
    <a id="dlopen-3_sect9" name="dlopen-3_sect9" shape="rect">
    </a>
    <h2>
     NOTES
    </h2>
    <p>
     The symbols
     <code class="constant">
      RTLD_DEFAULT
     </code>
     and
     <code class="constant">
      RTLD_NEXT
     </code>
     are defined by
     <code class="literal">
      &lt;
     </code>
     <code class="filename">
      dlfcn.h
     </code>
     <code class="literal">
      &gt;
     </code>
     only when
     <code class="constant">
      _GNU_SOURCE
     </code>
     was
      defined before including it.
    </p>
    <p>
     Since glibc 2.2.3,
     <a class="link" href="../htmlman3/atexit.3.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        atexit
       </span>
       (3)
      </span>
     </a>
     can be used to
      register an exit handler that is automatically called when a
      library is unloaded.
    </p>
    <div class="refsect2">
     <a id="dlopen-3_sect10" name="dlopen-3_sect10" shape="rect">
     </a>
     <h3>
      History
     </h3>
     <p>
      The dlopen interface standard comes from SunOS. That
        system also has
      <code class="function">
       dladdr
      </code>
      (), but
        not
      <code class="function">
       dlvsym
      </code>
      ().
     </p>
    </div>
   </div>
   <div class="refsect1">
    <a id="dlopen-3_sect11" name="dlopen-3_sect11" shape="rect">
    </a>
    <h2>
     BUGS
    </h2>
    <p>
     Sometimes, the function pointers you pass to
     <code class="function">
      dladdr
     </code>
     () may surprise you. On some
      architectures (notably i386 and x86_64),
     <em class="parameter">
      <code>
       dli_fname
      </code>
     </em>
     and
     <em class="parameter">
      <code>
       dli_fbase
      </code>
     </em>
     may end up pointing
      back at the object from which you called
     <code class="function">
      dladdr
     </code>
     (), even if the function used as an
      argument should come from a dynamically linked library.
    </p>
    <p>
     The problem is that the function pointer will still be
      resolved at compile time, but merely point to the
     <code class="function">
      plt
     </code>
     (Procedure Linkage Table)
      section of the original object (which dispatches the call
      after asking the dynamic linker to resolve the symbol). To
      work around this, you can try to compile the code to be
      position-independent: then, the compiler cannot prepare the
      pointer at compile time anymore and today's
     <span class="citerefentry">
      <span class="refentrytitle">
       gcc
      </span>
      (1)
     </span>
     will generate code that
      just loads the final symbol address from the
     <code class="constant">
      got
     </code>
     (Global Offset Table) at run time
      before passing it to
     <code class="function">
      dladdr
     </code>
     ().
    </p>
   </div>
   <div class="refsect1">
    <a id="dlopen-3_sect12" name="dlopen-3_sect12" shape="rect">
    </a>
    <h2>
     EXAMPLE
    </h2>
    <p>
     Load the math library, and print the cosine of 2.0:
    </p>
    <div class="informalexample">
     <pre class="programlisting" xml:space="preserve">
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;dlfcn.h&gt;

int
main(int argc, char **argv)
{
    void *handle;
    double (*cosine)(double);
    char *error;

    handle = dlopen("libm.so", RTLD_LAZY);
    if (!handle) {
        fprintf(stderr, "%s\n", dlerror());
        exit(EXIT_FAILURE);
    }

    dlerror();    /* Clear any existing error */

    cosine = (double (*)(double)) dlsym(handle, "cos");

    /* According to the ISO C standard, casting between function
       pointers and 'void *', as done above, produces undefined results.
       POSIX.1-2003 and POSIX.1-2008 accepted this state of affairs and
       proposed the following workaround:

           *(void **) (&amp;cosine) = dlsym(handle, "cos");

       This (clumsy) cast conforms with the ISO C standard and will
       avoid any compiler warnings.

       The 2013 Technical Corrigendum to POSIX.1-2008 (a.k.a.
       POSIX.1-2013) improved matters by requiring that conforming
       implementations support casting 'void *' to a function pointer.
       Nevertheless, some compilers (e.g., gcc with the '-pedantic'
       option) may complain about the cast used in this program. */

    error = dlerror();
    if (error != NULL) {
        fprintf(stderr, "%s\n", error);
        exit(EXIT_FAILURE);
    }

    printf("%f\n", (*cosine)(2.0));
    dlclose(handle);
    exit(EXIT_SUCCESS);
}
</pre>
    </div>
    <p>
     If this program were in a file named "foo.c", you would
      build the program with the following command:
    </p>
    <div class="blockquote">
     <blockquote class="blockquote">
      <p>
       gcc &minus;rdynamic &minus;o foo foo.c &minus;ldl
      </p>
     </blockquote>
    </div>
    <p>
     Libraries exporting
     <code class="function">
      _init
     </code>
     ()
      and
     <code class="function">
      _fini
     </code>
     () will want to be
      compiled as follows, using
     <code class="filename">
      bar.c
     </code>
     as the example name:
    </p>
    <div class="blockquote">
     <blockquote class="blockquote">
      <p>
       gcc &minus;shared &minus;nostartfiles &minus;o bar
          bar.c
      </p>
     </blockquote>
    </div>
   </div>
   <div class="refsect1">
    <a id="dlopen-3_sect13" name="dlopen-3_sect13" shape="rect">
    </a>
    <h2>
     SEE ALSO
    </h2>
    <p>
     <span class="citerefentry">
      <span class="refentrytitle">
       ld
      </span>
      (1)
     </span>
     ,
     <span class="citerefentry">
      <span class="refentrytitle">
       ldd
      </span>
      (1)
     </span>
     ,
     <a class="link" href="../htmlman3/dl_iterate_phdr.3.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        dl_iterate_phdr
       </span>
       (3)
      </span>
     </a>
     ,
     <a class="link" href="../htmlman7/rtld-audit.7.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        rtld-audit
       </span>
       (7)
      </span>
     </a>
     ,
     <a class="link" href="../htmlman8/ld.so.8.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        ld.so
       </span>
       (8)
      </span>
     </a>
     ,
     <a class="link" href="../htmlman8/ldconfig.8.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        ldconfig
       </span>
       (8)
      </span>
     </a>
    </p>
    <p>
     ld.so info pages, gcc info pages, ld info pages
    </p>
   </div>
   <div class="colophon">
    <a id="dlopen-3_sect14" name="dlopen-3_sect14" shape="rect">
    </a>
    <h2>
     COLOPHON
    </h2>
    <p>
     This page is part of release 3.72 of the Linux
     <em class="replaceable">
      <code>
       man-pages
      </code>
     </em>
     project. A
      description of the project, information about reporting bugs,
      and the latest version of this page, can be found at
      http://www.kernel.org/doc/man&minus;pages/.
    </p>
   </div>
  </div>
 </body>
</html>
