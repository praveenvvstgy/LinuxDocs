<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
  <title>
   getaddrinfo(3) &mdash; Linux manual pages
  </title>
  <link href="../stylesheet/manpages.css" rel="stylesheet" type="text/css"/>
  <link href="../index.html" rel="home" title="getaddrinfo(3) &mdash; Linux manual pages"/>
  <script src="../stylesheet/manpages.js" type="text/javascript" xml:space="preserve">
  </script>
  <link href="../stylesheet/icon.gif" rel="icon" type="image/gif"/>
 </head>
 <body>
  <div class="refentry">
   <a id="getaddrinfo.3" name="getaddrinfo.3" shape="rect">
   </a>
   <div class="titlepage">
   </div>
   <div class="refnamediv">
    <h2>
     Name
    </h2>
    <p>
     getaddrinfo, freeaddrinfo, gai_strerror &mdash; network
      address and service translation
    </p>
   </div>
   <div class="refsynopsisdiv">
    <h2>
     Synopsis
    </h2>
    <div class="informalexample">
     <pre class="programlisting" xml:space="preserve">
#include &lt;sys/types.h&gt;
#include &lt;sys/socket.h&gt;
#include &lt;netdb.h&gt;
</pre>
    </div>
    <div class="funcsynopsis">
     <table border="0" class="funcprototype-table" style="cellspacing: 0; cellpadding: 0;" summary="Function synopsis">
      <tr>
       <td colspan="1" rowspan="1">
        <code class="funcdef">
         int
         <strong>
          getaddrinfo
         </strong>
         (
        </code>
       </td>
       <td colspan="1" rowspan="1">
        const char *
        <var class="pdparam">
         node
        </var>
        ,
       </td>
      </tr>
      <tr>
       <td colspan="1" rowspan="1">
        &nbsp;
       </td>
       <td colspan="1" rowspan="1">
        const char *
        <var class="pdparam">
         service
        </var>
        ,
       </td>
      </tr>
      <tr>
       <td colspan="1" rowspan="1">
        &nbsp;
       </td>
       <td colspan="1" rowspan="1">
        const struct addrinfo *
        <var class="pdparam">
         hints
        </var>
        ,
       </td>
      </tr>
      <tr>
       <td colspan="1" rowspan="1">
        &nbsp;
       </td>
       <td colspan="1" rowspan="1">
        struct addrinfo **
        <var class="pdparam">
         res
        </var>
        <code>
         )
        </code>
        ;
       </td>
      </tr>
     </table>
     <div class="funcprototype-spacer">
      &nbsp;
     </div>
    </div>
    <div class="funcsynopsis">
     <table border="0" class="funcprototype-table" style="cellspacing: 0; cellpadding: 0;" summary="Function synopsis">
      <tr>
       <td colspan="1" rowspan="1">
        <code class="funcdef">
         void
         <strong>
          freeaddrinfo
         </strong>
         (
        </code>
       </td>
       <td colspan="1" rowspan="1">
        struct addrinfo *
        <var class="pdparam">
         res
        </var>
        <code>
         )
        </code>
        ;
       </td>
      </tr>
     </table>
     <div class="funcprototype-spacer">
      &nbsp;
     </div>
    </div>
    <div class="funcsynopsis">
     <table border="0" class="funcprototype-table" style="cellspacing: 0; cellpadding: 0;" summary="Function synopsis">
      <tr>
       <td colspan="1" rowspan="1">
        <code class="funcdef">
         const char
            *
         <strong>
          gai_strerror
         </strong>
         (
        </code>
       </td>
       <td colspan="1" rowspan="1">
        int
        <var class="pdparam">
         errcode
        </var>
        <code>
         )
        </code>
        ;
       </td>
      </tr>
     </table>
     <div class="funcprototype-spacer">
      &nbsp;
     </div>
    </div>
    <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tr>
       <td align="center" colspan="1" rowspan="2" valign="top" width="25">
        <img alt="[Note]" src="../stylesheet/note.png"/>
       </td>
       <th align="left" colspan="1" rowspan="1">
        Note
       </th>
      </tr>
      <tr>
       <td align="left" colspan="1" rowspan="1" valign="top">
        <div class="featuretests">
         <table style="border-collapse: collapse;">
          <colgroup span="1">
           <col span="1">
           </col>
          </colgroup>
          <thead>
           <tr>
            <th colspan="1" rowspan="1" style="">
             Feature Test Macro Requirements
                      for glibc (see
             <a class="link" href="../htmlman7/feature_test_macros.7.html" shape="rect" target="_top">
              <span class="citerefentry">
               <span class="refentrytitle">
                feature_test_macros
               </span>
               (7)
              </span>
             </a>
             ):
            </th>
           </tr>
          </thead>
          <tbody>
           <tr>
            <td colspan="1" rowspan="1" style="">
             <code class="function">
              getaddrinfo
             </code>
             (),
             <code class="function">
              freeaddrinfo
             </code>
             (),
             <code class="function">
              gai_strerror
             </code>
             ():
            </td>
           </tr>
           <tr>
            <td class="featuretestdef" colspan="1" rowspan="1" style="">
             <code class="constant">
              _POSIX_C_SOURCE
             </code>
             &gt;= 1 ||
             <code class="constant">
              _XOPEN_SOURCE
             </code>
             ||
             <code class="constant">
              _POSIX_SOURCE
             </code>
            </td>
           </tr>
          </tbody>
         </table>
        </div>
       </td>
      </tr>
     </table>
    </div>
   </div>
   <div class="refsect1">
    <a id="getaddrinfo-3_sect1" name="getaddrinfo-3_sect1" shape="rect">
    </a>
    <h2>
     DESCRIPTION
    </h2>
    <p>
     Given
     <em class="parameter">
      <code>
       node
      </code>
     </em>
     and
     <em class="parameter">
      <code>
       service
      </code>
     </em>
     , which
      identify an Internet host and a service,
     <code class="function">
      getaddrinfo
     </code>
     () returns one or more
     <span class="structname">
      addrinfo
     </span>
     structures, each of
      which contains an Internet address that can be specified in a
      call to
     <a class="link" href="../htmlman2/bind.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        bind
       </span>
       (2)
      </span>
     </a>
     or
     <a class="link" href="../htmlman2/connect.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        connect
       </span>
       (2)
      </span>
     </a>
     . The
     <code class="function">
      getaddrinfo
     </code>
     () function combines
      the functionality provided by the
     <a class="link" href="../htmlman3/gethostbyname.3.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        gethostbyname
       </span>
       (3)
      </span>
     </a>
     and
     <a class="link" href="../htmlman3/getservent.3.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        getservbyname
       </span>
       (3)
      </span>
     </a>
     functions
      into a single interface, but unlike the latter functions,
     <code class="function">
      getaddrinfo
     </code>
     () is reentrant and
      allows programs to eliminate IPv4-versus-IPv6
      dependencies.
    </p>
    <p>
     The
     <span class="structname">
      addrinfo
     </span>
     structure
      used by
     <code class="function">
      getaddrinfo
     </code>
     () contains
      the following fields:
    </p>
    <div class="blockquote">
     <blockquote class="blockquote">
      <div class="structdef">
       <table style="border-collapse: collapse;">
        <colgroup span="1">
         <col class="c1" span="1">
         </col>
         <col class="c2" span="1">
         </col>
         <col class="c3" span="1">
         </col>
         <col class="c4" span="1">
         </col>
         <col class="c5" span="1">
         </col>
        </colgroup>
        <tbody>
         <tr>
          <td align="left" class="structdefhdr" colspan="1" rowspan="1" style="">
           struct
          </td>
          <td align="left" class="structdefhdr" colspan="4" rowspan="1" style="">
           <span class="structname">
            addrinfo
           </span>
           &nbsp;{
          </td>
         </tr>
         <tr>
          <td colspan="1" rowspan="1" style="">
           &nbsp;
          </td>
          <td align="left" colspan="1" rowspan="1" style="">
           <span class="type">
            int
           </span>
          </td>
          <td align="right" class="norightpad" colspan="1" rowspan="1" style="">
           &nbsp;
          </td>
          <td align="left" colspan="1" rowspan="1" style="">
           <em class="structfield">
            <code>
             ai_flags
            </code>
           </em>
           ;
          </td>
          <td align="left" colspan="1" rowspan="1" style="">
           &nbsp;
          </td>
         </tr>
         <tr>
          <td colspan="1" rowspan="1" style="">
           &nbsp;
          </td>
          <td align="left" colspan="1" rowspan="1" style="">
           <span class="type">
            int
           </span>
          </td>
          <td align="right" class="norightpad" colspan="1" rowspan="1" style="">
           &nbsp;
          </td>
          <td align="left" colspan="1" rowspan="1" style="">
           <em class="structfield">
            <code>
             ai_family
            </code>
           </em>
           ;
          </td>
          <td align="left" colspan="1" rowspan="1" style="">
           &nbsp;
          </td>
         </tr>
         <tr>
          <td colspan="1" rowspan="1" style="">
           &nbsp;
          </td>
          <td align="left" colspan="1" rowspan="1" style="">
           <span class="type">
            int
           </span>
          </td>
          <td align="right" class="norightpad" colspan="1" rowspan="1" style="">
           &nbsp;
          </td>
          <td align="left" colspan="1" rowspan="1" style="">
           <em class="structfield">
            <code>
             ai_socktype
            </code>
           </em>
           ;
          </td>
          <td align="left" colspan="1" rowspan="1" style="">
           &nbsp;
          </td>
         </tr>
         <tr>
          <td colspan="1" rowspan="1" style="">
           &nbsp;
          </td>
          <td align="left" colspan="1" rowspan="1" style="">
           <span class="type">
            int
           </span>
          </td>
          <td align="right" class="norightpad" colspan="1" rowspan="1" style="">
           &nbsp;
          </td>
          <td align="left" colspan="1" rowspan="1" style="">
           <em class="structfield">
            <code>
             ai_protocol
            </code>
           </em>
           ;
          </td>
          <td align="left" colspan="1" rowspan="1" style="">
           &nbsp;
          </td>
         </tr>
         <tr>
          <td colspan="1" rowspan="1" style="">
           &nbsp;
          </td>
          <td align="left" colspan="1" rowspan="1" style="">
           <span class="type">
            socklen_t
           </span>
          </td>
          <td align="right" class="norightpad" colspan="1" rowspan="1" style="">
           &nbsp;
          </td>
          <td align="left" colspan="1" rowspan="1" style="">
           <em class="structfield">
            <code>
             ai_addrlen
            </code>
           </em>
           ;
          </td>
          <td align="left" colspan="1" rowspan="1" style="">
           &nbsp;
          </td>
         </tr>
         <tr>
          <td colspan="1" rowspan="1" style="">
           &nbsp;
          </td>
          <td align="left" colspan="1" rowspan="1" style="">
           <span class="type">
            struct&nbsp;sockaddr
           </span>
          </td>
          <td align="right" class="norightpad" colspan="1" rowspan="1" style="">
           *
          </td>
          <td align="left" colspan="1" rowspan="1" style="">
           <em class="structfield">
            <code>
             ai_addr
            </code>
           </em>
           ;
          </td>
          <td align="left" colspan="1" rowspan="1" style="">
           &nbsp;
          </td>
         </tr>
         <tr>
          <td colspan="1" rowspan="1" style="">
           &nbsp;
          </td>
          <td align="left" colspan="1" rowspan="1" style="">
           <span class="type">
            char
           </span>
          </td>
          <td align="right" class="norightpad" colspan="1" rowspan="1" style="">
           *
          </td>
          <td align="left" colspan="1" rowspan="1" style="">
           <em class="structfield">
            <code>
             ai_canonname
            </code>
           </em>
           ;
          </td>
          <td align="left" colspan="1" rowspan="1" style="">
           &nbsp;
          </td>
         </tr>
         <tr>
          <td colspan="1" rowspan="1" style="">
           &nbsp;
          </td>
          <td align="left" colspan="1" rowspan="1" style="">
           <span class="type">
            struct&nbsp;addrinfo
           </span>
          </td>
          <td align="right" class="norightpad" colspan="1" rowspan="1" style="">
           *
          </td>
          <td align="left" colspan="1" rowspan="1" style="">
           <em class="structfield">
            <code>
             ai_next
            </code>
           </em>
           ;
          </td>
          <td align="left" colspan="1" rowspan="1" style="">
           &nbsp;
          </td>
         </tr>
         <tr>
          <td align="left" class="structdefftr" colspan="5" rowspan="1" style="">
           };
          </td>
         </tr>
        </tbody>
       </table>
      </div>
     </blockquote>
    </div>
    <p>
     The
     <em class="parameter">
      <code>
       hints
      </code>
     </em>
     argument
      points to an
     <span class="structname">
      addrinfo
     </span>
     structure that specifies criteria for selecting the socket
      address structures returned in the list pointed to by
     <em class="parameter">
      <code>
       res
      </code>
     </em>
     . If
     <em class="parameter">
      <code>
       hints
      </code>
     </em>
     is not NULL it points to
      an
     <span class="structname">
      addrinfo
     </span>
     structure whose
     <em class="parameter">
      <code>
       ai_family
      </code>
     </em>
     ,
     <em class="parameter">
      <code>
       ai_socktype
      </code>
     </em>
     , and
     <em class="parameter">
      <code>
       ai_protocol
      </code>
     </em>
     specify criteria
      that limit the set of socket addresses returned by
     <code class="function">
      getaddrinfo
     </code>
     (), as follows:
    </p>
    <div class="variablelist">
     <dl class="variablelist">
      <dt>
       <span class="term">
        <em class="parameter">
         <code>
          ai_family
         </code>
        </em>
       </span>
      </dt>
      <dd>
       <p>
        This field specifies the desired address family for
            the returned addresses. Valid values for this field
            include
        <code class="constant">
         AF_INET
        </code>
        and
        <code class="constant">
         AF_INET6
        </code>
        . The value
        <code class="constant">
         AF_UNSPEC
        </code>
        indicates that
        <code class="function">
         getaddrinfo
        </code>
        () should
            return socket addresses for any address family (either
            IPv4 or IPv6, for example) that can be used with
        <em class="parameter">
         <code>
          node
         </code>
        </em>
        and
        <em class="parameter">
         <code>
          service
         </code>
        </em>
        .
       </p>
      </dd>
      <dt>
       <span class="term">
        <em class="parameter">
         <code>
          ai_socktype
         </code>
        </em>
       </span>
      </dt>
      <dd>
       <p>
        This field specifies the preferred socket type, for
            example
        <code class="constant">
         SOCK_STREAM
        </code>
        or
        <code class="constant">
         SOCK_DGRAM
        </code>
        . Specifying 0
            in this field indicates that socket addresses of any
            type can be returned by
        <code class="function">
         getaddrinfo
        </code>
        ().
       </p>
      </dd>
      <dt>
       <span class="term">
        <em class="parameter">
         <code>
          ai_protocol
         </code>
        </em>
       </span>
      </dt>
      <dd>
       <p>
        This field specifies the protocol for the returned
            socket addresses. Specifying 0 in this field indicates
            that socket addresses with any protocol can be returned
            by
        <code class="function">
         getaddrinfo
        </code>
        ().
       </p>
      </dd>
      <dt>
       <span class="term">
        <em class="parameter">
         <code>
          ai_flags
         </code>
        </em>
       </span>
      </dt>
      <dd>
       <p>
        This field specifies additional options, described
            below. Multiple flags are specified by bitwise OR-ing
            them together.
       </p>
      </dd>
     </dl>
    </div>
    <p>
     All the other fields in the structure pointed to by
     <em class="parameter">
      <code>
       hints
      </code>
     </em>
     must contain
      either 0 or a null pointer, as appropriate.
    </p>
    <p>
     Specifying
     <em class="parameter">
      <code>
       hints
      </code>
     </em>
     as NULL is equivalent to setting
     <em class="parameter">
      <code>
       ai_socktype
      </code>
     </em>
     and
     <em class="parameter">
      <code>
       ai_protocol
      </code>
     </em>
     to 0;
     <em class="parameter">
      <code>
       ai_family
      </code>
     </em>
     to
     <code class="constant">
      AF_UNSPEC
     </code>
     ; and
     <em class="parameter">
      <code>
       ai_flags
      </code>
     </em>
     to
     <span class="emphasis">
      <em>
       (AI_V4MAPPED | AI_ADDRCONFIG)
      </em>
     </span>
     .
      (POSIX specifies different defaults for
     <em class="parameter">
      <code>
       ai_flags
      </code>
     </em>
     ; see NOTES.)
     <em class="parameter">
      <code>
       node
      </code>
     </em>
     specifies either
      a numerical network address (for IPv4, numbers-and-dots
      notation as supported by
     <a class="link" href="../htmlman3/inet.3.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        inet_aton
       </span>
       (3)
      </span>
     </a>
     ; for IPv6,
      hexadecimal string format as supported by
     <a class="link" href="../htmlman3/inet_pton.3.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        inet_pton
       </span>
       (3)
      </span>
     </a>
     ), or a network
      hostname, whose network addresses are looked up and resolved.
      If
     <em class="replaceable">
      <code>
       hints.ai_flags
      </code>
     </em>
     contains the
     <code class="constant">
      AI_NUMERICHOST
     </code>
     flag, then
     <em class="parameter">
      <code>
       node
      </code>
     </em>
     must
      be a numerical network address. The
     <code class="constant">
      AI_NUMERICHOST
     </code>
     flag suppresses any
      potentially lengthy network host address lookups.
    </p>
    <p>
     If the
     <code class="constant">
      AI_PASSIVE
     </code>
     flag is
      specified in
     <em class="replaceable">
      <code>
       hints.ai_flags
      </code>
     </em>
     , and
     <em class="parameter">
      <code>
       node
      </code>
     </em>
     is NULL, then
      the returned socket addresses will be suitable for
     <a class="link" href="../htmlman2/bind.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        bind
       </span>
       (2)
      </span>
     </a>
     ing a socket that
      will
     <a class="link" href="../htmlman2/accept.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        accept
       </span>
       (2)
      </span>
     </a>
     connections. The
      returned socket address will contain the "wildcard address"
      (
     <code class="constant">
      INADDR_ANY
     </code>
     for IPv4 addresses,
     <code class="constant">
      IN6ADDR_ANY_INIT
     </code>
     for IPv6
      address). The wildcard address is used by applications
      (typically servers) that intend to accept connections on any
      of the hosts's network addresses. If
     <em class="parameter">
      <code>
       node
      </code>
     </em>
     is not NULL, then the
     <code class="constant">
      AI_PASSIVE
     </code>
     flag is ignored.
    </p>
    <p>
     If the
     <code class="constant">
      AI_PASSIVE
     </code>
     flag is
      not set in
     <em class="replaceable">
      <code>
       hints.ai_flags
      </code>
     </em>
     , then the
      returned socket addresses will be suitable for use with
     <a class="link" href="../htmlman2/connect.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        connect
       </span>
       (2)
      </span>
     </a>
     ,
     <a class="link" href="../htmlman2/send.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        sendto
       </span>
       (2)
      </span>
     </a>
     , or
     <a class="link" href="../htmlman2/send.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        sendmsg
       </span>
       (2)
      </span>
     </a>
     . If
     <em class="parameter">
      <code>
       node
      </code>
     </em>
     is NULL, then the network
      address will be set to the loopback interface address
      (
     <code class="constant">
      INADDR_LOOPBACK
     </code>
     for IPv4
      addresses,
     <code class="constant">
      IN6ADDR_LOOPBACK_INIT
     </code>
     for IPv6 address);
      this is used by applications that intend to communicate with
      peers running on the same host.
    </p>
    <p>
     <em class="parameter">
      <code>
       service
      </code>
     </em>
     sets the
      port in each returned address structure. If this argument is
      a service name (see
     <a class="link" href="../htmlman5/services.5.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        services
       </span>
       (5)
      </span>
     </a>
     ), it is
      translated to the corresponding port number. This argument
      can also be specified as a decimal number, which is simply
      converted to binary. If
     <em class="parameter">
      <code>
       service
      </code>
     </em>
     is NULL, then the port
      number of the returned socket addresses will be left
      uninitialized. If
     <code class="constant">
      AI_NUMERICSERV
     </code>
     is specified in
     <em class="replaceable">
      <code>
       hints.ai_flags
      </code>
     </em>
     and
     <em class="parameter">
      <code>
       service
      </code>
     </em>
     is not NULL, then
     <em class="parameter">
      <code>
       service
      </code>
     </em>
     must point to
      a string containing a numeric port number. This flag is used
      to inhibit the invocation of a name resolution service in
      cases where it is known not to be required.
    </p>
    <p>
     Either
     <em class="parameter">
      <code>
       node
      </code>
     </em>
     or
     <em class="parameter">
      <code>
       service
      </code>
     </em>
     , but not
      both, may be NULL.
    </p>
    <p>
     The
     <code class="function">
      getaddrinfo
     </code>
     () function
      allocates and initializes a linked list of
     <span class="structname">
      addrinfo
     </span>
     structures, one for each network
      address that matches
     <em class="parameter">
      <code>
       node
      </code>
     </em>
     and
     <em class="parameter">
      <code>
       service
      </code>
     </em>
     , subject to any
      restrictions imposed by
     <em class="parameter">
      <code>
       hints
      </code>
     </em>
     , and returns a pointer to
      the start of the list in
     <em class="parameter">
      <code>
       res
      </code>
     </em>
     . The items in the linked
      list are linked by the
     <em class="parameter">
      <code>
       ai_next
      </code>
     </em>
     field.
    </p>
    <p>
     There are several reasons why the linked list may have
      more than one
     <span class="structname">
      addrinfo
     </span>
     structure, including: the network host is multihomed,
      accessible over multiple protocols (e.g., both
     <code class="constant">
      AF_INET
     </code>
     and
     <code class="constant">
      AF_INET6
     </code>
     ); or the same service is available
      from multiple socket types (one
     <code class="constant">
      SOCK_STREAM
     </code>
     address and another
     <code class="constant">
      SOCK_DGRAM
     </code>
     address, for
      example). Normally, the application should try using the
      addresses in the order in which they are returned. The
      sorting function used within
     <code class="function">
      getaddrinfo
     </code>
     () is defined in RFC 3484; the
      order can be tweaked for a particular system by editing
     <code class="filename">
      /etc/gai.conf
     </code>
     (available since
      glibc 2.5).
    </p>
    <p>
     If
     <em class="replaceable">
      <code>
       hints.ai_flags
      </code>
     </em>
     includes the
     <code class="constant">
      AI_CANONNAME
     </code>
     flag, then the
     <em class="parameter">
      <code>
       ai_canonname
      </code>
     </em>
     field of
      the first of the
     <span class="structname">
      addrinfo
     </span>
     structures in the returned list is set to point to the
      official name of the host.
    </p>
    <p>
     The remaining fields of each returned
     <span class="structname">
      addrinfo
     </span>
     structure are initialized as
      follows:
    </p>
    <div class="itemizedlist">
     <ul class="itemizedlist" style="list-style-type: disc;">
      <li class="listitem">
       <p>
        The
        <em class="parameter">
         <code>
          ai_family
         </code>
        </em>
        ,
        <em class="parameter">
         <code>
          ai_socktype
         </code>
        </em>
        , and
        <em class="parameter">
         <code>
          ai_protocol
         </code>
        </em>
        fields return the socket creation parameters (i.e.,
            these fields have the same meaning as the corresponding
            arguments of
        <a class="link" href="../htmlman2/socket.2.html" shape="rect" target="_top">
         <span class="citerefentry">
          <span class="refentrytitle">
           socket
          </span>
          (2)
         </span>
        </a>
        ). For
            example,
        <em class="parameter">
         <code>
          ai_family
         </code>
        </em>
        might return
        <code class="constant">
         AF_INET
        </code>
        or
        <code class="constant">
         AF_INET6
        </code>
        ;
        <em class="parameter">
         <code>
          ai_socktype
         </code>
        </em>
        might return
        <code class="constant">
         SOCK_DGRAM
        </code>
        or
        <code class="constant">
         SOCK_STREAM
        </code>
        ; and
        <em class="parameter">
         <code>
          ai_protocol
         </code>
        </em>
        returns the protocol for the socket.
       </p>
      </li>
      <li class="listitem">
       <p>
        A pointer to the socket address is placed in the
        <em class="parameter">
         <code>
          ai_addr
         </code>
        </em>
        field,
            and the length of the socket address, in bytes, is
            placed in the
        <em class="parameter">
         <code>
          ai_addrlen
         </code>
        </em>
        field.
       </p>
      </li>
     </ul>
    </div>
    <p>
     If
     <em class="replaceable">
      <code>
       hints.ai_flags
      </code>
     </em>
     includes the
     <code class="constant">
      AI_ADDRCONFIG
     </code>
     flag, then IPv4
      addresses are returned in the list pointed to by
     <em class="parameter">
      <code>
       res
      </code>
     </em>
     only if the local system
      has at least one IPv4 address configured, and IPv6 addresses
      are returned only if the local system has at least one IPv6
      address configured. The loopback address is not considered
      for this case as valid as a configured address. This flag is
      useful on, for example, IPv4-only systems, to ensure that
     <code class="function">
      getaddrinfo
     </code>
     () does not return
      IPv6 socket addresses that would always fail in
     <a class="link" href="../htmlman2/connect.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        connect
       </span>
       (2)
      </span>
     </a>
     or
     <a class="link" href="../htmlman2/bind.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        bind
       </span>
       (2)
      </span>
     </a>
     .
    </p>
    <p>
     If
     <em class="replaceable">
      <code>
       hints.ai_flags
      </code>
     </em>
     specifies the
     <code class="constant">
      AI_V4MAPPED
     </code>
     flag, and
     <em class="replaceable">
      <code>
       hints.ai_family
      </code>
     </em>
     was
      specified as
     <code class="constant">
      AF_INET6
     </code>
     , and no
      matching IPv6 addresses could be found, then return
      IPv4-mapped IPv6 addresses in the list pointed to by
     <em class="parameter">
      <code>
       res
      </code>
     </em>
     . If both
     <code class="constant">
      AI_V4MAPPED
     </code>
     and
     <code class="constant">
      AI_ALL
     </code>
     are specified in
     <em class="replaceable">
      <code>
       hints.ai_flags
      </code>
     </em>
     , then return
      both IPv6 and IPv4-mapped IPv6 addresses in the list pointed
      to by
     <em class="parameter">
      <code>
       res
      </code>
     </em>
     .
     <code class="constant">
      AI_ALL
     </code>
     is ignored if
     <code class="constant">
      AI_V4MAPPED
     </code>
     is not also
      specified.
    </p>
    <p>
     The
     <code class="function">
      freeaddrinfo
     </code>
     () function
      frees the memory that was allocated for the dynamically
      allocated linked list
     <em class="parameter">
      <code>
       res
      </code>
     </em>
     .
    </p>
    <div class="refsect2">
     <a id="getaddrinfo-3_sect2" name="getaddrinfo-3_sect2" shape="rect">
     </a>
     <h3>
      Extensions to getaddrinfo() for Internationalized
        Domain Names
     </h3>
     <p>
      Starting with glibc 2.3.4,
      <code class="function">
       getaddrinfo
      </code>
      () has been extended to
        selectively allow the incoming and outgoing hostnames to be
        transparently converted to and from the Internationalized
        Domain Name (IDN) format (see RFC 3490,
      <span class="emphasis">
       <em>
        Internationalizing Domain Names in
        Applications (IDNA)
       </em>
      </span>
      ). Four new flags are
        defined:
     </p>
     <div class="variablelist">
      <dl class="variablelist">
       <dt>
        <span class="term">
         <code class="constant">
          AI_IDN
         </code>
        </span>
       </dt>
       <dd>
        <p>
         If this flag is specified, then the node name
              given in
         <em class="parameter">
          <code>
           node
          </code>
         </em>
         is converted to IDN format if necessary. The source
              encoding is that of the current locale.
        </p>
        <p>
         If the input name contains non-ASCII characters,
              then the IDN encoding is used. Those parts of the
              node name (delimited by dots) that contain non-ASCII
              characters are encoded using ASCII Compatible
              Encoding (ACE) before being passed to the name
              resolution functions.
        </p>
       </dd>
       <dt>
        <span class="term">
         <code class="constant">
          AI_CANONIDN
         </code>
        </span>
       </dt>
       <dd>
        <p>
         After a successful name lookup, and if the
         <code class="constant">
          AI_CANONNAME
         </code>
         flag was
              specified,
         <code class="function">
          getaddrinfo
         </code>
         () will return the
              canonical name of the node corresponding to the
         <span class="structname">
          addrinfo
         </span>
         structure
              value passed back. The return value is an exact copy
              of the value returned by the name resolution
              function.
        </p>
        <p>
         If the name is encoded using ACE, then it will
              contain the
         <em class="replaceable">
          <code>
           xn&minus;&minus;
          </code>
         </em>
         prefix for one or more components of the name. To
              convert these components into a readable form the
         <code class="constant">
          AI_CANONIDN
         </code>
         flag can be
              passed in addition to
         <code class="constant">
          AI_CANONNAME
         </code>
         . The resulting string
              is encoded using the current locale's encoding.
        </p>
       </dd>
       <dt>
        <span class="term">
         <code class="constant">
          AI_IDN_ALLOW_UNASSIGNED
         </code>
         ,
         <code class="constant">
          AI_IDN_USE_STD3_ASCII_RULES
         </code>
        </span>
       </dt>
       <dd>
        <p>
         Setting these flags will enable the
              IDNA_ALLOW_UNASSIGNED (allow unassigned Unicode code
              points) and IDNA_USE_STD3_ASCII_RULES (check output
              to make sure it is a STD3 conforming hostname) flags
              respectively to be used in the IDNA handling.
        </p>
       </dd>
      </dl>
     </div>
    </div>
   </div>
   <div class="refsect1">
    <a id="getaddrinfo-3_sect3" name="getaddrinfo-3_sect3" shape="rect">
    </a>
    <h2>
     RETURN VALUE
    </h2>
    <p>
     <code class="function">
      getaddrinfo
     </code>
     () returns 0 if
      it succeeds, or one of the following nonzero error codes:
    </p>
    <div class="variablelist">
     <dl class="variablelist">
      <dt>
       <span class="term">
        <code class="constant">
         EAI_ADDRFAMILY
        </code>
       </span>
      </dt>
      <dd>
       <p>
        The specified network host does not have any network
            addresses in the requested address family.
       </p>
      </dd>
      <dt>
       <span class="term">
        <code class="constant">
         EAI_AGAIN
        </code>
       </span>
      </dt>
      <dd>
       <p>
        The name server returned a temporary failure
            indication. Try again later.
       </p>
      </dd>
      <dt>
       <span class="term">
        <code class="constant">
         EAI_BADFLAGS
        </code>
       </span>
      </dt>
      <dd>
       <p>
        <em class="replaceable">
         <code>
          hints.ai_flags
         </code>
        </em>
        contains
            invalid flags; or,
        <em class="replaceable">
         <code>
          hints.ai_flags
         </code>
        </em>
        included
        <code class="constant">
         AI_CANONNAME
        </code>
        and
        <code class="function">
         name
        </code>
        was NULL.
       </p>
      </dd>
      <dt>
       <span class="term">
        <code class="constant">
         EAI_FAIL
        </code>
       </span>
      </dt>
      <dd>
       <p>
        The name server returned a permanent failure
            indication.
       </p>
      </dd>
      <dt>
       <span class="term">
        <code class="constant">
         EAI_FAMILY
        </code>
       </span>
      </dt>
      <dd>
       <p>
        The requested address family is not supported.
       </p>
      </dd>
      <dt>
       <span class="term">
        <code class="constant">
         EAI_MEMORY
        </code>
       </span>
      </dt>
      <dd>
       <p>
        Out of memory.
       </p>
      </dd>
      <dt>
       <span class="term">
        <code class="constant">
         EAI_NODATA
        </code>
       </span>
      </dt>
      <dd>
       <p>
        The specified network host exists, but does not have
            any network addresses defined.
       </p>
      </dd>
      <dt>
       <span class="term">
        <code class="constant">
         EAI_NONAME
        </code>
       </span>
      </dt>
      <dd>
       <p>
        The
        <em class="parameter">
         <code>
          node
         </code>
        </em>
        or
        <em class="parameter">
         <code>
          service
         </code>
        </em>
        is not
            known; or both
        <em class="parameter">
         <code>
          node
         </code>
        </em>
        and
        <em class="parameter">
         <code>
          service
         </code>
        </em>
        are NULL; or
        <code class="constant">
         AI_NUMERICSERV
        </code>
        was
            specified in
        <em class="replaceable">
         <code>
          hints.ai_flags
         </code>
        </em>
        and
        <em class="parameter">
         <code>
          service
         </code>
        </em>
        was not
            a numeric port-number string.
       </p>
      </dd>
      <dt>
       <span class="term">
        <code class="constant">
         EAI_SERVICE
        </code>
       </span>
      </dt>
      <dd>
       <p>
        The requested service is not available for the
            requested socket type. It may be available through
            another socket type. For example, this error could
            occur if
        <em class="parameter">
         <code>
          service
         </code>
        </em>
        was "shell" (a
            service available only on stream sockets), and either
        <em class="replaceable">
         <code>
          hints.ai_protocol
         </code>
        </em>
        was
        <code class="constant">
         IPPROTO_UDP
        </code>
        , or
        <em class="replaceable">
         <code>
          hints.ai_socktype
         </code>
        </em>
        was
        <code class="constant">
         SOCK_DGRAM
        </code>
        ; or the
            error could occur if
        <em class="parameter">
         <code>
          service
         </code>
        </em>
        was not NULL, and
        <em class="replaceable">
         <code>
          hints.ai_socktype
         </code>
        </em>
        was
        <code class="constant">
         SOCK_RAW
        </code>
        (a socket type
            that does not support the concept of services).
       </p>
      </dd>
      <dt>
       <span class="term">
        <code class="constant">
         EAI_SOCKTYPE
        </code>
       </span>
      </dt>
      <dd>
       <p>
        The requested socket type is not supported. This
            could occur, for example, if
        <em class="replaceable">
         <code>
          hints.ai_socktype
         </code>
        </em>
        and
        <em class="replaceable">
         <code>
          hints.ai_protocol
         </code>
        </em>
        are
            inconsistent (e.g.,
        <code class="constant">
         SOCK_DGRAM
        </code>
        and
        <code class="constant">
         IPPROTO_TCP
        </code>
        , respectively).
       </p>
      </dd>
      <dt>
       <span class="term">
        <code class="constant">
         EAI_SYSTEM
        </code>
       </span>
      </dt>
      <dd>
       <p>
        Other system error, check
        <code class="varname">
         errno
        </code>
        for details.
       </p>
      </dd>
     </dl>
    </div>
    <p>
     The
     <code class="function">
      gai_strerror
     </code>
     () function
      translates these error codes to a human readable string,
      suitable for error reporting.
    </p>
   </div>
   <div class="refsect1">
    <a id="getaddrinfo-3_sect4" name="getaddrinfo-3_sect4" shape="rect">
    </a>
    <h2>
     FILES
    </h2>
    <p>
     <code class="filename">
      /etc/gai.conf
     </code>
    </p>
   </div>
   <div class="refsect1">
    <a id="getaddrinfo-3_sect5" name="getaddrinfo-3_sect5" shape="rect">
    </a>
    <h2>
     CONFORMING TO
    </h2>
    <p>
     POSIX.1-2001. The
     <code class="function">
      getaddrinfo
     </code>
     () function is documented in RFC
      2553.
    </p>
   </div>
   <div class="refsect1">
    <a id="getaddrinfo-3_sect6" name="getaddrinfo-3_sect6" shape="rect">
    </a>
    <h2>
     NOTES
    </h2>
    <p>
     <code class="function">
      getaddrinfo
     </code>
     () supports the
     <code class="function">
      address
     </code>
     %
     <em class="replaceable">
      <code>
       scope-id
      </code>
     </em>
     notation for
      specifying the IPv6 scope-ID.
    </p>
    <p>
     <code class="constant">
      AI_ADDRCONFIG
     </code>
     ,
     <code class="constant">
      AI_ALL
     </code>
     , and
     <code class="constant">
      AI_V4MAPPED
     </code>
     are available since glibc
      2.3.3.
     <code class="constant">
      AI_NUMERICSERV
     </code>
     is
      available since glibc 2.3.4.
    </p>
    <p>
     According to POSIX.1-2001, specifying
     <em class="parameter">
      <code>
       hints
      </code>
     </em>
     as NULL should cause
     <em class="parameter">
      <code>
       ai_flags
      </code>
     </em>
     to be
      assumed as 0. The GNU C library instead assumes a value of
     <code class="function">
      (AI_V4MAPPED\ |\
      AI_ADDRCONFIG)
     </code>
     () for this case, since this value is
      considered an improvement on the specification.
    </p>
   </div>
   <div class="refsect1">
    <a id="getaddrinfo-3_sect7" name="getaddrinfo-3_sect7" shape="rect">
    </a>
    <h2>
     EXAMPLE
    </h2>
    <p>
     The following programs demonstrate the use of
     <code class="function">
      getaddrinfo
     </code>
     (),
     <code class="function">
      gai_strerror
     </code>
     (),
     <code class="function">
      freeaddrinfo
     </code>
     (), and
     <a class="link" href="../htmlman3/getnameinfo.3.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        getnameinfo
       </span>
       (3)
      </span>
     </a>
     . The
      programs are an echo server and client for UDP datagrams.
    </p>
    <div class="refsect2">
     <a id="getaddrinfo-3_sect8" name="getaddrinfo-3_sect8" shape="rect">
     </a>
     <h3>
      Server program
     </h3>
     <div class="informalexample">
      <pre class="programlisting" xml:space="preserve">
#include &lt;sys/types.h&gt;
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;
#include &lt;string.h&gt;
#include &lt;sys/socket.h&gt;
#include &lt;netdb.h&gt;

#define BUF_SIZE 500

int
main(int argc, char *argv[])
{
    struct addrinfo hints;
    struct addrinfo *result, *rp;
    int sfd, s;
    struct sockaddr_storage peer_addr;
    socklen_t peer_addr_len;
    ssize_t nread;
    char buf[BUF_SIZE];

    if (argc != 2) {
        fprintf(stderr, "Usage: %s port\n", argv[0]);
        exit(EXIT_FAILURE);
    }

    memset(&amp;hints, 0, sizeof(struct addrinfo));
    hints.ai_family = AF_UNSPEC;    /* Allow IPv4 or IPv6 */
    hints.ai_socktype = SOCK_DGRAM; /* Datagram socket */
    hints.ai_flags = AI_PASSIVE;    /* For wildcard IP address */
    hints.ai_protocol = 0;          /* Any protocol */
    hints.ai_canonname = NULL;
    hints.ai_addr = NULL;
    hints.ai_next = NULL;

    s = getaddrinfo(NULL, argv[1], &amp;hints, &amp;result);
    if (s != 0) {
        fprintf(stderr, "getaddrinfo: %s\n", gai_strerror(s));
        exit(EXIT_FAILURE);
    }

    /* getaddrinfo() returns a list of address structures.
       Try each address until we successfully bind(2).
       If socket(2) (or bind(2)) fails, we (close the socket
       and) try the next address. */

    for (rp = result; rp != NULL; rp = rp&minus;&gt;ai_next) {
        sfd = socket(rp&minus;&gt;ai_family, rp&minus;&gt;ai_socktype,
                rp&minus;&gt;ai_protocol);
        if (sfd == &minus;1)
            continue;

        if (bind(sfd, rp&minus;&gt;ai_addr, rp&minus;&gt;ai_addrlen) == 0)
            break;                  /* Success */

        close(sfd);
    }

    if (rp == NULL) {               /* No address succeeded */
        fprintf(stderr, "Could not bind\n");
        exit(EXIT_FAILURE);
    }

    freeaddrinfo(result);           /* No longer needed */

    /* Read datagrams and echo them back to sender */

    for (;;) {
        peer_addr_len = sizeof(struct sockaddr_storage);
        nread = recvfrom(sfd, buf, BUF_SIZE, 0,
                (struct sockaddr *) &amp;peer_addr, &amp;peer_addr_len);
        if (nread == &minus;1)
            continue;               /* Ignore failed request */

        char host[NI_MAXHOST], service[NI_MAXSERV];

        s = getnameinfo((struct sockaddr *) &amp;peer_addr,
                        peer_addr_len, host, NI_MAXHOST,
                        service, NI_MAXSERV, NI_NUMERICSERV);
       if (s == 0)
            printf("Received %zd bytes from %s:%s\n",
                    nread, host, service);
        else
            fprintf(stderr, "getnameinfo: %s\n", gai_strerror(s));

        if (sendto(sfd, buf, nread, 0,
                    (struct sockaddr *) &amp;peer_addr,
                    peer_addr_len) != nread)
            fprintf(stderr, "Error sending response\n");
    }
}
</pre>
     </div>
    </div>
    <div class="refsect2">
     <a id="getaddrinfo-3_sect9" name="getaddrinfo-3_sect9" shape="rect">
     </a>
     <h3>
      Client program
     </h3>
     <div class="informalexample">
      <pre class="programlisting" xml:space="preserve">
#include &lt;sys/types.h&gt;
#include &lt;sys/socket.h&gt;
#include &lt;netdb.h&gt;
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;
#include &lt;string.h&gt;

#define BUF_SIZE 500

int
main(int argc, char *argv[])
{
    struct addrinfo hints;
    struct addrinfo *result, *rp;
    int sfd, s, j;
    size_t len;
    ssize_t nread;
    char buf[BUF_SIZE];

    if (argc &lt; 3) {
        fprintf(stderr, "Usage: %s host port msg...\n", argv[0]);
        exit(EXIT_FAILURE);
    }

    /* Obtain address(es) matching host/port */

    memset(&amp;hints, 0, sizeof(struct addrinfo));
    hints.ai_family = AF_UNSPEC;    /* Allow IPv4 or IPv6 */
    hints.ai_socktype = SOCK_DGRAM; /* Datagram socket */
    hints.ai_flags = 0;
    hints.ai_protocol = 0;          /* Any protocol */

    s = getaddrinfo(argv[1], argv[2], &amp;hints, &amp;result);
    if (s != 0) {
        fprintf(stderr, "getaddrinfo: %s\n", gai_strerror(s));
        exit(EXIT_FAILURE);
    }

    /* getaddrinfo() returns a list of address structures.
       Try each address until we successfully connect(2).
       If socket(2) (or connect(2)) fails, we (close the socket
       and) try the next address. */

    for (rp = result; rp != NULL; rp = rp&minus;&gt;ai_next) {
        sfd = socket(rp&minus;&gt;ai_family, rp&minus;&gt;ai_socktype,
                     rp&minus;&gt;ai_protocol);
        if (sfd == &minus;1)
            continue;

        if (connect(sfd, rp&minus;&gt;ai_addr, rp&minus;&gt;ai_addrlen) != &minus;1)
            break;                  /* Success */

        close(sfd);
    }

    if (rp == NULL) {               /* No address succeeded */
        fprintf(stderr, "Could not connect\n");
        exit(EXIT_FAILURE);
    }

    freeaddrinfo(result);           /* No longer needed */

    /* Send remaining command&minus;line arguments as separate
       datagrams, and read responses from server */

    for (j = 3; j &lt; argc; j++) {
        len = strlen(argv[j]) + 1;
                /* +1 for terminating null byte */

        if (len + 1 &gt; BUF_SIZE) {
            fprintf(stderr,
                    "Ignoring long message in argument %d\n", j);
            continue;
        }

        if (write(sfd, argv[j], len) != len) {
            fprintf(stderr, "partial/failed write\n");
            exit(EXIT_FAILURE);
        }

        nread = read(sfd, buf, BUF_SIZE);
        if (nread == &minus;1) {
            perror("read");
            exit(EXIT_FAILURE);
        }

        printf("Received %zd bytes: %s\n", nread, buf);
    }

    exit(EXIT_SUCCESS);
}
</pre>
     </div>
    </div>
   </div>
   <div class="refsect1">
    <a id="getaddrinfo-3_sect10" name="getaddrinfo-3_sect10" shape="rect">
    </a>
    <h2>
     SEE ALSO
    </h2>
    <p>
     <a class="link" href="../htmlman3/getaddrinfo_a.3.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        getaddrinfo_a
       </span>
       (3)
      </span>
     </a>
     ,
     <a class="link" href="../htmlman3/gethostbyname.3.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        gethostbyname
       </span>
       (3)
      </span>
     </a>
     ,
     <a class="link" href="../htmlman3/getnameinfo.3.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        getnameinfo
       </span>
       (3)
      </span>
     </a>
     ,
     <a class="link" href="../htmlman3/inet.3.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        inet
       </span>
       (3)
      </span>
     </a>
     ,
     <a class="link" href="../htmlman5/gai.conf.5.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        gai.conf
       </span>
       (5)
      </span>
     </a>
     ,
     <a class="link" href="../htmlman7/hostname.7.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        hostname
       </span>
       (7)
      </span>
     </a>
     ,
     <a class="link" href="../htmlman7/ip.7.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        ip
       </span>
       (7)
      </span>
     </a>
    </p>
   </div>
   <div class="colophon">
    <a id="getaddrinfo-3_sect11" name="getaddrinfo-3_sect11" shape="rect">
    </a>
    <h2>
     COLOPHON
    </h2>
    <p>
     This page is part of release 3.72 of the Linux
     <em class="replaceable">
      <code>
       man-pages
      </code>
     </em>
     project. A
      description of the project, information about reporting bugs,
      and the latest version of this page, can be found at
      http://www.kernel.org/doc/man&minus;pages/.
    </p>
   </div>
  </div>
 </body>
</html>
