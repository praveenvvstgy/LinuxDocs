<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
  <title>
   lockf(3) &mdash; Linux manual pages
  </title>
  <link href="../stylesheet/manpages.css" rel="stylesheet" type="text/css"/>
  <link href="../index.html" rel="home" title="lockf(3) &mdash; Linux manual pages"/>
  <script src="../stylesheet/manpages.js" type="text/javascript" xml:space="preserve">
  </script>
  <link href="../stylesheet/icon.gif" rel="icon" type="image/gif"/>
 </head>
 <body>
  <div class="refentry">
   <a id="lockf.3" name="lockf.3" shape="rect">
   </a>
   <div class="titlepage">
   </div>
   <div class="refnamediv">
    <h2>
     Name
    </h2>
    <p>
     lockf &mdash; apply, test or remove a POSIX lock on an
      open file
    </p>
   </div>
   <div class="refsynopsisdiv">
    <h2>
     Synopsis
    </h2>
    <div class="funcsynopsis">
     <pre class="funcsynopsisinfo" xml:space="preserve">
#include &lt;unistd.h&gt;
</pre>
     <table border="0" class="funcprototype-table" style="cellspacing: 0; cellpadding: 0;" summary="Function synopsis">
      <tr>
       <td colspan="1" rowspan="1">
        <code class="funcdef">
         int
         <strong>
          lockf
         </strong>
         (
        </code>
       </td>
       <td colspan="1" rowspan="1">
        int
        <var class="pdparam">
         fd
        </var>
        ,
       </td>
      </tr>
      <tr>
       <td colspan="1" rowspan="1">
        &nbsp;
       </td>
       <td colspan="1" rowspan="1">
        int
        <var class="pdparam">
         cmd
        </var>
        ,
       </td>
      </tr>
      <tr>
       <td colspan="1" rowspan="1">
        &nbsp;
       </td>
       <td colspan="1" rowspan="1">
        off_t
        <var class="pdparam">
         len
        </var>
        <code>
         )
        </code>
        ;
       </td>
      </tr>
     </table>
     <div class="funcprototype-spacer">
      &nbsp;
     </div>
    </div>
    <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tr>
       <td align="center" colspan="1" rowspan="2" valign="top" width="25">
        <img alt="[Note]" src="../stylesheet/note.png"/>
       </td>
       <th align="left" colspan="1" rowspan="1">
        Note
       </th>
      </tr>
      <tr>
       <td align="left" colspan="1" rowspan="1" valign="top">
        <div class="featuretests">
         <table style="border-collapse: collapse;">
          <colgroup span="1">
           <col span="1">
           </col>
          </colgroup>
          <thead>
           <tr>
            <th colspan="1" rowspan="1" style="">
             Feature Test Macro Requirements
                      for glibc (see
             <a class="link" href="../htmlman7/feature_test_macros.7.html" shape="rect" target="_top">
              <span class="citerefentry">
               <span class="refentrytitle">
                feature_test_macros
               </span>
               (7)
              </span>
             </a>
             ):
            </th>
           </tr>
          </thead>
          <tbody>
           <tr>
            <td colspan="1" rowspan="1" style="">
             <code class="function">
              lockf
             </code>
             ():
            </td>
           </tr>
           <tr>
            <td class="featuretestdef" colspan="1" rowspan="1" style="">
             <code class="constant">
              _BSD_SOURCE
             </code>
             ||
             <code class="constant">
              _SVID_SOURCE
             </code>
             ||
             <code class="constant">
              _XOPEN_SOURCE
             </code>
             &gt;= 500 ||
             <code class="constant">
              _XOPEN_SOURCE
             </code>
             &amp;&amp;
             <code class="constant">
              _XOPEN_SOURCE_EXTENDED
             </code>
            </td>
           </tr>
          </tbody>
         </table>
        </div>
       </td>
      </tr>
     </table>
    </div>
   </div>
   <div class="refsect1">
    <a id="lockf-3_sect1" name="lockf-3_sect1" shape="rect">
    </a>
    <h2>
     DESCRIPTION
    </h2>
    <p>
     Apply, test or remove a POSIX lock on a section of an open
      file. The file is specified by
     <em class="parameter">
      <code>
       fd
      </code>
     </em>
     , a file descriptor open for
      writing, the action by
     <em class="parameter">
      <code>
       cmd
      </code>
     </em>
     , and the section consists
      of byte positions
     <em class="parameter">
      <code>
       pos
      </code>
     </em>
     ..
     <em class="parameter">
      <code>
       pos
      </code>
     </em>
     +
     <em class="parameter">
      <code>
       len
      </code>
     </em>
     &minus;1 if
     <em class="parameter">
      <code>
       len
      </code>
     </em>
     is positive, and
     <em class="parameter">
      <code>
       pos
      </code>
     </em>
     &minus;
     <em class="parameter">
      <code>
       len
      </code>
     </em>
     ..
     <em class="parameter">
      <code>
       pos
      </code>
     </em>
     &minus;1 if
     <em class="parameter">
      <code>
       len
      </code>
     </em>
     is negative, where
     <em class="parameter">
      <code>
       pos
      </code>
     </em>
     is the current
      file position, and if
     <em class="parameter">
      <code>
       len
      </code>
     </em>
     is zero, the section
      extends from the current file position to infinity,
      encompassing the present and future end-of-file positions. In
      all cases, the section may extend past current
      end-of-file.
    </p>
    <p>
     On Linux,
     <code class="function">
      lockf
     </code>
     () is just an
      interface on top of
     <a class="link" href="../htmlman2/fcntl.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        fcntl
       </span>
       (2)
      </span>
     </a>
     locking. Many
      other systems implement
     <code class="function">
      lockf
     </code>
     ()
      in this way, but note that POSIX.1-2001 leaves the
      relationship between
     <code class="function">
      lockf
     </code>
     ()
      and
     <a class="link" href="../htmlman2/fcntl.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        fcntl
       </span>
       (2)
      </span>
     </a>
     locks unspecified.
      A portable application should probably avoid mixing calls to
      these interfaces.
    </p>
    <p>
     Valid operations are given below:
    </p>
    <div class="variablelist">
     <dl class="variablelist">
      <dt>
       <span class="term">
        <code class="constant">
         F_LOCK
        </code>
       </span>
      </dt>
      <dd>
       <p>
        Set an exclusive lock on the specified section of
            the file. If (part of) this section is already locked,
            the call blocks until the previous lock is released. If
            this section overlaps an earlier locked section, both
            are merged. File locks are released as soon as the
            process holding the locks closes some file descriptor
            for the file. A child process does not inherit these
            locks.
       </p>
      </dd>
      <dt>
       <span class="term">
        <code class="constant">
         F_TLOCK
        </code>
       </span>
      </dt>
      <dd>
       <p>
        Same as
        <code class="constant">
         F_LOCK
        </code>
        but the
            call never blocks and returns an error instead if the
            file is already locked.
       </p>
      </dd>
      <dt>
       <span class="term">
        <code class="constant">
         F_ULOCK
        </code>
       </span>
      </dt>
      <dd>
       <p>
        Unlock the indicated section of the file. This may
            cause a locked section to be split into two locked
            sections.
       </p>
      </dd>
      <dt>
       <span class="term">
        <code class="constant">
         F_TEST
        </code>
       </span>
      </dt>
      <dd>
       <p>
        Test the lock: return 0 if the specified section is
            unlocked or locked by this process; return &minus;1,
            set
        <code class="varname">
         errno
        </code>
        to
        <span class="errorname">
         EAGAIN
        </span>
        (
        <span class="errorname">
         EACCES
        </span>
        on some other systems), if
            another process holds a lock.
       </p>
      </dd>
     </dl>
    </div>
   </div>
   <div class="refsect1">
    <a id="lockf-3_sect2" name="lockf-3_sect2" shape="rect">
    </a>
    <h2>
     RETURN VALUE
    </h2>
    <p>
     On success, zero is returned. On error, &minus;1 is
      returned, and
     <code class="varname">
      errno
     </code>
     is set
      appropriately.
    </p>
   </div>
   <div class="refsect1">
    <a id="lockf-3_sect3" name="lockf-3_sect3" shape="rect">
    </a>
    <h2>
     ERRORS
    </h2>
    <div class="variablelist">
     <dl class="variablelist">
      <dt>
       <span class="term">
        <span class="errorname">
         EACCES
        </span>
        or
        <span class="errorname">
         EAGAIN
        </span>
       </span>
      </dt>
      <dd>
       <p>
        The file is locked and
        <code class="constant">
         F_TLOCK
        </code>
        or
        <code class="constant">
         F_TEST
        </code>
        was specified, or the
            operation is prohibited because the file has been
            memory-mapped by another process.
       </p>
      </dd>
      <dt>
       <span class="term">
        <span class="errorname">
         EBADF
        </span>
       </span>
      </dt>
      <dd>
       <p>
        <em class="parameter">
         <code>
          fd
         </code>
        </em>
        is not an
            open file descriptor; or
        <em class="parameter">
         <code>
          cmd
         </code>
        </em>
        is
        <code class="constant">
         F_LOCK
        </code>
        or
        <code class="constant">
         F_TLOCK
        </code>
        and
        <em class="parameter">
         <code>
          fd
         </code>
        </em>
        is not a writable file
            descriptor.
       </p>
      </dd>
      <dt>
       <span class="term">
        <span class="errorname">
         EDEADLK
        </span>
       </span>
      </dt>
      <dd>
       <p>
        The command was
        <code class="constant">
         F_LOCK
        </code>
        and this lock operation would cause a deadlock.
       </p>
      </dd>
      <dt>
       <span class="term">
        <span class="errorname">
         EINVAL
        </span>
       </span>
      </dt>
      <dd>
       <p>
        An invalid operation was specified in
        <em class="parameter">
         <code>
          cmd
         </code>
        </em>
        .
       </p>
      </dd>
      <dt>
       <span class="term">
        <span class="errorname">
         ENOLCK
        </span>
       </span>
      </dt>
      <dd>
       <p>
        Too many segment locks open, lock table is full.
       </p>
      </dd>
     </dl>
    </div>
   </div>
   <div class="refsect1">
    <a id="lockf-3_sect4" name="lockf-3_sect4" shape="rect">
    </a>
    <h2>
     ATTRIBUTES
    </h2>
    <div class="refsect2">
     <a id="lockf-3_sect5" name="lockf-3_sect5" shape="rect">
     </a>
     <h3>
      Multithreading (see pthreads(7))
     </h3>
     <p>
      The
      <code class="function">
       lockf
      </code>
      () function is
        thread-safe.
     </p>
    </div>
   </div>
   <div class="refsect1">
    <a id="lockf-3_sect6" name="lockf-3_sect6" shape="rect">
    </a>
    <h2>
     CONFORMING TO
    </h2>
    <p>
     SVr4, POSIX.1-2001.
    </p>
   </div>
   <div class="refsect1">
    <a id="lockf-3_sect7" name="lockf-3_sect7" shape="rect">
    </a>
    <h2>
     SEE ALSO
    </h2>
    <p>
     <a class="link" href="../htmlman2/fcntl.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        fcntl
       </span>
       (2)
      </span>
     </a>
     ,
     <a class="link" href="../htmlman2/flock.2.html" shape="rect" target="_top">
      <span class="citerefentry">
       <span class="refentrytitle">
        flock
       </span>
       (2)
      </span>
     </a>
    </p>
    <p>
     <em class="replaceable">
      <code>
       locks.txt
      </code>
     </em>
     and
     <em class="replaceable">
      <code>
       mandatory-locking.txt
      </code>
     </em>
     in the
      Linux kernel source directory
     <code class="filename">
      Documentation/filesystems
     </code>
     (on older
      kernels, these files are directly under the
     <code class="function">
      Documentation
     </code>
     directory, and
     <em class="replaceable">
      <code>
       mandatory-locking.txt
      </code>
     </em>
     is
      called
     <em class="replaceable">
      <code>
       mandatory.txt
      </code>
     </em>
     )
    </p>
   </div>
   <div class="colophon">
    <a id="lockf-3_sect8" name="lockf-3_sect8" shape="rect">
    </a>
    <h2>
     COLOPHON
    </h2>
    <p>
     This page is part of release 3.72 of the Linux
     <em class="replaceable">
      <code>
       man-pages
      </code>
     </em>
     project. A
      description of the project, information about reporting bugs,
      and the latest version of this page, can be found at
      http://www.kernel.org/doc/man&minus;pages/.
    </p>
   </div>
  </div>
 </body>
</html>
